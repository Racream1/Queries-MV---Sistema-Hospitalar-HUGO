---------------------------------------------------------------------------
-- CURSOR cProcesso_00053
---------------------------------------------------------------------------
CURSOR cProcesso_00053(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE DE ENTRADAS NA URGÊNCIA: '||Movimento.Qtde_Conforme ||', QTDE DE PROJETADA NA URGÊNCIA: '||Movimento.Qtde_Projetada ||', QTDE DE ENTRADAS NA URGÊNCIA NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Projetada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Entradas Qtde_Conforme , Mov.Qtde_Entradas_Dia Qtde_Conforme_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Count(1) Qtde_Entradas , Sum(Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Entradas_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' And Ate.Dh_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00077
---------------------------------------------------------------------------
CURSOR cProcesso_00077(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE DE LEITOS OPERACIONAL: '||Trunc(Sum(Movimento.Qtde_Leitos),2)||Chr(10) ||', QTDE DE SAÍDAS ATUAL: '||Trunc(Sum(Movimento.Qtde_Saidas),2)||Chr(10) ||', GIRO DE LEITO ATUAL: '||Trunc(Avg(Movimento.Vl_Renovacao_Leito),2)||Chr(10) ||', QTDE DE LEITOS OPERACIONAL NO DIA: '||Trunc(Sum(Movimento.Qtde_Leitos_Dia),2)||Chr(10) ||', QTDE DE SAÍDAS NO DIA: '||Trunc(Sum(Movimento.Qtde_Saidas_Dia),2)||Chr(10) ||', GIRO DE LEITO DO DIA: '||Trunc(Avg(Movimento.Vl_Renovacao_Leito_Dia),2) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Renovacao_Leito),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Renovacao_Leito_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Leitos , Mov.Qtde_Saidas , Mov.Qtde_Leitos_Dia , Mov.Qtde_Saidas_Dia , (Case
WHEN Mov.Qtde_Leitos = 0
THEN 0
ELSE Round(Mov.Qtde_Saidas/Mov.Qtde_Leitos,2)
END ) Vl_Renovacao_Leito , (Case
WHEN Mov.Qtde_Leitos_Dia = 0
THEN 0
ELSE Round(Mov.Qtde_Saidas_Dia/Mov.Qtde_Leitos_Dia,2)
END ) Vl_Renovacao_Leito_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Leitos , Mov.Qtde_Saidas , Mov.Qtde_Leitos_Dia , Mov.Qtde_Saidas_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0)/To_Number(To_Char(v_Dt_Atual_Diagno,'DD')) Qtde_Leitos , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Leitos_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Saidas , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Saidas_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00079
---------------------------------------------------------------------------
CURSOR cProcesso_00079(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Convenio.Cd_Tipo_Convenio Cd_Departamento , Tipo_Convenio.Ds_Tipo_Convenio Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Convenio.Ds_Tipo_Convenio||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Tipo_Convenio , Mov.Dt_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Dt_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'H'
THEN 2
WHEN Con.Tp_Convenio = 'A'
THEN 3
WHEN Con.Tp_Convenio = 'P'
THEN 4
END ) Cd_Tipo_Convenio , To_Char(Avi.Dt_Realizacao,'MM/YYYY') dt_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Dt_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tipo_Convenio, 'CONVENIO' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 2 Cd_Tipo_Convenio, 'SUS-AIH' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 3 Cd_Tipo_Convenio, 'SUS-SIA' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 4 Cd_Tipo_Convenio, 'PARTICULAR' Ds_Tipo_Convenio
FROM Dual ) Tipo_Convenio , MvccAdmin.Estabelecimento
WHERE Tipo_Convenio.Cd_Tipo_Convenio = Movimento.Cd_Tipo_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Tipo_Convenio.Cd_Tipo_Convenio , Tipo_Convenio.Ds_Tipo_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00081
---------------------------------------------------------------------------
CURSOR cProcesso_00081(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO CONV.: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+ Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Setor = Dme.Cd_Setor) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Setor.Cd_Setor In ( SELECT Sal.Cd_Setor
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Setor = Setor.Cd_Setor) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00082
---------------------------------------------------------------------------
CURSOR cProcesso_00082(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO CONV. UTIs: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0))+Sum(Nvl(Dme.vl_pro_total_particul_interno,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Setor = Dme.Cd_Setor And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00083
---------------------------------------------------------------------------
CURSOR cProcesso_00083(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL SUS'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00084
---------------------------------------------------------------------------
CURSOR cProcesso_00084(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUZIDO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Produzido , Mov.Valor_Projetado
FROM ( SELECT Mov.Cd_Setor_Produziu , Sum(Mov.Valor_Produzido) Valor_Produzido , Nvl(MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno),0) Valor_Projetado
FROM (---VALORES--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+ Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Set_Exa Str
WHERE Str.Cd_Setor = Dme.Cd_Setor) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Setor.Cd_Setor , Setor.Nm_Setor , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00085
---------------------------------------------------------------------------
CURSOR cProcesso_00085(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO CONV., VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES INTERNADOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Tip_Acom.Tp_Acomodacao = 'U') And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Tip_Acom.Cd_Tip_Acom = Leito.Cd_Tip_Acom And Tip_Acom.Tp_Acomodacao = 'U' And Unid_Int.Cd_Setor = Setor.Cd_setor) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00086
---------------------------------------------------------------------------
CURSOR cProcesso_00086(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Bancada.Cd_Bancada Cd_Departamento , Bancada.Ds_Bancada Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Bancada.Ds_Bancada||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--UTILIZACAO DOS EXAMES LABORATORIAIS-- SELECT Mov.Cd_Bancada , Mov.Dt_Mes , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Exa_Lab_Set_Exa.Cd_Bancada , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Dt_Mes , Count(1) Qtde_Utilizada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , Sum(Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Ped_lab Ped , Dbamv.ItPed_Lab , Dbamv.Exa_Lab_Set_Exa
WHERE Ped.Cd_Ped_Lab = ItPed_Lab.Cd_Ped_Lab And ItPed_Lab.Cd_Exa_Lab = Exa_Lab_Set_Exa.Cd_Exa_Lab And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ped.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Exa_Lab_Set_Exa.Cd_Bancada , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Bancada , MvccAdmin.Estabelecimento
WHERE Bancada.Cd_Bancada = Movimento.Cd_Bancada And Exists ( SELECT 1
FROM Dbamv.Set_Exa, Dbamv.Setor
WHERE Bancada.Cd_Set_Exa = Set_Exa.Cd_Set_Exa And Set_Exa.Cd_Setor = Setor.Cd_Setor AND Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa) AND Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Bancada.Cd_Bancada , Bancada.Ds_Bancada , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00087
---------------------------------------------------------------------------
CURSOR cProcesso_00087(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00088
---------------------------------------------------------------------------
CURSOR cProcesso_00088(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Set_Exa.Cd_Set_Exa Cd_Departamento , Set_Exa.Nm_Set_Exa Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Null nm_processo , Set_Exa.Nm_Set_Exa||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', TAXA: '||Avg(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--UTILIZACAO DOS EXAMES DE DIAGNOSTICO POR IMAGEM-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Set_Exa , Mov.Dt_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada_Dia,0) Qtde_Projetada_Dia , Nvl(Mov.Qtde_Projetada,0)-Nvl(Mov.Qtde_Utilizada,0) qtde_naoconforme , Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Projetada,0))*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Ped.Cd_Multi_Empresa , Ped.Cd_Set_Exa , To_Char(Ped.Dt_Pedido,'MM/YYYY') Dt_Mes , Ped.Qtde_Utilizada , Ped.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Ped.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Ped.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Atual_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Setor.Cd_Multi_Empresa , Set_Exa.Cd_Set_Exa , Ped_Rx.Dt_Pedido , To_Char(Ped_Rx.Dt_Pedido,'MM/YYYY') Dt_Mes , ( SELECT Count(1)
FROM Dbamv.ItPed_Rx
WHERE Ped_Rx.Cd_Ped_Rx = ItPed_Rx.Cd_Ped_Rx) Qtde_Utilizada , (Case
WHEN Ped_Rx.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN ( SELECT Count(1)
    FROM Dbamv.ItPed_Rx
    WHERE Ped_Rx.Cd_Ped_Rx = ItPed_Rx.Cd_Ped_Rx)
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Ped_Rx , Dbamv.Set_Exa , Dbamv.Setor
WHERE Ped_Rx.Cd_Set_Exa = Set_Exa.Cd_Set_Exa And Set_Exa.Cd_Setor = Setor.Cd_Setor And Set_Exa.Tp_Setor = 'R' AND Set_Exa.Sn_Ativo = 'S' And Ped_Rx.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Setor.Cd_Multi_Empresa , Set_Exa.Cd_Set_Exa , Ped_Rx.Cd_Ped_Rx , Ped_Rx.Dt_Pedido , To_Char(Ped_Rx.Dt_Pedido,'MM/YYYY') ) Ped ) Mov ) Movimento , Dbamv.Set_Exa , MvccAdmin.Estabelecimento
WHERE Set_Exa.Cd_Set_Exa = Movimento.Cd_Set_Exa And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Set_Exa.Cd_Setor = Setor.Cd_Setor AND Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa) AND Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Set_Exa.Tp_Setor = 'R' AND Set_Exa.Sn_Ativo = 'S'
GROUP BY Set_Exa.Cd_Set_Exa , Set_Exa.Nm_Set_Exa , Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00089
---------------------------------------------------------------------------
CURSOR cProcesso_00089(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Sal_Cir.Cd_Sal_Cir Cd_Departamento , Sal_Cir.Ds_Sal_Cir Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null Nm_Processo , Sal_Cir.Ds_Sal_Cir||', QTDE HORAS REALIZADA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE HORAS REALIZADA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE HORAS PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--UTILIZACAO DAS SALAS CIRURGICAS-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Sal_Cir , Mov.Data_Mes , Nvl(Sum(Mov.Qtde_Utilizada),0) Qtde_Utilizada , Nvl(Sum(Mov.Qtde_Utilizada_Dia),0) Qtde_Utilizada_Dia , Nvl(Sum(Mov.Qtde_Projetada),0) Qtde_Projetada , Case
WHEN Nvl(Sum(Mov.Qtde_Projetada),0) = 0
THEN 0
ELSE Round((Nvl(Sum(Mov.Qtde_Utilizada),0)/Nvl(Sum(Mov.Qtde_Projetada),0))*100,2)
END Vl_Taxa_Conforme
FROM (--NUMERO DE PACIENTES DIA PO SETOR-- SELECT Aviso_Cirurgia.Cd_Multi_Empresa , Aviso_Cirurgia.Cd_Sal_Cir , To_Char(Aviso_Cirurgia.Dt_Realizacao,'MM/YYYY') Data_Mes , Trunc(Round((Aviso_Cirurgia.dt_saida_sal_cir-Aviso_Cirurgia.dt_realizacao)*24,2)) Qtde_Utilizada , (Case
WHEN Aviso_Cirurgia.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Trunc(Round((Aviso_Cirurgia.dt_saida_sal_cir-Aviso_Cirurgia.dt_realizacao)*24,2))
ELSE 0
END ) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Trunc(Round((Aviso_Cirurgia.dt_saida_sal_cir-Aviso_Cirurgia.dt_realizacao)*24,2)),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM Dbamv.Aviso_Cirurgia , Dbamv.Sal_Cir
WHERE Aviso_Cirurgia.Cd_Sal_Cir = Sal_Cir.Cd_Sal_Cir And Aviso_Cirurgia.Tp_Situacao = 'R' And Aviso_Cirurgia.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Aviso_Cirurgia.Cd_multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Setor.Cd_Setor = Sal_Cir.Cd_Setor And Setor.Sn_Ativo = 'S' And Setor.Cd_multi_Empresa = Aviso_Cirurgia.Cd_multi_Empresa And Setor.Sn_Ativo = 'S' ) ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Sal_Cir , Mov.Data_Mes ) Movimento , Dbamv.Sal_Cir , MvccAdmin.Estabelecimento
WHERE Sal_Cir.Cd_Sal_Cir = Movimento.Cd_Sal_Cir(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Setor.Sn_Ativo = 'S' And Setor.Cd_Setor = Sal_Cir.Cd_Setor And Setor.Sn_Ativo = 'S' And Setor.Cd_multi_Empresa = Estabelecimento.Cd_Multi_Empresa)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Sal_Cir.Cd_Sal_Cir , Sal_Cir.Ds_Sal_Cir , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00090
---------------------------------------------------------------------------
CURSOR cProcesso_00090(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR FATURADO CONV. DOS SADTs: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (--VALORES INTERNADOS--- SELECT Itr.Cd_Setor_Produziu, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat AND Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES FAT. INTERNOS-- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Itr.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES FAT. INTERNOS-- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA--- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Itr.Cd_Setor_produziu in ( SELECT Set_Exa.Cd_Setor
FROM Dbamv.Set_Exa
WHERE Set_Exa.Sn_Ativo = 'S') ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Setor.Cd_Setor And Set_Exa.Sn_Ativo = 'S') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00091
---------------------------------------------------------------------------
CURSOR cProcesso_00091(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR FATURADO CONV. GLOBAL' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR FATURADO CONV. GLOBAL: R$ '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR PROJETADO: R$ '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA DIFERÊNÇA PROJEÇÃO: R$ '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0))-Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES INTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat AND Reg.Sn_Fechada = 'S' And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa --- TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Reg.Sn_Fechada = 'S' And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa --- TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Itr.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Itr.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA--- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Itr.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA--- And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00092
---------------------------------------------------------------------------
CURSOR cProcesso_00092(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR REALIZADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'CON_PAG' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Desp_Pessoal_Mes Vl_Desp_Pessoal_Mes , Mov.Vl_Desp_Pessoal_Mes/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Dia , Mov.Vl_Desp_Pessoal_Media , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Desp_Pessoal_Mes_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Proj_Dia
FROM ( SELECT Setor.Cd_Setor , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes, Dme.Cd_Setor ) Dme
WHERE Dme.Cd_Setor = Setor.Cd_Setor ),0) Vl_Desp_Pessoal_Mes , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes, Dme.Cd_Setor ) Dme
WHERE Dme.Cd_Setor = Setor.Cd_Setor ),0) Vl_Desp_Pessoal_Media
FROM Dbamv.Setor
WHERE Exists ( SELECT 1
FROM Dbamv.Sal_Cir
WHERE Sal_Cir.Cd_Setor = Setor.Cd_Setor) And Setor.Cd_Multi_empresa = pCdMultiEmpresa ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Aceita_Lancamento = 'S' And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Sal_Cir
WHERE Sal_Cir.Cd_Setor = Setor.Cd_Setor)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Setor.Cd_Setor , Setor.Nm_Setor , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00093
---------------------------------------------------------------------------
CURSOR cProcesso_00093(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR REALIZADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Desp_Pessoal_Mes) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Desp_Pessoal_Mes Vl_Desp_Pessoal_Mes , Mov.Vl_Desp_Pessoal_Mes/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Dia , Mov.Vl_Desp_Pessoal_Media , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Desp_Pessoal_Mes_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Proj_Dia
FROM ( SELECT Setor.Cd_Setor , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes, Dme.Cd_Setor ) Dme ),0) Vl_Desp_Pessoal_Mes , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes, Dme.Cd_Setor ) Dme
WHERE Dme.Cd_Setor = Setor.Cd_Setor ),0) Vl_Desp_Pessoal_Media
FROM Dbamv.Setor --- IDENTIFICA O CENTRO DE CUSTO USADO PARA PAGAMENTO---
WHERE Setor.Cd_Multi_empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Und.Cd_Setor = Setor.Cd_Setor And Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U') ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Aceita_Lancamento = 'S' And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Tip_Acom.Tp_acomodacao = 'U' And Unid_Int.Cd_Setor = Setor.Cd_Setor)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.NM_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00094
---------------------------------------------------------------------------
CURSOR cProcesso_00094(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UNID.GERAL CONV.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UNID.GERAL CONV.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%' ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00095
---------------------------------------------------------------------------
CURSOR cProcesso_00095(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR REALIZADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'CON_PAG' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Desp_Pessoal_Mes Vl_Desp_Pessoal_Mes , Mov.Vl_Desp_Pessoal_Mes/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Dia , Mov.Vl_Desp_Pessoal_Media , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Desp_Pessoal_Mes_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Proj_Dia
FROM ( SELECT Setor.Cd_Setor , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Cd_Setor , Dme.Dt_Mes ) Dme
WHERE Dme.Cd_Setor = Setor.Cd_Setor ),0) Vl_Desp_Pessoal_Mes , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Cd_Setor , Dme.Dt_Mes ) Dme
WHERE Dme.Cd_Setor = Setor.Cd_Setor ),0) Vl_Desp_Pessoal_Media
FROM Dbamv.Setor
WHERE Setor.Cd_multi_Empresa = pCdMultiEmpresa --- SETORES DE EXAMES--- And Exists ( SELECT 1
FROM Dbamv.Set_Exa Ste
WHERE Ste.cd_setor = Setor.cd_setor) ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Aceita_Lancamento = 'S' And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Setor.Cd_Setor And Set_Exa.Sn_Ativo = 'S')
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Setor.Cd_Setor , Setor.Nm_Setor , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00107
---------------------------------------------------------------------------
CURSOR cProcesso_00107(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UNID.GERAL PART..' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UNID.GERAL´PART., QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA'||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00111
---------------------------------------------------------------------------
CURSOR cProcesso_00111(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PACIENTES ACAMADOS: '||Sum(Movimento.Qtde_Pacientes)||Chr(10) ||', QTDE PROFISSIONAIS TRABALHANDO: '||Sum(Movimento.Qtde_Recursos_Atendendo)||Chr(10) ||', QTDE RECURSOS PREVISTOS (POR PACIENTE): '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Perc_Utilizacao,0))||'%'||Chr(10) ||', FATOR DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Fator_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Recursos_Previsto , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Unid_Int,pNrCnpj,'SLA'),4)) Qtde_Recursos_Previsto
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int , Count(Distinct Ate.Cd_Atendimento) Qtde_Pacientes , Count(Distinct Doc.Cd_Prestador) Qtde_Recursos_Atendendo
FROM MvccAdmin.Fato_Atendime_Internado Ate , MvccAdmin.Fato_Documento_Clinico Doc
WHERE Doc.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Doc.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Prestador Ptd, MvccAdmin.V_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ptd.Cd_Tip_Presta) And Ptd.Cd_Prestador = Doc.Cd_Prestador And Vcc.Cd_Tipo_Campo_Chave = 194 --TIPO DE PRESTADOR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.cd_multi_empresa = pCdMvccEmpresa) And Doc.dh_referencia Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00112
---------------------------------------------------------------------------
CURSOR cProcesso_00112(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Estoque.Cd_Estoque Cd_Departamento , Estoque.Ds_Estoque Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , Estoque.Ds_Estoque||', QTDE PEDIDOS: '||Sum(Nvl(Movimento.Qtde_Pedidos,0))||Chr(10) ||', QTDE TÉCNICOS TRABALHANDO: '||Sum(Nvl(Movimento.Qtde_Recursos_Atendendo,0))||Chr(10) ||', QTDE TÉCNICOS PREVISTOS: '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO DO TÉCNICO: '||Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Estoque , Mov.Qtde_Recursos_Previsto , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Pedidos , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pedidos,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pedidos,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pedidos,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pedidos,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Estoque , Mov.Qtde_Pedidos , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Estoque,pNrCnpj,'SLA'),20)) Qtde_Recursos_Previsto
FROM ( SELECT Est.Cd_Multi_Empresa , Est.Cd_Estoque , ( SELECT Count(Distinct Mvt.Cd_Solsai_Pro)
FROM Dbamv.Mvto_Estoque Mvt
WHERE Mvt.cd_estoque = Est.Cd_Estoque And Mvt.dt_mvto_estoque Between Trunc(Sysdate) And Sysdate And Mvt.cd_multi_empresa = pCdMultiEmpresa ) Qtde_Pedidos , ( SELECT Count(Distinct Mvt.Cd_Usuario)
FROM Dbamv.Mvto_Estoque Mvt
WHERE Mvt.cd_estoque = Est.Cd_Estoque And Mvt.dt_mvto_estoque Between Trunc(Sysdate) And Sysdate And Mvt.cd_multi_empresa = pCdMultiEmpresa ) Qtde_Recursos_Atendendo
FROM Dbamv.Estoque Est
WHERE InStr(Est.Tp_Estoque,'D') > 0 And Est.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Est.Cd_Multi_Empresa , Est.Cd_Estoque ) Mov
WHERE Mov.Qtde_Pedidos > 0 ) Mov ) Movimento , Dbamv.Estoque , MvccAdmin.Estabelecimento
WHERE Estoque.Cd_Estoque = Movimento.Cd_Estoque And Estoque.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Estoque.Cd_Estoque , Estoque.Ds_Estoque , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00122
---------------------------------------------------------------------------
CURSOR cProcesso_00122(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tip_Categoria.Cd_Tip_Categoria Cd_Departamento , Tip_Categoria.Ds_Tip_Categoria Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tip_Categoria.Ds_Tip_Categoria||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO URGENCIA--- SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Tip_Categoria , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Tip_Categoria , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'P'
THEN 1
WHEN Con.Tp_Convenio = 'A'
THEN 2
END Cd_Tip_Categoria , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Dt_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Convenio Con
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Tp_Atendimento = 'U' And ((Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 67 /*Origem considerada*/ And Vcc.Nr_Cnpj = pNrCnpj) And Ate.Cd_Ori_Ate IN ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 67 /*Origem considerada*/ And Vcc.Nr_Cnpj = pNrCnpj)) Or Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 67 /*Origem considerada*/ And Vcc.Nr_Cnpj = pNrCnpj)) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Tip_Categoria , Mov.Dt_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tip_Categoria, 'CONVENIO/PARTICULAR' Ds_Tip_Categoria
FROM Dual
UNION ALL SELECT 2 Cd_Tip_Categoria, 'SIA SUS' Ds_Tip_Categoria
FROM Dual ) Tip_Categoria , MvccAdmin.Estabelecimento
WHERE Tip_Categoria.Cd_Tip_Categoria = Movimento.Cd_Tip_Categoria And Exists ( SELECT 1
FROM Dbamv.Convenio , Dbamv.Empresa_Convenio
WHERE Convenio.Cd_Convenio = Empresa_Convenio.Cd_Convenio AND Empresa_Convenio.sn_ativo = 'S' And Empresa_Convenio.cd_multi_empresa = Estabelecimento.Cd_Multi_Empresa And Decode(Convenio.Tp_Convenio,'C',1,'P',1,'A',2) = Tip_Categoria.Cd_Tip_Categoria ) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Tip_Categoria.Cd_Tip_Categoria , Tip_Categoria.Ds_Tip_Categoria , Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00124
---------------------------------------------------------------------------
CURSOR cProcesso_00124(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', TICKET MEDIO CONV. INTERNO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Round(Avg(Mov.Vl_Total_Conta),2) Vl_Ticket_Medio
FROM ( --VALOR MEDIO DAS CONTAS POR CONVENIO-- SELECT Reg.Cd_multi_Empresa , Reg.Cd_Convenio , Reg.Cd_Reg_Fat , To_Char(Reg.Dt_Final,'MM/YYYY') Data_Mes , ( SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Fat Itr
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat) Vl_Total_Conta
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Convenio.Cd_Convenio , Convenio.Nm_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00125
---------------------------------------------------------------------------
CURSOR cProcesso_00125(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS --########################################################################################## --125) TICKET MEDIO CONV. EXTERNO --########################################################################################## SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', TICKET MEDIO CONV. EXTERNO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Cd_Convenio , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , Ate.Cd_Ori_Ate , Ate.Cd_Atendimento , Ate.Dh_Atendimento , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , ( SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Amb Itr
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Atendimento = Ate.Cd_Atendimento And Itr.Cd_Convenio = Ate.Cd_Convenio And Not Exists ( SELECT 1
FROM Dbamv.Con_Rec, Dbamv.Itcon_Rec
WHERE Con_Rec.Cd_Con_Rec = Itcon_Rec.Cd_Con_Rec And Con_Rec.Cd_Reg_Amb = Itr.Cd_Reg_amb And Con_Rec.Tp_Quitacao <> 'L' And Nvl(Con_Rec.Tp_Quitacao,'X') In ('X','P','C') ) --Recebimento Pendente ) Vl_Total_Conta
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio = 'C') And Ate.tp_atendimento IN ('A','E') And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Cd_Convenio , Cta.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Convenio.Cd_Convenio , Convenio.Nm_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00126
---------------------------------------------------------------------------
CURSOR cProcesso_00126(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NULL Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', TICKET MEDIO CONV. URGENCIA: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Cd_Convenio , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , Ate.Cd_Ori_Ate , Ate.Cd_Atendimento , Ate.Dh_Atendimento , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , ( SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Amb Itr
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Atendimento = Ate.Cd_Atendimento And Itr.Cd_Convenio = Ate.Cd_Convenio And Not Exists ( SELECT 1
FROM Dbamv.Con_Rec, Dbamv.Itcon_Rec
WHERE Con_Rec.Cd_Con_Rec = Itcon_Rec.Cd_Con_Rec And Con_Rec.Cd_Reg_Amb = Itr.Cd_Reg_amb And Con_Rec.Tp_Quitacao <> 'L' And Nvl(Con_Rec.Tp_Quitacao,'X') In ('X','P','C') ) --Recebimento Pendente ) Vl_Total_Conta
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio = 'C') And Ate.tp_atendimento = 'U' And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Cd_Convenio , Cta.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Convenio.Cd_Convenio , Convenio.Nm_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00127
---------------------------------------------------------------------------
CURSOR cProcesso_00127(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE CONTAS INT. CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'NUMERO DE CONTAS INT. CONV./PART.'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO CIRURGICO--- SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Reg_Fat.Dt_Final,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Reg_Fat.Dt_Final Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Reg_Fat
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Reg_Fat.Cd_Convenio = Con.Cd_Convenio And Con.Tp_Convenio in ('C','P')) And Reg_Fat.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Reg_Fat.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00129
---------------------------------------------------------------------------
CURSOR cProcesso_00129(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR REALIZADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Desp_Pessoal_Mes_Proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Desp_Pessoal_Mes Vl_Desp_Pessoal_Mes , Mov.Vl_Desp_Pessoal_Mes/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Dia , Mov.Vl_Desp_Pessoal_Media , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Desp_Pessoal_Mes_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Desp_Pessoal_Mes,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Desp_Pessoal_Mes_Proj_Dia
FROM ( SELECT Setor.Cd_Setor , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Cd_Setor , Dme.Dt_Mes ) Dme
WHERE Dme.Cd_Setor = Setor.Cd_Setor ),0) Vl_Desp_Pessoal_Mes , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Cd_Setor , Dme.Dt_Mes ) Dme
WHERE Dme.Cd_Setor = Setor.Cd_Setor ),0) Vl_Desp_Pessoal_Media
FROM Dbamv.Setor
WHERE Setor.Cd_multi_Empresa = pCdMultiEmpresa ---SOMENTE O SETOR DE AMBULATORIAL, QUE CONSIDERAMOS EXTERNOS--- And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.Tp_Origem = 'A' And Ori.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.Tp_Origem = 'A' And Ori.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00134
---------------------------------------------------------------------------
CURSOR cProcesso_00134(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , NULL nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tip_Categoria.Cd_Tip_Categoria Cd_Departamento , Tip_Categoria.Ds_Tip_Categoria Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tip_Categoria.Ds_Tip_Categoria||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO URGENCIA--- SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Tip_Categoria , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Tip_Categoria , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'P'
THEN 1
WHEN Con.Tp_Convenio = 'A'
THEN 2
END Cd_Tip_Categoria , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Dt_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo ate , Dbamv.Convenio Con
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Tp_Atendimento = 'E' And Exists ( SELECT 1
FROM Dbamv.Ped_Lab
WHERE Ped_Lab.Cd_Atendimento = Ate.Cd_Atendimento And Ped_Lab.Dt_Pedido Between v_Dt_Ini_Diagno And Nvl(Ate.Dh_Alta,Sysdate) ) And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Tip_Categoria , Mov.Dt_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tip_Categoria, 'CONVENIO/PARTICULAR' Ds_Tip_Categoria
FROM Dual
UNION ALL SELECT 2 Cd_Tip_Categoria, 'SIA SUS' Ds_Tip_Categoria
FROM Dual ) Tip_Categoria , MvccAdmin.Estabelecimento
WHERE Tip_Categoria.Cd_Tip_Categoria = Movimento.Cd_Tip_Categoria And Exists ( SELECT 1
FROM Dbamv.Convenio , Dbamv.Empresa_Convenio
WHERE Convenio.Cd_Convenio = Empresa_Convenio.Cd_Convenio AND Empresa_Convenio.sn_ativo = 'S' And Empresa_Convenio.cd_multi_empresa = Estabelecimento.Cd_Multi_Empresa And Decode(Convenio.Tp_Convenio,'C',1,'P',1,'A',2) = Tip_Categoria.Cd_Tip_Categoria ) And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Tip_Categoria.Cd_Tip_Categoria , Tip_Categoria.Ds_Tip_Categoria , Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00135
---------------------------------------------------------------------------
CURSOR cProcesso_00135(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , NUll nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tip_Categoria.Cd_Tip_Categoria Cd_Departamento , Tip_Categoria.Ds_Tip_Categoria Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Tip_Categoria.Ds_Tip_Categoria||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO URGENCIA--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Tip_Categoria , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Tip_Categoria , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'P'
THEN 1
WHEN Con.Tp_Convenio = 'A'
THEN 2
END Cd_Tip_Categoria , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Convenio Con
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Tp_Atendimento = 'E' And Exists ( SELECT 1
FROM Dbamv.Ped_Rx
WHERE Ped_Rx.Cd_Atendimento = Ate.Cd_Atendimento And Ped_Rx.Dt_Pedido Between v_Dt_Ini_Diagno And Nvl(Ate.Dh_Alta,Sysdate) ) And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Tip_Categoria , Mov.Data_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tip_Categoria, 'CONVENIO/PARTICULAR' Ds_Tip_Categoria
FROM Dual
UNION ALL SELECT 2 Cd_Tip_Categoria, 'SIA SUS' Ds_Tip_Categoria
FROM Dual ) Tip_Categoria , MvccAdmin.Estabelecimento
WHERE Tip_Categoria.Cd_Tip_Categoria = Movimento.Cd_Tip_Categoria And Exists ( SELECT 1
FROM Dbamv.Convenio , Dbamv.Empresa_Convenio
WHERE Convenio.Cd_Convenio = Empresa_Convenio.Cd_Convenio AND Empresa_Convenio.sn_ativo = 'S' And Empresa_Convenio.cd_multi_empresa = Estabelecimento.Cd_Multi_Empresa And Decode(Convenio.Tp_Convenio,'C',1,'P',1,'A',2) = Tip_Categoria.Cd_Tip_Categoria ) And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Tip_Categoria.Cd_Tip_Categoria , Tip_Categoria.Ds_Tip_Categoria , Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00143
---------------------------------------------------------------------------
CURSOR cProcesso_00143(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAIDAS DE PAC´S URGÊNCIA INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAIDAS DE PAC´S URGÊNCIA INSTITUCIONAL, NO MÊS: '||Movimento.Qtde_Conforme ||', NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Conforme) Qtde_Conforme , Sum(Mov.Qtde_Conforme_Dia) Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Conforme , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00144
---------------------------------------------------------------------------
CURSOR cProcesso_00144(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Cd_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Alt.Cd_Multi_Empresa , Alt.Data_mes , Alt.Cd_Convenio , Sum(Alt.Qtde_Realizada) Qtde_Realizada , Sum(Alt.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Alt.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA A DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Alt
GROUP BY Alt.Cd_Multi_Empresa , Alt.Data_mes , Alt.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00145
---------------------------------------------------------------------------
CURSOR cProcesso_00145(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Leito = Lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00148
---------------------------------------------------------------------------
CURSOR cProcesso_00148(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR PRODUCAO CONVÊNNIO/PARTTICULAR ' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null Nm_Processo , 'VALOR PRODUCAO CONVÊNNIO/PARTTICULAR: '|| ', VALOR DO MÊS ATUAL R$ '||Nvl(LTrim(To_Char(Nvl(Sum(Movimento.Valor_Produzido),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DO MÊS PROJETADO: R$ '||Nvl(LTrim(To_Char(Nvl(Sum(Movimento.Valor_Projetado),0),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM ( SELECT ---VALOR TOTAL PRODUZIDO CONVENIO ANO/MES ANTERIOR--- Nvl(( SELECT Sum(Dme.Vl_Pro_Total_Convenio_Externo)+Sum(Dme.Vl_Pro_Total_Convenio_Interno) + Sum(Dme.Vl_Pro_Total_Particul_Externo)+Sum(Dme.Vl_Pro_Total_Particul_Interno)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes = To_Date(To_Char(Add_Months(sysdate,0),'MM/YYYY'),'MM/YYYY') ),0) Valor_Produzido
FROM Dual ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00149
---------------------------------------------------------------------------
CURSOR cProcesso_00149(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_departamento , Convenio.Nm_Convenio Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Convenio , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio in ('A')) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00150
---------------------------------------------------------------------------
CURSOR cProcesso_00150(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NULL Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR FATURADO DOS CONV. C.C.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR FATURADO DOS CONV. C.C. :'||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DO FATURAMENTO9-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES INTERNADOS--- SELECT Sum(Itr.Vl_Total_Conta) Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Reg.Sn_Fechada = 'S' And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES INTERNADOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES INTERNADOS--- SELECT Sum(Itr.Vl_Total_Conta) Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FERCHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) --- TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Reg.Sn_Fechada = 'S' And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FERCHAMENTO DA REMESSA--- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) --- SALA CIRURGICAS -- And Itr.Cd_Setor_Produziu In ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00155
---------------------------------------------------------------------------
CURSOR cProcesso_00155(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Sub_Grupo_Cirurgia.Cd_Sub_Grupo_Cirurgia Cd_departamento , Sub_Grupo_Cirurgia.Ds_Sub_Grupo_Cirurgia Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Sub_Grupo_Cirurgia.Ds_Sub_Grupo_Cirurgia||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO CIRURGICO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Sub_Grupo_Cirurgia , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Sub_Grupo_Cirurgia , To_Char(Avi.Dt_Realizacao,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cia , Dbamv.Cirurgia Cir
WHERE Avi.Cd_Aviso_Cirurgia = Cia.Cd_Aviso_Cirurgia And Cia.Cd_Cirurgia = Cir.Cd_Cirurgia And Cia.sn_principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao between v_Dt_Ini_Diagno AND v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Sub_Grupo_Cirurgia , Mov.Data_Mes ) Movimento , Dbamv.Sub_Grupo_Cirurgia , MvccAdmin.Estabelecimento
WHERE Sub_Grupo_Cirurgia.Cd_Sub_Grupo_Cirurgia = Movimento.Cd_Sub_Grupo_Cirurgia And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Sub_Grupo_Cirurgia.Cd_Sub_Grupo_Cirurgia , Sub_Grupo_Cirurgia.Ds_Sub_Grupo_Cirurgia , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00158
---------------------------------------------------------------------------
CURSOR cProcesso_00158(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Sal_Cir
WHERE Sal_Cir.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00159
---------------------------------------------------------------------------
CURSOR cProcesso_00159(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00160
---------------------------------------------------------------------------
CURSOR cProcesso_00160(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Setor.Cd_Setor And Set_Exa.Sn_Ativo = 'S') And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00161
---------------------------------------------------------------------------
CURSOR cProcesso_00161(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO CONV. UNID. GERAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES DE INTERNACAO--- ---VALORES DE INTERNACAO--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0))+Sum(Nvl(Dme.vl_pro_total_particul_interno,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa --- UNIDADE ABERTAS --- And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Unid_Int.Cd_Setor = Dme.Cd_Setor And Unid_Int.Tp_Unid_Int = 'I' And Tip_Acom.Tp_Acomodacao <> 'U')
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Unid_Int.Tp_Unid_Int = 'I' And Tip_Acom.Tp_Acomodacao <> 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00162
---------------------------------------------------------------------------
CURSOR cProcesso_00162(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO DE CONVENIO:'||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES INTERNADOS--- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_fat_total_convenio_interno) + Sum(Dme.vl_fat_total_convenio_externo) + Sum(Dme.vl_fat_total_sus_interno) + Sum(Dme.vl_fat_total_sus_externo)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Setor = Setor.Cd_Setor ),0) Valor_Faturado
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Unid_Int.Tp_Unid_Int = 'I' And Unid_Int.Cd_Setor = Setor.Cd_Setor And Tip_Acom.Tp_Acomodacao <> 'U') ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00163
---------------------------------------------------------------------------
CURSOR cProcesso_00163(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00164
---------------------------------------------------------------------------
CURSOR cProcesso_00164(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Cd_Setor = Setor.Cd_Setor and Ori_Ate.tp_origem = 'A') And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00165
---------------------------------------------------------------------------
CURSOR cProcesso_00165(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR DESP. C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Despesas_Pessoal),'999G999G999G999D99')),'0,00') ||', VALOR DESP. C/PESSOAL (PROJETADA): '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Despesas_Pessoal_Proj),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Despesas_Pessoal) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Despesas_Pessoal_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Despesas_Pessoal Vl_Despesas_Pessoal , Mov.Vl_Despesas_Pessoal/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Despesas_Pessoal_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Despesas_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Despesas_Pessoal_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Despesas_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Despesas_Pessoal_proj_Dia
FROM ( SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Vl_Despesas_Pessoal
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Und.Cd_Setor = Setor.Cd_Setor And Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U') And Setor.Sn_Ativo = 'S' ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00167
---------------------------------------------------------------------------
CURSOR cProcesso_00167(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UNID.GERAL CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UNID.GERAL´CONV./PART., QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA'||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00168
---------------------------------------------------------------------------
CURSOR cProcesso_00168(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_departamento , Convenio.Nm_Convenio Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Convenio , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio in ('C','P')) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00173
---------------------------------------------------------------------------
CURSOR cProcesso_00173(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Cd_Setor = Setor.Cd_Setor and Ori_Ate.tp_origem = 'U') And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00177
---------------------------------------------------------------------------
CURSOR cProcesso_00177(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00178
---------------------------------------------------------------------------
CURSOR cProcesso_00178(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV./PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio In ('C','P') --CONVENIO E PARTICULAR) And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00179
---------------------------------------------------------------------------
CURSOR cProcesso_00179(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTI SUS.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UTI SUS., QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA'||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00180
---------------------------------------------------------------------------
CURSOR cProcesso_00180(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTI CONV.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UTI´CONV., QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA'||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00181
---------------------------------------------------------------------------
CURSOR cProcesso_00181(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTI PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL PART., QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA'||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00182
---------------------------------------------------------------------------
CURSOR cProcesso_00182(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTI CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UTI´CONV./PART., QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA'||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00183
---------------------------------------------------------------------------
CURSOR cProcesso_00183(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UNID.GERAL SUS.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UNID.GERAL´SUS, QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA'||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00185
---------------------------------------------------------------------------
CURSOR cProcesso_00185(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TICKET MEDIO SUS INTERNO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'TICKET MEDIO SUS INTERNO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( SELECT pCdMultiEmpresa Cd_multi_Empresa , Valor_Conta.Cd_Reg_Fat , To_Char(Valor_Conta.Dt_Final,'MM/YYYY') Data_Mes , Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)) Vl_Total_Conta
FROM ( SELECT Valor.Cd_Reg_Fat , Valor.Dt_Final , Nvl(Sum(Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0)),0) Vl_Total_Conta
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Valor.Cd_Reg_Fat , Valor.Dt_Final ) Valor_Conta
GROUP BY Valor_Conta.Cd_Reg_Fat , To_Char(Valor_Conta.Dt_Final,'MM/YYYY') ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Nvl(Movimento.Vl_Ticket_Medio,0) > 0
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00186
---------------------------------------------------------------------------
CURSOR cProcesso_00186(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TICKET MEDIO SUS EXTERNO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TICKET MEDIO SUS EXTERNO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , ( SELECT Sum(Eve.vl_total_ambulatorial)
FROM Dbamv.Eve_SiaSus Eve
WHERE Eve.Cd_Atendimento = Ate.Cd_Atendimento ) Vl_Total_Conta
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'A' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Tp_Atendimento IN ('A','E') And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Nvl(Movimento.Vl_Ticket_Medio,0) > 0
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00187
---------------------------------------------------------------------------
CURSOR cProcesso_00187(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TICKET MEDIO SUS URGENCIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TICKET MEDIO SUS URGENCIA: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , ( SELECT Sum(Eve.vl_total_ambulatorial)
FROM Dbamv.Eve_SiaSus Eve
WHERE Eve.Cd_Atendimento = Ate.Cd_Atendimento ) Vl_Total_Conta
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'A' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Nvl(Movimento.Vl_Ticket_Medio,0) > 0
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00188
---------------------------------------------------------------------------
CURSOR cProcesso_00188(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TICKET MEDIO PART. INTERNO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'TICKET MEDIO PART. INTERNO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( --VALOR MEDIO DAS CONTAS POR CONVENIO-- SELECT Reg.Cd_multi_Empresa , Reg.Cd_Reg_Fat , To_Char(Reg.Dt_Final,'MM/YYYY') Data_Mes , ( SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Fat Itr
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat) Vl_Total_Conta
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'P') And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Nvl(Movimento.Vl_Ticket_Medio,0) > 0
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00189
---------------------------------------------------------------------------
CURSOR cProcesso_00189(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TICKET MEDIO PART. EXTERNO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TICKET MEDIO PART. EXTERNO: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Atendimento , Ate.Dh_Atendimento , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , ( SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Amb Itr
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Atendimento = Ate.Cd_Atendimento And Itr.Cd_Convenio = Ate.Cd_Convenio And Not Exists ( SELECT 1
FROM Dbamv.Con_Rec, Dbamv.Itcon_Rec
WHERE Con_Rec.Cd_Con_Rec = Itcon_Rec.Cd_Con_Rec And Con_Rec.Cd_Reg_Amb = Itr.Cd_Reg_amb And Con_Rec.Tp_Quitacao <> 'L' And Nvl(Con_Rec.Tp_Quitacao,'X') In ('X','P','C') ) --Recebimento Pendente ) Vl_Total_Conta
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio = 'P') And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00190
---------------------------------------------------------------------------
CURSOR cProcesso_00190(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TICKET MEDIO PART. URGENCIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TICKET MEDIO PART. URGENCIA: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'ITREG_AMB' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia,Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS CONVENIO EXTERNO-- SELECT Mov.Cd_multi_Empresa , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( SELECT pCdMultiEmpresa Cd_multi_Empresa , Medio_Conta.Data_Mes , Count(1) Qtde_Conta , Avg(Medio_Conta.Vl_Total_Conta) Vl_Total_Conta
FROM ( --VALOR MEDIO DAS CONTAS POR CONVENIO-- SELECT Itr.Cd_Reg_Amb , To_Char(Itr.Hr_Lancamento,'MM/YYYY') Data_Mes , Sum(Itr.Vl_Total_Conta) Vl_Total_Conta
FROM Dbamv.ItReg_Amb Itr
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Itr.Cd_Convenio And Con.Tp_Convenio = 'P') And Exists ( SELECT 1
FROM Dbamv.Atendime Ate
WHERE Ate.Tp_Atendimento in ('U') And Ate.Cd_Atendimento = Itr.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Hr_Lancamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Itr.Cd_Reg_Amb , To_Char(Itr.Hr_Lancamento,'MM/YYYY') ) Medio_Conta
GROUP BY Medio_Conta.Data_Mes ) Cta
GROUP BY Cta.Cd_Multi_Empresa , Cta.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00191
---------------------------------------------------------------------------
CURSOR cProcesso_00191(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO SUS'||', VALOR PRODUZIDO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Produzido_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM ( SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Setor = Dme.Cd_Setor) --SETOR And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00192
---------------------------------------------------------------------------
CURSOR cProcesso_00192(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR PRODUCAO SUS GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , null Nm_Processo , 'VALOR PRODUCAO SUS GLOBAL: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Produzido),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR PROJETADO: R$ '||Nvl(LTrim(To_Char(Nvl(Sum(Movimento.Valor_Projetado),0),'999G999G999G999D99')),'0,00')|| '. CONSIDERE TAMBÉM: '||Chr(10)|| ' VALOR DA RECEITA MÊS/ANO: '||To_Char(Add_Months(sysdate,-1),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Atual),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÊS/ANO: '||To_Char(Add_Months(sysdate,-13),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Anterior),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA DIFERÊNÇA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Total_Receitas_Dif),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÊS/ANO '||To_Char(Add_Months(sysdate,-12),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Anter),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÊS/ANO '||To_Char(Add_Months(sysdate,-0),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÊS/ANO '||To_Char(Add_Months(sysdate,-0),'MM/YYYY')||' (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA DIFERÊNÇA PROJEÇÃO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Dif),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Nvl(Sum(Movimento.Valor_Projetado),0)-Nvl(Sum(Movimento.Valor_Produzido),0) Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , Sum(Mov.Vl_Produzido_Atual) Vl_Produzido_Atual , Sum(Mov.Vl_Produzido_Anterior) Vl_Produzido_Anterior , Sum(Mov.Vl_Produzido_Atual)-Sum(Mov.Vl_Produzido_Anterior) Valor_Total_Receitas_Dif , Sum(Mov.Vl_Produzido_Mes_Atual) Vl_Produzido_Mes_Atual , Sum(Mov.Vl_Produzido_Mes_Anter) Vl_Produzido_Mes_Anter , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Vl_Produzido_Mes_Atual),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Vl_Produzido_Mes_Atual),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)-Sum(Mov.Vl_Produzido_Anterior) Vl_Produzido_Mes_Atual_Dif
FROM ( SELECT --CONTAS INTERNADOS E CONTAS EXTERNAS-- Nvl(( SELECT Sum(Dme.vl_pro_total_sus_interno)+Sum(Dme.vl_pro_total_sus_externo)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Produzido ---VALOR TOTAL PRODUZIDO ANO/MES ANTERIOR--- , Nvl(( SELECT Sum(Dme.vl_pro_total_sus_interno)+Sum(Dme.vl_pro_total_sus_externo)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes = To_Date(To_Char(Add_Months(sysdate,-13),'MM/YYYY'),'MM/YYYY') ),0) Vl_Produzido_Anterior ---VALOR TOTAL PRODUZIDO ANO/MES ATUAL--- , Nvl(( SELECT Sum(Dme.vl_pro_total_sus_interno)+Sum(Dme.vl_pro_total_sus_externo)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes = To_Date(To_Char(Add_Months(sysdate,-1),'MM/YYYY'),'MM/YYYY') ),0) Vl_Produzido_Atual ---VALOR TOTAL PRODUZIDO ANO/MES CORRENTE--- , Nvl(( SELECT Sum(Dme.vl_pro_total_sus_interno)+Sum(Dme.vl_pro_total_sus_externo)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Vl_Produzido_Mes_Atual ---VALOR TOTAL PRODUZIDO ANO/MES CORRENTE ANTES--- , Nvl(( SELECT Sum(Dme.vl_pro_total_sus_interno)+Sum(Dme.vl_pro_total_sus_externo)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes = To_Date(To_Char(Add_Months(sysdate,-12),'MM/YYYY'),'MM/YYYY') ),0) Vl_Produzido_Mes_Anter
FROM Dual ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00193
---------------------------------------------------------------------------
CURSOR cProcesso_00193(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , null Nm_Processo , Setor.nm_Setor||', VALOR PRODUCAO SUS UTIs'||', VALOR PRODUZIDO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE SUS UTIS-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_dIA
FROM (--CONTAS INTERNADOS-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_sus_interno,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Setor = Str.Cd_Setor And Und.Cd_Setor = Dme.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Setor = Str.Cd_Setor And Und.Cd_Setor = Setor.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00194
---------------------------------------------------------------------------
CURSOR cProcesso_00194(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUZIDO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE SUS SADTS-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (--CONTAS INTERNADOS-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa, Dbamv.Setor Str2
WHERE Exa.Cd_Setor = Str2.Cd_Setor And Str2.Cd_Setor = Dme.Cd_Setor And Str2.Cd_Multi_Empresa = pCdMultiEmpresa) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa
WHERE Exa.Cd_Setor = Setor.Cd_Setor)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00195
---------------------------------------------------------------------------
CURSOR cProcesso_00195(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO SUS: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---VALORES--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM ( SELECT Valor.Cd_Setor_produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Valor.Cd_Setor_produziu And Tip_Acom.Tp_Acomodacao <> 'U') And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00196
---------------------------------------------------------------------------
CURSOR cProcesso_00196(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---VALORES--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM ( SELECT Valor.Cd_Setor_produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Sal_Cir
WHERE Sal_Cir.Cd_Setor = Valor.Cd_Setor_produziu) And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Exists ( SELECT 1
FROM Dbamv.Sal_Cir
WHERE Sal_Cir.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00197
---------------------------------------------------------------------------
CURSOR cProcesso_00197(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR FATURADO SUS GLOBAL' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null Nm_Processo , 'VALOR FATURADO SUS GLOBAL: R$ '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00')|| ', VALOR PROJETADO: R$ '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00')||Chr(10)|| '. CONSIDERE TAMBÉM: '||Chr(10)|| ' VALOR DA FATURADO MÊS/ANO: '||To_Char(Add_Months(sysdate,-1),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Faturado_Sus_Atual),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA FATURADO MÊS/ANO: '||To_Char(Add_Months(sysdate,-13),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Faturado_Sus_Anterior),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA DIFERÊNÇA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Faturado_Sus_Dif),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÊS/ANO '||To_Char(Add_Months(sysdate,-12),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Faturado_Sus_Corr_Ant),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÊS/ANO '||To_Char(Add_Months(sysdate,-0),'MM/YYYY')||': R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Faturado_Sus_Corrente),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÊS/ANO '||To_Char(Add_Months(sysdate,-0),'MM/YYYY')||' (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Faturado_Sus_Corr_Proj),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA DIFERÊNÇA PROJEÇÃO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Faturado_Sus_Corr_Dif),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS SUS-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , Sum(Mov.Valor_Faturado_Sus_Anterior) Valor_Faturado_Sus_Anterior , Sum(Mov.Valor_Faturado_Sus_Atual) Valor_Faturado_Sus_Atual , Sum(Mov.Valor_Faturado_Sus_Atual)-Sum(Mov.Valor_Faturado_Sus_Anterior) Valor_Faturado_Sus_Dif , Sum(Mov.Valor_Faturado_Sus_Corrente) Valor_Faturado_Sus_Corrente , Sum(Mov.Valor_Faturado_Sus_Corr_Ant) Valor_Faturado_Sus_Corr_Ant , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado_Sus_Corrente),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Faturado_Sus_Corr_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado_Sus_Corrente),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)-Sum(Mov.Valor_Faturado_Sus_Anterior) Valor_Faturado_Sus_Corr_Dif
FROM ( SELECT ---VALOR FATURADO SUS--- Nvl(( SELECT Sum(Nvl(Valor.Vl_Sh_Proprio,0))+Sum(Nvl(Valor.Vl_Sp_Proprio,0))
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Faturado ---VALOR TOTAL FATURADO SUS MES/ANO ANTEIOR--- , Nvl(( SELECT Sum(Dme.vl_fat_total_sus_interno)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes = To_Date(To_Char(Add_Months(sysdate,-13),'MM/YYYY'),'MM/YYYY') ),0) Valor_Faturado_Sus_Anterior ---VALOR TOTAL FATURADO SUS MES/ANO ATUAL--- , Nvl(( SELECT Sum(Dme.vl_fat_total_sus_interno)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes = To_Date(To_Char(Add_Months(sysdate,-1),'MM/YYYY'),'MM/YYYY') ),0) Valor_Faturado_Sus_Atual ---VALOR TOTAL FATURADO SUS MES/ANO CORRENTE--- , Nvl(( SELECT Sum(Dme.vl_fat_total_sus_interno)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Faturado_Sus_Corrente ---VALOR TOTAL FATURADO SUS MES/ANO CORRENTE ANTES--- , Nvl(( SELECT Sum(Dme.vl_fat_total_sus_interno)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes = To_Date(To_Char(Add_Months(sysdate,-12),'MM/YYYY'),'MM/YYYY') And Dme.Vl_Fat_Total_Convenio_Interno > 0 ),0) Valor_Faturado_Sus_Corr_Ant
FROM Dual ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00198
---------------------------------------------------------------------------
CURSOR cProcesso_00198(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES-- SELECT Mov.Cd_Setor_Produziu Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DO SUS--- SELECT Valor.Cd_Setor_Produziu , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00199
---------------------------------------------------------------------------
CURSOR cProcesso_00199(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS SUS-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO--- SELECT Valor.Cd_Setor_Produziu , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa
WHERE Exa.Cd_Setor = Valor.Cd_Setor_Produziu) And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
UNION ALL ---VALORES DE EXTERNOS/URGENCIA--- SELECT Valor.Cd_Setor_Produziu , Nvl(Valor.vl_total_ambulatorial,0) Valor_Faturado
FROM Dbamv.Eve_SiaSus Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Valor.Cd_Setor_Produziu) And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.dt_eve_siasus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , MvccAdmin.Estabelecimento , Dbamv.Setor
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Setor.Cd_Setor) And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Setor.Cd_Setor , Setor.Nm_Setor , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00237
---------------------------------------------------------------------------
CURSOR cProcesso_00237(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO SUS UNID. GERAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE SUS UTIS-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_dIA
FROM (--CONTAS INTERNADOS-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Setor = Str.Cd_Setor And Und.Cd_Setor = Dme.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Setor = Str.Cd_Setor And Und.Cd_Setor = Setor.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00255
---------------------------------------------------------------------------
CURSOR cProcesso_00255(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO SUS URGENCIA: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'EVE_SIASUS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DA URGENCIA-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (--CONTAS DA URGENCIA-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Sn_Ativo = 'S' And Ori.Cd_Setor = Dme.Cd_Setor And Ori.Tp_Origem = 'U') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.Tp_Origem = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00276
---------------------------------------------------------------------------
CURSOR cProcesso_00276(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO DE FATURADO SUS URGENCIA SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE URGENCIA--- SELECT Itr.Cd_Setor_Produziu , Nvl(Itr.vl_total_ambulatorial,0) Valor_Faturado
FROM Dbamv.Eve_SiaSus Itr
WHERE Itr.Cd_Setor_Produziu in ( SELECT Ori.Cd_Setor
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Tp_Origem IN ('U') And Ori.Cd_Multi_Empresa = pCdMultiEmpresa) And Itr.Dt_Eve_Siasus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Itr.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00277
---------------------------------------------------------------------------
CURSOR cProcesso_00277(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO SUS AMBULATÓRIO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'EVE_SIASUS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Produzido_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---SUS EXTERNOS--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00278
---------------------------------------------------------------------------
CURSOR cProcesso_00278(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES SUS EXTERNO --VALORES SUS EXTERNO SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.vl_total_ambulatorial Valor_Faturado
FROM Dbamv.Eve_SiaSus Itr
WHERE Itr.Cd_Setor_Produziu in ( SELECT Ori.Cd_Setor
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Sn_Ativo = 'S' And Ori.Tp_Origem IN ('A','E')) And Itr.Dt_Eve_SiaSus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Itr.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , MvccAdmin.Estabelecimento , Dbamv.Setor
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Exists ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Tp_Origem IN ('A','E') And Ori_Ate.Cd_Setor = Setor.Cd_Setor) And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Setor.Cd_Setor , Setor.Nm_Setor , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00285
---------------------------------------------------------------------------
CURSOR cProcesso_00285(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Setor.Nm_Setor||', VALOR DA DESP. C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Desp_Pessoal),'999G999G999G999D99')),'0,00') ||', VALOR DA DESP. C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Desp_Pessoal_Proj),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Desp_Pessoal) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Desp_Pessoal_Proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Desp_Pessoal , Mov.Valor_Desp_Pessoal/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Desp_Pessoal_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Desp_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Desp_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Desp_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Desp_Pessoal_Proj_Dia
FROM (---MOVIMENTO--- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Desp_Pessoal
FROM Dbamv.Setor
WHERE Setor.Sn_Ativo = 'S' ---SOMENTE O SETOR DE URGENCIA, QUE CONSIDERAMOS--- And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.Tp_Origem = 'U' And Ori.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Unid_Int Und
WHERE Und.Cd_Setor = Setor.Cd_Setor And Und.tp_unid_int = 'U' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Setor.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Setor.Cd_Setor , Setor.Nm_Setor , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00286
---------------------------------------------------------------------------
CURSOR cProcesso_00286(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO CONV. URGENCIA: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE AMBULATORIAL CONVENIO-- SELECT Mov.Cd_Setor_produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr
WHERE Itr.Cd_Setor_Produziu in ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Sn_Ativo = 'S' And Ori_Ate.Tp_Origem = 'U' And Ori_Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Itr.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura, Dbamv.Reg_Amb Reg
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Sn_Ativo = 'S' And Ori_Ate.Tp_Origem = 'U' And Ori_Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr,Dbamv.Reg_Amb Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Itr.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Itr.Cd_Setor_Produziu in ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Sn_Ativo = 'S' And Ori_Ate.Tp_Origem = 'U' And Ori_Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Sn_Ativo = 'S' And Ori_Ate.Tp_Origem = 'U' And Ori_Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DO FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00287
---------------------------------------------------------------------------
CURSOR cProcesso_00287(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Cd_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DO FATURAMENTO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE EXTERNOS--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Dme.vl_fat_total_convenio_externo) Valor_Faturado
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.dt_mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , MvccAdmin.Estabelecimento , Dbamv.Setor
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Cd_Setor = Setor.Cd_Setor And Ori_Ate.Sn_Ativo = 'S' And Ori_Ate.Tp_Origem IN ('A','E') And Ori_Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Setor.Cd_Setor , Setor.Nm_Setor , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00288
---------------------------------------------------------------------------
CURSOR cProcesso_00288(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO CONV.: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE CONVENIO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_Interno,0)) + Sum(Nvl(Dme.vl_pro_total_convenio_externo,0)) + Sum(Nvl(Dme.vl_pro_total_particul_Interno,0)) + Sum(Nvl(Dme.vl_pro_total_particul_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Dme.Cd_Setor And Ori.Tp_Origem = 'U') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.tp_origem = 'U' And Ori.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL SELECT 1
FROM Dbamv.Unid_Int Und
WHERE Und.Cd_Setor = Setor.Cd_Setor And Und.tp_unid_int = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00289
---------------------------------------------------------------------------
CURSOR cProcesso_00289(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO CONV.: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Produzido),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE CONVENIO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_Interno,0)) + Sum(Nvl(Dme.vl_pro_total_convenio_externo,0)) + Sum(Nvl(Dme.vl_pro_total_particul_Interno,0)) + Sum(Nvl(Dme.vl_pro_total_particul_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Dme.Cd_Setor And Ori.Tp_Origem = 'A') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.tp_origem = 'A' And Ori.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00290
---------------------------------------------------------------------------
CURSOR cProcesso_00290(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR FATURADO TOTAL GLOBAL' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE ENTREGA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE ENTREGA --- And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA --- And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
UNION ALL ---VALOR FATURADO SUS EXTERNOS/URGENCIA--- SELECT Itr.vl_total_ambulatorial Valor_Faturado
FROM Dbamv.Eve_SiaSus Itr
WHERE Itr.Cd_Multi_Empresa = pCdMultiEmpresa And Itr.Dt_Eve_SiaSus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00291
---------------------------------------------------------------------------
CURSOR cProcesso_00291(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Sum(Nvl(Movimento.Valor_Projetado,0))-Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---VALORES--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE ENTREGA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE ENTREGA --- And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA --- And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_Produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Sal_Cir
WHERE Sal_Cir.Cd_Setor = Valor.Cd_Setor_Produziu) And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
UNION ALL ---VALOR FATURADO SUS EXTERNOS/URGENCIA--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.vl_total_ambulatorial Valor_Faturado
FROM Dbamv.Eve_SiaSus Itr
WHERE Itr.Cd_Multi_Empresa = pCdMultiEmpresa And Itr.Cd_Setor_Produziu in ( SELECT Sal_Cir.Cd_Setor
FROM Dbamv.Sal_Cir) And Itr.Dt_Eve_SiaSus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00292
---------------------------------------------------------------------------
CURSOR cProcesso_00292(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE FATURAMENTO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_Produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Sn_Fechada = 'S' And Valor.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Valor.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00293
---------------------------------------------------------------------------
CURSOR cProcesso_00293(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Cd_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE FATURAMENTO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA--- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_Produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Cd_Setor_Produziu in ( SELECT Unid_Int.Cd_Setor
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00294
---------------------------------------------------------------------------
CURSOR cProcesso_00294(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||': VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ITREG_FAT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor_produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA--- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE ENTREGA --- And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA --- And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_produziu,Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_produziu,Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Valor.Cd_Setor_Produziu And Set_Exa.Sn_Ativo = 'S') And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
UNION ALL ---VALOR FATURADO SUS SADTs: VALORES DE EXTERNOS/URGENCIA--- SELECT Itr.Cd_Setor_produziu, Itr.vl_total_ambulatorial Valor_Faturado
FROM Dbamv.Eve_SiaSus Itr
WHERE Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Itr.Cd_Setor_Produziu) And Itr.Cd_Multi_Empresa = pCdMultiEmpresa And Itr.Dt_Eve_Siasus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Setor.Cd_Setor And Set_Exa.Sn_Ativo = 'S') And Setor.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00295
---------------------------------------------------------------------------
CURSOR cProcesso_00295(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE CONVENIO-- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM ( ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('U')) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('U')) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE ENTREGA --- And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('U')) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA --- And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('U')) And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO SUS SADTs: VALORES DE EXTERNOS/URGENCIA--- SELECT Itr.Cd_Setor_Produziu , Itr.vl_total_ambulatorial Valor_Faturado
FROM Dbamv.Eve_SiaSus Itr
WHERE Itr.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('U')) And Itr.Dt_Eve_Siasus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.Tp_Origem IN ('U')) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.NM_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00296
---------------------------------------------------------------------------
CURSOR cProcesso_00296(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---VALORES-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM ( ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('A')) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('A')) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE ENTREGA --- And Remessa_Fatura.dt_entrega_da_fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('A')) And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO CONV. EXTERNOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('A')) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DO FECHAMENTO DA REMESSA--- And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALOR FATURADO SUS SADTs: VALORES DE EXTERNOS/URGENCIA--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.vl_total_ambulatorial Valor_Faturado
FROM Dbamv.Eve_SiaSus Itr
WHERE Itr.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Itr.Cd_Setor_Produziu And Ori.Tp_Origem IN ('A')) And Itr.Dt_Eve_Siasus Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Setor.Cd_Setor And Ori.Tp_Origem IN ('A'))
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00297
---------------------------------------------------------------------------
CURSOR cProcesso_00297(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR PRODUCAO TOTAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR PRODUCAO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Produzido,0)),'999G999G999G999D99')),'0,00')||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Produzido,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Produzido,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (--VALORES-- SELECT Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_sus_Interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00298
---------------------------------------------------------------------------
CURSOR cProcesso_00298(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO TOTAL C.C.: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Produzido,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Produzido,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Produzido,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (--VALORES-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal, Dbamv.Setor Str2
WHERE Sal.Cd_Setor = Str2.Cd_Setor And Sal.Cd_Setor = Dme.Cd_Setor And Str2.Cd_Multi_Empresa = pCdMultiEmpresa) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal, Dbamv.Setor Str2
WHERE Sal.Cd_Setor = Setor.Cd_Setor) And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00299
---------------------------------------------------------------------------
CURSOR cProcesso_00299(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO TOTAL UTIS: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Produzido,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Produzido,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Produzido_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (--VALORES-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Dme.Cd_Setor = Unid_Int.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Setor.Cd_Setor = Unid_Int.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00300
---------------------------------------------------------------------------
CURSOR cProcesso_00300(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO TOTAL UNID. GERAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Produzido,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Produzido,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Produzido_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (--VALORES-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Dme.Cd_Setor = Unid_Int.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Setor.Cd_Setor = Unid_Int.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao <> 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00301
---------------------------------------------------------------------------
CURSOR cProcesso_00301(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO TOTAL SADTs: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Produzido,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ITREG_FAT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Produzido,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Produzido_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (--VALORES-- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Dme.Cd_Setor) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Set_Exa
WHERE Set_Exa.Cd_Setor = Setor.Cd_Setor) And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00302
---------------------------------------------------------------------------
CURSOR cProcesso_00302(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO TOTAL URGENCIA: '||Nvl(LTrim(To_Char(Nvl(Sum(Movimento.Valor_Produzido),0),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Nvl(Sum(Movimento.Valor_Projetado),0),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Produzido_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Dme.Cd_Setor And Ori.Tp_Origem = 'U') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Cd_Setor = Setor.Cd_Setor And Ori_Ate.Tp_Origem = 'U'
UNION ALL SELECT 1
FROM Dbamv.Unid_Int Und
WHERE Und.Cd_Setor = Setor.Cd_Setor And Und.Tp_Unid_Int = 'U') And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00303
---------------------------------------------------------------------------
CURSOR cProcesso_00303(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , NUll Nm_Processo , Setor.Nm_Setor||', VALOR PRODUCAO TOTAL: '||Nvl(LTrim(To_Char(Nvl(Sum(Movimento.Valor_Produzido),0),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Nvl(Sum(Movimento.Valor_Projetado),0),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ITREG_FAT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Produzido_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor_Produziu , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Produzido) Valor_Produzido , Sum(Mov.Valor_Produzido)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Produzido),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES--- SELECT Dme.Cd_Setor Cd_Setor_Produziu , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Valor_Produzido
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Dme.Cd_Setor And Ori.Tp_Origem = 'A') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Dme.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Dme.Cd_Setor ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor_Produziu(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Ori_Ate
WHERE Ori_Ate.Cd_Setor = Setor.Cd_Setor And Ori_Ate.Tp_Origem = 'A' And Ori_Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00308
---------------------------------------------------------------------------
CURSOR cProcesso_00308(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'GIRO DE ESTOQUE' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'GIRO DE ESTOQUE: '||Sum(Nvl(Movimento.Vl_Giro_Estoque,0))||' (Ultimos 12 meses)'||Chr(10)|| ', VALOR TOTAL VENDA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Vendas),0),'999G999G999G999D99')),'0,00')||' (Ultimos 12 meses)'||Chr(10)|| ', VALOR TOTAL ESTOQUE: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Estoque),0),'999G999G999G999D99')),'0,00')||' (Ultimo Mês Fechado)'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Giro_Estoque,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Giro_Estoque,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Valor_Vendas,0) Valor_Vendas , Nvl(Mov.Valor_Estoque,0) Valor_Estoque ---VENDAS / ESTOQUE = GIRO DE ESTOQUE , (Case
WHEN Nvl(Mov.Valor_Estoque,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Valor_Vendas,0)/Nvl(Mov.Valor_Estoque,0),1)
END ) Vl_Giro_Estoque
FROM ( SELECT Sum(Dme.vl_venda_estoque) Valor_Vendas , Avg(Dme.vl_saldo_estoque) Valor_Estoque
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.dt_mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Dme.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00310
---------------------------------------------------------------------------
CURSOR cProcesso_00310(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Movimento.Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE REINCIDÊNCIA DE INTERNAÇÃO C/ALERTA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TAXA DE REINCIDÊNCIA DE INTERNAÇÃO C/ALERTA, CÓDIGO DO ATENDIMENTO: '||Movimento.Cd_Atendimento||Chr(10) ||', DATA/HORA DA ATENDIMENTO: '||To_Char(Movimento.Dh_Atendimento,'DD/MM/YYYY HH24:MI:SS')||Chr(10) ||', DATA/HORA DA ALTA: '||To_Char(Movimento.Dh_Alta,'DD/MM/YYYY HH24:MI:SS')||Chr(10) ||', CÓDIGO DO ATENDIMENTO DA REINTERNAÇÃO: '||Movimento.Cd_Atendimento_Reint||Chr(10) ||', DATA/HORA DA ATENDIMENTO DA REINTERNAÇÃO: '||To_Char(Movimento.Dh_Atendimento_Reint,'DD/MM/YYYY HH24:MI:SS')||Chr(10) ||', TEMPO DA REINTERNAÇÃO: '||Trunc(Movimento.Dh_Atendimento_Reint-Movimento.Dh_Alta)||' DIAS'||Chr(10) ||', QTDE DE INTERNAÇÃO: '||Nvl(Movimento.Qtde_Internacao,0)||Chr(10) ||', QTDE DE REINTERNAÇÃO: '||Nvl(Movimento.Qtde_ReInternacao,0)||Chr(10) ||', TAXA DE REINTERNAÇÃO: '||Nvl(Movimento.Vl_Taxa_ReInternacao,0)||'%'||Chr(10) ||', QTDE DE INTERNAÇÃO NO DIA: '||Nvl(Movimento.Qtde_Internacao_Dia,0)||Chr(10) ||', QTDE DE REINTERNAÇÃO NO DIA: '||Nvl(Movimento.Qtde_ReInternacao_Dia,0)||Chr(10) ||', TAXA DE REINTERNAÇÃO NO DIA: '||Nvl(Movimento.Vl_Taxa_ReInternacao_Dia,0)||'%'||Chr(10) ||'. NOTA: ESTE PACIENTE FOI REINTERNADO NO TEMPO MENOR QUE '||Movimento.Nr_Dias||', INDICANDO QUE O PROCESSO ESTAR APRESENTANDO INCONFORMIDADE.' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , Movimento.Cd_Atendimento_Reint Cd_Coluna_Chave , Movimento.Dh_Atendimento_Reint Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Reinternacao,0) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Nvl(Movimento.Qtde_Reinternacao_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Ate.Cd_Atendimento , Ate.Dh_Atendimento , Ate.Dh_Alta , Ate.Cd_Atendimento_Reint , Ate.Dh_Atendimento_Reint , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA')/24/60 Nr_Tempo , Mov.Qtde_Internacao , Mov.Qtde_Internacao_Dia , Mov.Qtde_ReInternacao , Mov.Qtde_ReInternacao_Dia , Mov.Vl_Taxa_Reinternacao , Mov.Vl_Taxa_Reinternacao_Dia , Nvl(( SELECT Min(Vcc.cd_campo_chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 77 --NÚMERO DE DIAS LIMITE CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ),30) Nr_Dias
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Internacao) Qtde_Internacao , Sum(Mov.Qtde_Internacao_Dia) Qtde_Internacao_Dia , Sum(Mov.Qtde_ReInternacao) Qtde_ReInternacao , Sum(Mov.Qtde_ReInternacao_Dia) Qtde_ReInternacao_Dia , (Case
WHEN Sum(Mov.Qtde_Internacao) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_ReInternacao)/Sum(Mov.Qtde_Internacao))*100,2)
END ) Vl_Taxa_Reinternacao , (Case
WHEN Sum(Mov.Qtde_Internacao_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_ReInternacao_Dia)/Sum(Mov.Qtde_Internacao_Dia))*100,2)
END ) Vl_Taxa_Reinternacao_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Qtde_Internacao , Mov.Qtde_Internacao_Dia , Mov.Qtde_ReInternacao , Mov.Qtde_ReInternacao_Dia
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Tp_Mov in ('I','O') And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) ) Qtde_Internacao , ( SELECT Sum(Case
WHEN Ate_Reint.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Tp_Mov in ('I','O') And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) ) Qtde_Internacao_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Tp_Mov in ('I','O') And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta , Dbamv.Leito Lei
WHERE Lei.Cd_leito = Ate_Alta.Cd_leito And Ate_Alta.Dt_Alta IS Not Null And Ate_Alta.Cd_Atendimento_Pai IS Null And Ate_Alta.Tp_Atendimento = 'I' And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And (Ate_Reint.Dh_Atendimento-To_Date(To_Char(Ate_Alta.Dt_Alta,'DD/MM/YYYY')||' '||To_Char(Ate_Alta.Hr_Alta,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))/24/60 <= Nvl(( SELECT Min(Vcc.cd_campo_chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 77 --NÚMERO DE DIAS LIMITE CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ),30) And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) ) And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Qtde_ReInternacao , ( SELECT Sum(Case
WHEN Ate_Reint.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Tp_Mov in ('I','O') And Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta , Dbamv.Leito Lei
WHERE Lei.Cd_leito = Ate_Alta.Cd_leito And Ate_Alta.Dt_Alta IS Not Null And Ate_Alta.Tp_Atendimento = 'I' And Ate_Alta.Cd_Atendimento_Pai IS Null And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And (Ate_Reint.Dh_Atendimento-To_Date(To_Char(Ate_Alta.Dt_Alta,'DD/MM/YYYY')||' '||To_Char(Ate_Alta.Hr_Alta,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')) <= Nvl(( SELECT Min(Vcc.cd_campo_chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 77 --NÚMERO DE DIAS LIMITE CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ),30) And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa )) And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Qtde_ReInternacao_Dia
FROM Dual ) Mov ) Mov
GROUP BY Mov.Data_Mes ) Mov , ( SELECT Nvl(lead(Ate_Alta2.cd_atendimento) OVER (PARTITION BY Ate_Alta2.cd_paciente
ORDER BY Ate_Alta2.dt_atendimento),Ate_Reint.Cd_Atendimento) Cd_Atendimento_Reint, Nvl(lead(Ate_Alta2.hr_atendimento) OVER (PARTITION BY Ate_Alta2.cd_paciente
ORDER BY Ate_Alta2.dt_atendimento),Ate_Reint.Dh_Atendimento)Dh_Atendimento_Reint, Ate_Alta2.Cd_Atendimento, To_Date(To_Char(Ate_Alta2.Dt_Alta,'DD/MM/YYYY')||' '||To_Char(Ate_Alta2.Hr_Alta,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') Dh_Alta , To_Date(To_Char(Ate_Alta2.Dt_Atendimento,'DD/MM/YYYY')||' '||To_Char(Ate_Alta2.Hr_Atendimento,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') Dh_Atendimento
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint , Dbamv.Atendime Ate_Alta2
WHERE Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Tp_Mov in ('I','O') And Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Cd_Paciente = Ate_Alta2.Cd_Paciente And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Alta2.Cd_Atendimento = ( SELECT Max(Ate_Alta.Cd_Atendimento)
FROM Dbamv.Atendime Ate_Alta , Dbamv.Leito Lei
WHERE Ate_Alta.Cd_leito = Lei.Cd_leito And Ate_Alta.Dt_Alta IS Not NULL And Ate_Alta.Tp_Atendimento = 'I' And Ate_Alta.Cd_Atendimento_Pai IS Null And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente --And Ate_Alta.Cd_Atendimento = Ate_Alta2.Cd_Atendimento And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And (Ate_Reint.Dh_Atendimento-To_Date(To_Char(Ate_Alta.Dt_Alta,'DD/MM/YYYY')||' '||To_Char(Ate_Alta.Hr_Alta,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')) <= Nvl(( SELECT Min(Vcc.cd_campo_chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 77 --NÚMERO DE DIAS LIMITE CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ),30) And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa )) And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.Diagnostico_Processo_Analitico Dpca
WHERE Dpca.Cd_Multi_Empresa = pCdMultiEmpresa And Dpca.dt_coluna_chave Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Dpca.Nr_Processo = pProcesso And Dpca.Cd_Coluna_Chave = Ate_Reint.Cd_Atendimento And Dpca.Dt_Coluna_Chave = Ate_Reint.Dh_Atendimento) ) Ate ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00312
---------------------------------------------------------------------------
CURSOR cProcesso_00312(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE RISCO DE PERDA DE CONTAS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TAXA DE RISCO: '||Avg(Nvl(Movimento.Vl_Taxa_Risco_Perda,0))||'%'||Chr(10)|| ', VALOR ESTOQUE CONTAS INTERNAS: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Estoque_Conta_Interna),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR ESTOQUE CONTAS EXTERNAS: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Estoque_Conta_Externa),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR VENCIDO CONTAS INTERNAS (>90 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Vencidas_Conta_Interna),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR VENCIDO CONTAS EXTERNAS (>90 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Vencidas_Conta_Externa),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR TOTAL DO ESTOQUE DE CONTAS: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Estoque_Contas),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR TOTAL DO ESTOQUE DE CONTAS VENCIDAS (>90 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Contas_Vencidas),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Taxa_Risco_Perda,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Taxa_Risco_Perda,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Valor_Estoque_Conta_Interna,0) Valor_Estoque_Conta_Interna , Nvl(Mov.Valor_Estoque_Conta_Externa,0) Valor_Estoque_Conta_Externa , Nvl(Mov.Valor_Vencidas_Conta_Interna,0) Valor_Vencidas_Conta_Interna , Nvl(Mov.Valor_Vencidas_Conta_Externa,0) Valor_Vencidas_Conta_Externa , Nvl(Mov.Valor_Estoque_Conta_Interna,0)+Nvl(Mov.Valor_Estoque_Conta_Externa,0) Valor_Estoque_Contas , Nvl(Mov.Valor_Vencidas_Conta_Interna,0)+Nvl(Mov.Valor_Vencidas_Conta_Externa,0) Valor_Contas_Vencidas , Case
WHEN Nvl(Mov.Valor_Estoque_Conta_Interna,0)+Nvl(Mov.Valor_Estoque_Conta_Externa,0) = 0
THEN 0
ELSE Trunc(((Nvl(Mov.Valor_Vencidas_Conta_Interna,0)+Nvl(Mov.Valor_Vencidas_Conta_Externa,0))/(Nvl(Mov.Valor_Estoque_Conta_Interna,0)+Nvl(Mov.Valor_Estoque_Conta_Externa,0)))*100,2)
END Vl_Taxa_Risco_Perda
FROM ( SELECT Nvl(Sum(Cta.Valor_Vencidas_Conta_Interna),0) Valor_Vencidas_Conta_Interna , Nvl(Sum(Cta.Valor_Vencidas_Conta_Externa),0) Valor_Vencidas_Conta_Externa , Nvl(Sum(Cta.Valor_Estoque_Conta_Interna),0) Valor_Estoque_Conta_Interna , Nvl(Sum(Cta.Valor_Estoque_Conta_Externa),0) Valor_Estoque_Conta_Externa
FROM ( SELECT ---VALOR TOTAL DAS CONTA VENCIDAS--- Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0))+Sum(Nvl(Dme. vl_estoque_conta_sus_interno,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Valor_Estoque_Conta_Interna , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_externo,0))+Sum(Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Valor_Estoque_Conta_Externa ---VALOR TOTAL DAS CONTA VENCIDAS MAIS DE 90 DIA--- , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0))+Sum(Nvl(Dme. vl_estoque_conta_sus_interno,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes < Sysdate-90 --VENCIDAS ),0) Valor_Vencidas_Conta_Interna , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_externo,0))+Sum(Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes < Sysdate-90 --VENCIDAS ),0) Valor_Vencidas_Conta_Externa
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00313
---------------------------------------------------------------------------
CURSOR cProcesso_00313(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%'||Chr(10) ||', QTDE INSTALADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Instalada_Dia)||Chr(10) ||', QTDE UTILIZADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%'||Chr(10) ||'DETALHAMENTO: '||Chr(10) ||', QTDE. INTERNADOS AS 00:00: '||Sum(Movimento.Qtde_00_00)||Chr(10) ||', QTDE. TRANSF. DE: '||Sum(Movimento.Qtde_Transf_De)||Chr(10) ||', QTDE. TRANSF. PARA: '||Sum(Movimento.Qtde_Transf_Para)||Chr(10) ||', QTDE. DE INTERNAÇÃO: '||Sum(Movimento.Qtde_Internacao)||Chr(10) ||', QTDE. ALTAS E OBITOS: '||Sum(Movimento.Qtde_Alta_Obito)||Chr(10) ||', QTDE. PACIENTE DIA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Movimento Qtde_00_00 , Mov.Qtde_Transf_De , Mov.Qtde_Transf_Para , Mov.Qtde_Internacao , Mov.Qtde_Alta_Obito , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Mov.Qtde_Movimento) Qtde_Movimento , Sum(Mov.Qtde_Transf_De) Qtde_Transf_De , Sum(Mov.Qtde_Transf_Para) Qtde_Transf_Para , Sum(Mov.Qtde_Internacao) Qtde_Internacao , Sum(Mov.Qtde_Alta_Obito) Qtde_Alta_Obito , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno,Null,1) Qtde_Movimento , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno,Null,2) Qtde_Transf_De , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno,Null,3) Qtde_Transf_Para , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno,Null,4) Qtde_Internacao , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno,Null,5) Qtde_Alta_Obito , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00314
---------------------------------------------------------------------------
CURSOR cProcesso_00314(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', QTDE INSTALADA NO DIA(DIARIA): '||Sum(Movimento.Qtde_Instalada_Dia) ||', QTDE UTILIZADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00315
---------------------------------------------------------------------------
CURSOR cProcesso_00315(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%'||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY mov.Cd_Unid_int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00316
---------------------------------------------------------------------------
CURSOR cProcesso_00316(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE OCUPACAO GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL, QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2) ||', QTDE UTILIZADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Utilizada),2) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%' ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_dia),2) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Utilizada_Dia),2) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00317
---------------------------------------------------------------------------
CURSOR cProcesso_00317(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'H' --SUSD And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00318
---------------------------------------------------------------------------
CURSOR cProcesso_00318(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00319
---------------------------------------------------------------------------
CURSOR cProcesso_00319(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%'||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY mov.Cd_Unid_int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00320
---------------------------------------------------------------------------
CURSOR cProcesso_00320(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00321
---------------------------------------------------------------------------
CURSOR cProcesso_00321(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%'||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY mov.Cd_Unid_int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00322
---------------------------------------------------------------------------
CURSOR cProcesso_00322(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00323
---------------------------------------------------------------------------
CURSOR cProcesso_00323(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%'||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTOICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY mov.Cd_Unid_int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00324
---------------------------------------------------------------------------
CURSOR cProcesso_00324(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , NUll Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , NUll Tp_diagnostico , NUll nm_indicador , NULL nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE INTERNACOES' Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'NUMERO DE INTERNACOES'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO URGENCIA--- SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Especialid , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dt_mes , Ate.Cd_Especialid , Sum(Ate.Qtde_Utilizada) Qtde_Utilizada , Sum(Ate.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Ate.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Dt_Mes , Ate.Dh_Atendimento , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia , 1 Qtde_Utilizada
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio in ('C','P','H')) And Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Ate
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , Ate.Dt_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00325
---------------------------------------------------------------------------
CURSOR cProcesso_00325(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE CONTAS INT. SUS AIH' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'NUMERO DE CONTAS INT. SUS AIH'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Reg_Fat.Cd_Multi_Empresa , To_Char(Reg_Fat.Dt_Final,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Reg_Fat.Dt_Final Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Reg_Fat
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Reg_fat.Cd_Convenio = Convenio.Cd_Convenio And Convenio.Tp_Convenio = 'H') And Reg_Fat.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Reg_Fat.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00339
---------------------------------------------------------------------------
CURSOR cProcesso_00339(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Dimensao.Cd_Dimensao Cd_Departamento , Dimensao.Ds_Dimensao Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'CONTRATUALIZACAO SUS, VALOR PRODUZIDO: '||Sum(Movimento.Valor_Produzido) ||', QTDE PROJETADA/CONTRATO: '||Sum(Movimento.Valor_Projetado) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , '' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTRATUALIZA??O SUS-- SELECT Mov.Data_Mes , Mov.Cd_Dimensao , Mov.Valor_Produzido , Mov.Valor_Projetado , Case
WHEN Mov.Valor_Produzido = 0
THEN 0
ELSE Round((Nvl(Mov.Valor_Projetado,0)/Nvl(Mov.Valor_Produzido,0))*100,2)
END Vl_Taxa_Projetada
FROM (--VALOR DAS AIHS-- SELECT 1 Cd_Dimensao --Valor da AIH , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY') Data_Mes , Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)) Valor_Produzido , Nvl(( SELECT Sum(Nvl(vl_internacao_contrato,0))
FROM Dbamv.Contrato_Sus Cs, Dbamv.Item_Contrato_Sus Ics
WHERE Cs.Cd_Contrato_Sus = Ics.Cd_Contrato_Sus And Cs.dt_vigencia_ini BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.dt_vigencia_Fim BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.cd_multi_empresa = pCdMultiEmpresa) --Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM ( SELECT Valor.Cd_Lancamento , Valor.Dt_Lancamento , Nvl(Valor.vl_sh_sp_proprio,0) Vl_Total_Conta
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Dt_Lancamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Valor_Conta
GROUP BY To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY')
UNION ALL --QUATIDADE DE AIHS (NUMERO DE INTERNA??ES-- SELECT 2 Cd_Dimensao --Quantidade de AIH , To_Char(Reg.Dt_Final,'MM/YYYY') Data_Mes , Count(1) Valor_Produzido , Nvl(( SELECT Sum(Nvl(qt_internacao_contrato,0))
FROM Dbamv.Contrato_Sus Cs, Dbamv.Item_Contrato_Sus Ics
WHERE Cs.Cd_Contrato_Sus = Ics.Cd_Contrato_Sus And Cs.dt_vigencia_ini BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.dt_vigencia_Fim BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.cd_multi_empresa = pCdMultiEmpresa) ---Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM Dbamv.Reg_Fat Reg
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Reg.Cd_Convenio = Con.Cd_Convenio And Con.Tp_Convenio = 'H') --SOMENTE CONTA DE AIH And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Reg.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY To_Char(Reg.Dt_Final,'MM/YYYY')
UNION ALL --VALOR SIA-- SELECT 3 Cd_Dimensao --Valor da SIA , To_Char(Valor_Conta.dh_atendimento,'MM/YYYY') Data_Mes , Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)) Valor_Produzido , Nvl(( SELECT Sum(Nvl(vl_ambulatorial_contrato,0))
FROM Dbamv.Contrato_Sus Cs, Dbamv.Item_Contrato_Sus Ics
WHERE Cs.Cd_Contrato_Sus = Ics.Cd_Contrato_Sus And Cs.dt_vigencia_ini BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.dt_vigencia_Fim BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.cd_multi_empresa = pCdMultiEmpresa) --Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM (--CONTAS SIA SUS SELECT Ate.dh_atendimento , ( SELECT Sum(Eve.Vl_Total_Ambulatorial)
FROM Dbamv.Eve_SiaSus Eve
WHERE Eve.Cd_Atendimento = Ate.Cd_Atendimento) Vl_Total_Conta
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Con.Tp_Convenio IN ('A')) --SOMENTE CONTA DE SIA And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Valor_Conta
GROUP BY To_Char(Valor_Conta.dh_atendimento,'MM/YYYY')
UNION ALL --QUATIDADE SIA (NUMERO DE ATENDIMENTOS-- SELECT 4 Cd_Dimensao --Quantidade de SIA , To_Char(Ate.dh_atendimento,'MM/YYYY') Data_Mes , Count(1) Valor_Produzido , Nvl(( SELECT Sum(Nvl(qt_ambulatorial_contrato,0))
FROM Dbamv.Contrato_Sus Cs, Dbamv.Item_Contrato_Sus Ics
WHERE Cs.Cd_Contrato_Sus = Ics.Cd_Contrato_Sus And Cs.dt_vigencia_ini BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.dt_vigencia_Fim BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cs.cd_multi_empresa = pCdMultiEmpresa) --Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Con.Tp_Convenio IN ('A')) --SOMENTE CONTA SIA And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY To_Char(Ate.dh_atendimento,'MM/YYYY') ) Mov ) Movimento , ( SELECT 1 Cd_Dimensao, 'VALOR DAS AIHS' Ds_Dimensao
FROM Dual
UNION ALL SELECT 2 Cd_Dimensao, 'QUANTIDADE DAS AIHS' Ds_Dimensao
FROM Dual
UNION ALL SELECT 3 Cd_Dimensao, 'VALOR SIA' Ds_Dimensao
FROM Dual
UNION ALL SELECT 4 Cd_Dimensao, 'QUANTIDADE SIA' Ds_Dimensao
FROM Dual ) Dimensao , MvccAdmin.Estabelecimento
WHERE Dimensao.Cd_Dimensao = Movimento.Cd_Dimensao And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Dimensao.Cd_Dimensao , Dimensao.Ds_Dimensao , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00340
---------------------------------------------------------------------------
CURSOR cProcesso_00340(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Dimensao.Cd_Dimensao Cd_Departamento , Dimensao.Ds_Dimensao Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'CONTROLE DE TETO UPS, VALOR PRODUZIDO: '||Sum(Movimento.Valor_Produzido) ||', QTDE PROJETADA/CONTRATO: '||Sum(Movimento.Valor_Projetado) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , '' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Produzido) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Produzido) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTRATUALIZA??O SUS-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Dimensao , Mov.Valor_Produzido , Mov.Valor_Projetado , Case
WHEN Mov.Valor_Produzido = 0
THEN 0
ELSE Round((Nvl(Mov.Valor_Projetado,0)/Nvl(Mov.Valor_Produzido,0))*100,2)
END Vl_Taxa_Projetada
FROM (--VALOR SERVICO AMBULATORIAL--- SELECT Valor_Conta.Cd_Multi_Empresa , 1 Cd_Dimensao --Valor vl_servico_ambulatorial , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY') Data_Mes , Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)) Valor_Produzido , Nvl(( SELECT Sum(Nvl(vl_servico_ambulatorial,0))
FROM Dbamv.Unidade_Prestadora_Servico Ups, Dbamv.Procedimento_Sus_Valor_Contrat Psvc
WHERE Ups.Cd_Ups = Psvc.Cd_Ups And Psvc.dt_vigencia BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ups.cd_multi_empresa = pCdMultiEmpresa) --Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM ( SELECT Eve.Cd_Multi_Empresa , Eve.Dt_Lancamento , Eve.vl_total_ambulatorial Vl_Total_Conta
FROM Dbamv.Eve_Siasus Eve
WHERE Eve.Cd_Multi_Empresa = pCdMultiEmpresa And Eve.Dt_Lancamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Valor_Conta
GROUP BY Valor_Conta.Cd_Multi_Empresa , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY')
UNION ALL --VALOR SERVICO PROFISSIONAL--- SELECT Valor_Conta.Cd_Multi_Empresa , 2 Cd_Dimensao --Valor vl_servico_profissional_amb , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY') Data_Mes , Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)) Valor_Produzido , Nvl(( SELECT Sum(Nvl(vl_servico_profissional_amb,0))
FROM Dbamv.Unidade_Prestadora_Servico Ups, Dbamv.Procedimento_Sus_Valor_Contrat Psvc
WHERE Ups.Cd_Ups = Psvc.Cd_Ups And Psvc.dt_vigencia BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ups.cd_multi_empresa = pCdMultiEmpresa) --Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM ( SELECT Eve.Cd_Multi_Empresa , Eve.Dt_Lancamento , Eve.vl_servico_profissional Vl_Total_Conta --servico_profissional
FROM Dbamv.Eve_Siasus Eve
WHERE Eve.Cd_Multi_Empresa = pCdMultiEmpresa And Eve.Dt_Lancamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Valor_Conta
GROUP BY Valor_Conta.Cd_Multi_Empresa , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY')
UNION ALL --VALOR SERVICO ANESTESIA--- SELECT Valor_Conta.Cd_Multi_Empresa , 3 Cd_Dimensao --Valor vl_servico_anestesia_amb , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY') Data_Mes , Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)) Valor_Produzido , Nvl(( SELECT Sum(Nvl(vl_servico_anestesia_amb,0))
FROM Dbamv.Unidade_Prestadora_Servico Ups, Dbamv.Procedimento_Sus_Valor_Contrat Psvc
WHERE Ups.Cd_Ups = Psvc.Cd_Ups And Psvc.dt_vigencia BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ups.cd_multi_empresa = pCdMultiEmpresa) --Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM ( SELECT Eve.Cd_Multi_Empresa , Eve.Dt_Lancamento , Eve.vl_servico_anestesia Vl_Total_Conta --servico_anestesia
FROM Dbamv.Eve_Siasus Eve
WHERE Eve.Cd_Multi_Empresa = pCdMultiEmpresa And Eve.Dt_Lancamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Valor_Conta
GROUP BY Valor_Conta.Cd_Multi_Empresa , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY')
UNION ALL --VALOR SERVICO TOTAL AMBULATORIAL--- SELECT Valor_Conta.Cd_Multi_Empresa , 4 Cd_Dimensao --Valor vl_total_ambulatorial , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY') Data_Mes , Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)) Valor_Produzido , Nvl(( SELECT Sum(Nvl(vl_total_ambulatorial,0))
FROM Dbamv.Unidade_Prestadora_Servico Ups, Dbamv.Procedimento_Sus_Valor_Contrat Psvc
WHERE Ups.Cd_Ups = Psvc.Cd_Ups And Psvc.dt_vigencia BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ups.cd_multi_empresa = pCdMultiEmpresa) --Valor_Contratado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Nvl(Valor_Conta.Vl_Total_Conta,0)),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Valor_Projetado
FROM ( SELECT Eve.Cd_Multi_Empresa , Eve.Dt_Lancamento , Eve.vl_total_ambulatorial Vl_Total_Conta --servico_total_ambulatorial
FROM Dbamv.Eve_Siasus Eve
WHERE Eve.Cd_Multi_Empresa = pCdMultiEmpresa And Eve.Dt_Lancamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Valor_Conta
GROUP BY Valor_Conta.Cd_Multi_Empresa , To_Char(Valor_Conta.Dt_Lancamento,'MM/YYYY') ) Mov ) Movimento , ( SELECT 1 Cd_Dimensao, 'VALOR SERV. AMBULATORIAL' Ds_Dimensao
FROM Dual
UNION ALL SELECT 2 Cd_Dimensao, 'VALOR SERV. PROFISSIONAL' Ds_Dimensao
FROM Dual
UNION ALL SELECT 3 Cd_Dimensao, 'VALOR SERV. ANESTESIA' Ds_Dimensao
FROM Dual
UNION ALL SELECT 4 Cd_Dimensao, 'VALOR TOTAL AMBULATORIAL' Ds_Dimensao
FROM Dual ) Dimensao , MvccAdmin.Estabelecimento
WHERE Dimensao.Cd_Dimensao = Movimento.Cd_Dimensao And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Dimensao.Cd_Dimensao , Dimensao.Ds_Dimensao , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00389
---------------------------------------------------------------------------
CURSOR cProcesso_00389(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'DESP. C/PESSOAL TOTAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'DESP. C/PESSOAL TOTAL, VALOR REALIZADO: '||Nvl(LTrim(To_Char(Nvl(Movimento.Valor_Desp_Pessoal,0),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Nvl(Movimento.Valor_Desp_Pessoal_Proj,0),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Valor_Desp_Pessoal_Proj Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Valor_Desp_Pessoal_Proj_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Desp_Pessoal) Valor_Desp_Pessoal , Sum(Mov.Valor_Desp_Pessoal)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Desp_Pessoal_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Desp_Pessoal),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Desp_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Desp_Pessoal),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Desp_Pessoal_Proj_Dia
FROM (---MOVIMENTO--- SELECT Sum(Dme.vl_despesas_pessoal) Valor_Desp_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00390
---------------------------------------------------------------------------
CURSOR cProcesso_00390(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR CUSTO OPERACIONAL GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR CUSTO OPERACIONAL GLOBAL'||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00399
---------------------------------------------------------------------------
CURSOR cProcesso_00399(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', QTDE DE ITENS MOVIMENTADOS: '||Nvl(Ltrim(To_Char(Nvl(Movimento.Qtde_Movimentada,0),'999G999G999G999')),'0')||Chr(10) ||', QTDE DE ITENS DEVOLVIDOS: '||Nvl(Ltrim(To_Char(Nvl(Movimento.Qtde_Devolucao,0),'999G999G999G999')),'0')||Chr(10) ||', TAXA DE DEVOLUÇÃO: '||Movimento.Vl_Taxa_Devolucao||'%'||Chr(10) ||', QTDE DE ITENS MOVIMENTADOS NO DIA: '||Nvl(Ltrim(To_Char(Nvl(Movimento.Qtde_Movimentada_Dia,0),'999G999G999G999')),'0')||Chr(10) ||', QTDE DE ITENS DEVOLVIDOS NO DIA: '||Nvl(Ltrim(To_Char(Nvl(Movimento.Qtde_Devolucao_Dia,0),'999G999G999G999')),'0')||Chr(10) ||', TAXA DE DEVOLUÇÃO NO DIA: '||Movimento.Vl_Taxa_Devolucao||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Movimento.Qtde_Movimentada Qtde_Instalada , 'CONTAGEM' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Devolucao Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Devolucao_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Trunc(Mov.Qtde_Movimentada) Qtde_Movimentada , Trunc(Mov.Qtde_Devolucao) Qtde_Devolucao , Trunc(Mov.Qtde_Movimentada_Dia) Qtde_Movimentada_Dia , Trunc(Mov.Qtde_Devolucao_Dia) Qtde_Devolucao_Dia , (Case
WHEN Mov.Qtde_Movimentada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Devolucao/Mov.Qtde_Movimentada)*100,2)
END ) Vl_Taxa_Devolucao , (Case
WHEN Mov.Qtde_Movimentada_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Devolucao_Dia/Mov.Qtde_Movimentada_Dia)*100,2)
END ) Vl_Taxa_Devolucao_Dia
FROM ( SELECT Str.Cd_Setor , ( SELECT Sum(ItMv.qt_movimentacao)/Max(( SELECT unp.vl_fator
FROM Dbamv.Uni_Pro Unp
WHERE Unp.Tp_Relatorios = 'R' And Unp.cd_uni_pro = ItMv.cd_uni_pro And Unp.cd_produto = ItMv.cd_produto))
FROM Dbamv.Mvto_Estoque Mvto , Dbamv.ItMvto_Estoque ItMv
WHERE Mvto.Cd_Mvto_Estoque = ItMv.Cd_Mvto_Estoque And Mvto.Tp_Mvto_Estoque In ('S','P') And Mvto.dt_mvto_estoque Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Mvto.Cd_Setor = Str.Cd_Setor And Mvto.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Movimentada , ( SELECT Sum(ItMv.qt_movimentacao)/Max(( SELECT unp.vl_fator
FROM Dbamv.Uni_Pro Unp
WHERE Unp.Tp_Relatorios = 'R' And Unp.cd_uni_pro = ItMv.cd_uni_pro And Unp.cd_produto = ItMv.cd_produto))
FROM Dbamv.Mvto_Estoque Mvto , Dbamv.ItMvto_Estoque ItMv
WHERE Mvto.Cd_Mvto_Estoque = ItMv.Cd_Mvto_Estoque And Mvto.Tp_Mvto_Estoque In ('S','P') And Mvto.dt_mvto_estoque Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Mvto.Cd_Setor = Str.Cd_Setor And Mvto.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Movimentada_Dia , ( SELECT Sum(ItMv.qt_movimentacao)/Max(( SELECT unp.vl_fator
FROM Dbamv.Uni_Pro Unp
WHERE Unp.Tp_Relatorios = 'R' And Unp.cd_uni_pro = ItMv.cd_uni_pro And Unp.cd_produto = ItMv.cd_produto))
FROM Dbamv.Mvto_Estoque Mvto , Dbamv.ItMvto_Estoque ItMv
WHERE Mvto.Cd_Mvto_Estoque = ItMv.Cd_Mvto_Estoque And Mvto.Tp_Mvto_Estoque In ('D','C') --DEVOLUÇÃO And Mvto.dt_mvto_estoque Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Mvto.Cd_Setor = Str.Cd_Setor And Mvto.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Devolucao , ( SELECT Sum(ItMv.qt_movimentacao)/Max(( SELECT unp.vl_fator
FROM Dbamv.Uni_Pro Unp
WHERE Unp.Tp_Relatorios = 'R' And Unp.cd_uni_pro = ItMv.cd_uni_pro And Unp.cd_produto = ItMv.cd_produto))
FROM Dbamv.Mvto_Estoque Mvto , Dbamv.ItMvto_Estoque ItMv
WHERE Mvto.Cd_Mvto_Estoque = ItMv.Cd_Mvto_Estoque And Mvto.Tp_Mvto_Estoque In ('D','C') --DEVOLUÇÃO And Mvto.dt_mvto_estoque Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Mvto.Cd_Setor = Str.Cd_Setor And Mvto.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Devolucao_Dia
FROM Dbamv.Setor Str
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int Und
WHERE Und.Cd_Setor = Str.Cd_Setor
UNION ALL SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Setor = Str.Cd_Setor) And Str.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa AND Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00401
---------------------------------------------------------------------------
CURSOR cProcesso_00401(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Departamento.Cd_Departamento , Departamento.Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Departamento.Ds_Departamento||Chr(10)||', QTDE DE PAC´S ATENDIDOS: '||Movimento.Qtde_Paciente||Chr(10) ||', QTDE DE PAC´S COM USO DE TERAPIA: '||Movimento.Qtde_Uso_Tera||Chr(10) ||', TAXA DE PAC´S COM USO DE TERAPIA: '||Movimento.Vl_Perc_Uso_Tera||'%'||Chr(10) ||', QTDE DE PAC´S ATENDIDOS NO DIA: '||Movimento.Qtde_Paciente_Dia||Chr(10) ||', QTDE DE PAC´S COM USO DE TERAPIA NO DIA: '||Movimento.Qtde_Uso_Tera_Dia||Chr(10) ||', TAXA DE PAC´S COM USO DE TERAPIA NO DIA: '||Movimento.Vl_Perc_Uso_Tera_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/MEDICAMENTOS: '||Movimento.Qtde_Uso_Medi||Chr(10) ||', TAXA DE PAC´S SOMENTE C/MEDICAMENTOS: '||Movimento.Vl_Perc_Uso_Medi||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/MEDICAMENTOS NO DIA: '||Movimento.Qtde_Uso_Medi_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/MEDICAMENTOS NO DIA: '||Movimento.Vl_Perc_Uso_Medi_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM: '||Movimento.Qtde_Uso_Imag||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM: '||Movimento.Vl_Perc_Uso_Imag||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM NO DIA: '||Movimento.Qtde_Uso_Imag_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO: '||Movimento.Qtde_Uso_Labo||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO: '||Movimento.Vl_Perc_Uso_Labo||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO NO DIA: '||Movimento.Qtde_Uso_Labo_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO NO DIA: '||Movimento.Vl_Perc_Uso_Labo_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO: '||Movimento.Qtde_Uso_Imag_Labo||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO: '||Movimento.Vl_Perc_Uso_Imag_Labo||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO NO DIA: '||Movimento.Qtde_Uso_Imag_Labo_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Labo_Dia||'%'||Chr(10) ||', QTDE DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO: '||Movimento.Qtde_Uso_Imag_Labo_Medi||Chr(10) ||', TAXA DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO: '||Movimento.Vl_Perc_Uso_Imag_Labo_Medi||'%'||Chr(10) ||', QTDE DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Qtde_Uso_Imag_Labo_Medi_Dia||Chr(10) ||', TAXA DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Labo_Medi_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO: '||Movimento.Qtde_Uso_Imag_Medi||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO: '||Movimento.Vl_Perc_Uso_Imag_Medi||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO NO DIA: '||Movimento.Qtde_Uso_Imag_Medi_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Medi_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO: '||Movimento.Qtde_Uso_Labo_Medi||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO: '||Movimento.Vl_Perc_Uso_Labo_Medi||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Qtde_Uso_Labo_Medi_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Vl_Perc_Uso_Labo_Medi_Dia||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Perc_Uso_Tera Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Perc_Uso_Tera_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Atendimento,'MM/YYYY') Data_Mes , Mov.Cd_departamento , Mov.Tp_Dimensao ---MENSAL--- , Sum(Mov.Qtde_Paciente) Qtde_Paciente , Sum(Mov.Qtde_Uso_Tera) Qtde_Uso_Tera , Sum(Mov.Qtde_Uso_Medi) Qtde_Uso_Medi , Sum(Mov.Qtde_Uso_Imag) Qtde_Uso_Imag , Sum(Mov.Qtde_Uso_Labo) Qtde_Uso_Labo , Sum(Mov.Qtde_Uso_Imag_Labo) Qtde_Uso_Imag_Labo , Sum(Mov.Qtde_Uso_Imag_Labo_Medi) Qtde_Uso_Imag_Labo_Medi , Sum(Mov.Qtde_Uso_Imag_Medi) Qtde_Uso_Imag_Medi , Sum(Mov.Qtde_Uso_Labo_Medi) Qtde_Uso_Labo_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Tera)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Tera , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Labo , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag_Labo , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag_Labo_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Labo_Medi ---DIARIO--- , Sum(Mov.Qtde_Paciente_Dia) Qtde_Paciente_Dia , Sum(Mov.Qtde_Uso_Tera_Dia) Qtde_Uso_Tera_Dia , Sum(Mov.Qtde_Uso_Medi_Dia) Qtde_Uso_Medi_Dia , Sum(Mov.Qtde_Uso_Imag_Dia) Qtde_Uso_Imag_Dia , Sum(Mov.Qtde_Uso_Labo_Dia) Qtde_Uso_Labo_Dia , Sum(Mov.Qtde_Uso_Imag_Labo_Dia) Qtde_Uso_Imag_Labo_Dia , Sum(Mov.Qtde_Uso_Imag_Labo_Medi_Dia) Qtde_Uso_Imag_Labo_Medi_Dia , Sum(Mov.Qtde_Uso_Imag_Medi_Dia) Qtde_Uso_Imag_Medi_Dia , Sum(Mov.Qtde_Uso_Labo_Medi_Dia) Qtde_Uso_Labo_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Tera_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Tera_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Labo_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Labo_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Labo_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Labo_Medi_Dia
FROM (---MEDICAMENTOS-- SELECT Mov.Cd_Multi_Empresa , Mov.Dh_Atendimento , Mov.Tp_Dimensao , (Case
WHEN Mov.Tp_Dimensao = 'E'
THEN Mov.Cd_Especialid
ELSE Mov.Cd_Fila_Senha
END ) Cd_departamento --- MENSAL --- , Mov.Qtde_Paciente , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag , (Case
WHEN Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo , (Case
WHEN Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 1 Or Mov.Qtde_Uso_Imag = 1 Or Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Tera --- DIARIO --- , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Paciente
ELSE 0
END ) Qtde_Paciente_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And (Mov.Qtde_Uso_Medi = 1 Or Mov.Qtde_Uso_Imag = 1 Or Mov.Qtde_Uso_Labo = 1)
THEN 1
ELSE 0
END ) Qtde_Uso_Tera_Dia
FROM (---MEDICAMENTOS--- SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Atendimento , Ate.Cd_Especialid , Ta.Cd_Fila_Senha , 1 Qtde_Paciente , Nvl(( SELECT Min(1)
FROM Dbamv.Pre_Med Prm, Dbamv.ItPre_Med Itp
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And Itp.Tp_Situacao = 'N' And Prm.Fl_Impresso = 'S' And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) And Itp.Cd_Tip_Esq = ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 196 --TIPO DE ESQUEMA DA PRESCRIÇÃO-MEDICAMENTOS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa
GROUP BY Vcc.Cd_Campo_Chave) And Rownum = 1),0) Qtde_Uso_Medi , Nvl(( SELECT Min(1)
FROM Dbamv.Pre_Med Prm, Dbamv.ItPre_Med Itp
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And Itp.Tp_Situacao = 'N' And Prm.Fl_Impresso = 'S' And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) And Itp.Cd_Tip_Esq = ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 198 --TIPO DE ESQUEMA DA PRESCRIÇÃO-IMAGINOLOGIA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa
GROUP BY Vcc.Cd_Campo_Chave) And Rownum = 1),0) Qtde_Uso_Imag , Nvl(( SELECT Min(1)
FROM Dbamv.Pre_Med Prm, Dbamv.ItPre_Med Itp
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And Itp.Tp_Situacao = 'N' And Prm.Fl_Impresso = 'S' And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) And Itp.Cd_Tip_Esq = ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 197 --TIPO DE ESQUEMA DA PRESCRIÇÃO-LABORATORIO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa
GROUP BY Vcc.Cd_Campo_Chave) And Rownum = 1),0) Qtde_Uso_Labo , Nvl(( SELECT Min('E')
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'ESPECIALIDADE' And Vcc.Cd_Tipo_Campo_Chave = 145 ---TIPO DE DIMENSAO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'F') Tp_Dimensao
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Atendimento,'MM/YYYY') , Mov.Cd_departamento , Mov.Tp_Dimensao ) Movimento , ( SELECT Esp.Cd_Especialid Cd_Departamento, Esp.Ds_Especialid Ds_Departamento, 'E' Tp_Dimensao
FROM Dbamv.Especialid Esp
UNION ALL SELECT Fse.Cd_Fila_Senha Cd_Departamento, Fse.Ds_Fila Ds_Departamento, 'F' Tp_Dimensao
FROM Dbamv.Fila_Senha Fse) Departamento , MvccAdmin.Estabelecimento
WHERE Departamento.Cd_Departamento = Movimento.Cd_Departamento And Departamento.Tp_Dimensao = Movimento.Tp_Dimensao And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00427
---------------------------------------------------------------------------
CURSOR cProcesso_00427(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA: '||Movimento.Qtde_Instalada||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Movimento.Qtde_Utilizada||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Movimento.Qtde_Utilizada_Dia||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Movimento.Vl_Taxa_Ocupacao||' %'||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Movimento.Vl_Taxa_Ocupacao_Dia||' %'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Movimento.Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Ocupacao Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Ocupacao_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00428
---------------------------------------------------------------------------
CURSOR cProcesso_00428(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA: '||Movimento.Qtde_Instalada||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Movimento.Qtde_Utilizada||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Movimento.Qtde_Utilizada_Dia||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Movimento.Vl_Taxa_Ocupacao||' %'||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Movimento.Vl_Taxa_Ocupacao_Dia||' %'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Movimento.Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Ocupacao Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Ocupacao_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00429
---------------------------------------------------------------------------
CURSOR cProcesso_00429(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO URGENCIA--- SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Unid_Int , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Unid_Int , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Dt_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc, Dbamv.Diagnostico_Atendime Cid
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Cid.Cd_Cid And Cid.Cd_Atendimento = Ate.Cd_Atendimento And Vcc.Cd_Tipo_Campo_Chave = 2 --CID A SER CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Unid_Int.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Unid_Int.Cd_Setor = Setor.Cd_Setor And Setor.Cd_multi_empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Nvl(Movimento.Dt_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00437
---------------------------------------------------------------------------
CURSOR cProcesso_00437(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , NULL Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes, To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'CONVENIO: '||Convenio.Nm_Convenio||', MÊS ANALISADO: '||To_Char(Add_Months(v_Dt_Ini_Diagno,-1),'MM/YYYY') ||', QTDE DE ALTAS/PARCIAL: '||Sum(Nvl(Movimento.Qtde_Altas,0)) ||', QTDE DE ENTREGUES: '||Sum(Nvl(Movimento.Qtde_Entregues,0)) ||', TAXA DE ENTREGA: '||Sum(Nvl(Movimento.Taxa_Entregues,0))||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'REG_FAT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Entregues,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Entregues,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---CONVENIO EXTERNO MES DA ALTA-- SELECT Mov.Cd_Convenio , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Nvl(Mov.Qtde_Altas,0) Qtde_Altas , Nvl(Mov.Qtde_Entregues,0) Qtde_Entregues , Nvl(Mov.Qtde_Entregues,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Entregues_Dia , Case
WHEN Nvl(Mov.Qtde_Altas,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.Qtde_Entregues,0)/Nvl(Mov.Qtde_Altas,0))*100,2)
END Taxa_Entregues
FROM ( SELECT Con.Cd_Convenio , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM Dbamv.Reg_Amb Reg
WHERE Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Reg.Dt_Lancamento Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-1),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Convenio = Con.Cd_Convenio) Qtde_Altas , ( SELECT Count(1)
FROM Dbamv.Reg_Amb Reg
WHERE Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Reg.Dt_Lancamento Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-1),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Convenio = Con.Cd_Convenio -- CONVENIO COM TISS --- And Exists (--- CONVENIO COM TISS --- SELECT 1
FROM Dbamv.Tiss_Guia Tg, Dbamv.Tiss_Mensagem Tm
WHERE Tg.Id = Tm.Id And Tg.Cd_Reg_Amb = Reg.Cd_Reg_Amb And Tm.tp_transacao = 'ENVIO_LOTE_GUIAS' And Tm.nr_documento IS Not Null And Tm.dt_enviou_xml Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno ,-1),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999
UNION ALL --CONVENIO SEM TISS--- SELECT 1
FROM Dbamv.Remessa_Fatura Rms, Dbamv.Fatura Fat
WHERE Rms.Cd_Fatura = Fat.Cd_Fatura And Rms.Cd_Remessa = Reg.Cd_Remessa And Rms.dt_entrega_da_fatura Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno ,-1),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Not Exists ( SELECT 1
FROM Dbamv.Convenio_Conf_Tiss Tis
WHERE Tis.Cd_Convenio = Fat.Cd_Convenio)) --COM TISS ) Qtde_Entregues
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'C' ) Mov
WHERE Nvl(Mov.Qtde_Altas,0) > 0 ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Nvl(Movimento.Qtde_Altas,0) > 0 And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes, To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Convenio.Cd_Convenio , Convenio.Nm_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00451
---------------------------------------------------------------------------
CURSOR cProcesso_00451(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Usuarios.Cd_Usuario Cd_Departamento , Usuarios.Cd_Login Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Usuarios.Cd_Login||', QTDE REGISTROS NAS CONTAS: '||Trunc(Sum(Movimento.Qtde_Registro_Total),2)||Chr(10) ||', QTDE REGISTROS AUDITADOS: '||Trunc(Sum(Movimento.Qtde_Registro_Fechado),2)||Chr(10) ||', TAXA DE REGISTROS AUDITADOS: '||Trunc(Avg(Movimento.Perc_Registro_Fechado),2)||'%'||Chr(10) ||', QTDE REGISTROS NAS CONTAS - MÉDIA DIA: '||Trunc(Sum(Movimento.Qtde_Registro_Total_Dia),2)||Chr(10) ||', QTDE REGISTROS AUDITADOS DIA: '||Trunc(Sum(Movimento.Qtde_Registro_Fechado_Dia),2)||Chr(10) ||', TAXA DE REGISTROS AUDITADOS DIA: '||Trunc(Avg(Movimento.Perc_Registro_Fechado_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITREG_FAT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Perc_Registro_Fechado,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Perc_Registro_Fechado_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Usuario Cd_Usuario , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Registro_Total , Mov.Qtde_Registro_Fechado , Mov.Qtde_Registro_Total_Dia , Mov.Qtde_Registro_Fechado_Dia , Trunc(Mov.Qtde_Registro_Fechado/Mov.Qtde_Registro_Total*100,2) Perc_Registro_Fechado , Trunc(Mov.Qtde_Registro_Fechado_Dia/Mov.Qtde_Registro_Total_Dia*100,2) Perc_Registro_Fechado_Dia
FROM ( SELECT Usu.Cd_Usuario Cd_Usuario , Count(1) Qtde_Registro_Fechado , Sum(Case
WHEN Reg.Dt_Fechamento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Registro_Fechado_Dia , Registro.Qtde_Registro_Total , Trunc(Registro.Qtde_Registro_Total/To_Char(v_Dt_Final_Diagno,'DD')) Qtde_Registro_Total_Dia
FROM Dbamv.Reg_Fat Reg , Dbamv.ItReg_Fat ItR , ( SELECT Ball.User_Id Cd_Usuario, Usu.Cd_Usuario Cd_Login
FROM All_Users Ball, Dbasgu.Usuarios Usu
WHERE Usu.Cd_Usuario = Ball.Username) Usu , ( SELECT Count(1) Qtde_Registro_Total
FROM Dbamv.Reg_Fat Reg, Dbamv.ItReg_Fat ItR
WHERE Reg.Cd_Reg_Fat = Itr.Cd_Reg_Fat And Reg.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Reg.Cd_Multi_Empresa = pCdMultiEmpresa) Registro
WHERE Reg.Cd_Reg_Fat = Itr.Cd_Reg_Fat And Reg.Nm_Usuario_Fechou = Usu.Cd_Login And Reg.Dt_Fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Reg.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Usu.Cd_Usuario , Registro.Qtde_Registro_Total ) Mov ) Movimento , ( SELECT Ball.User_Id Cd_Usuario, Usu.Cd_Usuario Cd_Login
FROM All_Users Ball, Dbasgu.Usuarios Usu
WHERE Usu.Cd_Usuario = Ball.Username) Usuarios , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Usuario = Usuarios.Cd_Usuario And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj , Usuarios.Cd_Usuario , Usuarios.Cd_Login;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00472
---------------------------------------------------------------------------
CURSOR cProcesso_00472(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NULL nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%' ||', QTDE INSTALADA NO DIA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2) ||', QTDE UTILIZADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00473
---------------------------------------------------------------------------
CURSOR cProcesso_00473(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio In ('C','P') --CONVENIO/PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00474
---------------------------------------------------------------------------
CURSOR cProcesso_00474(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00475
---------------------------------------------------------------------------
CURSOR cProcesso_00475(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00476
---------------------------------------------------------------------------
CURSOR cProcesso_00476(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00477
---------------------------------------------------------------------------
CURSOR cProcesso_00477(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPAÇÃO UNID. ABERTA-PANDEMIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPAÇÃO UNID.ABERTA-PANDEMIA-GLOBAL'||Chr(10)||', QTDE INSTALADA: '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00478
---------------------------------------------------------------------------
CURSOR cProcesso_00478(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE MORTALIDADE INSTITUCIONAL' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'TAXA DE MORTALIDADE INSTITUCIONAL, QTDE DE ALTAS: '||Sum(Movimento.Qtde_Altas) ||', QTDE DE OBITOS: '||Sum(Nvl(Movimento.Qtde_Mortes,0)) ||', TAXA DE MORTALIDADE: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes,0))||'%' ||', QTDE DE ALTAS DO DIA: '||Sum(Movimento.Qtde_Altas_Dia) ||', QTDE DE OBITOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)) ||', TAXA DE MORTALIDADE NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Mortes,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , Mov.Qtde_Mortes , Mov.Qtde_Altas , Mov.Qtde_Mortes_Dia , Mov.Qtde_Altas_Dia , (Case
WHEN Mov.Qtde_Altas = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes/Mov.Qtde_Altas)*100,2)
END ) Vl_Taxa_Mortes , (Case
WHEN Mov.Qtde_Altas_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Taxa_Mortes_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 > 24 --MAIS DE HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Mortes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 > 24 --MAIS DE HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Mortes_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00479
---------------------------------------------------------------------------
CURSOR cProcesso_00479(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE ABANDONO/EVASAO' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'TAXA DE ABANDONO/EVASÃO - SUS INTERNADOS, QTDE DE ALTAS: '||Sum(Movimento.Qtde_Altas) ||', QTDE DE ABANDONOS: '||Sum(Nvl(Movimento.Qtde_Abandono,0)) ||', TAXA DE ABANDONO: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2)||'%' ||', QTDE DE ALTAS DO DIA: '||Sum(Movimento.Qtde_Altas_Dia) ||', QTDE DE ABANDONOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Abandono_Dia,0)) ||', TAXA DE ABANDONO NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono_Dia,0)),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE ABANDONO-- SELECT Mov.cd_multi_empresa , Mov.Qtde_Abandono , Mov.Qtde_Altas , Mov.Qtde_Abandono_Dia , Mov.Qtde_Altas_Dia , (Case
WHEN Mov.Qtde_Altas = 0
THEN 0
ELSE Round((Mov.Qtde_Abandono/Mov.Qtde_Altas)*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Mov.Qtde_Altas_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Abandono_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.cd_alta_sus = 16 And Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Abandono , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.cd_alta_sus = 16 And Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Abandono_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00480
---------------------------------------------------------------------------
CURSOR cProcesso_00480(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE DE READMISSÃO: '||Nvl(Movimento.Qtde_Reint_Uti,0)||Chr(10) ||', QTDE DE READMISSÃO <24H: '||Nvl(Movimento.Qtde_Reint_Uti_24h,0)||Chr(10) ||', TAXA DE READMISSÃO <24H: '||Nvl(Movimento.Vl_Taxa_Conforme,0)||Chr(10) ||', QTDE DE READMISSÃO NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_Dia,0)||Chr(10) ||', QTDE DE READMISSÃO <24H NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_24h_Dia,0)||Chr(10) ||', TAXA DE READMISSÃO <24H NO DIA: '||Nvl(Movimento.Vl_Taxa_Conforme_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Conforme,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Vl_Taxa_Conforme_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Reint_Uti , Mov.Qtde_Reint_Uti_Dia , Mov.Qtde_Reint_Uti_24h , Mov.Qtde_Reint_Uti_24h_Dia , (Case
WHEN Mov.Qtde_Reint_Uti = 0
THEN 0
ELSE Round((Mov.Qtde_Reint_Uti_24h/Mov.Qtde_Reint_Uti)*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Mov.Qtde_Reint_Uti_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Reint_Uti_24h_Dia/Mov.Qtde_Reint_Uti_Dia)*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Sum(Mov.Qtde_Reint_Uti) Qtde_Reint_Uti , Sum(Mov.Qtde_Reint_Uti_Dia) Qtde_Reint_Uti_Dia , Sum(Mov.Qtde_Reint_Uti_24h) Qtde_Reint_Uti_24h , Sum(Mov.Qtde_Reint_Uti_24h_Dia) Qtde_Reint_Uti_24h_Dia
FROM ( SELECT Und.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Reint , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Tip_Acom Tip_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Leito Lei_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito --- ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA --- And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- --- O TEMPO DA ULTIMA SAIDA ATE A NOVA ENTRADA MENOR QUE 24 HORAS --- And (To_Date(To_Char(Mov_Reint.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov_Reint.Hr_Mov_Int,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') - To_Date(To_Char(Mov_Uti_Antes.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov_Uti_Antes.Hr_Lib_Mov,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 24 --24 HORAS And Mov_Uti_Antes.Dt_Lib_Mov IS Not Null And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_24h , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Reint , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Tip_Acom Tip_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Leito Lei_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito --- ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA --- And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- --- O TEMPO DA ULTIMA SAIDA ATE A NOVA ENTRADA MENOR QUE 24 HORAS --- And (To_Date(To_Char(Mov_Reint.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov_Reint.Hr_Mov_Int,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') - To_Date(To_Char(Mov_Uti_Antes.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov_Uti_Antes.Hr_Lib_Mov,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 24 --24 HORAS And Mov_Uti_Antes.Dt_Lib_Mov IS Not Null And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_24h_Dia
FROM Dbamv.Unid_Int Und
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Tp_Situacao = 'A' And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) AND Und.sn_ativo = 'S' ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int AND Unid_Int.sn_ativo = 'S' And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00481
---------------------------------------------------------------------------
CURSOR cProcesso_00481(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERCENTUAL DE PARTOS CESARIANOS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERCENTUAL DE PARTOS CESARIOS, QTDE DE PARTOS: '||Sum(Movimento.Qtde_Partos) ||', QTDE DE CESARIANAS: '||Sum(Nvl(Movimento.Qtde_Cesarianas,0)) ||', PERC. DE PARTOS CESARIANOS: '||Avg(Nvl(Movimento.Vl_Taxa_cesariana,0))||'%' ||', QTDE DE PARTOS NO DIA: '||Sum(Movimento.Qtde_Partos_Dia) ||', QTDE DE CESARIANAS NO DIA: '||Sum(Nvl(Movimento.Qtde_Cesarianas_Dia,0)) ||', PERC. DE PARTOS CESÁRIOS NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_cesariana_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Taxa_cesariana,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Taxa_cesariana_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Cesarianas , Mov.Qtde_Partos_Dia , Mov.Qtde_Cesarianas_Dia , (Case
WHEN Nvl(Mov.Qtde_Partos,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Cesarianas,0)/Nvl(Mov.Qtde_Partos,0))*100,2)
END ) Vl_Taxa_Cesariana , (Case
WHEN Nvl(Mov.Qtde_Partos_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Cesarianas_Dia,0)/Nvl(Mov.Qtde_Partos_Dia,0))*100,2)
END ) Vl_Taxa_Cesariana_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia , Sum(Mov.Qtde_Cesarianas) Qtde_Cesarianas , Sum(Mov.Qtde_Cesarianas_Dia) Qtde_Cesarianas_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (176) --CIRURGIA A SER CONSIDERADA PARTO CESAREANA And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Cesarianas , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (176) --CIRURGIA A SER CONSIDERADA PARTO CESAREANA And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Cesarianas_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00482
---------------------------------------------------------------------------
CURSOR cProcesso_00482(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Especialid.Ds_Especialid||', QTDE DE SENHAS: '||Sum(Movimento.Qtde_Total)||Chr(10) ||', QTDE DE ABANDONO: '||Sum(Nvl(Movimento.Qtde_Abandonos,0))||Chr(10) ||', TAXA DE ABANDONO: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2)||'%'||Chr(10) ||', QTDE DE ABANDONO NO DIA: '||Sum(Nvl(Movimento.Qtde_Abandonos_Dia,0))||Chr(10) ||', TAXA DE ABANDONO NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono_Dia,0)),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2) Qtde_NaoConforme , Null Qtde_Instalada , 'TRIAGEM_ATENDIMENTO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Null Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Null Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO TRIAGEM--- SELECT Mov.Cd_Multi_Empresa , Mov.cd_especialid , Mov.Data_Mes , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia , Sum(Mov.Qtde_Abandono) Qtde_Abandonos , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandonos_Dia , (Case
WHEN Sum(Mov.qtde_total) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono)/Sum(Mov.qtde_total))*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Sum(Mov.qtde_total_dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono_Dia)/Sum(Mov.qtde_total_dia))*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(Mov.Dh_Abandono,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Abandono) Qtde_Abandono , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandono_Dia , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia
FROM (---QTDE TOTAL DE ATENDIMENTO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE EVASÃO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Tip_Res And Vcc.Cd_Tipo_Campo_Chave = 134 --TIPO DE RESULTADO CONSIDERADO EVASAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE SENHAS--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS NULL And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---REMOÇÃO DE SENHA/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS Null And Ta.Dh_Removido IS Not Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(Mov.Dh_Abandono,'MM/YYYY') ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00483
---------------------------------------------------------------------------
CURSOR cProcesso_00483(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Departamento.Cd_Departamento , Departamento.Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Departamento.Ds_Departamento||', VALOR TOTAL FATURADO - MEDIA MENSAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Medio_Faturado),'999G999G999G999D99')),'0,00')||' Ultimos 6 Meses'||Chr(10) ||', VALOR DA GLOSA - MEDIA MENSAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Medio_Glosas),'999G999G999G999D99')),'0,00')||' Ultimos 6 Meses'||Chr(10) ||', TAXA DE GLOSAS - MEDIA MENSAL: '||Trunc(Avg(Movimento.Vl_Taxa_Media_Glosa),2)||'% Ultimos 6 Meses'||Chr(10) ||', VALOR TOTAL FATURADO - MEDIA MENSAL NO DIA: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Medio_Faturado_Dia),'999G999G999G999D99')),'0,00')||' Ultimos 6 Meses'||Chr(10) ||', VALOR DA GLOSA - MEDIA MENSAL NO DIA: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Taxa_Media_Glosa_Dia),'999G999G999G999D99')),'0,00')||' Ultimos 6 Meses'||Chr(10) ||', TAXA DE GLOSAS - MEDIA MENSAL NO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Media_Glosa_Dia),2)||'% Ultimos 6 Meses'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'GLOSA/GLOSA_SUS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Media_Glosa,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Taxa_Media_Glosa_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Cd_Departamento , Mov.Valor_Medio_Faturado , Mov.Valor_Medio_Glosas , Mov.Valor_Medio_Faturado_Dia , Mov.Valor_Medio_Glosas_Dia , Mov.Vl_Taxa_Media_Glosa , Mov.Vl_Taxa_Media_Glosa_Dia
FROM (--INDICE DE GLOSAS SUS AIH--- SELECT Medio.Cd_Departamento , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado , Trunc(Avg(Medio.Valor_Glosas),2) Valor_Medio_Glosas , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado_Dia , Trunc(Avg(Medio.Valor_Glosas_Dia),2) Valor_Medio_Glosas_Dia , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas),2)/Trunc(Avg(Medio.Valor_Total_Faturado),2))*100,2)
END ) Vl_Taxa_Media_Glosa , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas_Dia),2)/Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2))*100,2)
END ) Vl_Taxa_Media_Glosa_Dia
FROM ( SELECT Contas.Cd_Mes , 1 Cd_Departamento , Sum(Contas.Valor_Total_Faturado) Valor_Total_Faturado , Sum(Contas.Valor_Glosas) Valor_Glosas , Sum(Contas.Valor_Total_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Total_Faturado_Dia , Sum(Contas.Valor_Glosas)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Glosas_Dia
FROM ( SELECT To_Number(To_Char(Fat.Dt_Competencia,'MM')) Cd_Mes , To_Char(Fat.Dt_Competencia,'MM/YYYY') Data_Mes , ( SELECT Sum(Reg.Vl_Sh_Sp_Proprio)
FROM MvccAdmin.v_Valores_Aih Reg , Dbamv.Remessa_Fatura Rmf
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Rmf.Cd_Fatura = Fat.Cd_Fatura) Valor_Total_Faturado , ( SELECT Sum(Glo.vl_glosa)
FROM Dbamv.Reg_Fat Reg , Dbamv.Remessa_Fatura Rmf , Dbamv.Glosas_Sus Glo
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Rmf.Cd_Fatura = Fat.Cd_Fatura And Glo.Cd_Reg_Fat = Reg.Cd_Reg_Fat ) Valor_Glosas
FROM Dbamv.Fatura Fat
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Fat.Cd_Convenio And Con.Tp_Convenio = 'H') And Fat.Dt_Competencia Between Last_Day(To_Date(To_Char(Add_Months(Sysdate,-6),'MM/YYYY'),'MM/YYYY'))+.99999 And Last_Day(To_Date(To_Char(Add_Months(Sysdate,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Fat.Cd_Multi_Empresa = pCdMultiEmpresa ) Contas
GROUP BY Contas.Cd_Mes ) Medio
GROUP BY Medio.Cd_Departamento
UNION ALL --INDICE DE GLOSAS SUS SIA--- SELECT Medio.Cd_Departamento , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado , Trunc(Avg(Medio.Valor_Glosas),2) Valor_Medio_Glosas , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado_Dia , Trunc(Avg(Medio.Valor_Glosas_Dia),2) Valor_Medio_Glosas_Dia , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas),2)/Trunc(Avg(Medio.Valor_Total_Faturado),2))*100,2)
END ) Vl_Taxa_Media_Glosa , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas_Dia),2)/Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2))*100,2)
END ) Vl_Taxa_Media_Glosa_Dia
FROM ( SELECT Contas.Cd_Mes , 2 Cd_Departamento , Sum(Contas.Valor_Total_Faturado) Valor_Total_Faturado , Sum(Contas.Valor_Glosas) Valor_Glosas , Sum(Contas.Valor_Total_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Total_Faturado_Dia , Sum(Contas.Valor_Glosas)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Glosas_Dia
FROM ( SELECT To_Number(To_Char(Fat.Dt_Competencia,'MM')) Cd_Mes , To_Char(Fat.Dt_Competencia,'MM/YYYY') Data_Mes , ( SELECT Sum(Reg.vl_servico_ambulatorial)
FROM Dbamv.Eve_SiaSus Reg , Dbamv.Remessa_Fatura Rmf
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Rmf.Cd_Fatura = Fat.Cd_Fatura) Valor_Total_Faturado , ( SELECT Sum(Reg.vl_servico_ambulatorial)
FROM Dbamv.Eve_SiaSus Reg , Dbamv.Remessa_Fatura Rmf , Dbamv.Glosas_Sia_Sus Glo
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Rmf.Cd_Fatura = Fat.Cd_Fatura And Glo.cd_apac = Reg.cd_apac ) Valor_Glosas
FROM Dbamv.Fatura Fat
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Fat.Cd_Convenio And Con.Tp_Convenio = 'A') And Fat.Dt_Competencia Between Last_Day(To_Date(To_Char(Add_Months(Sysdate,-6),'MM/YYYY'),'MM/YYYY'))+.99999 And Last_Day(To_Date(To_Char(Add_Months(Sysdate,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Fat.Cd_Multi_Empresa = pCdMultiEmpresa ) Contas
GROUP BY Contas.Cd_Mes ) Medio
GROUP BY Medio.Cd_Departamento
UNION ALL --INDICE DE GLOSAS CONVENIO INTERNOS--- SELECT Medio.Cd_Departamento , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado , Trunc(Avg(Medio.Valor_Glosas),2) Valor_Medio_Glosas , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado_Dia , Trunc(Avg(Medio.Valor_Glosas_Dia),2) Valor_Medio_Glosas_Dia , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas),2)/Trunc(Avg(Medio.Valor_Total_Faturado),2))*100,2)
END ) Vl_Taxa_Media_Glosa , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas_Dia),2)/Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2))*100,2)
END ) Vl_Taxa_Media_Glosa_Dia
FROM ( SELECT Contas.Cd_Mes , 3 Cd_Departamento , Sum(Contas.Valor_Total_Faturado) Valor_Total_Faturado , Sum(Contas.Valor_Glosas) Valor_Glosas , Sum(Contas.Valor_Total_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Total_Faturado_Dia , Sum(Contas.Valor_Glosas)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Glosas_Dia
FROM ( SELECT To_Number(To_Char(Fat.Dt_Competencia,'MM')) Cd_Mes , To_Char(Fat.Dt_Competencia,'MM/YYYY') Data_Mes , ( SELECT Sum(Reg.Vl_Total_Conta)
FROM Dbamv.Reg_Fat Reg , Dbamv.Remessa_Fatura Rmf
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Rmf.Cd_Fatura = Fat.Cd_Fatura) Valor_Total_Faturado , ( SELECT Sum(Glo.vl_glosa)
FROM Dbamv.Reg_Fat Reg , Dbamv.Remessa_Fatura Rmf , Dbamv.Glosas Glo
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Rmf.Cd_Fatura = Fat.Cd_Fatura And Glo.Cd_Reg_Fat = Reg.Cd_Reg_Fat ) Valor_Glosas
FROM Dbamv.Fatura Fat
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Fat.Cd_Convenio And Con.Tp_Convenio = 'C') And Fat.Dt_Competencia Between Last_Day(To_Date(To_Char(Add_Months(Sysdate,-6),'MM/YYYY'),'MM/YYYY'))+.99999 And Last_Day(To_Date(To_Char(Add_Months(Sysdate,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Fat.Cd_Multi_Empresa = pCdMultiEmpresa ) Contas
GROUP BY Contas.Cd_Mes ) Medio
GROUP BY Medio.Cd_Departamento
UNION ALL --INDICE DE GLOSAS CONVENIO EXTERNOS--- SELECT Medio.Cd_Departamento , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado , Trunc(Avg(Medio.Valor_Glosas),2) Valor_Medio_Glosas , Trunc(Avg(Medio.Valor_Total_Faturado),2) Valor_Medio_Faturado_Dia , Trunc(Avg(Medio.Valor_Glosas_Dia),2) Valor_Medio_Glosas_Dia , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas),2)/Trunc(Avg(Medio.Valor_Total_Faturado),2))*100,2)
END ) Vl_Taxa_Media_Glosa , (Case
WHEN Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2) = 0
THEN 0
ELSE Round((Trunc(Avg(Medio.Valor_Glosas_Dia),2)/Trunc(Avg(Medio.Valor_Total_Faturado_Dia),2))*100,2)
END ) Vl_Taxa_Media_Glosa_Dia
FROM ( SELECT Contas.Cd_Mes , 4 Cd_Departamento , Sum(Contas.Valor_Total_Faturado) Valor_Total_Faturado , Sum(Contas.Valor_Glosas) Valor_Glosas , Sum(Contas.Valor_Total_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Total_Faturado_Dia , Sum(Contas.Valor_Glosas)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Glosas_Dia
FROM ( SELECT To_Number(To_Char(Fat.Dt_Competencia,'MM')) Cd_Mes , To_Char(Fat.Dt_Competencia,'MM/YYYY') Data_Mes , ( SELECT Sum(Reg.Vl_Total_Conta)
FROM Dbamv.Reg_Amb Reg , Dbamv.Remessa_Fatura Rmf
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Rmf.Cd_Fatura = Fat.Cd_Fatura) Valor_Total_Faturado , ( SELECT Sum(Glo.vl_glosa)
FROM Dbamv.Reg_Amb Reg , Dbamv.Remessa_Fatura Rmf , Dbamv.Glosas Glo
WHERE Reg.Cd_Remessa = Rmf.Cd_Remessa And Glo.cd_reg_amb = Reg.cd_reg_amb And Rmf.Cd_Fatura = Fat.Cd_Fatura ) Valor_Glosas
FROM Dbamv.Fatura Fat
WHERE Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Fat.Cd_Convenio And Con.Tp_Convenio = 'C') And Fat.Dt_Competencia Between Last_Day(To_Date(To_Char(Add_Months(Sysdate,-6),'MM/YYYY'),'MM/YYYY'))+.99999 And Last_Day(To_Date(To_Char(Add_Months(Sysdate,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Fat.Cd_Multi_Empresa = pCdMultiEmpresa ) Contas
GROUP BY Contas.Cd_Mes ) Medio
GROUP BY Medio.Cd_Departamento ) Mov ) Movimento , ( SELECT 1 Cd_Departamento, 'SUS AIHs' Ds_Departamento
FROM Dual
UNION ALL SELECT 2 Cd_Departamento, 'SUS SIA SUS APAC' Ds_Departamento
FROM Dual
UNION ALL SELECT 3 Cd_Departamento, 'CONVÊNIO INTERNOS' Ds_Departamento
FROM Dual
UNION ALL SELECT 4 Cd_Departamento, 'CONVÊNIO EXTERNOS' Ds_Departamento
FROM Dual ) Departamento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Departamento = Departamento.Cd_Departamento And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Departamento.Cd_Departamento , Departamento.Ds_Departamento , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00574
---------------------------------------------------------------------------
CURSOR cProcesso_00574(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NUll Tp_Diagnostico , NUll Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'PERC. DE USO ANTIBIOTICO NA URGÊNCIA, QTDE DE ATENDIMENTO: '||Nvl(Movimento.Qtde_Paciente,0)||Chr(10) ||', QTDE DE ATENDIMENTO C/USO DE ANTIBIÓTICO: '||Nvl(Movimento.Qtde_Paciente_Uso_Atb,0)||Chr(10) ||', PERC. USO DE ANTIBIÓTICO: '||Nvl(Movimento.Vl_Perc_Uso_Antibiotico,0)||Chr(10) ||', QTDE DE ATENDIMENTO NO DIA: '||Nvl(Movimento.Qtde_Paciente_Dia,0)||Chr(10) ||', QTDE DE ATENDIMENTO C/USO DE ANTIBIÓTICO NO DIA: '||Nvl(Movimento.Qtde_Paciente_Uso_Atb_Dia,0)||Chr(10) ||', PERC. USO DE ANTIBIÓTICO NO DIA: '||Nvl(Movimento.Vl_Perc_Uso_Antibiotico_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MVTO_ESTOQUE' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Paciente_Uso_Atb,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Paciente_Uso_Atb_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (-- MOVIMENTO--- SELECT Mov.Cd_Ori_Ate , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Qtde_Paciente,0) Qtde_Paciente , Nvl(Mov.Qtde_Paciente_Uso_Atb,0) Qtde_Paciente_Uso_Atb , Nvl(Mov.Qtde_Paciente_Dia,0) Qtde_Paciente_Dia , Nvl(Mov.Qtde_Paciente_Uso_Atb_Dia,0) Qtde_Paciente_Uso_Atb_Dia , (Case
WHEN Nvl(Mov.Qtde_Paciente,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Paciente_Uso_Atb,0)/Nvl(Mov.Qtde_Paciente,0)*100,2)
END ) Vl_Perc_Uso_Antibiotico , (Case
WHEN Nvl(Mov.Qtde_Paciente_Dia,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Paciente_Uso_Atb_Dia,0)/Nvl(Mov.Qtde_Paciente_Dia,0)*100,2)
END ) Vl_Perc_Uso_Antibiotico_Dia
FROM ( SELECT Ori.Cd_Ori_Ate , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.tp_atendimento = 'U' And Ate.dh_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Ori_Ate = Ori.Cd_Ori_Ate And Ate.Cd_Multi_Empresa = pCdMultiEmpresa),0) Qtde_Paciente , Nvl(( SELECT Count(Distinct Mvt.Cd_Atendimento)
FROM Dbamv.Mvto_Estoque Mvt , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Cd_Atendimento = Mvt.Cd_Atendimento And Mvt.Tp_Mvto_Estoque = 'P' And Ate.tp_atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.ItMvto_Estoque ItMv
WHERE Mvt.Tp_Mvto_Estoque = 'P' And Mvt.Cd_Mvto_Estoque = ItMv.Cd_Mvto_Estoque And Exists ( SELECT 1
FROM Dbamv.Ant_Pro Atp
WHERE Atp.Cd_Produto = ItMv.Cd_Produto) ) And Mvt.dt_mvto_estoque Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Ori_Ate = Ori.Cd_Ori_Ate And Mvt.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Paciente_Uso_Atb , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.tp_atendimento = 'U' And Ate.dh_atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Ori_Ate = Ori.Cd_Ori_Ate And Ate.Cd_Multi_Empresa = pCdMultiEmpresa),0) Qtde_Paciente_Dia , Nvl(( SELECT Count(Distinct Mvt.Cd_Atendimento)
FROM Dbamv.Mvto_Estoque Mvt , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Cd_Atendimento = Mvt.Cd_Atendimento And Mvt.Tp_Mvto_Estoque = 'P' And Ate.tp_atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.ItMvto_Estoque ItMv
WHERE Mvt.Tp_Mvto_Estoque = 'P' And Mvt.Cd_Mvto_Estoque = ItMv.Cd_Mvto_Estoque And Exists ( SELECT 1
FROM Dbamv.Ant_Pro Atp
WHERE Atp.Cd_Produto = ItMv.Cd_Produto) ) And Mvt.dt_mvto_estoque Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Ori_Ate = Ori.Cd_Ori_Ate And Mvt.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Paciente_Uso_Atb_Dia
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Tp_Origem = 'U' And Ori.Sn_Ativo = 'S' And Ori.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Ori_Ate.Tp_Origem = 'U' And Ori_Ate.Sn_Ativo = 'S' And Ori_Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00575
---------------------------------------------------------------------------
CURSOR cProcesso_00575(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NUll Tp_Diagnostico , NUll Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cen_Cir.Cd_Cen_Cir Cd_Departamento , Cen_Cir.Ds_Cen_Cir Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Cen_Cir.Ds_Cen_Cir||', QTDE DE CIRURGIA: '||Nvl(Movimento.Qtde_Cirurgia,0)||Chr(10) ||', QTDE DE REOPERAÇÃO: '||Nvl(Movimento.Qtde_Reincidencia,0)||Chr(10) ||', PERC. DE REOPERAÇÃO: '||Nvl(Movimento.Vl_Perc_Reincidencia,0)||Chr(10) ||', QTDE DE CIRURGIA NO DIA: '||Nvl(Movimento.Qtde_Cirurgia_Dia,0)||Chr(10) ||', QTDE DE REOPERAÇÃO NO DIA: '||Nvl(Movimento.Qtde_Reincidencia_Dia,0)||Chr(10) ||', PERC. DE REOPERAÇÃO NO DIA: '||Nvl(Movimento.Vl_Perc_Reincidencia_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Reincidencia,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Reincidencia_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Cen_Cir , Mov.Data_Mes , Sum(Nvl(Mov.Qtde_Cirurgia,0)) Qtde_Cirurgia , Sum(Nvl(Mov.Qtde_Cirurgia_Dia,0)) Qtde_Cirurgia_Dia , Sum(Nvl(Mov.Qtde_Reincidencia,0)) Qtde_Reincidencia , Sum(Nvl(Mov.Qtde_Reincidencia_Dia,0)) Qtde_Reincidencia_Dia , (Case
WHEN Sum(Nvl(Mov.Qtde_Cirurgia,0)) = 0
THEN 0
ELSE Round(Sum(Nvl(Mov.Qtde_Reincidencia,0))/Sum(Nvl(Mov.Qtde_Cirurgia,0))*100,2)
END ) Vl_Perc_Reincidencia , (Case
WHEN Sum(Nvl(Mov.Qtde_Cirurgia_Dia,0)) = 0
THEN 0
ELSE Round(Sum(Nvl(Mov.Qtde_Reincidencia_Dia,0))/Sum(Nvl(Mov.Qtde_Cirurgia_Dia,0))*100,2)
END ) Vl_Perc_Reincidencia_Dia
FROM ( SELECT Mov.Cd_Cen_Cir , To_Char(Mov.Dt_Realizacao_Reop,'MM/YYYY') Data_Mes , Mov.Qtde_Cirurgia , (Case
WHEN Mov.Dt_Realizacao_Reop Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Cirurgia_Dia , Mov.Qtde_Reincidencia , (Case
WHEN Mov.Dt_Realizacao_Reop Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Reincidencia
ELSE 0
END ) Qtde_Reincidencia_Dia
FROM ( SELECT Avi.Cd_Cen_Cir , Avi.Cd_Aviso_Cirurgia_Reop , Avi.Dt_Realizacao_Reop , 1 Qtde_Cirurgia , (Case
WHEN Avi.Cd_Aviso_Cirurgia_Antes IS Null
THEN 0
ELSE 1
END ) Qtde_Reincidencia
FROM ( SELECT Avi_Reop.Cd_Cen_Cir , Avi_Reop.Dt_Realizacao Dt_Realizacao_Reop , Avi_Reop.Cd_Aviso_Cirurgia Cd_Aviso_Cirurgia_Reop , Avi_Reop.Cd_Atendimento Cd_Atendimento_Reop , ( SELECT Max(Avi.Cd_Aviso_Cirurgia)
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' --RELIZADAS And Avi.Cd_Paciente = Avi_Reop.Cd_Paciente And Avi.Cd_Aviso_Cirurgia < Avi_Reop.Cd_Aviso_Cirurgia And Avi.Cd_Multi_Empresa = pCdMultiEmpresa And Avi.Dt_Realizacao+MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Avi.Cd_Cen_Cir,pNrCnpj,'SLA')/24/60 > Avi_Reop.Dt_Realizacao ) Cd_Aviso_Cirurgia_Antes
FROM Dbamv.Aviso_Cirurgia Avi_Reop
WHERE Avi_Reop.Tp_Situacao = 'R' --RELIZADAS And Avi_Reop.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi_Reop.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi ) Mov ) Mov
GROUP BY Mov.Cd_Cen_Cir , Mov.Data_Mes ) Movimento , Dbamv.Cen_cir , MvccAdmin.Estabelecimento
WHERE Cen_Cir.Cd_Cen_Cir = Movimento.Cd_Cen_Cir(+) And Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal, Dbamv.Setor Str
WHERE Sal.Cd_Setor = Str.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Sal.Cd_Cen_Cir = Cen_Cir.Cd_Cen_Cir) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00580
---------------------------------------------------------------------------
CURSOR cProcesso_00580(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA DESPESA C/FIXO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR DO CUSTO FIXO PROJETADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Despesas_Fixas),0),'999G999G999G999D99')),'0,00')||' (Projetado)'||Chr(10)|| 'VALOR DO CUSTO FIXO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Despesas_Fixas_Previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Valor_Despesas_Fixas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Valor_Despesas_Fixas,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Valor_Despesas_Fixas,0) Valor_Despesas_Fixas , Nvl(Mov.Valor_Despesas_Fixas_Previsto,0) Valor_Despesas_Fixas_Previsto , Case
WHEN Nvl(Mov.Valor_Despesas_Fixas_Previsto,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.Valor_Despesas_Fixas,0))/Nvl(Mov.Valor_Despesas_Fixas_Previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') Valor_Despesas_Fixas_Previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.Valor_Despesas_Fixas,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Despesas_Fixas
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.Valor_despesas_fixas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_despesas_fixas,0)) Valor_despesas_fixas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Valor_despesas_fixas
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00581
---------------------------------------------------------------------------
CURSOR cProcesso_00581(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR DA RECEITA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Receita),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR DE OUTRAS RECEITAS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Outra_Receita),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR TOTAL DA RECEITA PROJETADA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Geral_Receita),0),'999G999G999G999D99')),'0,00')||' (Projetada)'||Chr(10)|| 'VALOR TOTAL DA RECEITA PREVISTA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Receita_Prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Total_Geral_Receita,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Total_Geral_Receita,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Total_Receita,0) Vl_Total_Receita , Nvl(Mov.Vl_Total_Outra_Receita,0) Vl_Total_Outra_Receita , Nvl(Mov.Vl_Total_Receita,0)+Nvl(Mov.Vl_Total_Outra_Receita,0) Vl_Total_Geral_Receita , Nvl(Mov.Vl_Total_Receita_Prevista,0) Vl_Total_Receita_Prevista , Case
WHEN Nvl(Mov.Vl_Total_Receita_Prevista,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.Vl_Total_Receita,0)+Nvl(Mov.Vl_Total_Outra_Receita,0))/Nvl(Mov.Vl_Total_Receita_Prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') Vl_Total_Receita_Prevista , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.Vl_Total_Receita,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Total_Receita , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.Vl_Total_Outra_Receita,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Total_Outra_Receita
FROM ( SELECT ---VALOR TOTAL RECEITA--- Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Receita),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Vl_Total_Receita
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Total_Receita ---VALOR TOTAL OUTRA RECEITA--- , Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Outra_Receita),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_outras_receitas,0)) Vl_Total_Outra_Receita
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Total_Outra_Receita
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00582
---------------------------------------------------------------------------
CURSOR cProcesso_00582(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA DESPESA C/PESSOAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR CUSTO C/PESSOAL PROJETADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_despesas_pessoal),0),'999G999G999G999D99')),'0,00')||' (Projetado)'||Chr(10)|| 'VALOR CUSTO C/PESSOAL PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_despesas_pessoal_prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_despesas_pessoal,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_despesas_pessoal,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_despesas_pessoal,0) vl_despesas_pessoal , Nvl(Mov.vl_despesas_pessoal_prevista,0) vl_despesas_pessoal_prevista , Case
WHEN Nvl(Mov.vl_despesas_pessoal_prevista,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_despesas_pessoal,0)/Nvl(Mov.vl_despesas_pessoal_prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_despesas_pessoal_prevista , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.vl_despesas_pessoal,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_despesas_pessoal
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_despesas_pessoal),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_despesas_pessoal,0)) vl_despesas_pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_despesas_pessoal
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00583
---------------------------------------------------------------------------
CURSOR cProcesso_00583(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA DESPESA TOTAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR CUSTO TOTAL PROJETADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_despesas),0),'999G999G999G999D99')),'0,00')||' (Projetado)'||Chr(10)|| 'VALOR CUSTO TOTAL PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_despesas_prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_total_despesas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_total_despesas,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_total_despesas,0) vl_total_despesas , Nvl(Mov.vl_total_despesas_prevista,0) vl_total_despesas_prevista , Case
WHEN Nvl(Mov.vl_total_despesas_prevista,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_total_despesas,0)/Nvl(Mov.vl_total_despesas_prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_total_despesas_prevista , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.vl_total_despesas,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_total_despesas
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_total_despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_total_despesas,0)) vl_total_despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_total_despesas
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00584
---------------------------------------------------------------------------
CURSOR cProcesso_00584(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA DESPESA C/MAT./MED.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR CUSTO C/MAT. MED. PROJETADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_despesas_matmed),0),'999G999G999G999D99')),'0,00')||' (Projetado)'||Chr(10)|| 'VALOR CUSTO C/MAT. MED. PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_despesas_matmed_prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_despesas_matmed,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_despesas_matmed,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_despesas_matmed,0) vl_despesas_matmed , Nvl(Mov.vl_despesas_matmed_prevista,0) vl_despesas_matmed_prevista , Case
WHEN Nvl(Mov.vl_despesas_matmed_prevista,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_despesas_matmed,0)/Nvl(Mov.vl_despesas_matmed_prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_despesas_matmed_prevista , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.vl_despesas_matmed,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_despesas_matmed
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_despesas_matmed),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_despesas_matmed,0)) vl_despesas_matmed
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_despesas_matmed
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00585
---------------------------------------------------------------------------
CURSOR cProcesso_00585(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DO ESTOQUE C/MAT./MED.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR ESTOQUE C/MAT. MED. ATUAL: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_estoque_matmed),0),'999G999G999G999D99')),'0,00')||' (Atual)'||Chr(10)|| 'VALOR ESTOQUE C/MAT. MED. PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Estoque_Matmed_Prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_estoque_matmed,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_estoque_matmed,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Estoque_Matmed,0) Vl_Estoque_Matmed , Nvl(Mov.Vl_Estoque_Matmed,0)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Estoque_Matmed_Dia , Nvl(Mov.Vl_Estoque_Matmed_Prevista,0) Vl_Estoque_Matmed_Prevista , Case
WHEN Nvl(Mov.Vl_Estoque_Matmed_Prevista,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.Vl_Estoque_Matmed,0))/Nvl(Mov.Vl_Estoque_Matmed_Prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.Vl_Estoque_Matmed,0) Vl_Estoque_Matmed , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') Vl_Estoque_Matmed_Prevista
FROM ( SELECT --VALOR ESTOQUE MAT MED--- Nvl(( SELECT Trunc(Sum(Dbamv.Verif_Vl_Custo_Medio(Valor.Cd_Produto,v_Dt_Ini_Diagno,'H',Null,v_Dt_Ini_Diagno+.99999,pCdMultiEmpresa)*Valor.Qt_Estoque_Atual),2) Valor
FROM ( SELECT Est.Cd_Produto , Sum(Est.Qt_Estoque_Atual) Qt_Estoque_Atual
FROM Dbamv.Est_Pro Est
WHERE Exists ( SELECT 1
FROM Dbamv.Estoque Eto
WHERE Est.Cd_Estoque = Eto.Cd_Estoque And Eto.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Sub_Clas Cla, Dbamv.Produto Prd
WHERE Cla.Cd_Especie = Prd.Cd_Especie And Cla.Cd_Classe = Prd.Cd_Classe And Cla.Cd_Sub_Cla = Prd.Cd_Sub_Cla And Cla.sn_saida_paciente = 'S' And Prd.tp_ativo = 'S' And Prd.Cd_Produto = Est.Cd_Produto) And Nvl(Est.qt_estoque_atual,0) > 0
GROUP BY Est.Cd_Produto ) Valor ),0) Vl_Estoque_Matmed
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00586
---------------------------------------------------------------------------
CURSOR cProcesso_00586(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DO RECEBIDO NO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR TOTAL DE RECEBIMENTO PROJETADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_recebimentos),0),'999G999G999G999D99')),'0,00')||' (Projetado)'||Chr(10)|| 'VALOR TOTAL DE RECEBIMENTO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_recebimentos_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_total_recebimentos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_total_recebimentos,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_total_recebimentos,0) vl_total_recebimentos , Nvl(Mov.vl_total_recebimentos_previsto,0) vl_total_recebimentos_previsto , Case
WHEN Nvl(Mov.vl_total_recebimentos_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_total_recebimentos,0)/Nvl(Mov.vl_total_recebimentos_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_total_recebimentos_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.vl_total_recebimentos,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_total_recebimentos
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_total_recebimentos),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_total_recebimentos,0)) vl_total_recebimentos
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_total_recebimentos
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00587
---------------------------------------------------------------------------
CURSOR cProcesso_00587(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA RECEITA TOTAL À RECEBER' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR TOTAL À RECEBER ATUAL: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||' (Atual)'||Chr(10)|| 'VALOR TOTAL À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_a_receber,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_a_receber,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_a_receber_previsto
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_a_receber),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_a_receber
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00588
---------------------------------------------------------------------------
CURSOR cProcesso_00588(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DO ESTOQUE DE FATURAMENTO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR ESTOQUE DE FATURAMENTO ATUAL: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_estoque_faturamento),0),'999G999G999G999D99')),'0,00')||' (Projetado)'||Chr(10)|| 'VALOR ESTOQUE DE FATURAMENTO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_estoque_faturam_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_estoque_faturamento,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_estoque_faturamento,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_estoque_faturamento,0) vl_estoque_faturamento , Nvl(Mov.vl_estoque_faturam_previsto,0) vl_estoque_faturam_previsto , Case
WHEN Nvl(Mov.vl_estoque_faturam_previsto,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.vl_estoque_faturamento,0))/Nvl(Mov.vl_estoque_faturam_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_estoque_faturamento,0) vl_estoque_faturamento , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_estoque_faturam_previsto
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_estoque_faturamento),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0)+Nvl(Dme.vl_estoque_conta_conv_externo,0)+Nvl(Dme.vl_estoque_conta_sus_interno,0)+Nvl(Dme.vl_estoque_conta_sus_externo,0)) vl_estoque_faturamento
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_estoque_faturamento
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00589
---------------------------------------------------------------------------
CURSOR cProcesso_00589(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA RECEITA FATURADA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR TOTAL DE FATURAMENTO PROJETADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_faturamento),0),'999G999G999G999D99')),'0,00')||' (Projetado)'||Chr(10)|| 'VALOR TOTAL DE FATURAMENTO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_faturamento_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_total_faturamento,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_total_faturamento,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_total_faturamento,0) vl_total_faturamento , Nvl(Mov.vl_total_faturamento_previsto,0) vl_total_faturamento_previsto , Case
WHEN Nvl(Mov.vl_total_faturamento_previsto,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.vl_total_faturamento,0))/Nvl(Mov.vl_total_faturamento_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_total_faturamento_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.vl_total_faturamento,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_total_faturamento
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_total_faturamento),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_fat_total_convenio_interno,0)+Nvl(Dme.vl_fat_total_convenio_externo,0)+Nvl(Dme.vl_fat_total_particul_interno,0)+Nvl(Dme.vl_fat_total_particul_externo,0)+Nvl(Dme.vl_fat_total_sus_interno,0)+Nvl(Dme.vl_fat_total_sus_externo,0)) vl_total_faturamento
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_total_faturamento
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00590
---------------------------------------------------------------------------
CURSOR cProcesso_00590(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA RECEITA C/MAT./MED.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR DA RECEITA MAT/MED. PROJETADA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_receita_mat_med),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR DA RECEITA MAT/MED. PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_receita_mat_med),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_receita_mat_med,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_receita_mat_med,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_receita_mat_med,0) vl_receita_mat_med , Nvl(Mov.vl_receita_mat_med_prevista,0) vl_receita_mat_med_prevista , Case
WHEN Nvl(Mov.vl_receita_mat_med_prevista,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.vl_receita_mat_med,0))/Nvl(Mov.vl_receita_mat_med_prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_receita_mat_med_prevista , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Cta.vl_receita_mat_med,0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_receita_mat_med
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_receita_mat_med),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_pro_matmed_convenio_interno,0)+Nvl(Dme.vl_pro_matmed_convenio_externo,0)+Nvl(Dme.vl_pro_matmed_particul_interno,0)+Nvl(Dme.vl_pro_matmed_particul_externo,0)+Nvl(Dme.vl_pro_matmed_sus_interno,0)+Nvl(Dme.vl_pro_matmed_sus_externo,0)) vl_receita_mat_med
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_receita_mat_med
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00616
---------------------------------------------------------------------------
CURSOR cProcesso_00616(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Sac_Chamado.Cd_Chamado Cd_Departamento , Tipo_Sac_Chamado.Nm_Chamado Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Tipo_Sac_Chamado.Nm_Chamado||', QTDE DE PACIENTES: '||Sum(Movimento.Qtde_Amostra) ||', QTDE DE PESQUISA: '||Sum(Nvl(Movimento.Qtde_Pesquisas,0)) ||', TAXA DE SATISFAÇÃO: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa,0))||' %' ||', QTDE DE PACIENTES NO DIA: '||Sum(Movimento.Qtde_Amostra_Dia) ||', QTDE DE PESQUISA NO DIA: '||Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) ||', TAXA DE SATISFAÇÃO NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa_Dia,0))||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Amostra,0)) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Pesquisas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Chamado , Mov.Data_Mes , Mov.Qtde_Amostra , Mov.Qtde_Pesquisas , Mov.Vl_Taxa_Pesquisa , Mov.Qtde_Amostra_Dia , Mov.Qtde_Pesquisas_Dia , Mov.Vl_Taxa_Pesquisa_Dia
FROM ( SELECT Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Dia.Qtde_Amostra) Qtde_Amostra , Sum(Dia.Qtde_Pesquisas) Qtde_Pesquisas , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas)/Sum(Dia.Qtde_Amostra))*100,2)
END ) Vl_Taxa_Pesquisa , Sum(Dia.Qtde_Amostra_Dia) Qtde_Amostra_Dia , Sum(Dia.Qtde_Pesquisas_Dia) Qtde_Pesquisas_Dia , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas_Dia)/Sum(Dia.Qtde_Amostra_Dia))*100,2)
END ) Vl_Taxa_Pesquisa_Dia
FROM ( SELECT pCdMultiEmpresa Cd_Multi_Empresa , Cha.Cd_Chamado , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra_Dia , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas_Dia
FROM Dbamv.Tipo_Sac_Chamado Cha ) Dia
GROUP BY Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Tipo_Sac_Chamado , MvccAdmin.Estabelecimento
WHERE Tipo_Sac_Chamado.Cd_Chamado = Movimento.Cd_Chamado And Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Tipo_Sac_Chamado.Cd_Chamado , Tipo_Sac_Chamado.nm_chamado , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00617
---------------------------------------------------------------------------
CURSOR cProcesso_00617(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Sac_Chamado.Cd_Chamado Cd_Departamento , Tipo_Sac_Chamado.Nm_Chamado Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Sac_Chamado.Nm_Chamado||', QTDE DE PACIENTES: '||Sum(Movimento.Qtde_Amostra) ||', QTDE DE PESQUISA: '||Sum(Nvl(Movimento.Qtde_Pesquisas,0)) ||', TAXA DE RECLAMAÇÃO: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa,0))||' %' ||', QTDE DE PACIENTES NO DIA: '||Sum(Movimento.Qtde_Amostra_Dia) ||', QTDE DE PESQUISA NO DIA: '||Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) ||', TAXA DE RECLAMAÇÃO NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa_Dia,0))||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Amostra,0)) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Pesquisas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Chamado , Mov.Data_Mes , Mov.Qtde_Amostra , Mov.Qtde_Pesquisas , Mov.Vl_Taxa_Pesquisa , Mov.Qtde_Amostra_Dia , Mov.Qtde_Pesquisas_Dia , Mov.Vl_Taxa_Pesquisa_Dia
FROM ( SELECT Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Dia.Qtde_Amostra) Qtde_Amostra , Sum(Dia.Qtde_Pesquisas) Qtde_Pesquisas , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas)/Sum(Dia.Qtde_Amostra))*100,2)
END ) Vl_Taxa_Pesquisa , Sum(Dia.Qtde_Amostra_Dia) Qtde_Amostra_Dia , Sum(Dia.Qtde_Pesquisas_Dia) Qtde_Pesquisas_Dia , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas_Dia)/Sum(Dia.Qtde_Amostra_Dia))*100,2)
END ) Vl_Taxa_Pesquisa_Dia
FROM ( SELECT pCdMultiEmpresa Cd_Multi_Empresa , Cha.Cd_Chamado , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra_Dia , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas_Dia
FROM Dbamv.Tipo_Sac_Chamado Cha ) Dia
GROUP BY Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Tipo_Sac_Chamado , MvccAdmin.Estabelecimento
WHERE Tipo_Sac_Chamado.Cd_Chamado = Movimento.Cd_Chamado And Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Tipo_Sac_Chamado.Cd_Chamado , Tipo_Sac_Chamado.nm_chamado , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00618
---------------------------------------------------------------------------
CURSOR cProcesso_00618(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Sac_Chamado.Cd_Chamado Cd_Departamento , Tipo_Sac_Chamado.Nm_Chamado Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Tipo_Sac_Chamado.Nm_Chamado||', QTDE DE PACIENTES: '||Sum(Movimento.Qtde_Amostra) ||', QTDE DE PESQUISA: '||Sum(Nvl(Movimento.Qtde_Pesquisas,0)) ||', TAXA DE SATISFAÇÃO: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa,0))||' %' ||', QTDE DE PACIENTES NO DIA: '||Sum(Movimento.Qtde_Amostra_Dia) ||', QTDE DE PESQUISA NO DIA: '||Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) ||', TAXA DE SATISFAÇÃO NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa_Dia,0))||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Amostra,0)) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Pesquisas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Chamado , Mov.Data_Mes , Mov.Qtde_Amostra , Mov.Qtde_Pesquisas , Mov.Vl_Taxa_Pesquisa , Mov.Qtde_Amostra_Dia , Mov.Qtde_Pesquisas_Dia , Mov.Vl_Taxa_Pesquisa_Dia
FROM ( SELECT Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Dia.Qtde_Amostra) Qtde_Amostra , Sum(Dia.Qtde_Pesquisas) Qtde_Pesquisas , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas)/Sum(Dia.Qtde_Amostra))*100,2)
END ) Vl_Taxa_Pesquisa , Sum(Dia.Qtde_Amostra_Dia) Qtde_Amostra_Dia , Sum(Dia.Qtde_Pesquisas_Dia) Qtde_Pesquisas_Dia , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas_Dia)/Sum(Dia.Qtde_Amostra_Dia))*100,2)
END ) Vl_Taxa_Pesquisa_Dia
FROM ( SELECT pCdMultiEmpresa Cd_Multi_Empresa , Cha.Cd_Chamado , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra_Dia , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas_Dia
FROM Dbamv.Tipo_Sac_Chamado Cha ) Dia
GROUP BY Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Tipo_Sac_Chamado , MvccAdmin.Estabelecimento
WHERE Tipo_Sac_Chamado.Cd_Chamado = Movimento.Cd_Chamado And Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Tipo_Sac_Chamado.Cd_Chamado , Tipo_Sac_Chamado.nm_chamado , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00619
---------------------------------------------------------------------------
CURSOR cProcesso_00619(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Sac_Chamado.Cd_Chamado Cd_Departamento , Tipo_Sac_Chamado.Nm_Chamado Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Tipo_Sac_Chamado.Nm_Chamado||', QTDE DE PACIENTES: '||Sum(Movimento.Qtde_Amostra) ||', QTDE DE PESQUISA: '||Sum(Nvl(Movimento.Qtde_Pesquisas,0)) ||', TAXA DE RECLAMAÇÕES: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa,0))||' %' ||', QTDE DE PACIENTES NO DIA: '||Sum(Movimento.Qtde_Amostra_Dia) ||', QTDE DE PESQUISA NO DIA: '||Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) ||', TAXA DE RECLAMAÇÕES NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa_Dia,0))||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Amostra,0)) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Pesquisas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Chamado , Mov.Data_Mes , Mov.Qtde_Amostra , Mov.Qtde_Pesquisas , Mov.Vl_Taxa_Pesquisa , Mov.Qtde_Amostra_Dia , Mov.Qtde_Pesquisas_Dia , Mov.Vl_Taxa_Pesquisa_Dia
FROM ( SELECT Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Dia.Qtde_Amostra) Qtde_Amostra , Sum(Dia.Qtde_Pesquisas) Qtde_Pesquisas , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas)/Sum(Dia.Qtde_Amostra))*100,2)
END ) Vl_Taxa_Pesquisa , Sum(Dia.Qtde_Amostra_Dia) Qtde_Amostra_Dia , Sum(Dia.Qtde_Pesquisas_Dia) Qtde_Pesquisas_Dia , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas_Dia)/Sum(Dia.Qtde_Amostra_Dia))*100,2)
END ) Vl_Taxa_Pesquisa_Dia
FROM ( SELECT pCdMultiEmpresa Cd_Multi_Empresa , Cha.Cd_Chamado , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra_Dia , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas_Dia
FROM Dbamv.Tipo_Sac_Chamado Cha ) Dia
GROUP BY Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Tipo_Sac_Chamado , MvccAdmin.Estabelecimento
WHERE Tipo_Sac_Chamado.Cd_Chamado = Movimento.Cd_Chamado And Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Tipo_Sac_Chamado.Cd_Chamado , Tipo_Sac_Chamado.nm_chamado , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00620
---------------------------------------------------------------------------
CURSOR cProcesso_00620(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Sac_Chamado.Cd_Chamado Cd_Departamento , Tipo_Sac_Chamado.Nm_Chamado Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Sac_Chamado.Nm_Chamado||', QTDE DE PACIENTES: '||Sum(Movimento.Qtde_Amostra) ||', QTDE DE PESQUISA: '||Sum(Nvl(Movimento.Qtde_Pesquisas,0)) ||', TAXA DE OPINIÃO: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa,0))||' %' ||', QTDE DE PACIENTES NO DIA: '||Sum(Movimento.Qtde_Amostra_Dia) ||', QTDE DE PESQUISA NO DIA: '||Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) ||', TAXA DE OPINIÃO NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Pesquisa_Dia,0))||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Amostra,0)) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Pesquisas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Pesquisas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Chamado , Mov.Data_Mes , Mov.Qtde_Amostra , Mov.Qtde_Pesquisas , Mov.Vl_Taxa_Pesquisa , Mov.Qtde_Amostra_Dia , Mov.Qtde_Pesquisas_Dia , Mov.Vl_Taxa_Pesquisa_Dia
FROM ( SELECT Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Dia.Qtde_Amostra) Qtde_Amostra , Sum(Dia.Qtde_Pesquisas) Qtde_Pesquisas , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas)/Sum(Dia.Qtde_Amostra))*100,2)
END ) Vl_Taxa_Pesquisa , Sum(Dia.Qtde_Amostra_Dia) Qtde_Amostra_Dia , Sum(Dia.Qtde_Pesquisas_Dia) Qtde_Pesquisas_Dia , (Case
WHEN Sum(Nvl(Dia.Qtde_Amostra_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pesquisas_Dia)/Sum(Dia.Qtde_Amostra_Dia))*100,2)
END ) Vl_Taxa_Pesquisa_Dia
FROM ( SELECT pCdMultiEmpresa Cd_Multi_Empresa , Cha.Cd_Chamado , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra , ( SELECT count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Amostra_Dia , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas , ( SELECT Count(1)
FROM Dbamv.Sac_Solicitacao Sol , Dbamv.Meio_Sac_Solicitacao Mei
WHERE Sol.Cd_Meio = Mei.Cd_Meio And Sol.Cd_Chamado = Cha.Cd_Chamado And Sol.Dt_Solicidacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Pesquisas_Dia
FROM Dbamv.Tipo_Sac_Chamado Cha ) Dia
GROUP BY Dia.Cd_Multi_Empresa , Dia.Cd_Chamado , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Tipo_Sac_Chamado , MvccAdmin.Estabelecimento
WHERE Tipo_Sac_Chamado.Cd_Chamado = Movimento.Cd_Chamado And Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Tipo_Sac_Chamado.Cd_Chamado , Tipo_Sac_Chamado.nm_chamado , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00623
---------------------------------------------------------------------------
CURSOR cProcesso_00623(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. ATEND. SOLIC. HEMOCOMPONENTES' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC. ATEND. SOLIC. HEMOCOMPONENTES, QTDE DE SOLICITAÇÃO: '||Sum(Movimento.Qtde_Solicitada) ||', QTDE ATENDIDAS: '||Sum(Movimento.Qtde_Atendida) ||', TAXA DE ATENDIMENTO: '||Sum(Movimento.Vl_Taxa_Atendida)||' %' ||', QTDE DE SOLICITAÇÃO NO DIA: '||Sum(Movimento.Qtde_Solicitada_Dia) ||', QTDE ATENDIDAS NO DIA: '||Sum(Movimento.Qtde_Atendida_Dia) ||', TAXA DE ATENDIMENTO NO DIA: '||Sum(Movimento.Vl_Taxa_Atendida_Dia)||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Sum(Movimento.Qtde_Solicitada) Qtde_Instalada , 'SOLIC_SANGUE' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Atendida) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Atendida_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Solicitada , Mov.Qtde_Atendida , Mov.Qtde_Solicitada_Dia , Mov.Qtde_Atendida_Dia , (Case
WHEN Nvl(Mov.Qtde_Solicitada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Atendida,0)/Nvl(Mov.Qtde_Solicitada,0))*100,2)
END ) Vl_Taxa_Atendida , (Case
WHEN Nvl(Mov.Qtde_Solicitada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Atendida_Dia,0)/Nvl(Mov.Qtde_Solicitada_Dia,0))*100,2)
END ) Vl_Taxa_Atendida_Dia
FROM ( SELECT Sol.Data_Mes , Sum(Sol.Qtde_Solicitada) Qtde_Solicitada , Sum(Sol.Qtde_Atendida) Qtde_Atendida , Sum(Sol.Qtde_Solicitada) Qtde_Solicitada_Dia , Sum(Sol.Qtde_Atendida) Qtde_Atendida_Dia
FROM ( SELECT Solic_Sangue.Cd_Solic_Sangue , Solic_Sangue.Dt_Solic_Sangue , To_Char(Solic_Sangue.Dt_Solic_Sangue,'MM/YYYY') Data_Mes , 1 Qtde_Solicitada , (Case
WHEN Solic_Sangue.Dt_Solic_Sangue Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Solicitada_Dia , (Case
WHEN Nvl(It_Solic_Sangue.Sn_realizado,'N') = 'S'
THEN 1
ELSE 0
END ) Qtde_Atendida , (Case
WHEN Solic_Sangue.Dt_Solic_Sangue Between Trunc(Sysdate) And Sysdate And Nvl(It_Solic_Sangue.Sn_realizado,'N') = 'S'
THEN 1
ELSE 0
END ) Qtde_Atendida_Dia
FROM Dbamv.Solic_Sangue , Dbamv.It_Solic_Sangue
WHERE Solic_Sangue.cd_Solic_Sangue = It_Solic_Sangue.Cd_Solic_Sangue And Solic_Sangue.Tp_Situacao <> 'C' And Solic_Sangue.Dt_Solic_Sangue Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa , Dbamv.Setor Str
WHERE Exa.Cd_Setor = Str.Cd_Setor And Exa.Cd_Set_Exa = Solic_Sangue.Cd_Set_Exa And Exists ( SELECT 1
FROM MvccAdmin.Estabelecimento Emp
WHERE Str.Cd_Multi_Empresa = Emp.Cd_Multi_Empresa And (Case
WHEN ( SELECT Est2.Cd_Multi_Empresa
FROM MvccAdmin.Estabelecimento Est2
WHERE Est2.sn_banco_sangue_ses = 'S' And Est2.Cd_Multi_Empresa = pCdMultiEmpresa) = pCdMultiEmpresa
THEN pCdMultiEmpresa
ELSE Emp.Cd_Multi_Empresa
END ) = pCdMultiEmpresa And (Case
WHEN ( SELECT Est3.Cd_Multi_Empresa
FROM MvccAdmin.Estabelecimento Est3
WHERE Est3.sn_banco_sangue = 'N' And Est3.sn_banco_sangue_ses = 'N' And Est3.Cd_Multi_Empresa = pCdMultiEmpresa) = pCdMultiEmpresa
THEN pCdMultiEmpresa
ELSE Emp.Cd_Multi_Empresa
END ) = pCdMultiEmpresa ) ) ) Sol
GROUP BY Sol.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00624
---------------------------------------------------------------------------
CURSOR cProcesso_00624(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERCENTUAL CALIBRAÇÃES' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'PERCENTUAL CALIBRAÇÕES REALIZADAS, QTDE PREVISTA: '||Sum(Movimento.Qtde_Prevista) ||', QTDE CALIBRACAO: '||Sum(Movimento.Qtde_Realizada) ||', TAXA DE CALIBRAÇÃO: '||Sum(Movimento.Vl_Taxa)||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Sum(Movimento.Qtde_Prevista) Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Prevista ---NAO HÁ COMO ESTABECER ESSES NÚMEROS POR DIA-- , Mov.Qtde_Realizada Qtde_Realizada_Dia , Mov.Qtde_Prevista Qtde_Prevista_Dia , (Case
WHEN Mov.Qtde_Prevista = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada/Mov.Qtde_Prevista)*100,2)
END ) Vl_taxa
FROM ( SELECT Sol.Cd_Multi_Empresa , Sol.Data_Mes , Sum(Sol.Qtde_Realizada) Qtde_Realizada , Sum(Sol.Qtde_Prevista) Qtde_Prevista
FROM ( SELECT Bem.Cd_multi_empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT 1
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Tipo_Os = Tip.Cd_Tipo_Os And Sol.Cd_Bem = Bem.Cd_Bem And (Sysdate-Sol.Dt_Execucao)*24*60 > MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Sol.Cd_Tipo_Os,pNrCnpj,'SLA') And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Sol.Cd_Tipo_Os And Vcc.Cd_Tipo_Campo_Chave = 61 --TIPO DE OS And (Vcc.Cd_Departamento = Sol.Cd_Tipo_Os Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Rownum = 1 ) Qtde_Realizada , 1 Qtde_Prevista
FROM Dbamv.Bens Bem , Dbamv.Localidade Loc , Dbamv.Check_List Chk , Dbamv.Itcheck_List Itc , Dbamv.Tipo_Os Tip
WHERE Bem.Cd_Check_List = Chk.Cd_Check_List And Chk.Cd_check_list = Itc.Cd_check_list And Itc.Cd_Tipo_Os = Tip.Cd_Tipo_Os And Bem.Cd_Setor = Loc.cd_setor And Bem.Cd_Localidade = Loc.Cd_Localidade And Bem.Sn_Natureza_Permanente = 'S' And Bem.dt_baixa IS Null And Exists ( SELECT 1
FROM Dbamv.Sub_Clas Sub
WHERE Bem.Cd_Especie = Sub.Cd_Especie And Bem.Cd_Classe = Sub.Cd_Classe And Bem.Cd_Sub_Cla = Sub.Cd_Sub_Cla And Sub.sn_prod_permanente = 'P') And Bem.Cd_Multi_Empresa = pCdMultiEmpresa ) Sol
GROUP BY Sol.Cd_Multi_Empresa , Sol.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00625
---------------------------------------------------------------------------
CURSOR cProcesso_00625(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERCENTUAL QUALIF. TERMICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'PERCENTUAL QUALIF. TERMICA REALIZADA, QTDE PREVISTA: '||Sum(Movimento.Qtde_Prevista) ||', QTDE QUALIFIÇÕES: '||Sum(Movimento.Qtde_Realizada) ||', TAXA DE QUALIFIÇÕES: '||Sum(Movimento.Vl_taxa_Realizada)||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Sum(Movimento.Qtde_Prevista) Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Prevista --NÃO FOI POSSIVEL ESTABELECER OS VALORES DIA-- , Mov.Qtde_Realizada Qtde_Realizada_Dia , Mov.Qtde_Prevista Qtde_Prevista_Dia , (Case
WHEN Mov.Qtde_Prevista = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada/Mov.Qtde_Prevista)*100,2)
END ) Vl_taxa_Realizada
FROM ( SELECT Sol.Cd_Multi_Empresa , Sol.Data_Mes , Sum(Sol.Qtde_Realizada) Qtde_Realizada , Sum(Sol.Qtde_Prevista) Qtde_Prevista
FROM ( SELECT Bem.Cd_multi_empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT 1
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Tipo_Os = Tip.Cd_Tipo_Os And Sol.Cd_Bem = Bem.Cd_Bem And (Sysdate-Sol.Dt_Execucao)*24*60 > MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Sol.Cd_Tipo_Os,pNrCnpj,'SLA') And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Sol.Cd_Tipo_Os And Vcc.Cd_Tipo_Campo_Chave = 61 --TIPO DE OS And (Vcc.Cd_Departamento = Sol.Cd_Tipo_Os Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Rownum = 1 ) Qtde_Realizada , 1 Qtde_Prevista
FROM Dbamv.Bens Bem , Dbamv.Localidade Loc , Dbamv.Check_List Chk , Dbamv.Itcheck_List Itc , Dbamv.Tipo_Os Tip
WHERE Bem.Cd_Check_List = Chk.Cd_Check_List And Chk.Cd_check_list = Itc.Cd_check_list And Itc.Cd_Tipo_Os = Tip.Cd_Tipo_Os And Bem.Cd_Setor = Loc.cd_setor And Bem.Cd_Localidade = Loc.Cd_Localidade And Bem.Sn_Natureza_Permanente = 'S' And Bem.dt_baixa IS Null And Exists ( SELECT 1
FROM Dbamv.Sub_Clas Sub
WHERE Bem.Cd_Especie = Sub.Cd_Especie And Bem.Cd_Classe = Sub.Cd_Classe And Bem.Cd_Sub_Cla = Sub.Cd_Sub_Cla And Sub.sn_prod_permanente = 'P') And Bem.Cd_Multi_Empresa = pCdMultiEmpresa ) Sol
GROUP BY Sol.Cd_Multi_Empresa , Sol.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00626
---------------------------------------------------------------------------
CURSOR cProcesso_00626(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TEMPO DE INTERVALO DE SUBSTITUIÇÃO DE LEITO, TAXA DE OCUPAÇÃO: '||Movimento.Vl_Taxa_Ocupacao||'%' ||', MÉDIA DE PERMANÊNCIA: '||Movimento.Vl_Media_Permanencia||'dia(s)' ||', TEMPO INTERNALO DE LEITO: '||Movimento.Hr_Tempo_Conforme ||', TEMPO INTERNALO DE LEITO NO DIA: '||Movimento.Hr_Tempo_Conforme_Dia ||', TAXA DE OCUPAÇÃO MÊS: '||Movimento.Vl_Taxa_Ocupacao||' %' ||', MEDIA DE PERMANÊNCIA MÊS: '||Movimento.Vl_Media_Permanencia||' Dia' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tempo_Conforme Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tempo_Conforme_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , Mov.Nr_Paciente_Dia , Mov.Nr_Leito_Previsto , Mov.Nr_Saidas , Mov.Nr_Paciente_Dia_Dia , Mov.Nr_Leito_Previsto_Dia , Mov.Nr_Saidas_Dia , Mov.Vl_Media_Permanencia , Mov.Vl_Taxa_Ocupacao , Mov.Vl_Media_Permanencia_Dia , Mov.Vl_Taxa_Ocupacao_Dia , Mov.Data_Mes , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme,'N',MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Unid_Int,pNrCnpj,'SLN')) Vl_Tempo_Conforme , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme_Dia,'N',MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Unid_Int,pNrCnpj,'SLN')) Vl_Tempo_Conforme_Dia , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme,'C') Hr_Tempo_Conforme , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme_Dia,'C') Hr_Tempo_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Nr_Paciente_Dia , Mov.Nr_Leito_Previsto , Mov.Nr_Saidas , Mov.Nr_Paciente_Dia_Dia , Mov.Nr_Leito_Previsto_Dia , Mov.Nr_Saidas_Dia , Mov.Vl_Media_Permanencia , Mov.Vl_Taxa_Ocupacao , Mov.Vl_Media_Permanencia_Dia , Mov.Vl_Taxa_Ocupacao_Dia , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Avg((Mov.Vl_Tempo_Intervalo)*24*60) Vl_Tempo_Conforme , Avg((Mov.Vl_Tempo_Intervalo_Dia)*24*60) Vl_Tempo_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Nr_Paciente_Dia , Mov.Nr_Leito_Previsto , Mov.Nr_Saidas , Mov.Nr_Paciente_Dia_Dia , Mov.Nr_Leito_Previsto_Dia , Mov.Nr_Saidas_Dia , Mov.Vl_Media_Permanencia , Mov.Vl_Taxa_Ocupacao --Calculo: Índice Intervalo De Substituição = taxa de desocupação x média de permanência /taxa de ocupação , (Case
WHEN Mov.Vl_Taxa_Ocupacao = 0
THEN 0
ELSE ((100-Mov.Vl_Taxa_Ocupacao)*Mov.Vl_Media_Permanencia)/Mov.Vl_Taxa_Ocupacao
END ) Vl_Tempo_Intervalo , Mov.Vl_Media_Permanencia_Dia , Mov.Vl_Taxa_Ocupacao_Dia , (Case
WHEN Mov.Vl_Taxa_Ocupacao_Dia = 0
THEN 0
ELSE ((100-Mov.Vl_Taxa_Ocupacao_Dia)*Mov.Vl_Media_Permanencia_Dia)/Mov.Vl_Taxa_Ocupacao_Dia
END ) Vl_Tempo_Intervalo_Dia
FROM ( SELECT Dia.Cd_Unid_Int , Dia.Nr_Paciente_Dia , Dia.Nr_Leito_Previsto , Dia.Nr_Saidas , Dia.Nr_Paciente_Dia_Dia , Dia.Nr_Leito_Previsto_Dia , Dia.Nr_Saidas_Dia --Calculo: Média de permanência = Dia.Nr_Paciente_Dia/Dia.Nr_Saidas , Round(Case
WHEN Dia.Nr_Saidas = 0
THEN (Dia.Nr_Paciente_Dia/1)
ELSE (Dia.Nr_Paciente_Dia/Dia.Nr_Saidas)
END ,2) Vl_Media_Permanencia , Round(Case
WHEN Dia.Nr_Saidas_Dia = 0
THEN (Dia.Nr_Paciente_Dia_Dia/1)
ELSE (Dia.Nr_Paciente_Dia_Dia/Dia.Nr_Saidas_Dia)
END ,2) Vl_Media_Permanencia_Dia --Calculo: Taxa de Ocupação = (Nr_Paciente_Dia/Nr_Leito_Previsto)*100 , (Case
WHEN Dia.Nr_Leito_Previsto = 0
THEN 0
ELSE Round((Dia.Nr_Paciente_Dia/Dia.Nr_Leito_Previsto)*100,2)
END ) Vl_Taxa_Ocupacao , (Case
WHEN Dia.Nr_Leito_Previsto_Dia = 0
THEN 0
ELSE Round((Dia.Nr_Paciente_Dia_Dia/Dia.Nr_Leito_Previsto_Dia)*100,2)
END ) Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Nr_Leito_Previsto , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Nr_Leito_Previsto_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --PACIENTES CONVENIO/PART And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) Nr_Paciente_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --PACIENTES CONVENIO/PART And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) Nr_Saidas , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --PACIENTES CONVENIO/PART And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ) Nr_Paciente_Dia_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio IN ('C','P')) --PACIENTES CONVENIO/PART And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999) Nr_Saidas_Dia
FROM Dbamv.Unid_Int Und
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' ) Dia ) Mov ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Nr_Paciente_Dia , Mov.Nr_Leito_Previsto , Mov.Nr_Saidas , Mov.Nr_Paciente_Dia_Dia , Mov.Nr_Leito_Previsto_Dia , Mov.Nr_Saidas_Dia , Mov.Vl_Media_Permanencia , Mov.Vl_Taxa_Ocupacao , Mov.Vl_Media_Permanencia_Dia , Mov.Vl_Taxa_Ocupacao_Dia , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00629
---------------------------------------------------------------------------
CURSOR cProcesso_00629(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'MEDIA DE PERMANENCIA SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'MEDIA DE PERMANENCIA SUS'||', NÚMERO DE PACIENTES DIA: '||Avg(Movimento.Nr_Paciente_Dia) ||', NÚMERO DE SAÍDAS: '||Avg(Movimento.Nr_Saidas) ||', TEMPO MÉDIO: '||Avg(Movimento.Vl_Media_Permanencia)||' Dia(s). ' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Avg(Nvl(Movimento.Vl_Media_Permanencia,0)) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Media_Permanencia) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Media_Permanencia_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MEDIA DE PERMANENCIA SUS--- SELECT Mov.Nr_Paciente_Dia , Mov.Nr_Saidas , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Round(Case
WHEN Mov.Nr_Saidas = 0
THEN (Mov.Nr_Paciente_Dia/1)
ELSE (Mov.Nr_Paciente_Dia/Mov.Nr_Saidas)
END ,2) Vl_Media_Permanencia , Round(Case
WHEN Mov.Nr_Saidas_Dia = 0
THEN (Mov.Nr_Paciente_Dia_Dia/1)
ELSE (Mov.Nr_Paciente_Dia_Dia/Mov.Nr_Saidas_Dia)
END ,2) Vl_Media_Permanencia_Dia
FROM ( SELECT ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Movimentacao = 1 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio = 'H') --PACIENTES SUS And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) Nr_Paciente_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio = 'H') --PACIENTES SUS And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) Nr_Saidas , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Movimentacao = 1 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio = 'H') --PACIENTES SUS And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999) Nr_Paciente_Dia_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Ate.Cd_Convenio And Convenio.Tp_Convenio = 'H') --PACIENTES SUS And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999) Nr_Saidas_Dia
FROM Dual ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00635
---------------------------------------------------------------------------
CURSOR cProcesso_00635(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Movimento.Cd_Departamento , Movimento.Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , (Case
WHEN Movimento.Cd_Departamento = 1
THEN 'VALOR TOTAL PRODUZIDO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_receita_mais_perda),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA PERDA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_perda_media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR PAGO PELO SUS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_Receita_media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', PERC. DA PERDA: '||Sum(Nvl(Movimento.vl_perc_perda_media,0))||'%'
WHEN Movimento.Cd_Departamento = 2
THEN 'QTDE TOTAL DE CONTAS: '||Sum(Movimento.Qtde_Total)||Chr(10)|| ', QTDE DE CONTAS COM PERDA: '||Sum(Movimento.Qtde_Conforme)||Chr(10)|| ', PERC. DA PERDA: '||Sum(Nvl(Movimento.vl_perc_perda_media,0))||'%'
END ) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Conforme) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Conforme) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.cd_multi_empresa , Dep.Cd_Departamento , Dep.Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_mes , Round(Avg(Mov.Vl_Servico_Hosp_Perda),2) Vl_Perda_Media , Round(Avg(Mov.Vl_Total_Receita),2) Vl_Total_Receita_Media , Round(Avg(Mov.Vl_Total_Receita_Mais_Perda),2) Vl_Total_Receita_Mais_Perda , (Case
WHEN Dep.Cd_Departamento = 1
THEN Round(Avg(Mov.vl_servico_hosp_perda)/Avg(Mov.vl_total_receita_mais_perda)*100,2)
WHEN Dep.Cd_Departamento = 2
THEN (Case
WHEN Sum(Mov.Qtde_Total_Conta) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Conta_Perda)/Sum(Mov.Qtde_Total_Conta))*100,2)
END )
END ) vl_perc_perda_media , Sum(Mov.Qtde_Conta_Perda) Qtde_Conta_Perda , Sum(Mov.Qtde_Total_Conta) Qtde_Total_Conta , (Case
WHEN Dep.Cd_Departamento = 1
THEN Round(Avg(Mov.Vl_Servico_Hosp_Perda),2)
WHEN Dep.Cd_Departamento = 2
THEN Sum(Mov.Qtde_Conta_Perda)
END ) Qtde_Conforme , (Case
WHEN Dep.Cd_Departamento = 1
THEN Round(Avg(Mov.Vl_Total_Receita),2)
WHEN Dep.Cd_Departamento = 2
THEN Sum(Mov.Qtde_Total_Conta)
END ) Qtde_Total
FROM ( SELECT Perda.cd_multi_empresa , Perda.Data_Mes , Sum((Perda.nr_permanencia_diferenca*Perda.vl_servico_hosp_dia)-Perda.vl_lancamento_perm_a_maior) vl_servico_hosp_perda , Sum(Perda.vl_total_lancamento)+Sum((Perda.nr_permanencia_diferenca*Perda.vl_servico_hosp_dia)-Perda.vl_lancamento_perm_a_maior) vl_total_receita_mais_perda , Sum(Perda.vl_total_lancamento) vl_total_Receita , Sum(Case
WHEN Perda.nr_permanencia_diferenca > 0
THEN 1
ELSE 0
END ) Qtde_Conta_Perda , Count(1) Qtde_Total_Conta
FROM ( SELECT Conta.Cd_Multi_Empresa , Conta.nr_conta , Conta.cd_atendimento , Conta.cd_procedimento_realizado , Conta.cd_prestador_responsavel , Conta.dt_inicio , Conta.dt_final , Conta.Data_Mes , Conta.nr_permanencia_usado , Conta.nr_permanencia_previsto , (Case
WHEN Conta.nr_permanencia_usado > Conta.nr_permanencia_previsto
THEN (Conta.nr_permanencia_usado-Conta.nr_permanencia_previsto)
ELSE 0
END ) nr_permanencia_diferenca , Conta.qt_lancamento_perm_maior , Conta.vl_lancamento_perm_a_maior , Conta.vl_servico_hospitalar , Conta.Vl_Servico_Hospitalar_pago , (Case
WHEN Conta.nr_permanencia_previsto = 0
THEN Trunc(Conta.Vl_Servico_Hospitalar_pago/1,2)
ELSE Trunc(Conta.Vl_Servico_Hospitalar_pago/Conta.nr_permanencia_previsto)
END ) vl_servico_hosp_dia , Conta.vl_total_lancamento
FROM ( SELECT Valor.Cd_Multi_Empresa , Valor.Cd_Reg_Fat Nr_Conta , Valor.Cd_Atendimento , Valor.cd_procedimento_realizado , Valor.Cd_Prestador_Responsavel , Valor.Dt_Inicio , Valor.Dt_Final , To_Char(Valor.Dt_Final,'MM/YYYY') Data_Mes , Round(Valor.Dt_Final-Valor.Dt_Inicio) Nr_Permanencia_Usado , ( SELECT Min(pDetal.nr_dias_internacao)
FROM dbamv.Procedimento_Detalhe_Vigencia pDetal
WHERE pDetal.Cd_Procedimento = Valor.cd_procedimento_realizado And pDetal.dt_vigencia = ( SELECT Max(pDetal2.dt_vigencia)
FROM dbamv.Procedimento_Detalhe_Vigencia pDetal2
WHERE pDetal2.Cd_Procedimento = pDetal.Cd_Procedimento) ) nr_permanencia_previsto , Sum(Case
WHEN Valor.cd_procedimento = '0802010199'
THEN Valor.Qt_Lancamento
ELSE 0
END ) Qt_Lancamento_Perm_Maior , Sum(Case
WHEN Valor.cd_procedimento = '0802010199'
THEN Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0)
ELSE 0
END ) Vl_Lancamento_Perm_a_Maior , Sum(Nvl(Valor.Vl_Sh_Proprio,0)) Vl_Servico_Hospitalar , Sum(Case
WHEN Valor.cd_procedimento = Valor.cd_procedimento_realizado
THEN Nvl(Valor.Vl_Sh_Proprio,0)
ELSE 0
END ) Vl_Servico_Hospitalar_pago , Sum(Nvl(Valor.Vl_Sh_Proprio,0))+Sum(Nvl(Valor.Vl_Sp_Proprio,0)) Vl_Total_Lancamento
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Dt_Final Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-3),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 --- RETIRA OS PACIENTES QUE EST~IVERAM NA UTI-- And Not Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov
WHERE Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_acomodacao <> 'U' And Lei.Cd_leito = Mov.cd_leito) And Mov.Cd_Atendimento = Valor.Cd_Atendimento) And Valor.Dt_Final IS Not Null And Valor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Valor.Cd_Multi_Empresa , Valor.Cd_Reg_Fat , Valor.Cd_Atendimento , Valor.Dt_Inicio , Valor.Dt_Final , Valor.cd_procedimento_realizado , Valor.Cd_Prestador_Responsavel , To_Char(Valor.Dt_Final,'MM/YYYY') ) Conta
WHERE Conta.cd_procedimento_realizado <> '0415010012' --Retirada das Cirurgia Multipla ) Perda
GROUP BY Perda.cd_multi_empresa , Perda.Data_Mes ) Mov , ( SELECT 1 Cd_Departamento, 'EXCESSO DE PERMANENCIA SUS - ECONÔMICO' Ds_Departamento
FROM Dual
UNION ALL SELECT 2 Cd_Departamento, 'EXCESSO DE PERMANENCIA SUS - FÍSICO' Ds_Departamento
FROM Dual ) Dep
GROUP BY Mov.cd_multi_empresa , Dep.Cd_Departamento , Dep.Ds_Departamento ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Movimento.Cd_Departamento , Movimento.Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00637
---------------------------------------------------------------------------
CURSOR cProcesso_00637(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. MÉDIO ENTREGA NO MÊS DA ALTA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC. MÉDIO ENTREGA NO MÊS DA ALTA, NR DE ALTAS MEDIA MÊS: '||Sum(Movimento.Nr_Altas_Mes_Media)||Chr(10)||' (Média Mensal)'||Chr(10)|| ', NR DE ENTREGAS MEDIA MÊS: '||Sum(Movimento.Nr_Entregue_Mes_Media)||Chr(10)||' (Média Mensal)'||Chr(10)|| ', TAXA MÉDIA DE ENTREGA: '||Avg(Movimento.Vl_Perc_Entregue_Mes)||'%'|| ', NR DE ALTAS MEDIA NO DIA: '||Sum(Movimento.Nr_Altas_Mes_Media_Dia)||Chr(10)||' (Média dia)'||Chr(10)|| ', NR DE ENTREGAS MEDIA NO DIA: '||Sum(Movimento.Nr_Entregue_Mes_Media_Dia)||Chr(10)||' (Média dia)'||Chr(10)|| ', TAXA MÉDIA DE ENTREGA NO DIA: '||Avg(Movimento.Vl_Perc_Entregue_Mes_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Sum(Movimento.Nr_Altas_Mes_Media) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Perc_Entregue_Mes) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Perc_Entregue_Mes_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Mov.Nr_Altas_Mes_Media , Mov.Nr_Entregue_Mes_Media , Mov.Vl_Perc_Entregue_Mes , Mov.Nr_Altas_Mes_Media_Dia , Mov.Nr_Entregue_Mes_Media_Dia , Mov.Vl_Perc_Entregue_Mes_Dia
FROM ( SELECT Mov.Data_Mes , Trunc(Mov.Nr_Altas_Mes_Media) Nr_Altas_Mes_Media , Trunc(Mov.Nr_Entregue_Mes_Media) Nr_Entregue_Mes_Media , (Case
WHEN Nvl(Trunc(Mov.Nr_Altas_Mes_Media),0) = 0
THEN 0
ELSE Round(Nvl(Trunc(Nr_Entregue_Mes_Media),0)/Nvl(Trunc(Mov.Nr_Altas_Mes_Media),0)*100,2)
END ) Vl_Perc_Entregue_Mes , Trunc(Mov.Nr_Altas_Mes_Media_Dia) Nr_Altas_Mes_Media_Dia , Trunc(Mov.Nr_Entregue_Mes_Media_Dia) Nr_Entregue_Mes_Media_Dia , (Case
WHEN Nvl(Trunc(Mov.Nr_Altas_Mes_Media_Dia),0) = 0
THEN 0
ELSE Round(Nvl(Trunc(Nr_Entregue_Mes_Media_Dia),0)/Nvl(Trunc(Mov.Nr_Altas_Mes_Media_Dia),0)*100,2)
END ) Vl_Perc_Entregue_Mes_Dia
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(( SELECT Avg(Qtde_Altas)
FROM ( SELECT To_Char(Reg.Dt_Final,'MM/YYYY'), Count(1) Qtde_Altas
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-3),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Reg.Dt_Final,'MM/YYYY')) ),0) Nr_Altas_Mes_Media , Nvl(( SELECT Avg(Qtde_Entregas)
FROM ( SELECT To_Char(Reg.Dt_Final,'MM/YYYY'), Count(1) Qtde_Entregas
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-3),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura Rme, Dbamv.Fatura Fat
WHERE Rme.Cd_Remessa = Reg.Cd_Remessa And Rme.Cd_Fatura = Fat.Cd_Fatura And Fat.Cd_Multi_Empresa = pCdMultiEmpresa And Reg.Dt_Final Between Fat.Dt_Competencia And Last_Day(Fat.Dt_Competencia)+.9999 --- FILTRO POR DATA DE COMPETENCIA --- And (Rme.Dt_Entrega_Da_Fatura Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-3),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999 Or Fat.Dt_Competencia Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-3),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999) )
GROUP BY To_Char(Reg.Dt_Final,'MM/YYYY')) ),0) Nr_Entregue_Mes_Media , Nvl(( SELECT Avg(Qtde_Altas)
FROM ( SELECT To_Char(Reg.Dt_Final,'MM/YYYY'), Count(1) Qtde_Altas
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Reg.Dt_Final,'MM/YYYY')) ),0) Nr_Altas_Mes_Media_Dia , Nvl(( SELECT Avg(Qtde_Entregas)
FROM ( SELECT To_Char(Reg.Dt_Final,'MM/YYYY'), Count(1) Qtde_Entregas
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura Rme, Dbamv.Fatura Fat
WHERE Rme.Cd_Remessa = Reg.Cd_Remessa And Rme.Cd_Fatura = Fat.Cd_Fatura And Fat.Cd_Multi_Empresa = pCdMultiEmpresa And Reg.Dt_Final Between Fat.Dt_Competencia And Last_Day(Fat.Dt_Competencia)+.9999 --- FILTRO POR DATA DE COMPETENCIA --- And (Rme.Dt_Entrega_Da_Fatura Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 Or Fat.Dt_Competencia Between Trunc(Sysdate) And Trunc(Sysdate)+.99999) )
GROUP BY To_Char(Reg.Dt_Final,'MM/YYYY')) ),0) Nr_Entregue_Mes_Media_Dia
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00639
---------------------------------------------------------------------------
CURSOR cProcesso_00639(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'NUMERO DE INTERNAÇOES'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO URGENCIA--- SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Especialid , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Especialid , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , To_Char(Ate.Dt_Internado,'MM/YYYY') Dt_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio in ('C','P','H')) And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Dt_mes , Mov.Cd_Especialid ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00640
---------------------------------------------------------------------------
CURSOR cProcesso_00640(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--- MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Especialid , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Especialid , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA A DESSCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Especialid ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00641
---------------------------------------------------------------------------
CURSOR cProcesso_00641(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00642
---------------------------------------------------------------------------
CURSOR cProcesso_00642(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00643
---------------------------------------------------------------------------
CURSOR cProcesso_00643(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Multi_Empresa = pCdMultiEmpresa And Avi.Cd_Atendimento = Ate.Cd_Atendimento) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00644
---------------------------------------------------------------------------
CURSOR cProcesso_00644(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Nvl(Qtde_Realizada,0) Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Projetada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CIRURGIAS PROGRAMADAS-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Age_Cir Age
WHERE Avi.Cd_Aviso_Cirurgia = Age.Cd_Aviso_Cirurgia And Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Tp_Cirurgias = 'E' And Avi.Tp_Situacao = 'R') --CIRURGIAA PROGRAMADAS/AGENDADAS And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Cd_Convenio , Sai.Data_Mes ) Mov ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00645
---------------------------------------------------------------------------
CURSOR cProcesso_00645(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Multi_Empresa = pCdMultiEmpresa And Avi.Cd_Atendimento = Ate.Cd_Atendimento) ---CIRURGIA And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00646
---------------------------------------------------------------------------
CURSOR cProcesso_00646(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00647
---------------------------------------------------------------------------
CURSOR cProcesso_00647(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Cd_Convenio , Sai.Data_Mes ) Mov ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00649
---------------------------------------------------------------------------
CURSOR cProcesso_00649(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE EXAME ANÁLISES CLÍNICAS(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'EXAMES DE ANALISES CLINICAS'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Lab Ped , Dbamv.ItPed_Lab Itp
WHERE Itp.Cd_Ped_Lab = Ped.Cd_Ped_Lab And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Lab And Vcc.Cd_Tipo_Campo_Chave = 90 ---EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Lab ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00650
---------------------------------------------------------------------------
CURSOR cProcesso_00650(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE TESTE ERGOMÉTRICO(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'EXAMES CICLOERGOMETRIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00651
---------------------------------------------------------------------------
CURSOR cProcesso_00651(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE COLANGIOPANCREAT. RETR/ENDOSC.(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , NUll nm_processo , 'NÚMERO DE COLANGIOPANCREAT. RETR/ENDOSC.(EXT)'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00652
---------------------------------------------------------------------------
CURSOR cProcesso_00652(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE COLONOSCOPIA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , NUll nm_processo , 'COLONOSCOPIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00653
---------------------------------------------------------------------------
CURSOR cProcesso_00653(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ECOCARDIOGRAMA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ECOCARDIOGRAMA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00654
---------------------------------------------------------------------------
CURSOR cProcesso_00654(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ELETROENCEFALOGRAMA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ELETROENCEFALOGRAMA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00655
---------------------------------------------------------------------------
CURSOR cProcesso_00655(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DIGESTIVA ALTA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ENDOSCOPIA DIGESTIVA ALTA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00656
---------------------------------------------------------------------------
CURSOR cProcesso_00656(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DAS VIAS URINÁRIAS(EXT)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Null nm_processo , 'ENDOSCOPIA VIAS URINARIAS'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00657
---------------------------------------------------------------------------
CURSOR cProcesso_00657(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DAS VIAS RESPIRATÓRIAS(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ENDOSCOPIA VIAS RESPIRAT?RIAS'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00658
---------------------------------------------------------------------------
CURSOR cProcesso_00658(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE HOLTER(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'HOLTER'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00659
---------------------------------------------------------------------------
CURSOR cProcesso_00659(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE MAPA(EXT)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Null nm_processo , 'MAPA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00660
---------------------------------------------------------------------------
CURSOR cProcesso_00660(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE MAMOGRAFIA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'MAMOGRAFIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00661
---------------------------------------------------------------------------
CURSOR cProcesso_00661(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE RAIO-X(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'RAIO-X'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00662
---------------------------------------------------------------------------
CURSOR cProcesso_00662(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE RESSONÂNCIA MAGNÉTICA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'RESSONANCIA MAGNETICA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00663
---------------------------------------------------------------------------
CURSOR cProcesso_00663(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE TOMOGRAFIA COMPUTADORIZADA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'TOMOGRAFIA COMPUTADORIZADA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00664
---------------------------------------------------------------------------
CURSOR cProcesso_00664(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ULTRASSONOGRAFIA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ULTRASONOGRAFIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00665
---------------------------------------------------------------------------
CURSOR cProcesso_00665(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ULTRASSONOGRAFIA/DOPPLER(EXT)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Null nm_processo , 'ULTRASONOGRAFIA/DOPPLER'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00666
---------------------------------------------------------------------------
CURSOR cProcesso_00666(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Convenio.Cd_Tipo_Convenio Cd_Departamento , Tipo_Convenio.Ds_Tipo_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'CIRURGIA AMBULATORIAL DE '||Tipo_Convenio.Ds_Tipo_Convenio||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Tipo_Convenio , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'H'
THEN 2
WHEN Con.Tp_Convenio = 'A'
THEN 3
WHEN Con.Tp_Convenio = 'P'
THEN 4
END ) Cd_Tipo_Convenio , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.sn_principal = 'S' And Avi.Sn_Ambulatorial = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tipo_Convenio, 'CONVENIO' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 2 Cd_Tipo_Convenio, 'SUS-AIH' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 3 Cd_Tipo_Convenio, 'SUS-SIA' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 4 Cd_Tipo_Convenio, 'PARTICULAR' Ds_Tipo_Convenio
FROM Dual ) Tipo_Convenio , MvccAdmin.Estabelecimento
WHERE Tipo_Convenio.Cd_Tipo_Convenio = Movimento.Cd_Tipo_Convenio(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Tipo_Convenio.Cd_Tipo_Convenio , Tipo_Convenio.Ds_Tipo_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00667
---------------------------------------------------------------------------
CURSOR cProcesso_00667(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE INTERNACOES HOSPITAL DIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'INTERNACOES HOSPITAL DIA'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO--- ---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Ate.Cd_Convenio And Con.Tp_Convenio in ('C','P','H')) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Lei.Cd_leito = Ate.Cd_leito And Tip.Tp_Acomodacao = 'H') And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00668
---------------------------------------------------------------------------
CURSOR cProcesso_00668(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NuLL nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'SESSOES DE QUIMIOTERAPIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'SESSOES DE QUIMIOTERAPIA'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO ATENDIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT pCdMultiEmpresa Cd_Multi_Empresa , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Pre.Nr_Sessao Qtde_Realizada , (Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN Pre.Nr_Sessao
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre
WHERE Pre.Cd_Tratamento IS Not Null And Exists ( SELECT 1
FROM Dbamv.Hritpre_Cons Hri, Dbamv.ItPre_Med Itp
WHERE Hri.Sn_Suspenso = 'N' And Hri.Cd_Itpre_Med = Itp.Cd_Itpre_Med And Itp.Cd_Pre_Med = Pre.Cd_Pre_Med) And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Atendime Ate
WHERE Ate.Cd_Atendimento = Pre.Cd_Atendimento and Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00670
---------------------------------------------------------------------------
CURSOR cProcesso_00670(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE TESTE ERGOMÉTRICO(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , NUll nm_processo , 'EXAMES CICLOERGOMETRIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'PED_RX' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00671
---------------------------------------------------------------------------
CURSOR cProcesso_00671(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE HOLTER(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , NUll nm_processo , 'HOLTER'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00672
---------------------------------------------------------------------------
CURSOR cProcesso_00672(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ULTRASSONOGRAFIA/DOPPLER(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , NUll nm_processo , 'ULTRASONOGRAFIA/DOPPLER'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00673
---------------------------------------------------------------------------
CURSOR cProcesso_00673(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE COLANGIOPANCREAT. RETR/ENDOSC.(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'COLANGIOPANCREATOGRAFIA RETR?GRADA ENDOSC.'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00674
---------------------------------------------------------------------------
CURSOR cProcesso_00674(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE COLONOSCOPIA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , NUll nm_processo , 'COLONOSCOPIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00675
---------------------------------------------------------------------------
CURSOR cProcesso_00675(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE EXAME ANÁLISES CLÍNICAS(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'EXAMES DE ANALISES CLINICAS'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'PED_LAB' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Lab Ped , Dbamv.ItPed_Lab Itp
WHERE Itp.Cd_Ped_Lab = Ped.Cd_Ped_Lab And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Lab And Vcc.Cd_Tipo_Campo_Chave = 90 --EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Lab ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00676
---------------------------------------------------------------------------
CURSOR cProcesso_00676(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DAS VIAS RESPIRATÓRIAS(INT)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Null nm_processo , 'ENDOSCOPIA VIAS RESPIRATÓRIAS'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00677
---------------------------------------------------------------------------
CURSOR cProcesso_00677(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE RAIO-X(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'RAIO-X'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00678
---------------------------------------------------------------------------
CURSOR cProcesso_00678(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ELETROENCEFALOGRAMA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'ELETROENCEFALOGRAMA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00679
---------------------------------------------------------------------------
CURSOR cProcesso_00679(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE TOMOGRAFIA COMPUTADORIZADA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'TOMOGRAFIA COMPUTADORIZADA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00680
---------------------------------------------------------------------------
CURSOR cProcesso_00680(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ULTRASSONOGRAFIA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'ULTRASONOGRAFIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00681
---------------------------------------------------------------------------
CURSOR cProcesso_00681(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NULL nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE MAPA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'MAPA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00682
---------------------------------------------------------------------------
CURSOR cProcesso_00682(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE RESSONÂNCIA MAGNÉTICA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'RESSONANCIA MAGNETICA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00683
---------------------------------------------------------------------------
CURSOR cProcesso_00683(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DIGESTIVA ALTA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'ENDOSCOPIA DIGESTIVA ALTA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00684
---------------------------------------------------------------------------
CURSOR cProcesso_00684(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ECOCARDIOGRAMA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'ECOCARDIOGRAMA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00685
---------------------------------------------------------------------------
CURSOR cProcesso_00685(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DAS VIAS URINÁRIAS(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'ENDOSCOPIA VIAS URIN?RIAS'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00686
---------------------------------------------------------------------------
CURSOR cProcesso_00686(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE MAMOGRAFIA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'MAMOGRAFIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00688
---------------------------------------------------------------------------
CURSOR cProcesso_00688(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE DIÁRIAS CLINICA ADULTO SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'NUMERO DE DIÁRIAS CLINICAS SUS'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Realizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CLÍNICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '03' And ps.cd_sub_grupo_procedimento <> 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CLÍNICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '03' And ps.cd_sub_grupo_procedimento <> 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00689
---------------------------------------------------------------------------
CURSOR cProcesso_00689(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE DIARIAS CIRURGICA ADULTO SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'NUMERO DE DIARIAS CIRURGICAS SUS'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Realizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CIRURGICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '04' And ps.cd_sub_grupo_procedimento <> 11 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CIRURGICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '04' And ps.cd_sub_grupo_procedimento <> 11 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00690
---------------------------------------------------------------------------
CURSOR cProcesso_00690(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE DI?RIAS CLINICA PED. SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'NUMERO DE DIARIAS CLINICA PED. SUS'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Realizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CLÍNICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '03' And ps.cd_sub_grupo_procedimento <> 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CLÍNICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '03' And ps.cd_sub_grupo_procedimento <> 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00691
---------------------------------------------------------------------------
CURSOR cProcesso_00691(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', TAXA PRODUZIDA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%'||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia)||Chr(10) ||', QTDE PROJETADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) ||', TAXA PRODUZIDA NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme_Dia,0))||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Nvl(Mov.Qtde_Projetada_Dia,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada_Dia,0)/Nvl(Mov.Qtde_Projetada_Dia,0)*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada Qtde_Realizada , Mov.Qtde_Utilizada_Dia Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00692
---------------------------------------------------------------------------
CURSOR cProcesso_00692(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA PRODUZIDA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Projetada_Dia) ||', TAXA PRODUZIDA NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0))) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Trunc(Sum(Nvl(Movimento.Qtde_Instalada_Dia,0))) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Nvl(Mov.Qtde_Projetada_Dia,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada_Dia,0)/Nvl(Mov.Qtde_Projetada_Dia,0)*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada Qtde_Realizada , Mov.Qtde_Utilizada_Dia Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00693
---------------------------------------------------------------------------
CURSOR cProcesso_00693(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA PRODUZIDA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Projetada_Dia) ||', TAXA PRODUZIDA NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0))) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Trunc(Sum(Nvl(Movimento.Qtde_Instalada_Dia,0))) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Nvl(Mov.Qtde_Projetada_Dia,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada_Dia,0)/Nvl(Mov.Qtde_Projetada_Dia,0)*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada Qtde_Realizada , Mov.Qtde_Utilizada_Dia Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00694
---------------------------------------------------------------------------
CURSOR cProcesso_00694(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE DIARIAS CIRURGICA PED. SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'NUMERO DE DIARIAS CIRURGICA PED. SUS'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0))) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Trunc(Sum(Nvl(Movimento.Qtde_Instalada_Dia,0))) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Realizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CIRURGICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '04' And ps.cd_sub_grupo_procedimento <> 11 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PACIENTES CIRURGICOS --- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.Cd_grupo_Procedimento = '04' And ps.cd_sub_grupo_procedimento <> 11 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Ate.Cd_Paciente) And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00695
---------------------------------------------------------------------------
CURSOR cProcesso_00695(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE DIARIAS OBSTETRICA CIRURGICA SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'NUMERO DE DIARIAS OBSTETRICA CIRURGICA SUS'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0))) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Trunc(Sum(Nvl(Movimento.Qtde_Instalada_Dia,0))) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Realizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PROCEDIMENTO CIRURGICA OBSTETRA--- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.cd_grupo_procedimento = '04' And Ps.cd_sub_grupo_procedimento = 11 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PROCEDIMENTO CLINICOS OBSTETRA--- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.cd_grupo_procedimento = '04' And Ps.cd_sub_grupo_procedimento = 11 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00696
---------------------------------------------------------------------------
CURSOR cProcesso_00696(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE DIARIAS OBSTETRICA CLINICA SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'NUMERO DE DIARIAS OBSTETRICA CLINICA SUS'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0))) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Trunc(Sum(Nvl(Movimento.Qtde_Instalada_Dia,0))) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Realizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PROCEDIMENTO CLINICOS OBSTETRA--- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.cd_grupo_procedimento = '03' And Ps.Cd_organiza_grupo_procedimento = 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PROCEDIMENTO CLINICOS OBSTETRA--- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.cd_grupo_procedimento = '03' And Ps.Cd_organiza_grupo_procedimento = 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00697
---------------------------------------------------------------------------
CURSOR cProcesso_00697(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , nULL nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE DIARIAS OBSTETRICA PARTO SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'NUMERO DE DIARIAS OBSTETRICA PARTO SUS'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0))) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Trunc(Sum(Nvl(Movimento.Qtde_Instalada_Dia,0))) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Realizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PROCEDIMENTO PARTOS--- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.cd_grupo_procedimento = '03' And Ps.cd_sub_grupo_procedimento = 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int --- PROCEDIMENTO CLINICOS OBSTETRA--- And Exists ( SELECT 1
FROM Dbamv.Procedimento_Sus Ps
WHERE Ps.cd_grupo_procedimento = '03' And Ps.cd_sub_grupo_procedimento = 10 And Ps.Cd_procedimento = Ate.Cd_procedimento) --- PACIENTES SUS --- And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Tp_Convenio = 'H' And Con.Cd_Convenio = Ate.Cd_Convenio) And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00699
---------------------------------------------------------------------------
CURSOR cProcesso_00699(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Pro_Invasivo.Cd_Pro_Invasivo Cd_Departamento , Pro_Invasivo.ds_Pro_Invasivo Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Null Nm_Processo , Pro_Invasivo.ds_Pro_Invasivo||', QTDE DE PACIENTE DIA: '||Sum(Nvl(Movimento.Qtde_Pac_Dia,0))||Chr(10) ||', QTDE UTILIZADA: '||Sum(Nvl(Movimento.Qtde_Pro_Invasivo,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Taxa_Pro_Invasivo,0))||'%'||Chr(10) ||', QTDE DE PACIENTE DIA NO DIA: '||Sum(Nvl(Movimento.Qtde_Pac_Dia_Dia,0))||Chr(10) ||', QTDE UTILIZADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Pro_Invasivo_Dia,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Pro_Invasivo_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Pac_Dia,0)) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Pro_Invasivo,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Pro_Invasivo_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Pro_Invasivo , Mov.Data_Mes , Mov.Qtde_Pac_Dia , Mov.Qtde_Pro_Invasivo , Mov.Qtde_Pac_Dia_Dia , Mov.Qtde_Pro_Invasivo_Dia , Mov.Vl_Taxa_Pro_Invasivo , Mov.Vl_Taxa_Pro_Invasivo_Dia
FROM ( SELECT Dia.Cd_Multi_Empresa , Dia.Cd_Pro_Invasivo , Dia.Data_Mes , Sum(Dia.Qtde_Pac_Dia) Qtde_Pac_Dia , Sum(Dia.Qtde_Pro_Invasivo) Qtde_Pro_Invasivo , Sum(Dia.Qtde_Pac_Dia_Dia) Qtde_Pac_Dia_Dia , Sum(Dia.Qtde_Pro_Invasivo_Dia) Qtde_Pro_Invasivo_Dia , (Case
WHEN Sum(Dia.Qtde_Pac_Dia) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pro_Invasivo)/Sum(Dia.Qtde_Pac_Dia))*100,2)
END ) Vl_Taxa_Pro_Invasivo , (Case
WHEN Sum(Dia.Qtde_Pac_Dia_Dia) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Pro_Invasivo_Dia)/Sum(Dia.Qtde_Pac_Dia_Dia))*100,2)
END ) Vl_Taxa_Pro_Invasivo_Dia
FROM ( SELECT pCdMultiEmpresa Cd_Multi_Empresa , Pro.Cd_Pro_Invasivo , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ),0) Qtde_Pac_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Inv Mov
WHERE Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa And Ate.Cd_Atendimento = Mov.Cd_Atendimento) And Mov.dt_inicio Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Mov.Cd_Pro_Invasivo = Pro.Cd_Pro_Invasivo ),0) Qtde_Pro_Invasivo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ),0) Qtde_Pac_Dia_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Inv Mov
WHERE Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Tp_Atendimento = 'I' And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa And Ate.Cd_Atendimento = Mov.Cd_Atendimento) And Mov.dt_inicio Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Mov.Cd_Pro_Invasivo = Pro.Cd_Pro_Invasivo ),0) Qtde_Pro_Invasivo_Dia
FROM Dbamv.Pro_Invasivo Pro
WHERE Pro.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Mov_Inv Mov
WHERE Mov.Cd_Pro_Invasivo = Pro.Cd_Pro_Invasivo And Exists ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Tp_Atendimento = 'I' And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa And Ate.Cd_Atendimento = Mov.Cd_Atendimento) And Mov.dt_inicio Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ) Dia
GROUP BY Dia.Cd_Multi_Empresa , Dia.Cd_Pro_Invasivo , Dia.Data_Mes ) Mov ) Movimento , Dbamv.Pro_Invasivo , MvccAdmin.Estabelecimento
WHERE Pro_Invasivo.Cd_Pro_Invasivo = Movimento.Cd_Pro_Invasivo And Pro_Invasivo.Sn_Ativo = 'S' And Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Pro_Invasivo.Cd_Pro_Invasivo , Pro_Invasivo.Ds_Pro_Invasivo , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00700
---------------------------------------------------------------------------
CURSOR cProcesso_00700(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE RECUSA DE DOAÇÃO-P/MORTE ENCEFÁLICA' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERC. DE RECUSA DE DOAÇÃO-P/MORTE ENCEFÁLICA'||', QTDE DE MORTE DE PCR: '||Nvl(Movimento.Qtde_Morte,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR: '||Nvl(Movimento.Qtde_Recusa,0)||Chr(10) ||', TAXA DE RECUSA DE MORTE DE PCR: '||Nvl(Movimento.Vl_Taxa_Recusa,0) ||', QTDE DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Morte_Dia,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Recusa_Dia,0)||Chr(10) ||', TAXA DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Vl_Taxa_Recusa_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Nvl(Movimento.Qtde_Morte,0) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Recusa,0) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Nvl(Movimento.Vl_Taxa_Recusa_Dia,0) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Morte , Mov.Qtde_Recusa , Mov.Qtde_Morte_Dia , Mov.Qtde_Recusa_Dia , (Case
WHEN Nvl(Mov.Qtde_Morte,0) = 0
THEN 0
ELSE Round((Mov.Qtde_Recusa/Mov.Qtde_Morte)*100,2)
END ) Vl_Taxa_Recusa , (Case
WHEN Nvl(Mov.Qtde_Morte_Dia,0) = 0
THEN 0
ELSE Round((Mov.Qtde_Recusa_Dia/Mov.Qtde_Morte_Dia)*100,2)
END ) Vl_Taxa_Recusa_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Count(1) Qtde_Morte , Sum(Mov.Qtde_Recusa) Qtde_Recusa , Sum(Case
WHEN Mov.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Morte_Dia , Sum(Case
WHEN Mov.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Recusa
ELSE 0
END ) Qtde_Recusa_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Morte , ( SELECT Min(1)
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) Qtde_Recusa
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00701
---------------------------------------------------------------------------
CURSOR cProcesso_00701(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE RECUSA DE DOAÇÃO-P/MORTE DE PCR' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERC. DE RECUSA DE DOAÇÃO-P/MORTE DE PCR'||', QTDE DE MORTE DE PCR: '||Nvl(Movimento.Qtde_Morte,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR: '||Nvl(Movimento.Qtde_Recusa,0)||Chr(10) ||', TAXA DE RECUSA DE MORTE DE PCR: '||Nvl(Movimento.Vl_Taxa_Recusa,0) ||', QTDE DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Morte_Dia,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Recusa_Dia,0)||Chr(10) ||', TAXA DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Vl_Taxa_Recusa_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Nvl(Movimento.Qtde_Morte,0) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Recusa,0) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Nvl(Movimento.Vl_Taxa_Recusa_Dia,0) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Morte , Mov.Qtde_Recusa , Mov.Qtde_Morte_Dia , Mov.Qtde_Recusa_Dia , (Case
WHEN Nvl(Mov.Qtde_Morte,0) = 0
THEN 0
ELSE Round((Mov.Qtde_Recusa/Mov.Qtde_Morte)*100,2)
END ) Vl_Taxa_Recusa , (Case
WHEN Nvl(Mov.Qtde_Morte_Dia,0) = 0
THEN 0
ELSE Round((Mov.Qtde_Recusa_Dia/Mov.Qtde_Morte_Dia)*100,2)
END ) Vl_Taxa_Recusa_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Count(1) Qtde_Morte , Sum(Mov.Qtde_Recusa) Qtde_Recusa , Sum(Case
WHEN Mov.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Morte_Dia , Sum(Case
WHEN Mov.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Recusa
ELSE 0
END ) Qtde_Recusa_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Morte , ( SELECT Min(1)
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) Qtde_Recusa
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00703
---------------------------------------------------------------------------
CURSOR cProcesso_00703(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE REINCIDÊNCIA DE INTERNAÇÃO <=30D' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TAXA DE REINCIDÊNCIA DE INTERNAÇÃO, QTDE DE INTERNAÇÃO: '||Nvl(Movimento.Qtde_Internacao,0)||Chr(10) ||', QTDE DE REINTERNAÇÃO: '||Nvl(Movimento.Qtde_ReInternacao,0)||Chr(10) ||', TAXA DE REINTERNAÇÃO: '||Nvl(Movimento.Vl_Taxa_ReInternacao,0)||'%'||Chr(10) ||', QTDE DE INTERNAÇÃO NO DIA: '||Nvl(Movimento.Qtde_Internacao_Dia,0)||Chr(10) ||', QTDE DE REINTERNAÇÃO NO DIA: '||Nvl(Movimento.Qtde_ReInternacao_Dia,0)||Chr(10) ||', TAXA DE REINTERNAÇÃO NO DIA: '||Nvl(Movimento.Vl_Taxa_ReInternacao_Dia,0)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Reinternacao,0) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Nvl(Movimento.Qtde_Reinternacao_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Internacao , Mov.Qtde_Internacao_Dia , Mov.Qtde_ReInternacao , Mov.Qtde_ReInternacao_Dia , Mov.Vl_Taxa_Reinternacao , Mov.Vl_Taxa_Reinternacao_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Internacao) Qtde_Internacao , Sum(Mov.Qtde_Internacao_Dia) Qtde_Internacao_Dia , Sum(Mov.Qtde_ReInternacao) Qtde_ReInternacao , Sum(Mov.Qtde_ReInternacao_Dia) Qtde_ReInternacao_Dia , (Case
WHEN Sum(Mov.Qtde_Internacao) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_ReInternacao)/Sum(Mov.Qtde_Internacao))*100,2)
END ) Vl_Taxa_Reinternacao , (Case
WHEN Sum(Mov.Qtde_Internacao_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_ReInternacao_Dia)/Sum(Mov.Qtde_Internacao_Dia))*100,2)
END ) Vl_Taxa_Reinternacao_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Qtde_Internacao , Mov.Qtde_Internacao_Dia , Mov.Qtde_ReInternacao , Mov.Qtde_ReInternacao_Dia
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) ) Qtde_Internacao , ( SELECT Sum(Case
WHEN Ate_Reint.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) ) Qtde_Internacao_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta , Dbamv.Leito Lei
WHERE Lei.Cd_leito = Ate_Alta.Cd_leito And Ate_Alta.Dt_Alta IS Not Null And Ate_Alta.Cd_Atendimento_Pai IS Null And Ate_Alta.Tp_Atendimento = 'I' And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And (Ate_Reint.Dh_Atendimento-To_Date(To_Char(Ate_Alta.Dt_Alta,'DD/MM/YYYY')||' '||To_Char(Ate_Alta.Hr_Alta,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')) <= 30 --30 DIAS And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) ) And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) ) Qtde_ReInternacao , ( SELECT Sum(Case
WHEN Ate_Reint.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint
WHERE Ate_Reint.Cd_Movimentacao = 4 And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta , Dbamv.Leito Lei
WHERE Lei.Cd_leito = Ate_Alta.Cd_leito And Ate_Alta.Dt_Alta IS Not Null And Ate_Alta.Tp_Atendimento = 'I' And Ate_Alta.Cd_Atendimento_Pai IS Null And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And (Ate_Reint.Dh_Atendimento-To_Date(To_Char(Ate_Alta.Dt_Alta,'DD/MM/YYYY')||' '||To_Char(Ate_Alta.Hr_Alta,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')) <= 30 --30 DIAS And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa )) And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Reint.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Ate_Reint.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Qtde_ReInternacao_Dia
FROM Dual ) Mov ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00704
---------------------------------------------------------------------------
CURSOR cProcesso_00704(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERCENTUAL DE CONSULTAS OFERTADAS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERCENTUAL DE CONSULTAS OFERTADAS, QTDE CONTRATADA: '||Sum(Nvl(Movimento.Qtde_Contratada,0))||Chr(10) ||', QTDE OFERTADA: '||Sum(Nvl(Movimento.Qtde_Ofertada,0))||Chr(10) ||', TAXA OFERTADA: '||Sum(Nvl(Movimento.Taxa_Consulta_Ofertada,0))||'%'||Chr(10) ||', QTDE CONTRATADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Contratada,0))||Chr(10) ||', QTDE OFERTADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Ofertada,0))||Chr(10) ||', TAXA OFERTADA NO DIA: '||Sum(Nvl(Movimento.Taxa_Consulta_Ofertada,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'IT_AGENDA_CENTRAL' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Ofertada,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Ofertada_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--ITENS E AGENDAS ABERTAS-- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Contratada , Mov.Qtde_Contratada_Dia , Mov.Qtde_Ofertada , Mov.Qtde_Ofertada_Dia , (Case
WHEN Mov.Qtde_Contratada = 0
THEN 0
ELSE Round((Mov.Qtde_Ofertada/Mov.Qtde_Contratada)*100,2)
END ) Taxa_Consulta_Ofertada , (Case
WHEN Mov.Qtde_Contratada_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Ofertada_Dia/Mov.Qtde_Contratada_Dia)*100,2)
END ) Taxa_Consulta_Ofertada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Multi_Empresa,pNrCnpj,'SLA'),0) Qtde_Contratada , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Multi_Empresa,pNrCnpj,'SLA')/30,0) Qtde_Contratada_Dia , Mov.Qtde_Ofertada , Mov.Qtde_Ofertada_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM Dbamv.Agenda_Central Agc , Dbamv.It_Agenda_Central Ita
WHERE Agc.Cd_Agenda_Central = Ita.Cd_Agenda_Central And Agc.Dt_liberacao IS Not Null --Agenda Liberada And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ita.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Agc.cd_setor Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)--CONSULTAS And Ita.tp_situacao <> 'C' --CANCELADO And Agc.Dt_Agenda Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Agc.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Ofertada , Nvl(( SELECT Count(1)
FROM Dbamv.Agenda_Central Agc , Dbamv.It_Agenda_Central Ita
WHERE Agc.Cd_Agenda_Central = Ita.Cd_Agenda_Central And Agc.Dt_liberacao IS Not Null --Agenda Liberada And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ita.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Agc.cd_setor Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)--CONSULTAS And Ita.tp_situacao <> 'C' --CANCELADO And Agc.Dt_Agenda Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Agc.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Ofertada_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00705
---------------------------------------------------------------------------
CURSOR cProcesso_00705(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE EXAMES (SADTS) REALIZADOS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC. DE EXAMES (SADTS) REALIZADOS, QTDE DE CONTRATADA: '||Sum(Nvl(Movimento.Qtde_Contratada,0))||Chr(10) ||', QTDE DE REALIZADA: '||Sum(Nvl(Movimento.Qtde_Realizada,0))||Chr(10) ||', TAXA DE REALIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Taxa_Realizacao,0))||'%'||Chr(10) ||', QTDE DE CONTRATADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Contratada,0))||Chr(10) ||', QTDE DE REALIZADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Realizada,0))||Chr(10) ||', TAXA DE REALIZAÇÃO NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Realizacao,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPED_RX' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Realizada,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Realizada_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--EXAMES REALIZADOS-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Contratada , Mov.Qtde_Realizada , Mov.Qtde_Contratada_Dia , Mov.Qtde_Realizada_Dia , (Case
WHEN Nvl(Mov.Qtde_Realizada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Contratada,0)/Nvl(Mov.Qtde_Realizada,0))*100,2)
END ) Vl_Taxa_Realizacao , (Case
WHEN Nvl(Mov.Qtde_Realizada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Contratada_Dia,0)/Nvl(Mov.Qtde_Realizada_Dia,0))*100,2)
END ) Vl_Taxa_Realizacao_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Multi_Empresa,pNrCnpj,'SLA'),0) Qtde_Contratada , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Multi_Empresa,pNrCnpj,'SLA'),0)/30 Qtde_Contratada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , ( SELECT Count(1)
FROM Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Ped.Cd_Ped_Rx = Itp.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' --REALIZADO And Itp.dt_realizado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa, Dbamv.Setor Str
WHERE Exa.Cd_Setor = Str.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Qtde_Realizada , ( SELECT Count(1)
FROM Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Ped.Cd_Ped_Rx = Itp.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' --REALIZADO And Itp.dt_realizado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa, Dbamv.Setor Str
WHERE Exa.Cd_Setor = Str.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Qtde_Realizada_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00710
---------------------------------------------------------------------------
CURSOR cProcesso_00710(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Estoque.Cd_Estoque Cd_Departamento , Estoque.Ds_Estoque Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Estoque.Ds_Estoque||', QTDE DE ITENS CONTADOS: '||Nvl(Movimento.Qtde_Total,0)||Chr(10) ||', QTDE DE ITENS DIVERGENTES: '||Nvl(Movimento.Qtde_Divergente,0)||Chr(10) ||', TAXA DE DIVERGENCIA DO ESTOQUE: '||Nvl(Movimento.Vl_Taxa_Divergencia,0)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'CONTAGEM' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Divergencia,0) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Nvl(Movimento.Vl_Taxa_Divergencia,0) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Estoque , To_Char(Mov.Dt_Geracao,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Item_Total) Qtde_Total , Sum(Mov.Qtde_Item_Divergente) Qtde_Divergente , (Case
WHEN Sum(Mov.Qtde_Item_Total) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Item_Divergente)/Sum(Mov.Qtde_Item_Total))*100,2)
END ) Vl_Taxa_Divergencia
FROM ( SELECT MOv.Cd_Estoque , Mov.Dt_Geracao , Mov.Qt_Estoque , 1 Qtde_Item_Total , (Case
WHEN Mov.Qt_Estoque <> Mov.Qt_Estoque_Antes
THEN 1
ELSE 0
END ) Qtde_Item_Divergente
FROM ( SELECT Ctg.Cd_Estoque , Ctg.Dt_Geracao , ItC.Qt_Estoque , Nvl(( SELECT Cop.Qt_Estoque
FROM MvccAdmin.Fato_Copia_Estoque Cop
WHERE Ctg.cd_estoque = Cop.cd_estoque And Ctg.cd_contagem = Cop.cd_contagem And ItC.cd_produto = Cop.cd_produto And (Case
WHEN Cop.Cd_Lote IS Null
THEN '-Xz'
ELSE Cop.Cd_Lote
END ) = (Case
WHEN Itc.Cd_Lote IS Null
THEN '-Xz'
ELSE Itc.Cd_Lote
END ) And (Case
WHEN cop.dt_validade IS Null
THEN Sysdate
ELSE cop.dt_validade
END ) = (Case
WHEN itc.dt_validade IS Null
THEN Sysdate
ELSE itc.dt_validade
END ) And Cop.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Cop.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qt_Estoque_Antes
FROM Dbamv.Contagem Ctg , Dbamv.ItContagem ItC , Dbamv.Estoque Est
WHERE Ctg.Cd_Contagem = ItC.Cd_Contagem And Est.Cd_Estoque = Ctg.Cd_EStoque And Ctg.Dt_Geracao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Est.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Estoque , To_Char(Mov.Dt_Geracao,'MM/YYYY') ) Movimento , Dbamv.Estoque , MvccAdmin.Estabelecimento
WHERE Estoque.Cd_Estoque = Movimento.Cd_Estoque And Estoque.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa AND Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00713
---------------------------------------------------------------------------
CURSOR cProcesso_00713(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Convenio Con
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Ori_Ate.Cd_Ori_Ate , Ori_Ate.Ds_Ori_Ate , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00714
---------------------------------------------------------------------------
CURSOR cProcesso_00714(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate --VERIFICAR A TABELA DOMICILIAR , Dbamv.Convenio Con
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Ori_Ate.Cd_Ori_Ate , Ori_Ate.Ds_Ori_Ate , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00715
---------------------------------------------------------------------------
CURSOR cProcesso_00715(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Convenio.Cd_Tipo_Convenio Cd_Departamento , Tipo_Convenio.Ds_Tipo_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Convenio.Ds_Tipo_Convenio||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Tipo_Convenio , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Case
WHEN Nvl(Mov.Qtde_Realizada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'H'
THEN 2
WHEN Con.Tp_Convenio = 'A'
THEN 3
WHEN Con.Tp_Convenio = 'P'
THEN 4
END ) Cd_Tipo_Convenio , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Age_Cir Agi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Avi.Cd_Aviso_Cirurgia = Agi.Cd_Aviso_Cirurgia And Cir.sn_principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias = 'E' --(E)letiva, E(M)erg¿ncia, (U)rg¿ncia. --- IDADE LIMITE DO EVENTO --- And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 > Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Avi.Cd_Paciente) And Not Exists ( SELECT 1
FROM Dbamv.Cirurgia_Aviso Cia, Dbamv.Cirurgia Cir
WHERE Cia.Cd_Cirurgia = Cir.Cd_Cirurgia And Cia.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And (Cir.Cd_Procedimento_Sia IN ('404030106','404030262') or Cir.Cd_Procedimento_Sih IN ('404030106','404030262'))) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tipo_Convenio, 'CONVENIO' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 2 Cd_Tipo_Convenio, 'SUS-AIH' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 3 Cd_Tipo_Convenio, 'SUS-SIA' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 4 Cd_Tipo_Convenio, 'PARTICULAR' Ds_Tipo_Convenio
FROM Dual ) Tipo_Convenio , MvccAdmin.Estabelecimento
WHERE Tipo_Convenio.Cd_Tipo_Convenio = Movimento.Cd_Tipo_Convenio(+) And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Tipo_Convenio.Cd_Tipo_Convenio , Tipo_Convenio.Ds_Tipo_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00716
---------------------------------------------------------------------------
CURSOR cProcesso_00716(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Convenio.Cd_Tipo_Convenio Cd_Departamento , Tipo_Convenio.Ds_Tipo_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Convenio.Ds_Tipo_Convenio||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Tipo_Convenio , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'H'
THEN 2
WHEN Con.Tp_Convenio = 'A'
THEN 3
WHEN Con.Tp_Convenio = 'P'
THEN 4
END ) Cd_Tipo_Convenio , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Age_Cir Agi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Avi.Cd_Aviso_Cirurgia = Agi.Cd_Aviso_Cirurgia And Cir.sn_principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias IN ('M','U') --(E)letiva, E(M)erg¿ncia, (U)rg¿ncia. --- IDADE MINIMA A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 74 --IDADE MINIMA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) -- CIRUGIAS A SER DESCONSIDERADAS -- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 89 --CIRURGIA A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tipo_Convenio, 'CONVENIO' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 2 Cd_Tipo_Convenio, 'SIH SUS' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 3 Cd_Tipo_Convenio, 'SIA SUS' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 4 Cd_Tipo_Convenio, 'PARTICULAR' Ds_Tipo_Convenio
FROM Dual ) Tipo_Convenio , MvccAdmin.Estabelecimento
WHERE Tipo_Convenio.Cd_Tipo_Convenio = Movimento.Cd_Tipo_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Tipo_Convenio.Cd_Tipo_Convenio , Tipo_Convenio.Ds_Tipo_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00717
---------------------------------------------------------------------------
CURSOR cProcesso_00717(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE CIRURGIA CERFIS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'NUMERO DE CIRURGIA CERFIS'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Con.Tp_Convenio = 'A' --SIA And Avi.tp_cirurgias IN ('M','U','E') --(E)letiva, E(M)erg?ncia, (U)rg?ncia. And Exists ( SELECT 1
FROM Dbamv.Cirurgia_Aviso Cia, Dbamv.Cirurgia Cir
WHERE Cia.Cd_Cirurgia = Cir.Cd_Cirurgia And Cia.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And (Cir.Cd_Procedimento_Sia IN ('404030106','404030262') or Cir.Cd_Procedimento_Sih IN ('404030106','404030262'))) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00718
---------------------------------------------------------------------------
CURSOR cProcesso_00718(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE CIRURGIA PEDIATRICA SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE CIRURGIA PEDIATRICA SUS'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NOD IA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Avi.Dt_Realizacao,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Con.Tp_Convenio In ('A','H') --CIRURGIAS SUS And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias IN ('M','U','E') --(E)letiva, E(M)erg¿ncia, (U)rg¿ncia. And (Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 < Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Avi.Cd_Paciente) Or Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 66 --ESPECIALIDADE MÉDICA And Vcc.Cd_Campo_Chave = To_Char(Cir.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00719
---------------------------------------------------------------------------
CURSOR cProcesso_00719(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Convenio.Cd_Tipo_Convenio Cd_Departamento , Tipo_Convenio.Ds_Tipo_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Convenio.Ds_Tipo_Convenio||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Tipo_Convenio , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Con.Tp_Convenio = 'C'
THEN 1
WHEN Con.Tp_Convenio = 'H'
THEN 2
WHEN Con.Tp_Convenio = 'A'
THEN 3
WHEN Con.Tp_Convenio = 'P'
THEN 4
END ) Cd_Tipo_Convenio , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 16 --CIRURGIA A SER CONSIDERADA And Vcc.cd_campo_chave = Cir.Cd_Cirurgia And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Convenio , Avi.Data_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tipo_Convenio, 'CONVENIO' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 2 Cd_Tipo_Convenio, 'SUS-AIH' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 3 Cd_Tipo_Convenio, 'SUS-SIA' Ds_Tipo_Convenio
FROM Dual
UNION ALL SELECT 4 Cd_Tipo_Convenio, 'PARTICULAR' Ds_Tipo_Convenio
FROM Dual ) Tipo_Convenio , MvccAdmin.Estabelecimento
WHERE Tipo_Convenio.Cd_Tipo_Convenio = Movimento.Cd_Tipo_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Tipo_Convenio.Cd_Tipo_Convenio , Tipo_Convenio.Ds_Tipo_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00720
---------------------------------------------------------------------------
CURSOR cProcesso_00720(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS AMBULATORIAIS GLOBAIS' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS AMBULATORIAIS GLOBAIS'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 138 --ITEM DE AGENDAMENTO A DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00721
---------------------------------------------------------------------------
CURSOR cProcesso_00721(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_departamento , Convenio.Nm_Convenio Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Convenio , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00722
---------------------------------------------------------------------------
CURSOR cProcesso_00722(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null tp_diagnostico , Null Nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_departamento , Ori_Ate.Ds_Ori_Ate Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , NUll nm_processo , Ori_Ate.Ds_Ori_Ate||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Ori_Ate , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Ori_Ate , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , Ate.Cd_Ori_Ate , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag , Dbamv.Convenio Con
WHERE Ate.Tp_Atendimento = 'A' And Ate.Cd_Convenio = Con.Cd_Convenio And Con.Tp_Convenio = 'A' And Iag.Cd_Atendimento = Ate.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Ori_Ate ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate(+) And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Ori_Ate.Cd_Ori_Ate , Ori_Ate.Ds_Ori_Ate , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00723
---------------------------------------------------------------------------
CURSOR cProcesso_00723(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Tp_Situacao = 'R' And Avi.Cd_Multi_Empresa = pCdMultiEmpresa) --CIRURGIA And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00724
---------------------------------------------------------------------------
CURSOR cProcesso_00724(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---SAIDAS CIRURGICAS CERFIS--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- CIRURGIA REALIZADA CERFIS --- And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cia, Dbamv.Cirurgia Cir
WHERE Cia.Cd_Cirurgia = Cir.Cd_Cirurgia And Avi.Cd_Aviso_Cirurgia = Cia.Cd_Aviso_Cirurgia And Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Tp_Situacao = 'R' And (Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Cir.Cd_Procedimento_Sia And Vcc.Cd_Tipo_Campo_Chave = 137 --CIRURGIAS/PROCEDIMENTOS CERFIS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) OR Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Cir.Cd_Procedimento_Sih And Vcc.Cd_Tipo_Campo_Chave = 137 --CIRURGIAS/PROCEDIMENTOS CERFIS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa))) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00725
---------------------------------------------------------------------------
CURSOR cProcesso_00725(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PACIENTE DIA REALIZADA: '||Sum(Nvl(Movimento.Qtde_Realizada,0))||Chr(10) ||', QTDE PACIENTE DIA PROJETADA: '||Sum(Nvl(Movimento.Qtde_Projetada,0))||Chr(10) ||', QTDE PACIENTE DIA REALIZADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Realizada_Dia,0))||Chr(10) ||', QTDE PACIENTE DIA PROJETADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Projetada_Dia,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Realizada,0)) Qtde_Conforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Realizada_Dia,0)) Qtde_Conforme_Dia , Sum(Nvl(Movimento.Qtde_Instalada_dia,0)) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Nvl(Sum(Mov.Qtde_Realizada),0) Qtde_Realizada , Nvl(Sum(Mov.Qtde_Realizada_Dia),0) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada_Dia),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Sum(Case
WHEN Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 2 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 3 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN -1
WHEN Ate.Cd_Movimentacao = 4 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN -1
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Sum(Case
WHEN Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 2 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 3 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN -1
WHEN Ate.Cd_Movimentacao = 4 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN -1
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00726
---------------------------------------------------------------------------
CURSOR cProcesso_00726(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PACIENTE DIA REALIZADA: '||Sum(Nvl(Movimento.Qtde_Realizada,0))||Chr(10) ||', QTDE PACIENTE DIA PROJETADA: '||Sum(Nvl(Movimento.Qtde_Projetada,0))||Chr(10) ||', QTDE PACIENTE DIA REALIZADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Realizada_Dia,0))||Chr(10) ||', QTDE PACIENTE DIA PROJETADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Projetada_Dia,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Realizada,0)) Qtde_Conforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Realizada_Dia,0)) Qtde_Conforme_Dia , Sum(Nvl(Movimento.Qtde_Instalada_dia,0)) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Nvl(Sum(Mov.Qtde_Realizada),0) Qtde_Realizada , Nvl(Sum(Mov.Qtde_Realizada_Dia),0) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada_Dia),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Sum(Case
WHEN Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 2 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 3 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN -1
WHEN Ate.Cd_Movimentacao = 4 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN -1
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Sum(Case
WHEN Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 2 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 3 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN -1
WHEN Ate.Cd_Movimentacao = 4 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN -1
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00727
---------------------------------------------------------------------------
CURSOR cProcesso_00727(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Projetada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sai.Cd_Convenio , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = Lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Vcc.Cd_Campo_Chave = Ate.Cd_Tipo_Internacao OR Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom) And (Vcc.Cd_Tipo_Campo_Chave = 65 Or Vcc.Cd_Campo_Chave = To_Char(Lei.Cd_Tip_Acom)) --TIPO DE INTERNACAO OU TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Cd_Convenio , Sai.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00728
---------------------------------------------------------------------------
CURSOR cProcesso_00728(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Unid_Int , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 --- DOCUMENTO ELETRÔNICO INDICANDO O CUIDADO PALIATIVO--- And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.Cd_Atendimento = Ate.Cd_Atendimento And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Ate.Cd_Unid_Int , To_Char(Ate.Dt_Internado,'MM/YYYY') ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00729
---------------------------------------------------------------------------
CURSOR cProcesso_00729(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA HEMATOLOGIA SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE PACIENTE-DIA HEMATOLOGIA SUS'||', QTDE PROJETADA: '||Sum(Nvl(Movimento.Qtde_Projetada,0))||Chr(10) ||', QTDE PRODUZIDA: '||Sum(Nvl(Movimento.Qtde_Utilizada,0))||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Utilizada,0)) Qtde_Conforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0)) Qtde_Conforme_Dia , Sum(Nvl(Movimento.Qtde_Instalada_Dia,0)) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO--- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Tip.Cd_Tipo_Internacao,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Tip.Cd_Tipo_Internacao,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str, Dbamv.Tipo_Internacao Tip
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' And Str.Cd_multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Tip.Cd_Tipo_Internacao And Vcc.Cd_Tipo_Campo_Chave = 65 --TIPO DE INTERNACAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY Und.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00730
---------------------------------------------------------------------------
CURSOR cProcesso_00730(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_departamento , Especialid.Ds_Especialid Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Especialid , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00731
---------------------------------------------------------------------------
CURSOR cProcesso_00731(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_departamento , Convenio.Nm_Convenio Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Convenio , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00734
---------------------------------------------------------------------------
CURSOR cProcesso_00734(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE CESARIANA EM PRIMIPARAS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'TAXA DE CESARIANA PRIMIPARAS, QTDE DE PARTOS CESARIOS: '||Sum(Nvl(Movimento.Qtde_Cesarianas,0))||Chr(10) ||', QTDE DE PRIMIPARAS: '||Sum(Nvl(Movimento.Qtde_Primiparas,0))||Chr(10) ||', PERC. DE PRIMIPARAS: '||Avg(Nvl(Movimento.Vl_Taxa_Primiparas,0))||'%'||Chr(10) ||', QTDE DE PARTOS CESARIOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Cesarianas,0))||Chr(10) ||', QTDE DE PRIMIPARAS NO DIA: '||Sum(Nvl(Movimento.Qtde_Primiparas,0))||Chr(10) ||', PERC. DE PRIMIPARAS NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Primiparas,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NUll Qtde_NaoConforme , NUll Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Primiparas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Primiparas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Cesarianas , Mov.Qtde_Primiparas , Mov.Qtde_Cesarianas_Dia , Mov.Qtde_Primiparas_Dia , (Case
WHEN Nvl(Mov.Qtde_Cesarianas,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas,0)/Nvl(Mov.Qtde_Cesarianas,0))*100,2)
END ) Vl_Taxa_Primiparas , (Case
WHEN Nvl(Mov.Qtde_Cesarianas_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas_Dia,0)/Nvl(Mov.Qtde_Cesarianas_Dia,0))*100,2)
END ) Vl_Taxa_Primiparas_Dia
FROM ( SELECT Sum(Mov.Qtde_Cesarianas) Qtde_Cesarianas , Sum(Mov.Qtde_Primiparas) Qtde_Primiparas , Sum(Mov.Qtde_Cesarianas_Dia) Qtde_Cesarianas_Dia , Sum(Mov.Qtde_Primiparas_Dia) Qtde_Primiparas_Dia , (Case
WHEN Sum(Mov.Qtde_Cesarianas) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Primiparas)/Sum(Mov.Qtde_Cesarianas))*100,2)
END ) Vl_Taxa_Primiparas , (Case
WHEN Sum(Mov.Qtde_Cesarianas_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Primiparas_Dia)/Sum(Mov.Qtde_Cesarianas_Dia))*100,2)
END ) Vl_Taxa_Primiparas_Dia
FROM ( SELECT ( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cav, Dbamv.Cirurgia Cir
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And (Cir.Cd_procedimento_sih In (/*CESARIOS SUS:*/'0411010042','0411010034','0411010026') Or Cir.Cd_Pro_Fat In (/*CESARIOS CONV:*/'31309054','31309208')) --- TOTAL DE CESARIANAS EM PRIMIPARAS --- And Exists ( SELECT 1
FROM Dbamv.Admissao_Co Adm
WHERE Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Cesarianas , ( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cav, Dbamv.Cirurgia Cir
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And (Cir.Cd_procedimento_sih In (/*CESARIOS SUS:*/'0411010042','0411010034','0411010026') Or Cir.Cd_Pro_Fat In (/*CESARIOS CONV:*/'31309054','31309208')) --- TOTAL DE CESARIANAS EM PRIMIPARAS --- And Exists ( SELECT 1
FROM Dbamv.Admissao_Co Adm
WHERE Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0) And Avi.Dt_Realizacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Cesarianas_Dia , ( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' --- TOTAL DE MULHERES PRIMIPARAS --- And Exists ( SELECT 1
FROM Dbamv.Admissao_Co Adm
WHERE Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Primiparas , ( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' --- TOTAL DE MULHERES PRIMIPARAS --- And Exists ( SELECT 1
FROM Dbamv.Admissao_Co Adm
WHERE Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0) And Avi.Dt_Realizacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Primiparas_Dia
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00735
---------------------------------------------------------------------------
CURSOR cProcesso_00735(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , NUll Nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'CLASSIFICACAO DE ROBSON' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , NUll nm_processo , 'PERCENTUAL CLASSIFICA?AO DE ROBSON, QTDE CESARIANA: '||Sum(Nvl(Movimento.Qtde_Cesariana,0))||Chr(10) ||', QTDE CLASSIFICADA: '||Sum(Nvl(Movimento.Qtde_Classificada,0))||Chr(10) ||', PERC. DE CLASSIFICACAO: '||Avg(Nvl(Movimento.Vl_Taxa_Classificacao,0))||'%'||Chr(10) ||', QTDE CESARIANA NO DIA: '||Sum(Nvl(Movimento.Qtde_Cesariana,0))||Chr(10) ||', QTDE CLASSIFICADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Classificada,0))||Chr(10) ||', PERC. DE CLASSIFICACAO NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Classificacao_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Classificada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Classificada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO CIRURGICO--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Cesariana , Mov.Qtde_Classificada , Mov.Qtde_Cesariana_Dia , Mov.Qtde_Classificada_Dia , (Case
WHEN Nvl(Mov.Qtde_Cesariana,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Classificada,0)/Nvl(Mov.Qtde_Cesariana,0))*100,2)
END ) Vl_Taxa_Classificacao , (Case
WHEN Nvl(Mov.Qtde_Cesariana_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Classificada_Dia,0)/Nvl(Mov.Qtde_Cesariana_Dia,0))*100,2)
END ) Vl_Taxa_Classificacao_Dia
FROM ( SELECT Sum(Mov.Qtde_Cesariana) Qtde_Cesariana , Sum(Mov.Qtde_Classificada) Qtde_Classificada , Sum(Mov.Qtde_Cesariana_Dia) Qtde_Cesariana_Dia , Sum(Mov.Qtde_Classificada_Dia) Qtde_Classificada_Dia
FROM ( SELECT Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav , Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026') Or Cir.Cd_Pro_Fat In ('31309054','31309208')) --CESARIOS-- And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Cesariana , Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav , Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026') Or Cir.Cd_Pro_Fat In ('31309054','31309208')) --CESARIOS-- And Avi.Dt_Realizacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Cesariana_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav , Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026') Or Cir.Cd_Pro_Fat In ('31309054','31309208')) --CESARIOS-- And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Pdc.Cd_Atendimento = Avi.Cd_Atendimento) ),0) Qtde_Classificada , Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav , Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026') Or Cir.Cd_Pro_Fat In ('31309054','31309208')) --CESARIOS-- And Avi.Dt_Realizacao Between Trunc(sysdate) And Trunc(sysdate)+.99999 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between Trunc(sysdate) And Trunc(sysdate)+.99999 And Pdc.Cd_Atendimento = Avi.Cd_Atendimento) ),0) Qtde_Classificada_Dia
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00736
---------------------------------------------------------------------------
CURSOR cProcesso_00736(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , NUll Tp_Diagnostico , NUll Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE APGAR NOS 1º E 5º MINUTOS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'TAXA DE APGAR NOS 1º E 5º MINUTOS, QTDE DE PARTOS: '||Sum(Nvl(Movimento.Qtde_Partos,0))||Chr(10) ||', QTDE DE APGAR: '||Sum(Nvl(Movimento.Qtde_Apgar,0))||Chr(10) ||', TAXA DE APGAR: '||Avg(Nvl(Movimento.Vl_Taxa_Apgar,0))||'%'||Chr(10) ||', QTDE DE PARTOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Partos,0))||Chr(10) ||', QTDE DE APGAR NO DIA: '||Sum(Nvl(Movimento.Qtde_Apgar,0))||Chr(10) ||', TAXA DE APGAR NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Apgar,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NUll Qtde_NaoConforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Apgar) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Apgar_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Apgar , Mov.Qtde_Partos_Dia , Mov.Qtde_Apgar_Dia , (Case
WHEN Nvl(Mov.Qtde_Partos,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Apgar,0)/nvl(Mov.Qtde_Partos,0)*100,2)
END ) Vl_Taxa_Apgar , (Case
WHEN Nvl(Mov.Qtde_Partos_Dia,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Apgar_Dia,0)/nvl(Mov.Qtde_Partos_Dia,0)*100,2)
END ) Vl_Taxa_Apgar_Dia
FROM ( SELECT Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cav, Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026' --CESARIOS ,'0310010047','0310010039','0411010000','0310010055') --PARTOS Or Cir.Cd_Pro_Fat In ('31309127','31309135' --PARTOS ,'31309054','31309208')) --CESARIOS-- And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Partos , Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cav, Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026' --CESARIOS ,'0310010047','0310010039','0411010000','0310010055') --PARTOS Or Cir.Cd_Pro_Fat In ('31309127','31309135' --PARTOS ,'31309054','31309208')) --CESARIOS-- And Avi.Dt_Realizacao Between Trunc(sysdate) And Trunc(Sysdate)+.99999 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Partos_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cav, Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026' --CESARIOS ,'0310010047','0310010039','0411010000','0310010055') --PARTOS Or Cir.Cd_Pro_Fat In ('31309127','31309135' --PARTOS ,'31309054','31309208')) --CESARIOS-- --- PACIENTES COM REGISTRO DE APGAR--- And Exists ( SELECT 1
FROM Dbamv.Recem_Nascido Ren
WHERE Ren.Cd_Atendimento = Avi.Cd_Atendimento And Ren.Vl_Apgar_5Minuto IS Not Null) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Apgar , Nvl(( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cav, Dbamv.Cirurgia Cir
WHERE Cav.Cd_Cirurgia = Cir.Cd_Cirurgia And Cav.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Tp_Situacao = 'R' And (Cir.Cd_procedimento_sih In ('0411010042','0411010034','0411010026' --CESARIOS ,'0310010047','0310010039','0411010000','0310010055') --PARTOS Or Cir.Cd_Pro_Fat In ('31309127','31309135' --PARTOS ,'31309054','31309208')) --CESARIOS-- --- PACIENTES COM REGISTRO DE APGAR--- And Exists ( SELECT 1
FROM Dbamv.Recem_Nascido Ren
WHERE Ren.Cd_Atendimento = Avi.Cd_Atendimento And Ren.Vl_Apgar_5Minuto IS Not Null) And Avi.Dt_Realizacao Between Trunc(sysdate) And Trunc(Sysdate)+.99999 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Apgar_Dia
FROM Dual ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00737
---------------------------------------------------------------------------
CURSOR cProcesso_00737(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , NUll Tp_Diagnostico , NUll Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE DOADOR ESPONTANEO' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'TAXA DE DOADOR ESPONTANEO, QTDE DE DOADORES: '||Sum(Movimento.Qtde_Doadores) ||', QTDE DE ESPONTANEO: '||Sum(Nvl(Movimento.Qtde_Espontaneo,0)) ||', TAXA DE DOADOR ESPONTANEO: '||Sum(Movimento.Vl_Taxa_Espontaneo) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Doadores,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Doadores,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Doadores , Mov.Qtde_Espontaneo , Mov.Vl_Taxa_Espontaneo
FROM ( SELECT Lau.Cd_Multi_Empresa , Lau.Data_Mes , Sum(Lau.Qtde_Doadores) Qtde_Doadores , Sum(Lau.Qtde_Espontaneo) Qtde_Espontaneo , (Case
WHEN Sum(Lau.Qtde_Doadores) = 0
THEN 0
ELSE Round((Sum(Lau.Qtde_Espontaneo)/Sum(Lau.Qtde_Doadores))*100,2)
END ) Vl_Taxa_Espontaneo
FROM ( SELECT Emp.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.dh_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = Emp.Cd_Multi_Empresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0) And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) Qtde_Doadores , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.dh_atendimento Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = Emp.Cd_Multi_Empresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0 And (InStr(Ori.Ds_Ori_Ate,'ESPONT?NEO') > 0 Or InStr(Ori.Ds_Ori_Ate,'ESPONTANEO') > 0)) And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) Qtde_Espontaneo
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Lau
GROUP BY Lau.Cd_Multi_Empresa , Lau.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00738
---------------------------------------------------------------------------
CURSOR cProcesso_00738(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , NUll Tp_Diagnostico , NUll Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE DOADOR REPETICAO' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'TAXA DE DOADOR REPETICAO, QTDE DE DOADORES: '||Sum(Movimento.Qtde_Doadores) ||', QTDE DE REPETICAO: '||Sum(Nvl(Movimento.Qtde_Repeticao,0)) ||', TAXA DE REPETIÇÃO: '||Sum(Nvl(Movimento.Vl_Taxa_Repeticao,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Repeticao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Repeticao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Doadores , Mov.Qtde_Repeticao , Mov.Vl_Taxa_Repeticao
FROM ( SELECT Lau.Cd_Multi_Empresa , Lau.Data_Mes , Sum(Lau.Qtde_Doadores) Qtde_Doadores , Sum(Lau.Qtde_Repeticao) Qtde_Repeticao , (Case
WHEN Sum(Lau.Qtde_Doadores) = 0
THEN 0
ELSE Round((Sum(Lau.Qtde_Repeticao)/Sum(Lau.Qtde_Doadores))*100,2)
END ) Vl_Taxa_Repeticao
FROM ( SELECT Emp.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.dh_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = Emp.Cd_Multi_Empresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0) And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) Qtde_Doadores , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.dh_atendimento Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = Emp.Cd_Multi_Empresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0) And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Rep
WHERE Ate_Rep.Tp_Atendimento = 'A' And Ate_Rep.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate_Rep.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0) And Ate_Rep.Cd_Multi_Empresa = pCdMultiEmpresa And Ate_Rep.Dt_Atendimento > Sysdate-365 --Dose Meses ) ) Qtde_Repeticao
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Lau
GROUP BY Lau.Cd_Multi_Empresa , Lau.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00739
---------------------------------------------------------------------------
CURSOR cProcesso_00739(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , NUll Tp_Diagnostico , NUll Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE DOADOR PRIMEIRA VEZ' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'TAXA DE DOADOR PRIMEIRA VEZ, QTDE DE DOADORES: '||Sum(Movimento.Qtde_Doadores) ||', QTDE DE PRIMEIRA VEZ: '||Sum(Nvl(Movimento.Qtde_Primeira,0)) ||', TAXA DE PRIMEIRA VEZ: '||Sum(Nvl(Movimento.Vl_Taxa_Primeira,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Primeira,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Primeira,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Doadores , Mov.Qtde_Primeira , Mov.Vl_Taxa_Primeira
FROM ( SELECT Lau.Cd_Multi_Empresa , Lau.Data_Mes , Sum(Lau.Qtde_Doadores) Qtde_Doadores , Sum(Lau.Qtde_Primeira) Qtde_Primeira , (Case
WHEN Sum(Lau.Qtde_Doadores) = 0
THEN 0
ELSE Round((Sum(Lau.Qtde_Primeira)/Sum(Lau.Qtde_Doadores))*100,2)
END ) Vl_Taxa_Primeira
FROM ( SELECT Emp.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.dh_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = Emp.Cd_Multi_Empresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0) And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) Qtde_Doadores , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.dh_atendimento Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = Emp.Cd_Multi_Empresa And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0) And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Rep
WHERE Ate_Rep.Tp_Atendimento = 'A' And Ate_Rep.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Ori_Ate Ori
WHERE Ori.Cd_Ori_Ate = Ate_Rep.Cd_Ori_Ate And InStr(Ori.Ds_Ori_Ate,'DOADOR') > 0) And Ate_Rep.Cd_Multi_Empresa = pCdMultiEmpresa And Ate_Rep.Dt_Atendimento > Sysdate-(365*30) --30 Anos ) ) Qtde_Primeira
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Lau
GROUP BY Lau.Cd_Multi_Empresa , Lau.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00740
---------------------------------------------------------------------------
CURSOR cProcesso_00740(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , NUll Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'SOLIC. HEMOCOMPONENTE (INTERNO)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'PERCENTUAL ATEND. SOLIC. HEMOCOMPONENTE (INTERNO), QTDE DE PEDIDOS: '||Sum(Nvl(Movimento.Qtde_Solicitacao,0))||Chr(10) ||', QTDE ATENDIDAS: '||Sum(Nvl(Movimento.Qtde_Atendida,0))||Chr(10) ||', PERC. DE ATENDIMENTO: '||Avg(Nvl(Movimento.Vl_Taxa_Atendida,0))||'%'||Chr(10) ||', QTDE DE PEDIDOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Solicitacao_dia,0))||Chr(10) ||', QTDE ATENDIDAS NO DIA: '||Sum(Nvl(Movimento.Qtde_Atendida_dia,0))||Chr(10) ||', PERC. DE ATENDIMENTO NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Atendida_dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLIC_SANGUE' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Atendida,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Atendida,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Solicitacao , Mov.Qtde_Solicitacao_Dia , Mov.Qtde_Atendida , Mov.Qtde_Atendida_Dia , (Case
WHEN Nvl(Mov.Qtde_Solicitacao,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Atendida,0)/Nvl(Mov.Qtde_Solicitacao,0))*100,2)
END ) Vl_Taxa_Atendida , (Case
WHEN Nvl(Mov.Qtde_Solicitacao_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Atendida_Dia,0)/Nvl(Mov.Qtde_Solicitacao_Dia,0))*100,2)
END ) Vl_Taxa_Atendida_Dia
FROM ( SELECT Nvl(( SELECT Count(1)
FROM Dbamv.Solic_Sangue , Dbamv.It_Solic_Sangue
WHERE Solic_Sangue.cd_Solic_Sangue = It_Solic_Sangue.Cd_Solic_Sangue And Solic_Sangue.Tp_Situacao <> 'C' And Solic_Sangue.Dt_Solic_Sangue Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa , Dbamv.Setor Str
WHERE Exa.Cd_Setor = Str.Cd_Setor And Exa.Cd_Set_Exa = Solic_Sangue.Cd_Set_Exa And Str.cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Solicitacao , Nvl(( SELECT Count(1)
FROM Dbamv.Solic_Sangue , Dbamv.It_Solic_Sangue
WHERE Solic_Sangue.cd_Solic_Sangue = It_Solic_Sangue.Cd_Solic_Sangue And Solic_Sangue.Tp_Situacao <> 'C' And Solic_Sangue.Dt_Solic_Sangue Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa , Dbamv.Setor Str
WHERE Exa.Cd_Setor = Str.Cd_Setor And Exa.Cd_Set_Exa = Solic_Sangue.Cd_Set_Exa And Str.cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Solicitacao_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Solic_Sangue , Dbamv.It_Solic_Sangue
WHERE Solic_Sangue.cd_Solic_Sangue = It_Solic_Sangue.Cd_Solic_Sangue And Solic_Sangue.Tp_Situacao <> 'C' And Nvl(It_Solic_Sangue.Sn_realizado,'N') = 'S' And Solic_Sangue.Dt_Solic_Sangue Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa , Dbamv.Setor Str
WHERE Exa.Cd_Setor = Str.Cd_Setor And Exa.Cd_Set_Exa = Solic_Sangue.Cd_Set_Exa And Str.cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Atendida , Nvl(( SELECT Count(1)
FROM Dbamv.Solic_Sangue , Dbamv.It_Solic_Sangue
WHERE Solic_Sangue.cd_Solic_Sangue = It_Solic_Sangue.Cd_Solic_Sangue And Solic_Sangue.Tp_Situacao <> 'C' And Nvl(It_Solic_Sangue.Sn_realizado,'N') = 'S' And Solic_Sangue.Dt_Solic_Sangue Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM Dbamv.Set_Exa Exa , Dbamv.Setor Str
WHERE Exa.Cd_Setor = Str.Cd_Setor And Exa.Cd_Set_Exa = Solic_Sangue.Cd_Set_Exa And Str.cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Atendida_Dia
FROM Dual ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00743
---------------------------------------------------------------------------
CURSOR cProcesso_00743(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , NUll Tp_Diagnostico , NUll Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. INVEST. DE EVENTO ADVERSO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processooo , 'PERC. INVESTIGAO, QTDE DE NOTIFICACAO: '||Sum(Movimento.Qtde_Notificacao)||Chr(10) ||', QTDE DE INVESTIGACAO: '||Sum(Movimento.Qtde_Investigacao)||Chr(10) ||', PERC. DE INVESTIGACAO: '||Avg(Movimento.Vl_Perc_Investigado)||'%' Ds_Item_Nao_Conformeee , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PW_DOCUMENTO_CLINICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Investigacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Investigacao) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO DAS MORTES-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Notificacao , Mov.Qtde_Investigacao , Mov.Vl_Perc_Investigado
FROM ( SELECT Dia.Cd_Multi_Empresa , Dia.Data_Mes , Sum(Dia.Qtde_Notificacao) Qtde_Notificacao , Sum(Dia.Qtde_Investigacao) Qtde_Investigacao , (Case
WHEN Sum(Dia.Qtde_Notificacao) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Investigacao)/Sum(Dia.Qtde_Notificacao))*100,2)
END ) Vl_Perc_Investigado
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Atendimento = Pdc.cd_atendimento ),0) +Nvl(( SELECT Count(1)
FROM Dbamv.Registro_Documento Rd
WHERE Nvl(Sn_Impresso,'N') = 'S' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Rd.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Rd.Dt_Registro Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Atendimento = Rd.cd_atendimento ),0) Qtde_Notificacao , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Atendimento = Pdc.cd_atendimento ),0) +Nvl(( SELECT Count(1)
FROM Dbamv.Registro_Documento Rd , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Nvl(Rd.Sn_Impresso,'N') = 'S' And Vcc.Cd_Campo_Chave = Rd.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Rd.Dt_Registro Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Atendimento = Rd.cd_atendimento ),0) Qtde_Investigacao
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento BetWeen v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Dia
GROUP BY Dia.Cd_Multi_Empresa , Dia.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00744
---------------------------------------------------------------------------
CURSOR cProcesso_00744(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , NUll Tp_Diagnostico , NUll Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Sal_Cir.Cd_Sal_Cir Cd_Departamento , Sal_Cir.Ds_Sal_Cir Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'TAXA DE UTILIZACAO DO C.C., QTDE DE HORAS DISPONIVEIS: '||Trunc(Sum(Nvl(Movimento.Qtde_Hora_Disponivel,0)),2)||Chr(10) ||', QTDE DE HORAS UTILIZADAS: '||Trunc(Sum(Nvl(Movimento.Qtde_Hora_Utilizada,0)),2)||Chr(10) ||', TAXA DE UTILIZAÇÃO: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Utilizacao,0)),2)||'%'||Chr(10) ||', QTDE DE HORAS DISPONIVEIS NO DIA: '||Trunc(Sum(Nvl(Movimento.Qtde_Hora_Disponivel_Dia,0)),2)||Chr(10) ||', QTDE DE HORAS UTILIZADAS NO DIA: '||Trunc(Sum(Nvl(Movimento.Qtde_Hora_Utilizada_Dia,0)),2)||Chr(10) ||', TAXA DE UTILIZAÇÃO NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Utilizacao_Dia,0)),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Utilizacao,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Taxa_Utilizacao_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO DO CENTRO CIRURGICO-- SELECT Mov.Cd_Sal_Cir , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Hora_Disponivel , Mov.Qtde_Hora_Utilizada , (Mov.Qtde_Hora_Disponivel/To_Char(v_Dt_Atual_Diagno,'DD')) Qtde_Hora_Disponivel_Dia , Mov.Qtde_Hora_Utilizada_Dia , (Case
WHEN Nvl(Mov.Qtde_Hora_Disponivel,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Hora_Utilizada,0)/Nvl(Mov.Qtde_Hora_Disponivel,0))*100,2)
END ) Vl_Taxa_Utilizacao , (Case
WHEN Nvl((Mov.Qtde_Hora_Disponivel/To_Char(v_Dt_Atual_Diagno,'DD')),0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Hora_Utilizada_Dia,0)/Nvl((Mov.Qtde_Hora_Disponivel/To_Char(v_Dt_Atual_Diagno,'DD')),0))*100,2)
END ) Vl_Taxa_Utilizacao_Dia
FROM ( SELECT Sala.Cd_Sal_Cir , Nvl(( SELECT Sum((Nvl(Hsa.Dh_Hora_Comercial_Final,Hsa.Hr_Final)-Nvl(Hsa.Dh_Hora_Comercial_Inicial,Hsa.Hr_Inicial))*24)
FROM ( SELECT Hsa.Cd_Sal_Cir , To_Date(To_Char(Data,'DD/MM/YYYY')||' '||To_Char(Hsa.Hr_Inicial,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') Hr_Inicial , To_Date(To_Char(Data,'DD/MM/YYYY')||' '||To_Char(Hsa.Hr_Final,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') Hr_Final , ( SELECT Case
WHEN Vcc.Cd_Campo_Chave IS Null
THEN Null
ELSE To_Date(To_Char(Data,'DD/MM/YYYY')||' '||Vcc.Cd_Campo_Chave||':00','DD/MM/YYYY HH24:MI:SS')
END
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 96 --HORARIO INICIAL DE FUNCIONAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Hsa.Cd_Sal_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Dh_Hora_Comercial_Inicial , ( SELECT Case
WHEN Vcc.Cd_Campo_Chave IS Null
THEN Null
ELSE To_Date(To_Char(Data,'DD/MM/YYYY')||' '||Vcc.Cd_Campo_Chave||':00','DD/MM/YYYY HH24:MI:SS')
END
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 97 --HORARIO FINAL DE FUNCIONAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Hsa.Cd_Sal_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Dh_Hora_Comercial_Final
FROM Dbamv.Hr_Sal_Cir Hsa , ( SELECT Ld.Data, To_Char(Ld.Data,'D') Tp_Dia_Semana
FROM MvccAdmin.Lista_Data Ld
WHERE Ld.cd_multi_empresa = pCdMultiEmpresa) Contador
WHERE Contador.Tp_Dia_Semana = Hsa.Tp_Dia_Semana And Contador.Tp_Dia_Semana In ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 199 --DIA DA SEMANA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Hsa.Cd_Sal_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Contador.Data Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Hsa
WHERE Hsa.Cd_Sal_Cir = Sala.Cd_Sal_Cir ),0) Qtde_Hora_Disponivel , Nvl(( SELECT Round(Sum((Nvl(Avi.Dt_Saida_Sal_Cir,Avi.Dt_Fim_Cirurgia)-Avi.Dt_Realizacao)*24))
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Sal_Cir = Sala.Cd_Sal_Cir And Avi.cd_multi_empresa = pCdMultiEmpresa And To_Char(Avi.Dt_Realizacao,'D') In ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 199 --DIA DA SEMANA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Sala.Cd_Sal_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ),0) Qtde_Hora_Utilizada , Nvl(( SELECT Round(Sum((Nvl(Avi.Dt_Saida_Sal_Cir,Avi.Dt_Fim_Cirurgia)-Avi.Dt_Realizacao)*24))
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Avi.Cd_Sal_Cir = Sala.Cd_Sal_Cir And Avi.cd_multi_empresa = pCdMultiEmpresa And To_Char(Avi.Dt_Realizacao,'D') In ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 199 --DIA DA SEMANA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Sala.Cd_Sal_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ),0) Qtde_Hora_Utilizada_Dia
FROM Dbamv.Sal_Cir Sala
WHERE Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Setor.Cd_Setor = Sala.Cd_Setor And Setor.cd_multi_empresa = pCdMultiEmpresa) ) Mov ) Movimento , Dbamv.Sal_Cir , MvccAdmin.Estabelecimento
WHERE Sal_Cir.Cd_Sal_Cir = Movimento.Cd_Sal_Cir And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Sal_Cir.Cd_Sal_Cir , Sal_Cir.Ds_Sal_Cir , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00747
---------------------------------------------------------------------------
CURSOR cProcesso_00747(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR ESTOQUE FATURAMENTO VS RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NULL Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR TOTAL DO ESTOQUE DE RECEITA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Est_Faturado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Medio),0),'999G999G999G999D99')),'0,00')||Chr(10)|| '. CONSIDERE TAMBÉM: '||Chr(10)|| ', VALOR DA RECEITA DO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJATADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DO ESTOQUE DE RECEITA (30 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Est_Fat_30),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DO ESTOQUE DE RECEITA (60 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Est_Fat_60),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DO ESTOQUE DE RECEITA (90 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Est_Fat_90),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DO ESTOQUE DE RECEITA (180 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Est_Fat_180),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DO ESTOQUE DE RECEITA (>180 DIAS): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Est_Fat_180_Mais),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Est_Faturado , Mov.Vl_Est_Fat_30 , Mov.Vl_Est_Fat_60 , Mov.Vl_Est_Fat_90 , Mov.Vl_Est_Fat_180 , Mov.Vl_Est_Fat_180_Mais , Mov.Vl_Produzido_Medio , Mov.Vl_Produzido_Mes_Atual , Mov.Vl_Produzido_Mes_Atual_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Est_Faturado,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Est_Faturado,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Est_Faturado,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Est_Faturado,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Est_Faturado , Mov.Vl_Est_Fat_30 , Mov.Vl_Est_Fat_60 , Mov.Vl_Est_Fat_90 , Mov.Vl_Est_Fat_180 , Mov.Vl_Est_Fat_180_Mais , Mov.Vl_Produzido_Medio , Mov.Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Vl_Produzido_Mes_Atual,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT ---VALOR_EST_FATURADO--- Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0) + Nvl(Dme.vl_estoque_conta_conv_externo,0) + Nvl(Dme.vl_estoque_conta_sus_interno,0) + Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Est_Faturado ---VALOR_EST_FAT_30--- , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0) + Nvl(Dme.vl_estoque_conta_conv_externo,0) + Nvl(Dme.vl_estoque_conta_sus_interno,0) + Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Trunc(Sysdate)-Dme.Dt_Mes Between 0 And 30 --Dias 30 ),0) Vl_Est_Fat_30 ---VALOR_EST_FAT_60--- , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0) + Nvl(Dme.vl_estoque_conta_conv_externo,0) + Nvl(Dme.vl_estoque_conta_sus_interno,0) + Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Trunc(Sysdate)-Dme.Dt_Mes Between 31 And 60 --Dias 60 ),0) Vl_Est_Fat_60 ---VALOR_EST_FAT_90--- , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0) + Nvl(Dme.vl_estoque_conta_conv_externo,0) + Nvl(Dme.vl_estoque_conta_sus_interno,0) + Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Trunc(Sysdate)-Dme.Dt_Mes Between 61 And 90 --Dias 90 ),0) Vl_Est_Fat_90 ---VALOR_EST_FAT_180--- , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0) + Nvl(Dme.vl_estoque_conta_conv_externo,0) + Nvl(Dme.vl_estoque_conta_sus_interno,0) + Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Trunc(Sysdate)-Dme.Dt_Mes Between 91 And 180 --Dias 180 ),0) Vl_Est_Fat_180 ---VALOR_EST_FAT_180_MAIS--- , Nvl(( SELECT Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0) + Nvl(Dme.vl_estoque_conta_conv_externo,0) + Nvl(Dme.vl_estoque_conta_sus_interno,0) + Nvl(Dme.vl_estoque_conta_sus_externo,0))
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Trunc(Sysdate)-Dme.Dt_Mes > 180 --Dias 180 Mais ),0) Vl_Est_Fat_180_Mais ---VALOR TOTAL PRODUZIDO MEDIA ULTIMOS 12 MESES--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR TOTAL PRODUZIDO MEDIA MES CORRENTE--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00748
---------------------------------------------------------------------------
CURSOR cProcesso_00748(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'TICKET MEDIO CIRURGICO CONV.: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_multi_Empresa , Mov.Cd_Convenio , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Cd_Convenio , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( --VALOR MEDIO DAS CONTAS POR CONVENIO-- SELECT Reg.Cd_multi_Empresa , Reg.Cd_Convenio , Reg.Cd_Reg_Fat , To_Char(Reg.Dt_Final,'MM/YYYY') Data_Mes , ( SELECT Sum(Itr.Vl_Total_Conta)
FROM Dbamv.ItReg_Fat Itr
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat) Vl_Total_Conta
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'C') --- APCIENTES CIRURGICOS--- And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Reg.Cd_Atendimento And Avi.Dt_Realizacao Between Reg.Dt_Inicio And Reg.Dt_Final) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Cd_Convenio , Cta.Data_Mes ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Convenio.Cd_Convenio , Convenio.Nm_Convenio , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00749
---------------------------------------------------------------------------
CURSOR cProcesso_00749(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TICKET MEDIO CIRURGICO SUS.' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Null Nm_Processo , 'TICKET MEDIO CIRURGICO SUS.: '||Nvl(LTrim(To_Char(Sum(Movimento.Vl_Ticket_Medio),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Vl_Ticket_Medio) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS SUS-- SELECT Mov.Cd_multi_Empresa , Mov.Data_Mes , Mov.Vl_Ticket_Medio , Mov.Vl_Ticket_Esperado
FROM ( SELECT Cta.Cd_multi_Empresa , Cta.Data_Mes , Round(Avg(Nvl(Cta.Vl_Total_Conta,0)),2) Vl_Ticket_Medio , Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),0) Vl_Ticket_Esperado
FROM ( --VALOR MEDIO DAS CONTAS POR SUS-- SELECT Reg.Cd_multi_Empresa , Reg.Cd_Reg_Fat , To_Char(Reg.Dt_Final,'MM/YYYY') Data_Mes , ( SELECT Nvl(Sum(Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0)),0)
FROM MvccAdmin.v_Valores_Aih Valor
WHERE valor.Cd_Multi_Empresa = pCdMultiEmpresa And valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Valor.Cd_Reg_Fat = Reg.Cd_Reg_Fat) Vl_Total_Conta
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Convenio = Reg.Cd_Convenio And Con.Tp_Convenio = 'H') --- APCIENTES CIRURGICOS--- And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Reg.Cd_Atendimento And Avi.Dt_Realizacao Between Reg.Dt_Inicio And Reg.Dt_Final) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_multi_Empresa , Cta.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00750
---------------------------------------------------------------------------
CURSOR cProcesso_00750(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR RECEBIDO DO MÊS VS RECEITA MÉDIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NULL Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR DO RECEBIMENTO DO MÊS (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Recebido_Mes_Corrente_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês corrente)'||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ' CONSIDERE TAMBÉM RESULTADO DA MÉDIA: '||Chr(10)|| ', RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR MÉDIO DOS RECEBIMENTOS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Recebido_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR MÉDIO DAS RECEITAS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Recebido_Media,0) Vl_Recebido_Media , Nvl(Mov.Vl_Recebido_Mes_Corrente,0) Vl_Recebido_Mes_Corrente , Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0) Vl_Recebido_Mes_Corrente_Proj , Nvl(Mov.Vl_Produzido_Media,0) Vl_Produzido_Media , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , (Case
WHEN Nvl(Mov.Vl_Recebido_Media,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Recebido_Media,0)/Nvl(Mov.Vl_Produzido_Media,0),2)
END ) Vl_Fracao_Razao , (Case
WHEN Nvl(Mov.Vl_Recebido_Media,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Recebido_Media,0)/Nvl(Mov.Vl_Produzido_Media,0)*100,2)
END ) Vl_Perc_Fracao_Razao , (Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END ) Vl_Fracao_Razao_Proj , (Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END ) Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Recebido_Media),0) Vl_Recebido_Media , Nvl(Sum(Mov.Vl_Recebido_Mes_Corrente),0) Vl_Recebido_Mes_Corrente , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Recebido_Mes_Corrente),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Recebido_Mes_Corrente_Proj , Nvl(Sum(Mov.Vl_Produzido_Media),0) Vl_Produzido_Media , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT ---VALOR_RECEBIDO_MEDIA--- Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_total_recebimentos,0)) + Sum(Nvl(Dme.Vl_Outras_Receitas_Recebidas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Recebido_Media ---VALOR TOTAL PRODUZIDO MEDIA--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Media ---VALOR_RECEBIDO_MES CORRENTE--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_total_recebimentos,0)) + Sum(Nvl(Dme.Vl_Outras_Receitas_Recebidas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Recebido_Mes_Corrente ---VALOR TOTAL PRODUZIDO MEDIA--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00751
---------------------------------------------------------------------------
CURSOR cProcesso_00751(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR MÉDIO DESPESA FIXA VS RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Fixas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. CONSIDERE TAMBÉM O RESULTADO MÉDIO: '||Chr(10)|| 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Fixas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Despesas_Fixas_Media,0) Vl_Despesas_Fixas_Media , Nvl(Mov.Vl_Produzido_Medio,0) Vl_Produzido_Medio , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Fixas_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Fixas_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Fixas_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Fixas_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Despesas_Fixas_Media),0) Vl_Despesas_Fixas_Media , Nvl(Sum(Mov.Vl_Produzido_Medio),0) Vl_Produzido_Medio , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT ---VALOR MEDIO DE DESPESAS FIXA--- Nvl(( SELECT Trunc(Avg(Dme.Valor_Despesas_Fixas_Media),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_despesas_fixas,0)) Valor_Despesas_Fixas_Media
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_Fixas_Media ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00752
---------------------------------------------------------------------------
CURSOR cProcesso_00752(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DESP. TOTAL VS RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%)' ||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJEDA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. CONSIDERE TAMBÉM O RESULTADO MÉDIO: '||Chr(10)|| 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%)' ||Chr(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Despesas_Media,0) Vl_Despesas_Media , Nvl(Mov.Vl_Produzido_Medio,0) Vl_Produzido_Medio , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Despesas_Media),0) Vl_Despesas_Media , Nvl(Sum(Mov.Vl_Produzido_Medio),0) Vl_Produzido_Medio , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT --VALOR TOTAL GASTO NO MES ANTERIOR--- Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Total_Despesas,0)) Vl_Total_Despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_Media ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00753
---------------------------------------------------------------------------
CURSOR cProcesso_00753(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR MÉDIO DESPESA VS RECEBIDO DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR DO RECEBIMENTO DO MÊS (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Recebido_Mes_Corrente_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês corrente)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. CONSIDERE TAMBÉM O RESULDO MÉDIO: '||Chr(10)|| ' RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ' VALOR DO RECEBIMENTO MÉDIO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Recebido_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. OUTROS VALORES: '||Chr(10)|| ' VALOR DO RECEBIMENTO DO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Recebido_Mes_Corrente),0),'999G999G999G999D99')),'0,00')||' (Mês corrente)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Despesas_Media,0) Vl_Despesas_Media , Nvl(Mov.Vl_Recebido_Medio,0) Vl_Recebido_Medio , Nvl(Mov.Vl_Recebido_Mes_Corrente,0) Vl_Recebido_Mes_Corrente , Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0) Vl_Recebido_Mes_Corrente_Proj , Case
WHEN Nvl(Mov.Vl_Recebido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Recebido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Recebido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Recebido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Media,0)/Nvl(Mov.Vl_Recebido_Mes_Corrente_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Despesas_Media),0) Vl_Despesas_Media , Nvl(Sum(Mov.Vl_Recebido_Medio),0) Vl_Recebido_Medio , Nvl(Sum(Mov.Vl_Recebido_Mes_Corrente),0) Vl_Recebido_Mes_Corrente , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Recebido_Mes_Corrente),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Recebido_Mes_Corrente_Proj
FROM ( SELECT ---VALOR DESPESAS MEDIAS--- Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Total_Despesas,0)) Vl_Total_Despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_Media ---VALOR TOTAL RECEBIDOS MEDIA--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_total_recebimentos,0)) + Sum(Nvl(Dme.vl_outras_receitas_recebidas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Recebido_Medio ---VALOR TOTAL RECEBIDOS MES CORRENTE--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_total_recebimentos,0)) + Sum(Nvl(Dme.vl_outras_receitas_recebidas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Recebido_Mes_Corrente
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00754
---------------------------------------------------------------------------
CURSOR cProcesso_00754(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE EFICIÊNCIA DE LEITO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'EFICIÊNCIA DO LEITO, QTDE DIÁRIA INSTALADA (ATUAL): '||Sum(Nvl(Movimento.Qtde_Instalada,0))||Chr(10) ||', QTDE DIÁRIA UTILIZADA (MÉDIA 3 MESES): '||Sum(Nvl(Movimento.Qtde_Utilizada_Media,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO (MÉDIA 3 MESES): '||Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Media,0))||'%'||Chr(10) ||', VALOR DA PRODUÇÃO DA UNIDADE (MÉDIA 3 MESES): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Interno_Medio),0),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR DA OCIOSIDADE/PERDA (MÉDIA 3 MESES): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_da_Ociosidade),0),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Utilizada_Media,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Utilizada_Media,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Utilizada_Media , Mov.Vl_Produzido_Interno_Medio , Round((Mov.Vl_Produzido_Interno_Medio/100)*(100-Nvl(Mov.Vl_Taxa_Ocupacao_Media,0)),2) Valor_da_Ociosidade , Mov.Vl_Taxa_Ocupacao_Media
FROM ( SELECT Nvl(Cta.Qtde_Instalada,0) Qtde_Instalada , Nvl(Cta.Qtde_Utilizada_Media,0) Qtde_Utilizada_Media , Nvl(Cta.Vl_Produzido_Interno_Medio,0) Vl_Produzido_Interno_Medio , Case
WHEN Nvl(Cta.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Cta.Qtde_Utilizada_Media,0)/Nvl(Cta.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao_Media
FROM ( SELECT Nvl(( SELECT Sum(Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0))
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Instalada , Nvl(( SELECT Avg(Ate.Qtde_Utilizada_Media) Qtde_Utilizada_Media
FROM ( SELECT Ate.Data_Mes , Avg(Ate.Qtde_Diaria) Qtde_Utilizada_Media
FROM ( SELECT Ate.Data_Mes , Sum(Ate.Qtde_Diaria) Qtde_Diaria
FROM ( SELECT To_Char(Contador.Data,'MM/YYYY') Data_Mes , 1 Qtde_Diaria
FROM Dbamv.Atendime Ate , ( SELECT Add_Months(Ld.Data,-3) Data
FROM MvccAdmin.Lista_Data Ld) Contador
WHERE Ate.Tp_Atendimento = 'I' And Ate.Cd_Atendimento_Pai IS Null And Contador.Data Between (Case
WHEN Ate.Dt_Atendimento < To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-3),'MM/YYYY'),'MM/YYYY')
THEN Contador.Data
ELSE Ate.Dt_Atendimento
END ) And (Case
WHEN Nvl(Ate.Dt_Alta,Sysdate) > Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY'))+.99999
THEN Contador.Data
ELSE Nvl(Ate.Dt_Alta,Sysdate)
END ) And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Ate
GROUP BY Ate.Data_Mes ) Ate
GROUP BY Ate.Data_Mes ) Ate ),0) Qtde_Utilizada_Media ---VALOR TOTAL PRODUZIDO INTERNO (SUS/CONVENIO/PARTICULAR)--- , Nvl(( SELECT Trunc(Avg(Dme.vl_outras_receitas_recebidas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Sus_Interno,0)+Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)+Nvl(Dme.Vl_Pro_Total_Particul_Interno,0)) vl_outras_receitas_recebidas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(sysdate,-3),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(sysdate,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Interno_Medio
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00755
---------------------------------------------------------------------------
CURSOR cProcesso_00755(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR RECEITA DO MÊS VS DESP. MÉDIA C/PESSOAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJETADA) R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA C/PESSOAL: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Pessoal_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. CONSIDERE TAMBÉM O RESULTADO MÉDIO: '||Chr(10)|| ' RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA C/PESSOAL: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Pessoal_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Despesas_Pessoal_Media,0) Vl_Despesas_Pessoal_Media , Nvl(Mov.Vl_Produzido_Medio,0) Vl_Produzido_Medio , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Pessoal_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Pessoal_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Pessoal_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Pessoal_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Despesas_Pessoal_Media),0) Vl_Despesas_Pessoal_Media , Nvl(Sum(Mov.Vl_Produzido_Medio),0) Vl_Produzido_Medio , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT ---VALOR CUSTO COM PESSOAL MEDIO--- Nvl(( SELECT Trunc(Avg(Dme.Valor_Despesas_Pessoal_Media),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Valor_Despesas_Pessoal_Media
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_Pessoal_Media ---VALOR TOTAL PRODUZIDO MEDIA--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR TOTAL PRODUZIDO MEDIA--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00756
---------------------------------------------------------------------------
CURSOR cProcesso_00756(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR MÉDIO DESPESA C/PESSOAL VS DESPESA MÉDIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA DESPESA C/PESSOAL MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Pessoal_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Despesas_Media,0) Vl_Despesas_Media , Nvl(Mov.Vl_Despesas_Pessoal_Media,0) Vl_Despesas_Pessoal_Media , Case
WHEN Nvl(Mov.Vl_Despesas_Media,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Pessoal_Media,0)/Nvl(Mov.Vl_Despesas_Media,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Despesas_Media,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_Pessoal_Media,0)/Nvl(Mov.Vl_Despesas_Media,0)*100,2)
END Vl_Perc_Fracao_Razao
FROM ( SELECT Nvl(Sum(Mov.Vl_Despesas_Media),0) Vl_Despesas_Media , Nvl(Sum(Mov.Vl_Despesas_Pessoal_Media),0) Vl_Despesas_Pessoal_Media
FROM ( SELECT ---DESPESAS MEDIAS--- Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Total_Despesas,0)) Vl_Total_Despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_Media ---VALOR_DESPESAS_PESSOAL_MEDIA--- , Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_Pessoal),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_Pessoal,0)) Vl_Despesas_Pessoal
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_Pessoal_Media
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00757
---------------------------------------------------------------------------
CURSOR cProcesso_00757(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR MÉDIO DESPESA C/MAT./MÉD. VS RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Sum(Nvl(Movimento.Vl_Produzido_Mes_Atual_Proj,0)),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||Chr(10)|| ', VALOR DA DESPESAS MÉDIA C/MAT/MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_MatMed_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. CONSIDERE TAMBÉM O RESULTADO MÉDIO: '||Chr(10)|| ' RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Sum(Nvl(Movimento.Vl_Produzido_Medio,0)),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA DESPESAS MÉDIA C/MAT/MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_MatMed_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Despesas_MatMed_Media,0) Vl_Despesas_MatMed_Media , Nvl(Mov.Vl_Produzido_Medio,0) Vl_Produzido_Medio , Nvl(Mov.Vl_Produzido_Medio,0)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Medio_Dia , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Despesas_MatMed_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Despesas_MatMed_Media,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Despesas_MatMed_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Despesas_MatMed_Media,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Despesas_MatMed_Media),0) Vl_Despesas_MatMed_Media , Nvl(Sum(Mov.Vl_Produzido_Medio),0) Vl_Produzido_Medio , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT --VALOR TOTAL GASTO COM MAT MED--- Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_MatMed),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_MatMed,0)) Vl_Despesas_MatMed
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_MatMed_Media ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00758
---------------------------------------------------------------------------
CURSOR cProcesso_00758(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR MÉDIO RECEITA C/MAT./MÉD. VS RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||Chr(10)|| ', VALOR DA RECEITA MÉDIA C/MAT/MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_MatMed_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. CONSIDERE TAMBÉM O RESULTADO MÉDIO: '||Chr(10)|| 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA RECEITA MÉDIA C/MAT/MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_MatMed_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)), Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Produzido_MatMed_Medio,0) Vl_Produzido_MatMed_Medio , Nvl(Mov.Vl_Produzido_Medio,0) Vl_Produzido_Medio , Nvl(Mov.Vl_Produzido_Medio,0)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Medio_Dia , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Produzido_MatMed_Medio,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Produzido_MatMed_Medio,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Produzido_MatMed_Medio,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Vl_Produzido_MatMed_Medio,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Produzido_MatMed_Medio),0) Vl_Produzido_MatMed_Medio , Nvl(Sum(Mov.Vl_Produzido_Medio),0) Vl_Produzido_Medio , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT ---VALOR PRODUZIDO MAT E MED MEDIO--- Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_MatMed_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_MatMed_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_MatMed_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_MatMed_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_MatMed_Medio ---VALOR PRODUZIDO MÉDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR PRODUZIDO MÉDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00759
---------------------------------------------------------------------------
CURSOR cProcesso_00759(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR ESTOQUE C/MAT./MÉD. VS RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA DO MÊS (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||Chr(10)|| ', VALOR DO ESTOQUE C/MAT/MED: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Estoque_MatMed),0),'999G999G999G999D99')),'0,00')||Chr(10)|| '. CONSIDERE TAMBÉM O RESULTADO MÉDIO: '||Chr(10)|| 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DO ESTOQUE C/MAT/MED: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Estoque_MatMed),0),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Estoque_MatMed,0) Vl_Estoque_MatMed , Nvl(Mov.Vl_Produzido_Medio,0) Vl_Produzido_Medio , Nvl(Mov.Vl_Produzido_Medio,0)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Produzido_Medio_Dia , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Estoque_MatMed,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Estoque_MatMed,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END Vl_Perc_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Estoque_MatMed,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END Vl_Fracao_Razao_Proj , Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Estoque_MatMed,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Estoque_MatMed),0) Vl_Estoque_MatMed , Nvl(Sum(Mov.Vl_Produzido_Medio),0) Vl_Produzido_Medio , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj
FROM ( SELECT --VALOR ESTOQUE MAT MED--- Nvl(( SELECT Avg(Valor)
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Trunc(Sum(Dbamv.Verif_Vl_Custo_Medio(Valor.Cd_Produto,v_Dt_Ini_Diagno,'H',Null,v_Dt_Ini_Diagno+.99999,pCdMultiEmpresa)*Valor.Qt_Estoque_Atual),2) Valor
FROM ( SELECT Est.Cd_Produto , Sum(Est.Qt_Estoque_Atual) Qt_Estoque_Atual
FROM Dbamv.Est_Pro Est
WHERE Exists ( SELECT 1
FROM Dbamv.Estoque Eto
WHERE Est.Cd_Estoque = Eto.Cd_Estoque And Eto.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Sub_Clas Cla, Dbamv.Produto Prd
WHERE Cla.Cd_Especie = Prd.Cd_Especie And Cla.Cd_Classe = Prd.Cd_Classe And Cla.Cd_Sub_Cla = Prd.Cd_Sub_Cla And Cla.sn_saida_paciente = 'S' And Prd.tp_ativo = 'S' And Prd.Cd_Produto = Est.Cd_Produto) And Nvl(Est.qt_estoque_atual,0) > 0
GROUP BY Est.Cd_Produto ) Valor
GROUP BY To_Char(v_Dt_Ini_Diagno,'MM/YYYY') )),0) Vl_Estoque_MatMed ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00760
---------------------------------------------------------------------------
CURSOR cProcesso_00760(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR MÉDIO DESPESA C/MAT./MÉD. VS DESPESA MÉDIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||Chr(10)|| ', VALOR DA DESPESA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA C/MAT/MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Despesas_MatMed_Media),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Despesas_MatMed_Media,0) Vl_Despesas_MatMed_Media , Nvl(Mov.Vl_Despesas_Media,0) Vl_Despesas_Media , Case
WHEN Nvl(Mov.Vl_Despesas_Media,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_MatMed_Media,0)/Nvl(Mov.Vl_Despesas_Media,0),2)
END Vl_Fracao_Razao , Case
WHEN Nvl(Mov.Vl_Despesas_Media,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Despesas_MatMed_Media,0)/Nvl(Mov.Vl_Despesas_Media,0)*100,2)
END Vl_Perc_Fracao_Razao
FROM ( SELECT Nvl(Sum(Mov.Vl_Despesas_MatMed_Media),0) Vl_Despesas_MatMed_Media , Nvl(Sum(Mov.Vl_Despesas_Media),0) Vl_Despesas_Media
FROM ( SELECT --VALOR TOTAL GASTO COM MAT MED--- Nvl(( SELECT Trunc(Avg(Dme.Vl_Despesas_MatMed),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Despesas_MatMed,0)) Vl_Despesas_MatMed
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_MatMed_Media ---VALOR TOTAL GASTO DESPESAS TOTAL--- , Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Total_Despesas,0)) Vl_Total_Despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Despesas_Media
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00761
---------------------------------------------------------------------------
CURSOR cProcesso_00761(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR FATURADO MÉDIO VS RECEITA DO MÊS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'RESULTADO PROJETADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao_Proj,0))||'%) '||CHR(10)|| ', VALOR DA RECEITA DO MÊS (PROJETADA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||CHR(10)|| ', VALOR DO FATURADO DO MÊS (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Faturado_Mes_Corrente_Proj),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||CHR(10)|| '. CONSIDERE TAMBÉM O RESULTADO MÉDIO: '||Chr(10)|| 'RESULTADO: '||Avg(Nvl(Movimento.Vl_Fracao_Razao,0))||' ('||Avg(Nvl(Movimento.Vl_Perc_Fracao_Razao,0))||'%) '||CHR(10)|| ', VALOR DA RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_MediO),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||CHR(10)|| ', VALOR DO FATURADO MÉDIO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Faturado_Medio),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| '. VALOR DO MÊS: '||Chr(10)|| ' VALOR DA RECEITA DO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Mes_Atual),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)'||CHR(10)|| ', VALOR DO FATURADO NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Faturado_Mes_Corrente),0),'999G999G999G999D99')),'0,00')||' (Mês Corrente)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Fracao_Razao_Proj,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Produzido_Medio,0) Vl_Produzido_Medio , Nvl(Mov.Vl_Produzido_Mes_Atual,0) Vl_Produzido_Mes_Atual , Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) Vl_Produzido_Mes_Atual_Proj , Nvl(Mov.Vl_Faturado_Medio,0) Vl_Faturado_Medio , Nvl(Mov.Vl_Faturado_Mes_Corrente,0) Vl_Faturado_Mes_Corrente , Nvl(Mov.Vl_Faturado_Mes_Corrente_Proj,0) Vl_Faturado_Mes_Corrente_Proj , (Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Faturado_Medio,0)/Nvl(Mov.Vl_Produzido_Medio,0),2)
END ) Vl_Fracao_Razao , (Case
WHEN Nvl(Mov.Vl_Produzido_Medio,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Faturado_Medio,0)/Nvl(Mov.Vl_Produzido_Medio,0)*100,2)
END ) Vl_Perc_Fracao_Razao , (Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Faturado_Mes_Corrente_Proj,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0),2)
END ) Vl_Fracao_Razao_Proj , (Case
WHEN Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Faturado_Mes_Corrente_Proj,0)/Nvl(Mov.Vl_Produzido_Mes_Atual_Proj,0)*100,2)
END ) Vl_Perc_Fracao_Razao_Proj
FROM ( SELECT Nvl(Sum(Mov.Vl_Produzido_Medio),0) Vl_Produzido_Medio , Nvl(Sum(Mov.Vl_Faturado_Medio),0) Vl_Faturado_Medio , Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0) Vl_Produzido_Mes_Atual , Nvl(Sum(Mov.Vl_Faturado_Mes_Corrente),0) Vl_Faturado_Mes_Corrente , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Produzido_Mes_Atual),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Mes_Atual_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Sum(Mov.Vl_Faturado_Mes_Corrente),0),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Faturado_Mes_Corrente_Proj
FROM ( SELECT ---VALOR TOTAL PRODUZIDO--- Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Medio ---VALOR TOTAL PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Produzido_Mes_Atual ---VALOR FATURADO MÉDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Fat_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Fat_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Fat_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Fat_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes >= To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-12),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Faturado_Medio ---VALOR PRODUZIDO MEDIO--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Fat_Total_Convenio_Interno,0)) + Sum(Nvl(Dme.Vl_Fat_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Fat_Total_SUS_Interno,0)) + Sum(Nvl(Dme.Vl_Fat_Total_SUS_Externo,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Faturado_Mes_Corrente
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00763
---------------------------------------------------------------------------
CURSOR cProcesso_00763(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERDA DE RECEITA C/OCIOSIDADE DO C.C.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'EFICIÊNCIA: '||Sum(Nvl(Movimento.Perc_Eficiencia,0))||'%'||Chr(10)|| ', TAXA DE UTILIZAÇÃO DO BLOCO: '||Sum(Nvl(Movimento.Taxa_Utilizacao_Bloco,0))||'% MEDIA MÊS'||Chr(10)|| ', VALOR TOTAL RECEITA MÉDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Media),0),'999G999G999G999D99')),'0,00')||' (Forecast)'||Chr(10)|| ', QTDE HORAS INSTALADAS C.C. MEDIA: '||Sum(Nvl(Movimento.Qtde_Hora_Instalada_Media,0))||' HORA(s) (Capacidade Atual)'||Chr(10)|| ', QTDE HORAS UTILIZADAS C.C. MEDIA: '||Sum(Nvl(Movimento.Qtde_Hora_Utilizada_Media,0))||' HORA(s) (Forecast)'||Chr(10)|| ', VALOR DA INEFICIÊNCIA (PERDA) MEDIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Ineficiencia),0),'999G999G999G999D99')),'0,00')||' (Forecast)'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Hora_Utilizada_Media,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Sum(Nvl(Movimento.Qtde_Hora_Utilizada_Media,0)) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Nvl(Mov.Qtde_Hora_Instalada_Media,0) Qtde_Hora_Instalada_Media , Nvl(Mov.Qtde_Hora_Utilizada_Media,0) Qtde_Hora_Utilizada_Media , Nvl(Mov.Vl_Produzido_Media,0) Vl_Produzido_Media , Nvl(Mov.Taxa_Utilizacao_Bloco,0) Taxa_Utilizacao_Bloco , Nvl(Mov.Valor_Ineficiencia,0) Valor_Ineficiencia , (Case
WHEN Nvl(Mov.Taxa_Utilizacao_Bloco,0) = 0
THEN 0
WHEN Nvl(Mov.Vl_Produzido_Media,0) = 0
THEN 0
ELSE 100-(Round(Nvl(Mov.Valor_Ineficiencia,0)/Nvl(Mov.Vl_Produzido_Media,0)*100,2))
END ) Perc_Eficiencia
FROM ( SELECT Inef.Cd_Multi_Empresa , Inef.Data_Mes , Nvl(Inef.Qtde_Hora_Instalada_Media,0) Qtde_Hora_Instalada_Media , Nvl(Inef.Qtde_Hora_Utilizada_Media,0) Qtde_Hora_Utilizada_Media , Nvl(Inef.Vl_Produzido_Media,0) Vl_Produzido_Media , Nvl(Inef.Taxa_Utilizacao_Bloco,0) Taxa_Utilizacao_Bloco , Case
WHEN Nvl(Inef.Taxa_Utilizacao_Bloco,0) = 0
THEN Nvl(Inef.Vl_Produzido_Media,0)
ELSE Trunc((Case
WHEN Nvl(Inef.Taxa_Utilizacao_Bloco,0) = 0
THEN 0
ELSE Nvl(Inef.Vl_Produzido_Media,0)/Nvl(Inef.Taxa_Utilizacao_Bloco,0)
END ) * (100-Nvl(Inef.Taxa_Utilizacao_Bloco,0)),2)
END Valor_Ineficiencia
FROM ( SELECT Tax.Cd_Multi_Empresa , Tax.Data_Mes , Nvl(Tax.Qtde_Hora_Instalada_Media,0) Qtde_Hora_Instalada_Media , Nvl(Tax.Qtde_Hora_Utilizada_Media,0) Qtde_Hora_Utilizada_Media , Nvl(Tax.Vl_Produzido_Media,0) Vl_Produzido_Media , Case
WHEN Nvl(Tax.Qtde_Hora_Instalada_Media,0) = 0
THEN 0
ELSE Round(Nvl(Tax.Qtde_Hora_Utilizada_Media,0)/Nvl(Tax.Qtde_Hora_Instalada_Media,0)*100,2)
END Taxa_Utilizacao_Bloco
FROM ( SELECT Cta.Cd_Multi_Empresa , Cta.Data_Mes , Nvl(Sum(Cta.Qtde_Hora_Instalada_Media),0) Qtde_Hora_Instalada_Media , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Cta.Vl_Produzido_Media),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Vl_Produzido_Media , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Cta.Qtde_Hora_Utilizada_Media),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Hora_Utilizada_Media
FROM ( SELECT Emp.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes ---QTDE HORAS INSTALADA--- , Nvl(( SELECT Avg(Qtde_Hora_Inst_Media)
FROM ( SELECT To_Char(Contador.Data,'MM/YYYY'), Sum(Trunc((To_Date(To_Char(Contador.Data,'DD/MM/YYYY')||' '||To_Char(Hrc.hr_final,'hh24:mi'),'DD/MM/YYYY HH24:MI') -To_Date(To_Char(Contador.Data,'DD/MM/YYYY')||' '||To_Char(Hrc.hr_inicial,'hh24:mi'),'DD/MM/YYYY HH24:MI'))*24)) Qtde_Hora_Inst_Media
FROM Dbamv.Hr_Sal_Cir Hrc , ( SELECT Ld.Data, To_Char(Ld.Data,'D') Tp_Dia_Semana
FROM MvccAdmin.Lista_Data Ld
WHERE Ld.cd_multi_empresa = pCdMultiEmpresa) Contador
WHERE Hrc.tp_dia_semana = Contador.tp_dia_semana And Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sla
WHERE Sla.Cd_Sal_Cir = Hrc.Cd_Sal_Cir And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Sla.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa)) And Contador.Data Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999
GROUP BY To_Char(Contador.Data,'MM/YYYY')) ),0) Qtde_Hora_Instalada_Media ---QTDE HORAS UTILIZADA--- , Nvl(( SELECT Avg(Qtde_Horas_Media)
FROM ( SELECT To_Char(Avi.Dt_Realizacao,'MM/YYYY'),Trunc(Sum(Round(Avi.dt_saida_sal_cir-Avi.dt_realizacao,1))*24) Qtde_Horas_Media
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Avi.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Avi.Dt_Realizacao,'MM/YYYY')) ),0) Qtde_Hora_Utilizada_Media ---VALOR TOTAL PRODUZIDO INTERNO CONVENIO--- , Nvl(( SELECT Avg(Valor)
FROM ( SELECT To_Char(ItR.dt_lancamento,'MM/YYYY'), Sum(Itr.Vl_Total_Conta) Valor
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Reg.Cd_Reg_Fat = Itr.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And ItR.dt_lancamento Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa --- CENTRO CIRURGICO --- And Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Setor = Itr.Cd_Setor_Produziu)
GROUP BY To_Char(ItR.dt_lancamento,'MM/YYYY')) ),0) ---VALOR TOTAL PRODUZIDO EXTERNO CONVENIO--- + Nvl(( SELECT Avg(Valor)
FROM ( SELECT To_Char(ItR.Hr_Lancamento,'MM/YYYY'),Sum(Nvl(Itr.Vl_Total_Conta,0)) Valor
FROM Dbamv.ItReg_Amb Itr, Dbamv.Reg_Amb Reg
WHERE Itr.Cd_Convenio = Reg.Cd_Convenio And Itr.Cd_Reg_Amb = Reg.Cd_Reg_Amb And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And (Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And ItR.Hr_Lancamento Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa --- CENTRO CIRURGICO --- And Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Setor = Itr.Cd_Setor_Produziu)
GROUP BY To_Char(ItR.Hr_Lancamento,'MM/YYYY')) ),0) ---VALOR TOTAL PRODUZIDO INTERNADOS DE SUS--- + Nvl(( SELECT Avg(Valor)
FROM ( SELECT To_Char(Valor.Dt_Lancamento,'MM/YYYY'), Sum(Nvl(Valor.Vl_Sh_Proprio,0))+Sum(Nvl(Valor.Vl_Sp_Proprio,0)) Valor
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Dt_Lancamento Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Valor.Cd_Multi_Empresa = pCdMultiEmpresa --- CENTRO CIRURGICO --- And Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Setor = Valor.Cd_Setor_Produziu)
GROUP BY To_Char(Valor.Dt_Lancamento,'MM/YYYY')) ),0) ---VALOR TOTAL PRODUZIDO EXTERNAS SUS--- + Nvl(( SELECT Avg(Valor)
FROM ( SELECT To_Char(Valor.dt_eve_siasus,'MM/YYYY'),Sum(Nvl(vl_servico_ambulatorial,0)+Nvl(vl_servico_profissional,0)+Nvl(vl_servico_anestesia,0)) Valor
FROM Dbamv.Eve_SiaSus Valor
WHERE Valor.dt_eve_siasus Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Valor.Cd_Multi_Empresa = pCdMultiEmpresa --- CENTRO CIRURGICO --- And Exists ( SELECT 1
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Setor = Valor.Cd_Setor_Produziu)
GROUP BY To_Char(Valor.dt_eve_siasus,'MM/YYYY')) ),0) Vl_Produzido_Media
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_Multi_Empresa , Cta.Data_Mes ) Tax ) Inef ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00764
---------------------------------------------------------------------------
CURSOR cProcesso_00764(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. MÉDIO ENTREGA NO MÊS DA ALTA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC. MÉDIO ENTREGA NO MÊS DA ALTA, RESULTADO: '||Sum(Movimento.Vl_Perc_Entregue_Mes)||'%'||Chr(10)|| ' NR DE ALTAS MEDIA MÊS: '||Sum(Movimento.Nr_Altas_Mes_Media)||Chr(10)||' (Forecast)'||Chr(10)|| ' NR DE ENTREGAS MEDIA MÊS: '||Sum(Movimento.Nr_Entregue_Mes_Media)||Chr(10)||' (Forecast)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Sum(Movimento.Nr_Altas_Mes_Media) Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Nr_Entregue_Mes_Media) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Nr_Entregue_Mes_Media) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes ---NÃO É POSSIVEL ESTABELECER VALORES DIARIOS--- , Trunc(Mov.Nr_Altas_Mes_Media) Nr_Altas_Mes_Media , Trunc(Mov.Nr_Entregue_Mes_Media) Nr_Entregue_Mes_Media , (Case
WHEN Nvl(Trunc(Mov.Nr_Altas_Mes_Media),0) = 0
THEN 0
ELSE Round(Nvl(Trunc(Nr_Entregue_Mes_Media),0)/Nvl(Trunc(Mov.Nr_Altas_Mes_Media),0)*100,2)
END ) Vl_Perc_Entregue_Mes
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(( SELECT Avg(Qtde_Altas)
FROM ( SELECT To_Char(Reg.Dt_Final,'MM/YYYY'), Count(1) Qtde_Altas
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Reg.Dt_Final,'MM/YYYY')) ),0) Nr_Altas_Mes_Media , Nvl(( SELECT Avg(Qtde_Entregas)
FROM ( SELECT To_Char(Reg.Dt_Final,'MM/YYYY'), Count(1) Qtde_Entregas
FROM Dbamv.Reg_Fat Reg
WHERE Reg.Dt_Final Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura Rme, Dbamv.Fatura Fat
WHERE Rme.Cd_Remessa = Reg.Cd_Remessa And Rme.Cd_Fatura = Fat.Cd_Fatura And Fat.Cd_Multi_Empresa = pCdMultiEmpresa And Reg.Dt_Final Between Fat.Dt_Competencia And Last_Day(Fat.Dt_Competencia)+.9999 --- FILTRO POR DATA DE COMPETENCIA --- And (Rme.Dt_Entrega_Da_Fatura Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 Or Fat.Dt_Competencia Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999) )
GROUP BY To_Char(Reg.Dt_Final,'MM/YYYY')) ),0) Nr_Entregue_Mes_Media
FROM Dual ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00767
---------------------------------------------------------------------------
CURSOR cProcesso_00767(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00768
---------------------------------------------------------------------------
CURSOR cProcesso_00768(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00769
---------------------------------------------------------------------------
CURSOR cProcesso_00769(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00770
---------------------------------------------------------------------------
CURSOR cProcesso_00770(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00771
---------------------------------------------------------------------------
CURSOR cProcesso_00771(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00772
---------------------------------------------------------------------------
CURSOR cProcesso_00772(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'EFICIENCIA NA TAXA DE OCUPAÇÃO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'EFICIÊNCIA DO LEITO, QTDE DIÁRIA INSTALADA: '||Sum(Nvl(Movimento.Qtde_Instalada,0))||Chr(10) ||', QTDE DIÁRIA UTILIZADA: '||Sum(Nvl(Movimento.Qtde_Utilizada,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0))||'%'||Chr(10) ||', VALOR DA PRODUÇÃO DA UNIDADE: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Internado),0),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR DA OCIOSIDADE (PERDA): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_da_Ociosidade),0),'999G999G999G999D99')),'0,00')||Chr(10) ||', QTDE DIÁRIA INSTALADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Instalada_Dia,0))||Chr(10) ||', QTDE DIÁRIA UTILIZADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO NO DIA: '||Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0))||'%'||Chr(10) ||', VALOR DA PRODUÇÃO DA UNIDADE NO DIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Produzido_Internado_Dia),0),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR DA OCIOSIDADE (PERDA) NO DIA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_da_Ociosidade_Dia),0),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Utilizada,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Vl_Produzido_Internado , Mov.Vl_Produzido_Internado_Dia , Round((Mov.Vl_Produzido_Internado/100)*(100-Nvl(Mov.Vl_Taxa_Ocupacao,0)),2) Valor_da_Ociosidade , Round((Mov.Vl_Produzido_Internado_Dia/100)*(100-Nvl(Mov.Vl_Taxa_Ocupacao_Dia,0)),2) Valor_da_Ociosidade_Dia , Mov.Vl_Taxa_Ocupacao , Mov.Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(Mov.Qtde_Instalada,0) Qtde_Instalada , Nvl(Mov.Qtde_Instalada_Dia,0) Qtde_Instalada_Dia , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Vl_Produzido_Internado,0) Vl_Produzido_Internado , Nvl(Mov.Vl_Produzido_Internado,0)/30 Vl_Produzido_Internado_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_multi_Empresa = pCdMultiEmpresa And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Qtde_Utilizada , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 4 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Internacao , ( SELECT Count(Distinct Ate.Cd_Atendimento||Ate.Cd_Leito||Ate.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_multi_Empresa = pCdMultiEmpresa And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ) Qtde_Utilizada_Dia ---VALOR TOTAL PRODUZIDO INTERNADOS (SUS/CONVENIO/PARTICULAR)--- , ( SELECT Trunc(Avg(Dme.vl_pro_total_particul_interno+Dme.vl_pro_total_convenio_interno+Dme.vl_pro_total_sus_interno),2)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,0),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY'))+.99999 And Dme.Cd_Setor = Und.Cd_Setor And Dme.Cd_Multi_Empresa = pCdMultiEmpresa) Vl_Produzido_Internado
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00773
---------------------------------------------------------------------------
CURSOR cProcesso_00773(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR À RECEBER NO MÊS SUS (GLOBAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_a_receber),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('H','A')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_a_receber
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00774
---------------------------------------------------------------------------
CURSOR cProcesso_00774(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('H','A')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00775
---------------------------------------------------------------------------
CURSOR cProcesso_00775(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('H','A')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00776
---------------------------------------------------------------------------
CURSOR cProcesso_00776(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('H','A')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00777
---------------------------------------------------------------------------
CURSOR cProcesso_00777(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('H','A')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00778
---------------------------------------------------------------------------
CURSOR cProcesso_00778(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('H','A')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00779
---------------------------------------------------------------------------
CURSOR cProcesso_00779(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE DIFERENÇA DA VARIAÇÃO DA RECEITA VS DESPESA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo ,' RELATÓRIO ANOS: '||To_Char(Add_Months(v_Dt_Ini_Diagno,-1),'MM/YYYY')||' VS '||To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY')||Chr(10)|| ' PERC. DE DIFERNÇA DA VARIAÇÃO-RECEITA MÊS ATUAL (PROJETADA) VS DESPESAS MÊS ATUAL (PROJETADA): '||Trunc(Avg(Nvl(Movimento.Vl_Per_Dif_Variacao_Mes_Atual,0)),2)||'%'||Chr(10)|| ', VALOR DA PRODUÇÃO DO MÊS: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Prod_Mes_Atual),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA PRODUÇÃO DO MÊS (PROJETADA): '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Prod_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||'('||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Prod_Proj_Variacao_Per_Atu),0),'999G999G999G999D99')),'0,00')||'%)'||Chr(10)|| '. DETALHE DA PRODUÇÃO MÉDIA ANO:'||Chr(10)|| ' VALOR DA PRODUÇÃO MÉDIA ANO ATUAL: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Prod_Media_Ano_Atual),0),'999G999G999G999D99')),'0,00')||'('||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Prod_Media_Ano_Variacao_Per),0),'999G999G999G999D99')),'0,00')||'%)'||Chr(10)|| ', VALOR DA PRODUÇÃO MÉDIA ANO ANTERIOR: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Prod_Media_Ano_Anter),0),'999G999G999G999D99')),'0,00')||Chr(10)|| '. DETALHE DA DESPESA MÉDIA ANO:'||Chr(10)|| ', VALOR DA DESPESA DO MÊS: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Desp_Mes_Atual),0),'999G999G999G999D99')),'0,00')||Chr(10)|| ', VALOR DA DESPESA DO MÊS (PROJETADA): '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Desp_Mes_Atual_Proj),0),'999G999G999G999D99')),'0,00')||'('||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Desp_Proj_Variacao_Per_Atu),0),'999G999G999G999D99')),'0,00')||'%)'||Chr(10)|| ' VALOR DA DESPESA MÉDIA ANO ATUAL: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Desp_Media_Ano_Atual),0),'999G999G999G999D99')),'0,00')||'('||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Desp_Media_Ano_Variacao_Per),0),'999G999G999G999D99')),'0,00')||'%)'||Chr(10)|| ', VALOR DA DESPESA MÉDIA ANO ANTERIOR: '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Desp_Media_Ano_Anter),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Per_Dif_Variacao_Mes_Atual,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Per_Dif_Variacao_Mes_Atual,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes ---VALORES DA PRODUÇÃO/ANO(ATUAL/ANTERIOR)--- , Sum(Mov.Vl_Prod_Media_Ano_Anter) Vl_Prod_Media_Ano_Anter , Sum(Mov.Vl_Prod_Media_Ano_Atual) Vl_Prod_Media_Ano_Atual , Sum(Mov.Vl_Prod_Media_Ano_Atual)/To_Char(v_Dt_Fim_Diagno,'DD') Vl_Prod_Media_Ano_Atual_Dia , Sum(Mov.Vl_Prod_Media_Ano_Variacao) Vl_Prod_Media_Ano_Variacao , Avg(Mov.Vl_Prod_Media_Ano_Variacao_Per) Vl_Prod_Media_Ano_Variacao_Per ---VALORES DA DESPESA/ANO(ATUAL/ANTERIOR)--- , Sum(Mov.Vl_Desp_Media_Ano_Anter) Vl_Desp_Media_Ano_Anter , Sum(Mov.Vl_Desp_Media_Ano_Atual) Vl_Desp_Media_Ano_Atual , Sum(Mov.Vl_Desp_Media_Ano_Variacao) Vl_Desp_Media_Ano_Variacao , Avg(Mov.Vl_Desp_Media_Ano_Variacao_Per) Vl_Desp_Media_Ano_Variacao_Per , Avg(Vl_Desp_Proj_Variacao_Per_Atu) Vl_Desp_Proj_Variacao_Per_Atu ---VALORES DA PRODUÇÃO MÊS(CORRENBRE) , Sum(Mov.Vl_Prod_Mes_Atual) Vl_Prod_Mes_Atual , Sum(Mov.Vl_Desp_Mes_Atual) Vl_Desp_Mes_Atual , Sum(Mov.Vl_Desp_Mes_Atual_Proj) Vl_Desp_Mes_Atual_Proj , Sum(Mov.Vl_Prod_Mes_Atual_Proj) Vl_Prod_Mes_Atual_Proj , Sum(Mov.Vl_Prod_Mes_Atual_Proj_Varia) Vl_Prod_Mes_Atual_Proj_Varia , Avg(Mov.Vl_Prod_Proj_Variacao_Per_Atu) Vl_Prod_Proj_Variacao_Per_Atu , Avg(Mov.Vl_Prod_Proj_Variacao_Per_Ant) Vl_Prod_Proj_Variacao_Per_Ant ---PERC. DE DIFERNÇA DA VARIAÇÃO-RECEITA MÊS CORRENTE (PROJETADA) VS DESPESAS MÉDIA ANO--- , Sum(Mov.Vl_Prod_Proj_Variacao_Per_Atu)-Sum(Mov.Vl_Desp_Proj_Variacao_Per_Atu) Vl_Per_Dif_Variacao_Mes_Atual
FROM ( SELECT ---VALORES DA PRODUÇÃO/ANO(ATUAL/ANTERIOR)--- Nvl(Mov.Vl_Prod_Media_Ano_Anter,0) Vl_Prod_Media_Ano_Anter , Nvl(Mov.Vl_Prod_Media_Ano_Atual,0) Vl_Prod_Media_Ano_Atual , Nvl(Mov.Vl_Prod_Media_Ano_Variacao,0) Vl_Prod_Media_Ano_Variacao , Case
WHEN Nvl(Mov.Vl_Prod_Media_Ano_Anter,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Prod_Media_Ano_Atual,0)/Nvl(Mov.Vl_Prod_Media_Ano_Anter,0)*100,2)-100
END Vl_Prod_Media_Ano_Variacao_Per ---VALORES DA DESPESA/ANO(ATUAL/ANTERIOR)--- , Nvl(Mov.Vl_Desp_Media_Ano_Anter,0) Vl_Desp_Media_Ano_Anter , Nvl(Mov.Vl_Desp_Media_Ano_Atual,0) Vl_Desp_Media_Ano_Atual , Nvl(Mov.Vl_Desp_Media_Ano_Variacao,0) Vl_Desp_Media_Ano_Variacao , Case
WHEN Nvl(Mov.Vl_Desp_Media_Ano_Anter,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Desp_Media_Ano_Atual,0)/Nvl(Mov.Vl_Desp_Media_Ano_Anter,0)*100,2)-100
END Vl_Desp_Media_Ano_Variacao_Per , Case
WHEN Nvl(Mov.Vl_Desp_Mes_Atual_Proj,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Desp_Media_Ano_Atual,0)/Nvl(Mov.Vl_Desp_Mes_Atual_Proj,0)*100,2)-100
END Vl_Desp_Proj_Variacao_Per_Atu ---VALORES DA PRODUÇÃO MÊS(CORRENBRE) , Nvl(Mov.Vl_Prod_Mes_Atual,0) Vl_Prod_Mes_Atual , Nvl(Mov.Vl_Desp_Mes_Atual,0) Vl_Desp_Mes_Atual , Nvl(Mov.Vl_Prod_Mes_Atual_Proj,0) Vl_Prod_Mes_Atual_Proj , Nvl(Mov.Vl_Desp_Mes_Atual_Proj,0) Vl_Desp_Mes_Atual_Proj , Nvl(Mov.Vl_Prod_Mes_Atual_Proj,0)-Nvl(Vl_Prod_Media_Ano_Atual,0) Vl_Prod_Mes_Atual_Proj_Varia , Nvl(Mov.Vl_Desp_Mes_Atual_Proj,0)-Nvl(Vl_Desp_Media_Ano_Atual,0) Vl_Desp_Mes_Atual_Proj_Varia ---VALORES DA VARIAÇÃO DO MÊS CORRENTE COM O ANO ATUAL , Case
WHEN Nvl(Mov.Vl_Prod_Mes_Atual_Proj,0) = 0
THEN 0
ELSE 100-Trunc(Nvl(Mov.Vl_Prod_Media_Ano_Atual,0)/Nvl(Mov.Vl_Prod_Mes_Atual_Proj,0)*100,2)
END Vl_Prod_Proj_Variacao_Per_Atu ---VALORES DA VARIAÇÃO DO MÊS CORRENTE COM O ANO ANTERIOR , Case
WHEN Nvl(Mov.Vl_Desp_Media_Ano_Anter,0) = 0
THEN 0
ELSE 100-Trunc(Nvl(Mov.Vl_Desp_Media_Ano_Anter,0)-Nvl(Mov.Vl_Prod_Mes_Atual_Proj,0)*100,2)
END Vl_Prod_Proj_Variacao_Per_Ant
FROM ( SELECT Sum(Mov.Vl_Prod_Media_Ano_Anter) Vl_Prod_Media_Ano_Anter , Sum(Mov.Vl_Prod_Media_Ano_Atual) Vl_Prod_Media_Ano_Atual , Sum(Mov.Vl_Prod_Media_Ano_Atual)-Sum(Mov.Vl_Prod_Media_Ano_Anter) Vl_Prod_Media_Ano_Variacao , Sum(Mov.Vl_Desp_Media_Ano_Anter) Vl_Desp_Media_Ano_Anter , Sum(Mov.Vl_Desp_Media_Ano_Atual) Vl_Desp_Media_Ano_Atual , Sum(Mov.Vl_Desp_Media_Ano_Atual)-Sum(Mov.Vl_Desp_Media_Ano_Anter) Vl_Desp_Media_Ano_Variacao , Sum(Mov.Vl_Prod_Mes_Atual) Vl_Prod_Mes_Atual , Sum(Mov.Vl_Desp_Mes_Atual) Vl_Desp_Mes_Atual , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Vl_Prod_Mes_Atual),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Vl_Prod_Mes_Atual_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Vl_Desp_Mes_Atual),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Vl_Desp_Mes_Atual_Proj
FROM ( SELECT ---VALOR TOTAL PRODUZIDO: ANO ATUAL--- Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0))+Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0))+Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) + Sum(Nvl(Dme.vl_outras_receitas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date('01/01/'||To_Char(v_Dt_Ini_Diagno,'YYYY'),'DD/MM/YYYY') And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Prod_Media_Ano_Atual ---VALOR TOTAL PRODUZIDO: ANO ANTERIOR--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0))+Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0))+Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) + Sum(Nvl(Dme.vl_outras_receitas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date('01/01/'||To_Char(to_number(To_Char(v_Dt_Ini_Diagno,'YYYY'))-1),'DD/MM/YYYY') And To_Date('31/12/'||To_Char(to_number(To_Char(v_Dt_Fim_Diagno,'YYYY'))-1),'DD/MM/YYYY')+.99999
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Prod_Media_Ano_Anter ---VALOR TOTAL GASTO/DESPESAS ANO ATUAL--- , Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Total_Despesas,0)) Vl_Total_Despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date('01/01/'||To_Char(v_Dt_Ini_Diagno,'YYYY'),'DD/MM/YYYY') And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Desp_Media_Ano_Atual ---VALOR TOTAL GASTO/DESPESAS ANO ANTERIOR--- , Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Total_Despesas,0)) Vl_Total_Despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date('01/01/'||To_Char(to_number(To_Char(v_Dt_Ini_Diagno,'YYYY'))-1),'DD/MM/YYYY') And To_Date('31/12/'||To_Char(to_number(To_Char(v_Dt_Fim_Diagno,'YYYY'))-1),'DD/MM/YYYY')+.99999
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Desp_Media_Ano_Anter ---VALOR TOTAL PRODUZIDO: MES CORRENTE--- , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Interno,0))+Sum(Nvl(Dme.Vl_Pro_Total_Convenio_Externo,0)) + Sum(Nvl(Dme.Vl_Pro_Total_SUS_Interno,0))+Sum(Nvl(Dme.Vl_Pro_Total_SUS_Externo,0)) + Sum(Nvl(Dme.vl_outras_receitas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Prod_Mes_Atual , Nvl(( SELECT Trunc(Avg(Dme.Valor),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(vl_total_despesas,0)) Valor
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Desp_Mes_Atual
FROM Dual ) Mov ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00785
---------------------------------------------------------------------------
CURSOR cProcesso_00785(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Sal_Cir.Cd_Sal_Cir Cd_Departamento , Cen_Cir.Ds_Cen_Cir||'-'||Sal_Cir.Ds_Sal_Cir Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cen_Cir.Ds_Cen_Cir||', QTDE DE SALAS OPERACIONAL: '||Movimento.Qtde_Sala_Operacional ||', QTDE DE PAC. CIRURGICOS: '||Movimento.Qtde_Pac_Cirurgico ||', GIRO DE SALA CIRÚRGICA ATUAL: '||Movimento.Vl_Giro_Sala_Atual ||', QTDE DE PAC. CIRURGICOS PROJETADA: '||Movimento.Qtde_Pac_Projetada ||', GIRO DE SALA CIRÚRGICA PROJETADO: '||Movimento.Vl_Giro_Sala_Projetado Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Giro_Sala_Projetado Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Movimento.Vl_Giro_Sala_Atual Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Sal_Cir , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Sala_Operacional , Mov.Qtde_Pac_Cirurgico , Mov.Qtde_Pac_Projetada , (Case
WHEN Mov.Qtde_Sala_Operacional = 0
THEN 0
ELSE Round(Mov.Qtde_Pac_Cirurgico/Mov.Qtde_Sala_Operacional,2)
END ) Vl_Giro_Sala_Atual , (Case
WHEN Mov.Qtde_Sala_Operacional = 0
THEN 0
ELSE Round(Mov.Qtde_Pac_Projetada/Mov.Qtde_Sala_Operacional,2)
END ) Vl_Giro_Sala_Projetado
FROM ( SELECT Mov.Cd_Sal_Cir , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Sala_Operacional , Mov.Qtde_Pac_Cirurgico , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Pac_Cirurgico,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Pac_Projetada
FROM ( SELECT Sla.Cd_Sal_Cir , ( SELECT Count(1)
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Sal_Cir = Sla.Cd_Sal_Cir) Qtde_Sala_Operacional , ( SELECT Count(1)
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Sal_Cir = Sla.Cd_Sal_Cir) Qtde_Pac_Cirurgico
FROM Dbamv.Sal_Cir Sla
WHERE Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Sla.Cd_Setor = Setor.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa) --- SOMENTE SE EXISTIR PACIENTES NO MÊS --- And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Sal_Cir = Sla.Cd_Sal_Cir) ) Mov ) Mov ) Movimento , Dbamv.Cen_Cir , Dbamv.Sal_Cir , MvccAdmin.Estabelecimento
WHERE Sal_Cir.Cd_Sal_Cir = Movimento.Cd_Sal_Cir And Cen_Cir.Cd_Cen_Cir = Sal_Cir.Cd_Cen_Cir And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00787
---------------------------------------------------------------------------
CURSOR cProcesso_00787(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UNID. GERAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UNID. GERAL, QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia , Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao <> 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00788
---------------------------------------------------------------------------
CURSOR cProcesso_00788(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTIS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UTIS, QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Unid_Int = Lei.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00803
---------------------------------------------------------------------------
CURSOR cProcesso_00803(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Setor.Cd_Setor = Unid_Int.Cd_Setor And Setor.Cd_Multi_Empresa = Pcdmultiempresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00804
---------------------------------------------------------------------------
CURSOR cProcesso_00804(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'C' --CONVENIO And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00805
---------------------------------------------------------------------------
CURSOR cProcesso_00805(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00806
---------------------------------------------------------------------------
CURSOR cProcesso_00806(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'P' --PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00807
---------------------------------------------------------------------------
CURSOR cProcesso_00807(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' --SUS And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00808
---------------------------------------------------------------------------
CURSOR cProcesso_00808(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00809
---------------------------------------------------------------------------
CURSOR cProcesso_00809(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'C' --CONVENIO And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00810
---------------------------------------------------------------------------
CURSOR cProcesso_00810(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio IN ('C','P') --CONVENIO/PART And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00811
---------------------------------------------------------------------------
CURSOR cProcesso_00811(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'P' --PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa)
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00812
---------------------------------------------------------------------------
CURSOR cProcesso_00812(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'H' --SUS And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00813
---------------------------------------------------------------------------
CURSOR cProcesso_00813(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PACIENTE DIA REALIZADA: '||Movimento.Qtde_Realizada ||', QTDE PACIENTE DIA PROJETADA: '||Movimento.Qtde_Projetada ||' ,TAXA PACIENTE DIA: '||Movimento.Vl_Taxa_Conforme||'%' ||', QTDE PACIENTE DIA REALIZADA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PACIENTE DIA PROJETADA NO DIA: '||Movimento.Qtde_Projetada_Dia ||' ,TAXA PACIENTE DIA NO DIA: '||Movimento.Vl_Taxa_Conforme_Dia||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Movimento.Qtde_Instalada Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia , Movimento.Qtde_Instalada_dia Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia , Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0))*100,2)
END Vl_Taxa_Conforme , Case
WHEN Nvl(Mov.Qtde_Projetada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Realizada_Dia,0)/Nvl(Mov.Qtde_Projetada_Dia,0))*100,2)
END Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Nvl(Sum(Mov.Qtde_Realizada),0) Qtde_Realizada , Nvl(Sum(Mov.Qtde_Realizada_Dia),0) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada_Dia),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Sum(Case
WHEN Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 2 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 3 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN -1
WHEN Ate.Cd_Movimentacao = 4 And Ate.Dh_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN +1
WHEN Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
THEN -1
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Sum(Case
WHEN Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 2 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 3 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN -1
WHEN Ate.Cd_Movimentacao = 4 And Ate.Dh_Mov_Int Between Trunc(Sysdate) And Sysdate
THEN +1
WHEN Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN -1
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Not Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao <> 'U' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00814
---------------------------------------------------------------------------
CURSOR cProcesso_00814(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00815
---------------------------------------------------------------------------
CURSOR cProcesso_00815(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'C' --CONVENIO And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00816
---------------------------------------------------------------------------
CURSOR cProcesso_00816(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00817
---------------------------------------------------------------------------
CURSOR cProcesso_00817(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'P' --PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00818
---------------------------------------------------------------------------
CURSOR cProcesso_00818(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE PACIENTE-DIA DE UTI SUS GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'NÚMERO DE PACIENTE-DIA DE UTI SUS GLOBAL'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio = 'H' --SUS And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00819
---------------------------------------------------------------------------
CURSOR cProcesso_00819(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PACIENTE DIA REALIZADA: '||Sum(Nvl(Movimento.Qtde_Utilizada,0))||Chr(10) ||', QTDE PACIENTE DIA PROJETADA: '||Sum(Nvl(Movimento.Qtde_Projetada,0))||Chr(10) ||', QTDE PACIENTE DIA REALIZADA NO DIA: '||Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Utilizada,0)) Qtde_Conforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0)) Qtde_Conforme_Dia , Sum(Nvl(Movimento.Qtde_Instalada_dia,0)) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_multi_Empresa = pCdMultiEmpresa And Str.Cd_Setor = Und.Cd_Setor)
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00895
---------------------------------------------------------------------------
CURSOR cProcesso_00895(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Movimento.Cd_Departamento , Movimento.Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Movimento.Ds_Departamento||', VALOR DA TOTAL: '||Nvl(LTrim(To_Char(Movimento.vl_total_geral,'999G999G999G999D99')),'0,00') ||', VALOR DA PERDA: '||Nvl(LTrim(To_Char(Movimento.vl_perda,'999G999G999G999D99')),'0,00') ||', PERC. DA PERDA: '||Nvl(LTrim(To_Char(Movimento.vl_perc_valor_perda,'999G999G999G999D99')),'0,00')||'%' ||', QTDE CONTAS TOTAL: '||Movimento.Qtde_Conta_Total ||', QTDE CONTAS C/PERDA: '||Movimento.Qtde_Conta_perda ||', PERC. CONTA C/PERDA: '||Movimento.Vl_Perc_Conta_Perda Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'ITREG_FAT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.vl_perda Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.vl_perda Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , 1 Cd_Departamento , 'PERDA DE RECEITA SUS C/EXCESSO DE PERMANENCIA(f)' Ds_Departamento , Count(1) Qtde_Conta_Total , Sum(Case
WHEN Mov.Vl_Perda > 0
THEN 1
ELSE 0
END ) Qtde_Conta_Perda , Round((Sum(Case
WHEN Mov.Vl_Perda > 0
THEN 1
ELSE 0
END )/Count(1))*100,2) Vl_Perc_Conta_Perda , Sum(Mov.Vl_Conta)+Sum(Mov.Vl_Perda) Vl_Total_Geral , Sum(Mov.Vl_Perda) Vl_Perda , Sum(Mov.Vl_Conta) Vl_Conta , (Case
WHEN Sum(Mov.Vl_Conta+Mov.Vl_Perda) = 0
THEN 0
ELSE Round((Sum(Mov.Vl_Perda)/Sum(Mov.Vl_Conta+Mov.Vl_Perda))*100,2)
END ) Vl_Perc_Valor_Perda
FROM ( SELECT Perda.Cd_Multi_Empresa , Perda.Cd_Reg_Fat , Perda.cd_atendimento , Perda.cd_procedimento_realizado , Perda.ds_procedimento , Perda.cd_prestador_responsavel , Perda.dt_inicio , Perda.dt_final , Perda.Data_Mes , Perda.Vl_Conta , Perda.nr_permanencia_usado , Perda.nr_permanencia_previsto , Perda.nr_permanencia_diferenca , Perda.qt_lancamento_perm_maior , Perda.vl_lancamento_perm_a_maior , Perda.vl_servico_hospitalar , Perda.vl_servico_hosp_dia , (Case
WHEN Perda.Sn_Cirurgia_Multipla = 'S' Or Perda.Sn_Uti = 'S'
THEN 0
WHEN Perda.nr_permanencia_diferenca > 0
THEN Perda.vl_servico_hosp_dia*Perda.nr_permanencia_diferenca
ELSE 0
END ) Vl_Perda
FROM ( SELECT Conta.Cd_Multi_Empresa , Conta.Cd_Reg_Fat , Conta.cd_atendimento , Conta.cd_procedimento_realizado , Conta.ds_procedimento , Conta.cd_prestador_responsavel , Conta.dt_inicio , Conta.dt_final , Conta.Data_Mes , Conta.nr_permanencia_usado , Conta.nr_permanencia_previsto , Conta.Sn_Cirurgia_Multipla , Conta.Sn_Uti , Nvl((Case
WHEN Conta.nr_permanencia_usado > Conta.nr_permanencia_previsto
THEN (Conta.nr_permanencia_usado-Conta.nr_permanencia_previsto)
ELSE 0
END ),0) nr_permanencia_diferenca , Conta.qt_lancamento_perm_maior , Conta.vl_lancamento_perm_a_maior , Conta.vl_servico_hospitalar , (Case
WHEN Conta.nr_permanencia_previsto = 0
THEN Trunc(Conta.vl_servico_hospitalar/1,2)
ELSE Trunc(Conta.vl_servico_hospitalar/Conta.nr_permanencia_previsto)
END ) vl_servico_hosp_dia , Conta.Vl_Conta , 1 Qtde_Conta
FROM ( SELECT Valor.Cd_Multi_Empresa , Valor.Cd_Reg_Fat , Valor.Cd_Atendimento , Valor.cd_procedimento_realizado , ( SELECT Pro.Ds_procedimento
FROM Dbamv.Procedimento_Sus Pro
WHERE Pro.Cd_procedimento = Valor.cd_procedimento_realizado) ds_procedimento , Valor.Cd_Prestador_Responsavel , Valor.Dt_Inicio , Valor.Dt_Final , (Case
WHEN Valor.cd_procedimento_realizado = '0415010012'
THEN 'S'
ELSE 'N'
END ) Sn_Cirurgia_Multipla , Nvl(( SELECT Min('S')
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Tip.tp_acomodacao = 'U' And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Ate.Cd_leito = Lei.Cd_leito And Ate.Cd_Atendimento = Valor.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Valor.Dt_Lancamento Between Ate.Dt_Internado And Ate.Dt_Internado+.99999),'N') Sn_Uti , To_Char(Nvl(Valor.Dt_Final,v_Dt_Fim_Diagno),'MM/YYYY') Data_Mes , Round(Valor.Dt_Final-Valor.Dt_Inicio) Nr_Permanencia_Usado , ( SELECT Min(pDetal.nr_dias_internacao)
FROM dbamv.Procedimento_Detalhe_Vigencia pDetal
WHERE pDetal.Cd_Procedimento = Valor.cd_procedimento_realizado And pDetal.dt_vigencia = ( SELECT Max(pDetal2.dt_vigencia)
FROM dbamv.Procedimento_Detalhe_Vigencia pDetal2
WHERE pDetal2.Cd_Procedimento = pDetal.Cd_Procedimento) ) nr_permanencia_previsto , Sum(Case
WHEN Valor.cd_procedimento = '0802010199'
THEN Valor.Qt_Lancamento
ELSE 0
END ) Qt_Lancamento_Perm_Maior , Sum(Case
WHEN Valor.cd_procedimento = '0802010199'
THEN Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0)
ELSE 0
END ) Vl_Lancamento_Perm_a_Maior , Sum(Case
WHEN Valor.cd_procedimento = Valor.cd_procedimento_realizado
THEN Nvl(Valor.Vl_Sh_Proprio,0)
ELSE 0
END ) Vl_Servico_Hospitalar , Sum(Nvl(Valor.Vl_Sh_Proprio,0))+Sum(Nvl(Valor.Vl_Sp_Proprio,0)) Vl_Conta
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.nr_permanencia_previsto > Round(Sysdate-Valor.Dt_Inicio) And (Case
WHEN Valor.Dt_Final IS Null
THEN Sysdate
ELSE Valor.Dt_Final
END ) Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Valor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Valor.Cd_Multi_Empresa , Valor.Cd_Reg_Fat , Valor.Cd_Atendimento , Valor.Dt_Inicio , Valor.Dt_Final , Valor.cd_procedimento_realizado , Valor.Dt_Lancamento , Valor.Cd_Prestador_Responsavel , To_Char(Nvl(Valor.Dt_Final,v_Dt_Fim_Diagno),'MM/YYYY') ) Conta ) Perda ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00901
---------------------------------------------------------------------------
CURSOR cProcesso_00901(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'TAXA DE MORTALIDADE NA UTI' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'TAXA DE MORTALIDADE NA UTI, QTDE ALTAS DA UTI: '||Sum(Movimento.Qtde_Altas_Da_Uti) ||', QTDE DE OBITOS NA UTI: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) ||', TAXA DE MORTALIDADE NA UTI: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti,0))||'%' ||', QTDE ALTAS DA UTI DO DIA: '||Sum(Movimento.Qtde_Altas_Da_Uti_Dia) ||', QTDE DE OBITOS NA UTI NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) ||', TAXA DE MORTALIDADE NA UTI DO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas_Da_Uti) Qtde_Altas_Da_Uti , Sum(Mov.Qtde_Mortes_Na_Uti) Qtde_Mortes_Na_Uti , Sum(Mov.Qtde_Altas_Da_Uti_Dia) Qtde_Altas_Da_Uti_Dia , Sum(Mov.Qtde_Mortes_Na_Uti_Dia) Qtde_Mortes_Na_Uti_Dia , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti)/Sum(Mov.Qtde_Altas_Da_Uti))*100,2)
END ) Vl_Taxa_Mortes_Uti , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti_Dia)/Sum(Mov.Qtde_Altas_Da_Uti_Dia))*100,2)
END ) Vl_Taxa_Mortes_Uti_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00908
---------------------------------------------------------------------------
CURSOR cProcesso_00908(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Movimento.Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int|| ' QTDE DE MORTES NA UTI: '||Nvl(Movimento.Qtde_Obito_Uti,0)||Chr(10) ||', QTDE DE MORTES NA UTI <24H: '||Nvl(Movimento.Qtde_Obito_Uti_NaoConforme,0)||Chr(10) ||', TAXA DE MORTALIDADE NA UTI <24H: '||Nvl(Movimento.Vl_Taxa_Obito_Uti,0)||'%'||Chr(10) || ' QTDE DE MORTES NA UTI NO DIA: '||Nvl(Movimento.Qtde_Obito_Uti_Dia,0)||Chr(10) ||', QTDE DE MORTES NA UTI <24H NO DIA: '||Nvl(Movimento.Qtde_Obito_Uti_NaoConforme_Dia,0)||Chr(10) ||', TAXA DE MORTALIDADE NA UTI <24H NO DIA: '||Nvl(Movimento.Vl_Taxa_Obito_Uti_Dia,0)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Nvl(Movimento.Qtde_Obito_Uti_NaoConforme,0) Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Obito_Uti_NaoConforme,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Obito_Uti_NaoConforme_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Obito_Uti , Mov.Qtde_Obito_Uti_Dia , Mov.Qtde_Obito_Uti_NaoConforme , Mov.Qtde_Obito_Uti_NaoConforme_Dia , (Case
WHEN Mov.Qtde_Obito_Uti = 0
THEN 0
ELSE Round((Mov.Qtde_Obito_Uti_NaoConforme/Mov.Qtde_Obito_Uti)*100,2)
END ) Vl_Taxa_Obito_uti , (Case
WHEN Mov.Qtde_Obito_Uti_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Obito_Uti_NaoConforme_Dia/Mov.Qtde_Obito_Uti_Dia)*100,2)
END ) Vl_Taxa_Obito_Uti_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Mov.Qtde_Obito_Uti) Qtde_Obito_Uti , Sum(Mov.Qtde_Obito_Uti_Dia) Qtde_Obito_Uti_Dia , Sum(Mov.Qtde_Obito_Uti_NaoConforme) Qtde_Obito_Uti_NaoConforme , Sum(Mov.Qtde_Obito_Uti_NaoConforme_Dia) Qtde_Obito_Uti_NaoConforme_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_Dia ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And (Ate.dh_Lib_Mov-Ate.Dh_mov_Int) < MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Ate.Cd_Unid_Int,pNrCnpj,'SLA')/24/60 --MENOR QUE NUMERO DE HORAS And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_NaoConforme ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And (Ate.dh_Lib_Mov-Ate.Dh_mov_Int) < MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Ate.Cd_Unid_Int,pNrCnpj,'SLA')/24/60 --MENOR QUE NUMERO DE HORAS And Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_NaoConforme_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00929
---------------------------------------------------------------------------
CURSOR cProcesso_00929(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR À RECEBER NO MÊS CONV. (GLOBAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_a_receber),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'C') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_a_receber
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00939
---------------------------------------------------------------------------
CURSOR cProcesso_00939(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE DE REINTERNAÇÃO: '||Nvl(Movimento.Qtde_Reint_Uti,0)||Chr(10) ||', QTDE DE REINTERNAÇÃO <48H: '||Nvl(Movimento.Qtde_Reint_Uti_48h,0)||Chr(10) ||', TAXA DE REINTERNAÇÃO <48H: '||Nvl(Movimento.Vl_Taxa_Conforme,0)||'%'||Chr(10) ||', QTDE DE REINTERNAÇÃO NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_Dia,0)||Chr(10) ||', QTDE DE REINTERNAÇÃO <48H NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_48h_Dia,0)||Chr(10) ||', TAXA DE REINTERNAÇÃO <48H NO DIA: '||Nvl(Movimento.Vl_Taxa_Conforme_Dia,0)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Conforme,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Vl_Taxa_Conforme_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Sum(Mov.Qtde_Reint_Uti) Qtde_Reint_Uti , Sum(Mov.Qtde_Reint_Uti_Dia) Qtde_Reint_Uti_Dia , Sum(Mov.Qtde_Reint_Uti_48h) Qtde_Reint_Uti_48h , Sum(Mov.Qtde_Reint_Uti_48h_Dia) Qtde_Reint_Uti_48h_Dia , (Case
WHEN Sum(Mov.Qtde_Reint_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Reint_Uti_48h)/Sum(Mov.Qtde_Reint_Uti))*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Sum(Mov.Qtde_Reint_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Reint_Uti_48h_Dia)/Sum(Mov.Qtde_Reint_Uti_Dia))*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Reint_Uti , Mov.Qtde_Reint_Uti_Dia , Mov.Qtde_Reint_Uti_48h , Mov.Qtde_Reint_Uti_48h_Dia
FROM ( SELECT Und.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint , Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint
WHERE Ate_Reint.Cd_Movimentacao = 1 And Ate_Reint.cd_atendimento = Mov_Reint.cd_atendimento And Mov_Reint.Tp_Mov = 'I' And Mov_Reint.Cd_leito = Lei_Reint.Cd_Leito And Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta
WHERE Ate_Alta.Dt_Alta IS Not Null And Ate_Alta.Tp_Atendimento = 'I' And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Alta.Dt_Alta > v_Dt_Ini_Diagno-30 --Limite de 30 Dias And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Leito = Ate_Alta.Cd_Leito) ) ) Qtde_Reint_Uti , ( SELECT Sum(Case
WHEN Ate_Reint.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint , Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint
WHERE Ate_Reint.Cd_Movimentacao = 1 And Ate_Reint.cd_atendimento = Mov_Reint.cd_atendimento And Mov_Reint.Tp_Mov = 'I' And Mov_Reint.Cd_leito = Lei_Reint.Cd_Leito And Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta
WHERE Ate_Alta.Dt_Alta IS Not NULL And Ate_Alta.Tp_Atendimento = 'I' And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Alta.Dt_Alta > v_Dt_Ini_Diagno-30 --Limite de 30 Dias And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Leito = Ate_Alta.Cd_Leito) And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa) ) Qtde_Reint_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint , Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint
WHERE Ate_Reint.Cd_Movimentacao = 1 And Ate_Reint.cd_atendimento = Mov_Reint.cd_atendimento And Mov_Reint.Tp_Mov = 'I' And Mov_Reint.Cd_leito = Lei_Reint.Cd_Leito And Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta
WHERE Ate_Alta.Dt_Alta IS Not NULL And Ate_Alta.Tp_Atendimento = 'I' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Leito = Ate_Alta.Cd_Leito) And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Alta.Dt_Alta > v_Dt_Ini_Diagno-30 --Limite de 30 Dias And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And (Ate_Reint.Dh_Atendimento-To_Date(To_Char(Ate_Alta.Dt_Atendimento,'DD/MM/YYYY')||' '||To_Char(Ate_Alta.Hr_Atendimento,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 48 --HORAS And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa) ) Qtde_Reint_Uti_48h , ( SELECT Sum(Case
WHEN Ate_Reint.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END )
FROM MvccAdmin.Fato_Atendime_Internado Ate_Reint , Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint
WHERE Ate_Reint.Cd_Movimentacao = 1 And Ate_Reint.cd_atendimento = Mov_Reint.cd_atendimento And Mov_Reint.Tp_Mov = 'I' And Mov_Reint.Cd_leito = Lei_Reint.Cd_Leito And Ate_Reint.Dt_Internado = Trunc(Ate_Reint.Dh_Atendimento) And Ate_Reint.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Reint.Cd_Multi_Empresa = pCdMultiEmpresa And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Atendime Ate_Alta
WHERE Ate_Alta.Dt_Alta IS Not NULL And Ate_Alta.Tp_Atendimento = 'I' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Leito = Ate_Alta.Cd_Leito) And Ate_Alta.Cd_paciente = Ate_Reint.Cd_paciente And Ate_Alta.Dt_Alta > v_Dt_Ini_Diagno-30 --Limite de 30 Dias And Ate_Reint.Cd_Atendimento > Ate_Alta.Cd_Atendimento And (Ate_Reint.Dh_Atendimento-To_Date(To_Char(Ate_Alta.Dt_Atendimento,'DD/MM/YYYY')||' '||To_Char(Ate_Alta.Hr_Atendimento,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 48 --HORAS And Ate_Alta.Cd_Multi_Empresa = pCdMultiEmpresa) ) Qtde_Reint_Uti_48h_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.sn_ativo = 'S' AND Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Tp_Situacao = 'A' And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) ) Mov ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Data_Mes ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) AND Unid_Int.sn_ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Tp_Situacao = 'A' And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00945
---------------------------------------------------------------------------
CURSOR cProcesso_00945(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR CUSTO C/MAT. MED. (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR CUSTO C/MAT. MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_despesas_matmed),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR CUSTO C/MAT. MED. PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_despesas_matmed_prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_despesas_matmed,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_despesas_matmed,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_despesas_matmed,0) vl_despesas_matmed , Nvl(Mov.vl_despesas_matmed_prevista,0) vl_despesas_matmed_prevista , Case
WHEN Nvl(Mov.vl_despesas_matmed_prevista,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_despesas_matmed,0)/Nvl(Mov.vl_despesas_matmed_prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_despesas_matmed,0) vl_despesas_matmed , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_despesas_matmed_prevista
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_despesas_matmed),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Dme.vl_despesas_matmed) vl_despesas_matmed
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY') And Dme.vl_despesas_matmed > 0
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_despesas_matmed
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00947
---------------------------------------------------------------------------
CURSOR cProcesso_00947(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR CUSTO TOTAL (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR CUSTO TOTAL: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_despesas),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR CUSTO TOTAL PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_despesas_prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_total_despesas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_total_despesas,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_total_despesas,0) vl_total_despesas , Nvl(Mov.vl_total_despesas_prevista,0) vl_total_despesas_prevista , Case
WHEN Nvl(Mov.vl_total_despesas_prevista,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_total_despesas,0)/Nvl(Mov.vl_total_despesas_prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_total_despesas,0) vl_total_despesas , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_total_despesas_prevista
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Despesas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Dme.Vl_Total_Despesas) Vl_Total_Despesas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY') And Dme.Vl_Total_Despesas > 0
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Total_Despesas
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00948
---------------------------------------------------------------------------
CURSOR cProcesso_00948(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR DA RECEITA MAT/MED. (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR DA RECEITA MAT/MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_receita_mat_med),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR DA RECEITA MAT/MED. PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_receita_mat_med),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_receita_mat_med,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_receita_mat_med,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_receita_mat_med,0) vl_receita_mat_med , Nvl(Mov.vl_receita_mat_med_prevista,0) vl_receita_mat_med_prevista , Case
WHEN Nvl(Mov.vl_receita_mat_med_prevista,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.vl_receita_mat_med,0))/Nvl(Mov.vl_receita_mat_med_prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_receita_mat_med,0) vl_receita_mat_med , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_receita_mat_med_prevista
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_receita_mat_med),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_pro_matmed_convenio_interno,0)+Nvl(Dme.vl_pro_matmed_convenio_externo,0)+Nvl(Dme.vl_pro_matmed_particul_interno,0)+Nvl(Dme.vl_pro_matmed_particul_externo,0)+Nvl(Dme.vl_pro_matmed_sus_interno,0)+Nvl(Dme.vl_pro_matmed_sus_externo,0)) vl_receita_mat_med
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_receita_mat_med
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00949
---------------------------------------------------------------------------
CURSOR cProcesso_00949(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR ESTOQUE DE FATURAMENTO (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR ESTOQUE DE FATURAMENTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_estoque_faturamento),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR ESTOQUE DE FATURAMENTO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_estoque_faturam_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_estoque_faturamento,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_estoque_faturamento,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_estoque_faturamento,0) vl_estoque_faturamento , Nvl(Mov.vl_estoque_faturam_previsto,0) vl_estoque_faturam_previsto , Case
WHEN Nvl(Mov.vl_estoque_faturam_previsto,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.vl_estoque_faturamento,0))/Nvl(Mov.vl_estoque_faturam_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_estoque_faturamento,0) vl_estoque_faturamento , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_estoque_faturam_previsto
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_estoque_faturamento),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_estoque_conta_conv_interno,0)+Nvl(Dme.vl_estoque_conta_conv_externo,0)+Nvl(Dme.vl_estoque_conta_sus_interno,0)+Nvl(Dme.vl_estoque_conta_sus_externo,0)) vl_estoque_faturamento
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_estoque_faturamento
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00950
---------------------------------------------------------------------------
CURSOR cProcesso_00950(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR ESTOQUE MAT. MED. (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR ESTOQUE C/MAT. MED.: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_estoque_matmed),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR ESTOQUE C/MAT. MED. PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_estoque_matmed_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_estoque_matmed,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_estoque_matmed,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_estoque_matmed,0) vl_estoque_matmed , Nvl(Mov.vl_estoque_matmed_previsto,0) vl_estoque_matmed_previsto , Case
WHEN Nvl(Mov.vl_estoque_matmed_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_estoque_matmed,0)/Nvl(Mov.vl_estoque_matmed_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_estoque_matmed,0) vl_estoque_matmed , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_estoque_matmed_previsto
FROM ( SELECT --VALOR ESTOQUE MAT MED--- Nvl(( SELECT Trunc(Avg(Valor),2)
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Trunc(Sum(Dbamv.Verif_Vl_Custo_Medio(Valor.Cd_Produto,v_Dt_Ini_Diagno,'H',Null,v_Dt_Ini_Diagno+.99999,pCdMultiEmpresa)*Valor.Qt_Estoque_Atual),2) Valor
FROM ( SELECT Est.Cd_Produto , Sum(Est.Qt_Estoque_Atual) Qt_Estoque_Atual
FROM Dbamv.Est_Pro Est
WHERE Exists ( SELECT 1
FROM Dbamv.Estoque Eto
WHERE Est.Cd_Estoque = Eto.Cd_Estoque And Eto.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Sub_Clas Cla, Dbamv.Produto Prd
WHERE Cla.Cd_Especie = Prd.Cd_Especie And Cla.Cd_Classe = Prd.Cd_Classe And Cla.Cd_Sub_Cla = Prd.Cd_Sub_Cla And Cla.sn_saida_paciente = 'S' And Prd.tp_ativo = 'S' And Prd.Cd_Produto = Est.Cd_Produto) And Nvl(Est.qt_estoque_atual,0) > 0
GROUP BY Est.Cd_Produto ) Valor
GROUP BY To_Char(v_Dt_Ini_Diagno,'MM/YYYY') )),0) Vl_Estoque_MatMed
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00951
---------------------------------------------------------------------------
CURSOR cProcesso_00951(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR TOTAL DA RECEITA (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR TOTAL DA RECEITA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Receita),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR TOTAL OUTRAS RECEITAS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Outra_Receita),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR TOTAL GERAL DA RECEITA: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Geral_Receita),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR TOTAL PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Total_Receita_Prevista),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Total_Geral_Receita,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Total_Geral_Receita,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Vl_Total_Receita,0) Vl_Total_Receita , Nvl(Mov.Vl_Total_Outra_Receita,0) Vl_Total_Outra_Receita , Nvl(Mov.Vl_Total_Geral_Receita,0) Vl_Total_Geral_Receita , Nvl(Mov.Vl_Total_Receita_Prevista,0) Vl_Total_Receita_Prevista , Case
WHEN Nvl(Mov.Vl_Total_Receita_Prevista,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.Vl_Total_Geral_Receita,0)/Nvl(Mov.Vl_Total_Receita_Prevista,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.Vl_Total_Receita,0) Vl_Total_Receita , Nvl(Cta.Vl_Total_Outra_Receita,0) Vl_Total_Outra_Receita , Nvl(Cta.Vl_Total_Receita,0)+Nvl(Cta.Vl_Total_Outra_Receita,0) Vl_Total_Geral_Receita , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') Vl_Total_Receita_Prevista
FROM ( SELECT ---VALOR TOTAL RECEITA--- Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Receita),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_pro_total_convenio_interno,0)+Nvl(Dme.vl_pro_total_convenio_externo,0)+Nvl(Dme.vl_pro_total_particul_interno,0)+Nvl(Dme.vl_pro_total_particul_externo,0)+Nvl(Dme.vl_pro_total_sus_interno,0)+Nvl(Dme.vl_pro_total_sus_externo,0)) Vl_Total_Receita
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Total_Receita ---VALOR TOTAL OUTRA RECEITA--- , Nvl(( SELECT Trunc(Avg(Dme.Vl_Total_Outra_Receita),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_outras_receitas,0)) Vl_Total_Outra_Receita
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Vl_Total_Outra_Receita
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00952
---------------------------------------------------------------------------
CURSOR cProcesso_00952(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR TOTAL DE FATURAMENTO (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR TOTAL DE FATURAMENTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_faturamento),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR TOTAL DE FATURAMENTO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_faturamento_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_total_faturamento,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_total_faturamento,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_total_faturamento,0) vl_total_faturamento , Nvl(Mov.vl_total_faturamento_previsto,0) vl_total_faturamento_previsto , Case
WHEN Nvl(Mov.vl_total_faturamento_previsto,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.vl_total_faturamento,0))/Nvl(Mov.vl_total_faturamento_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_total_faturamento,0) vl_total_faturamento , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_total_faturamento_previsto
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_total_faturamento),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_fat_total_convenio_interno,0)+Nvl(Dme.vl_fat_total_convenio_externo,0)+Nvl(Dme.vl_fat_total_particul_interno,0)+Nvl(Dme.vl_fat_total_particul_externo,0)+Nvl(Dme.vl_fat_total_sus_interno,0)+Nvl(Dme.vl_fat_total_sus_externo,0)) vl_total_faturamento
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_total_faturamento
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00953
---------------------------------------------------------------------------
CURSOR cProcesso_00953(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR CUSTO FIXO MÉDIO MENSAL (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR TOTAL DO CUSTO FIXO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Despesas_Fixas),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR CUSTO FIXO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Valor_Despesas_Fixas_Previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Valor_Despesas_Fixas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Valor_Despesas_Fixas,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.Valor_Despesas_Fixas,0) Valor_Despesas_Fixas , Nvl(Mov.Valor_Despesas_Fixas_Previsto,0) Valor_Despesas_Fixas_Previsto , Case
WHEN Nvl(Mov.Valor_Despesas_Fixas_Previsto,0) = 0
THEN 0
ELSE Trunc((Nvl(Mov.Valor_Despesas_Fixas,0))/Nvl(Mov.Valor_Despesas_Fixas_Previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.Valor_despesas_fixas,0) Valor_Despesas_Fixas , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') Valor_Despesas_Fixas_Previsto
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.Valor_despesas_fixas),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_despesas_fixas,0)) Valor_despesas_fixas
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) Valor_despesas_fixas
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00954
---------------------------------------------------------------------------
CURSOR cProcesso_00954(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR TOTAL RECEBIMENTO (MEDIA MENSAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR TOTAL DE RECEBIMENTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_recebimentos),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'VALOR TOTAL DE RECEBIMENTO PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_total_recebimentos_previsto),0),'999G999G999G999D99')),'0,00')||' (Média Mensal)'||Chr(10)|| 'PERC. ALCANÇADO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.Vl_Taxa_Conforme),0),'999G999G999G999D99')),'0,00')||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'PROCESSO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.vl_total_recebimentos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.vl_total_recebimentos,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_total_recebimentos,0) vl_total_recebimentos , Nvl(Mov.vl_total_recebimentos_previsto,0) vl_total_recebimentos_previsto , Case
WHEN Nvl(Mov.vl_total_recebimentos_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_total_recebimentos,0)/Nvl(Mov.vl_total_recebimentos_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Cta.vl_total_recebimentos,0) vl_total_recebimentos , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_total_recebimentos_previsto
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_total_recebimentos),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_total_recebimentos,0)) vl_total_recebimentos
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-13),'MM/YYYY'),'MM/YYYY') And To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,-1),'MM/YYYY'),'MM/YYYY')
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_total_recebimentos
FROM Dual ) Cta ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00955
---------------------------------------------------------------------------
CURSOR cProcesso_00955(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR À RECEBER NO MÊS (GLOBAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_a_receber),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_a_receber
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00956
---------------------------------------------------------------------------
CURSOR cProcesso_00956(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'C' --CONVENIO And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00957
---------------------------------------------------------------------------
CURSOR cProcesso_00957(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'C' --CONVENIO And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00958
---------------------------------------------------------------------------
CURSOR cProcesso_00958(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'C' --CONVENIO And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00959
---------------------------------------------------------------------------
CURSOR cProcesso_00959(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00960
---------------------------------------------------------------------------
CURSOR cProcesso_00960(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00961
---------------------------------------------------------------------------
CURSOR cProcesso_00961(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00962
---------------------------------------------------------------------------
CURSOR cProcesso_00962(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'P' --PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00963
---------------------------------------------------------------------------
CURSOR cProcesso_00963(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'P' --PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00964
---------------------------------------------------------------------------
CURSOR cProcesso_00964(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'P' --PARTICULAR And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00965
---------------------------------------------------------------------------
CURSOR cProcesso_00965(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00966
---------------------------------------------------------------------------
CURSOR cProcesso_00966(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00967
---------------------------------------------------------------------------
CURSOR cProcesso_00967(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00968
---------------------------------------------------------------------------
CURSOR cProcesso_00968(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE ALTAS DA UTI: '||Sum(Movimento.Qtde_Altas_Da_Uti) ||', QTDE DE OBITOS NA UTI: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) ||', TAXA DE MORTALIDADE NA UTI: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti,0))||'%' ||', QTDE ALTAS DA UTI DO DIA: '||Sum(Movimento.Qtde_Altas_Da_Uti_Dia) ||', QTDE DE OBITOS NA UTI NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) ||', TAXA DE MORTALIDADE NA UTI DO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas_Da_Uti) Qtde_Altas_Da_Uti , Sum(Mov.Qtde_Mortes_Na_Uti) Qtde_Mortes_Na_Uti , Sum(Mov.Qtde_Altas_Da_Uti_Dia) Qtde_Altas_Da_Uti_Dia , Sum(Mov.Qtde_Mortes_Na_Uti_Dia) Qtde_Mortes_Na_Uti_Dia , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti)/Sum(Mov.Qtde_Altas_Da_Uti))*100,2)
END ) Vl_Taxa_Mortes_Uti , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti_Dia)/Sum(Mov.Qtde_Altas_Da_Uti_Dia))*100,2)
END ) Vl_Taxa_Mortes_Uti_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00969
---------------------------------------------------------------------------
CURSOR cProcesso_00969(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE ALTAS DA UTI: '||Sum(Movimento.Qtde_Altas_Da_Uti) ||', QTDE DE OBITOS NA UTI: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) ||', TAXA DE MORTALIDADE NA UTI: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti,0))||'%' ||', QTDE ALTAS DA UTI DO DIA: '||Sum(Movimento.Qtde_Altas_Da_Uti_Dia) ||', QTDE DE OBITOS NA UTI NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) ||', TAXA DE MORTALIDADE NA UTI DO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas_Da_Uti) Qtde_Altas_Da_Uti , Sum(Mov.Qtde_Mortes_Na_Uti) Qtde_Mortes_Na_Uti , Sum(Mov.Qtde_Altas_Da_Uti_Dia) Qtde_Altas_Da_Uti_Dia , Sum(Mov.Qtde_Mortes_Na_Uti_Dia) Qtde_Mortes_Na_Uti_Dia , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti)/Sum(Mov.Qtde_Altas_Da_Uti))*100,2)
END ) Vl_Taxa_Mortes_Uti , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti_Dia)/Sum(Mov.Qtde_Altas_Da_Uti_Dia))*100,2)
END ) Vl_Taxa_Mortes_Uti_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00970
---------------------------------------------------------------------------
CURSOR cProcesso_00970(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE ALTAS DA UTI: '||Sum(Movimento.Qtde_Altas_Da_Uti) ||', QTDE DE OBITOS NA UTI: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) ||', TAXA DE MORTALIDADE NA UTI: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti,0))||'%' ||', QTDE ALTAS DA UTI DO DIA: '||Sum(Movimento.Qtde_Altas_Da_Uti_Dia) ||', QTDE DE OBITOS NA UTI NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) ||', TAXA DE MORTALIDADE NA UTI DO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas_Da_Uti) Qtde_Altas_Da_Uti , Sum(Mov.Qtde_Mortes_Na_Uti) Qtde_Mortes_Na_Uti , Sum(Mov.Qtde_Altas_Da_Uti_Dia) Qtde_Altas_Da_Uti_Dia , Sum(Mov.Qtde_Mortes_Na_Uti_Dia) Qtde_Mortes_Na_Uti_Dia , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti)/Sum(Mov.Qtde_Altas_Da_Uti))*100,2)
END ) Vl_Taxa_Mortes_Uti , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti_Dia)/Sum(Mov.Qtde_Altas_Da_Uti_Dia))*100,2)
END ) Vl_Taxa_Mortes_Uti_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00971
---------------------------------------------------------------------------
CURSOR cProcesso_00971(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE OBITO/MORTALIDADE NÃO INSTITUCIONAL <24H' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERC. DE OBITO/MORTALIDADE NÃO INSTITUCIONAL <24H, QTDE DE ALTAS: '||Sum(Movimento.Qtde_Altas) ||', QTDE DE OBITOS: '||Sum(Nvl(Movimento.Qtde_Mortes,0)) ||', TAXA DE MORTALIDADE: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes,0))||'%' ||', QTDE DE ALTAS DO DIA: '||Sum(Movimento.Qtde_Altas_Dia) ||', QTDE DE OBITOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)) ||', TAXA DE MORTALIDADE NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Mortes,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , Mov.Qtde_Mortes , Mov.Qtde_Altas , Mov.Qtde_Mortes_Dia , Mov.Qtde_Altas_Dia , (Case
WHEN Mov.Qtde_Altas = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes/Mov.Qtde_Altas)*100,2)
END ) Vl_Taxa_Mortes , (Case
WHEN Mov.Qtde_Altas_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Taxa_Mortes_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Qtde_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 <= 24 --MENOR OU IGUAL A 24 HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Qtde_Mortes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ),0) Qtde_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 <= 24 --MENOR OU IGUAL A 24 HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ),0) Qtde_Mortes_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00972
---------------------------------------------------------------------------
CURSOR cProcesso_00972(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE OBITO/MORTALIDADE GLOBAIS (TODOS)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERC. DE OBITO/MORTALIDADE GLOBAIS (TODOS), QTDE DE ALTAS: '||Sum(Movimento.Qtde_Altas) ||', QTDE DE OBITOS: '||Sum(Nvl(Movimento.Qtde_Mortes,0)) ||', TAXA DE MORTALIDADE: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes,0))||'%' ||', QTDE DE ALTAS DO DIA: '||Sum(Movimento.Qtde_Altas_Dia) ||', QTDE DE OBITOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)) ||', TAXA DE MORTALIDADE NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Mortes,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , Mov.Qtde_Mortes , Mov.Qtde_Altas , Mov.Qtde_Mortes_Dia , Mov.Qtde_Altas_Dia , (Case
WHEN Mov.Qtde_Altas = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes/Mov.Qtde_Altas)*100,2)
END ) Vl_Taxa_Mortes , (Case
WHEN Mov.Qtde_Altas_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Taxa_Mortes_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Qtde_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Qtde_Mortes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ),0) Qtde_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ),0) Qtde_Mortes_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00973
---------------------------------------------------------------------------
CURSOR cProcesso_00973(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE OBITOS/MORTES INSTITUCIONAL (>24H)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE OBITOS/MORTES INSTITUCIONAL (>24H), QTDE DE ALTAS: '||Sum(Movimento.Qtde_Altas) ||', QTDE DE OBITOS: '||Sum(Nvl(Movimento.Qtde_Mortes,0)) ||', TAXA DE MORTALIDADE: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes,0))||'%' ||', QTDE DE ALTAS DO DIA: '||Sum(Movimento.Qtde_Altas_Dia) ||', QTDE DE OBITOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)) ||', TAXA DE MORTALIDADE NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Sum(Nvl(Movimento.Qtde_Mortes,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , Mov.Qtde_Mortes , Mov.Qtde_Altas , Mov.Qtde_Mortes_Dia , Mov.Qtde_Altas_Dia , (Case
WHEN Mov.Qtde_Altas = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes/Mov.Qtde_Altas)*100,2)
END ) Vl_Taxa_Mortes , (Case
WHEN Mov.Qtde_Altas_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Taxa_Mortes_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Qtde_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 > 24 --MAIS DE HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Qtde_Mortes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ),0) Qtde_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 > 24 --MAIS DE HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ),0) Qtde_Mortes_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00974
---------------------------------------------------------------------------
CURSOR cProcesso_00974(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTIS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UTIS, QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00975
---------------------------------------------------------------------------
CURSOR cProcesso_00975(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTIS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UTIS, QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00976
---------------------------------------------------------------------------
CURSOR cProcesso_00976(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'OCUPACAO GLOBAL UTIS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'OCUPACAO GLOBAL UTIS, QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00977
---------------------------------------------------------------------------
CURSOR cProcesso_00977(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00978
---------------------------------------------------------------------------
CURSOR cProcesso_00978(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00979
---------------------------------------------------------------------------
CURSOR cProcesso_00979(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'C' --CONVENIO And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00980
---------------------------------------------------------------------------
CURSOR cProcesso_00980(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV./PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio In ('C','P') --CONVENIO E PARTICULAR) And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00981
---------------------------------------------------------------------------
CURSOR cProcesso_00981(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV./PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio In ('C','P') --CONVENIO E PARTICULAR) And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00982
---------------------------------------------------------------------------
CURSOR cProcesso_00982(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL CONV./PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio In ('C','P') --CONVENIO E PARTICULAR) And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00983
---------------------------------------------------------------------------
CURSOR cProcesso_00983(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00984
---------------------------------------------------------------------------
CURSOR cProcesso_00984(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00985
---------------------------------------------------------------------------
CURSOR cProcesso_00985(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL PART.'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'P' --PARTICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00986
---------------------------------------------------------------------------
CURSOR cProcesso_00986(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL SUS'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00987
---------------------------------------------------------------------------
CURSOR cProcesso_00987(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL SUS'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00988
---------------------------------------------------------------------------
CURSOR cProcesso_00988(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPACAO GLOBAL SUS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPACAO GLOBAL SUS'||', QTDE INSTALADA (DIARIA): '||Trunc(Sum(Movimento.Qtde_Instalada),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||'%'||Chr(10) ||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_Dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Trunc(Sum(Nvl(Movimento.Qtde_Instalada,0)),2) Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao,0)),2) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Ocupacao_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Con.Tp_Convenio = 'H' --SUS And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00989
---------------------------------------------------------------------------
CURSOR cProcesso_00989(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00990
---------------------------------------------------------------------------
CURSOR cProcesso_00990(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00991
---------------------------------------------------------------------------
CURSOR cProcesso_00991(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||' SENDO: '||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||', DEMAIS DESPESAS: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Demais),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , Mov.Valor_Custo_Demais , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total)-Sum(Mov.Valor_Custo_Pessoal)-Sum(Mov.Valor_Custo_MatMed)-Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Demais
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00992
---------------------------------------------------------------------------
CURSOR cProcesso_00992(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO CONV., VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES INTERNADOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA(F) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Tip_Acom.Cd_Tip_Acom = Leito.Cd_Tip_Acom And Tip_Acom.Tp_Acomodacao = 'U' And Unid_Int.Cd_Setor = Setor.Cd_setor) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00993
---------------------------------------------------------------------------
CURSOR cProcesso_00993(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO CONV., VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES INTERNADOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA(F) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Tip_Acom.Cd_Tip_Acom = Leito.Cd_Tip_Acom And Tip_Acom.Tp_Acomodacao = 'U' And Unid_Int.Cd_Setor = Setor.Cd_setor) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00994
---------------------------------------------------------------------------
CURSOR cProcesso_00994(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO CONV., VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES INTERNADOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA(F) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Tip_Acom.Cd_Tip_Acom = Leito.Cd_Tip_Acom And Tip_Acom.Tp_Acomodacao = 'U' And Unid_Int.Cd_Setor = Setor.Cd_setor) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00997
---------------------------------------------------------------------------
CURSOR cProcesso_00997(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ENTRADAS NO BLOCO CIR. INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE ENTRADAS NO BLOCO CIR. INSTITUCIONAL'||', NO MÊS: '||Movimento.Qtde_Conforme ||', NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Entradas) Qtde_Conforme , Sum(Mov.Qtde_Entradas_Dia) Qtde_Conforme_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Rpa.Dt_Centro_Cirurgico,'MM/YYYY') Data_Mes , 1 Qtde_Entradas , (Case
WHEN Rpa.Dt_Centro_Cirurgico Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Entradas_Dia
FROM dbamv.Mov_Cc_Rpa Rpa , Dbamv.Aviso_Cirurgia Avi , Dbamv.Age_Cir Age
WHERE Avi.Cd_Aviso_Cirurgia = Rpa.Cd_Aviso_Cirurgia(+) And Avi.Cd_Aviso_Cirurgia = Age.Cd_Aviso_Cirurgia And Avi.Tp_Situacao <> 'C' And Avi.Cd_Mot_Canc IS Null And Rpa.Dt_Centro_Cirurgico Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00998
---------------------------------------------------------------------------
CURSOR cProcesso_00998(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAIDAS DE BLOCO CIR. INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAIDAS DE BLOCO CIR. INSTITUCIONAL'||', NO MÊS: '||Movimento.Qtde_Conforme ||', NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Saidas) Qtde_Conforme , Sum(Mov.Qtde_Saidas_Dia) Qtde_Conforme_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Rpa.Dt_Saida_Rpa,'MM/YYYY') Data_Mes , 1 Qtde_Saidas , (Case
WHEN Rpa.Dt_Saida_Rpa Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Saidas_Dia
FROM Dbamv.Mov_Cc_Rpa Rpa , Dbamv.Aviso_Cirurgia Avi , Dbamv.Age_Cir Age
WHERE Avi.Cd_Aviso_Cirurgia = Rpa.Cd_Aviso_Cirurgia And Rpa.Cd_Aviso_Cirurgia = Age.Cd_Aviso_Cirurgia And Avi.Tp_Situacao <> 'C' And Rpa.Dt_Centro_Cirurgico IS Not Null --Entrou No Bloco And Avi.Cd_Mot_Canc IS Null And Rpa.Dt_Saida_Rpa Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_00999
---------------------------------------------------------------------------
CURSOR cProcesso_00999(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%' ||', QTDE INSTALADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Instalada_Dia) ||', QTDE UTILIZADA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01000
---------------------------------------------------------------------------
CURSOR cProcesso_01000(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE RENOVAÇÃO DE LEITO (GIRO)-INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'GIRO DE LEITO INSTITUCIONAL'||', QTDE DE LEITOS OPERACIONAL: '||Trunc(Sum(Movimento.Qtde_Leitos),2)||Chr(10) ||', QTDE DE SAÍDAS ATUAL: '||Trunc(Sum(Movimento.Qtde_Saidas),2)||Chr(10) ||', GIRO DE LEITO ATUAL: '||Trunc(Avg(Movimento.Vl_Renovacao_Leito),2)||Chr(10) ||', QTDE DE LEITOS OPERACIONAL NO DIA: '||Trunc(Sum(Movimento.Qtde_Leitos_Dia),2)||Chr(10) ||', QTDE DE SAÍDAS NO DIA: '||Trunc(Sum(Movimento.Qtde_Saidas_Dia),2)||Chr(10) ||', GIRO DE LEITO DO DIA: '||Trunc(Avg(Movimento.Vl_Renovacao_Leito_Dia),2) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Renovacao_Leito),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Renovacao_Leito_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Leitos , Mov.Qtde_Saidas , Mov.Qtde_Leitos_Dia , Mov.Qtde_Saidas_Dia , (Case
WHEN Mov.Qtde_Leitos = 0
THEN 0
ELSE Round(Mov.Qtde_Saidas/Mov.Qtde_Leitos,2)
END ) Vl_Renovacao_Leito , (Case
WHEN Mov.Qtde_Leitos_Dia = 0
THEN 0
ELSE Round(Mov.Qtde_Saidas_Dia/Mov.Qtde_Leitos_Dia,2)
END ) Vl_Renovacao_Leito_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Leitos , Mov.Qtde_Saidas , Mov.Qtde_Leitos_Dia , Mov.Qtde_Saidas_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0)/To_Number(To_Char(v_Dt_Atual_Diagno,'DD')) Qtde_Leitos , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Leitos_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Saidas , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Saidas_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa )
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01001
---------------------------------------------------------------------------
CURSOR cProcesso_01001(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES-- SELECT Mov.Cd_Setor_Produziu Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DO SUS--- SELECT Valor.Cd_Setor_Produziu , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01002
---------------------------------------------------------------------------
CURSOR cProcesso_01002(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES-- SELECT Mov.Cd_Setor_Produziu Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DO SUS--- SELECT Valor.Cd_Setor_Produziu , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01003
---------------------------------------------------------------------------
CURSOR cProcesso_01003(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES-- SELECT Mov.Cd_Setor_Produziu Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DO SUS--- SELECT Valor.Cd_Setor_Produziu , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01010
---------------------------------------------------------------------------
CURSOR cProcesso_01010(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE FATURAMENTO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_Produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01011
---------------------------------------------------------------------------
CURSOR cProcesso_01011(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE FATURAMENTO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_Produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01012
---------------------------------------------------------------------------
CURSOR cProcesso_01012(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE FATURAMENTO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_Produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01013
---------------------------------------------------------------------------
CURSOR cProcesso_01013(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01014
---------------------------------------------------------------------------
CURSOR cProcesso_01014(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01015
---------------------------------------------------------------------------
CURSOR cProcesso_01015(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01016
---------------------------------------------------------------------------
CURSOR cProcesso_01016(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01017
---------------------------------------------------------------------------
CURSOR cProcesso_01017(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01018
---------------------------------------------------------------------------
CURSOR cProcesso_01018(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01019
---------------------------------------------------------------------------
CURSOR cProcesso_01019(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01020
---------------------------------------------------------------------------
CURSOR cProcesso_01020(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01021
---------------------------------------------------------------------------
CURSOR cProcesso_01021(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01022
---------------------------------------------------------------------------
CURSOR cProcesso_01022(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01023
---------------------------------------------------------------------------
CURSOR cProcesso_01023(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01024
---------------------------------------------------------------------------
CURSOR cProcesso_01024(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01025
---------------------------------------------------------------------------
CURSOR cProcesso_01025(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01026
---------------------------------------------------------------------------
CURSOR cProcesso_01026(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01027
---------------------------------------------------------------------------
CURSOR cProcesso_01027(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01028
---------------------------------------------------------------------------
CURSOR cProcesso_01028(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01029
---------------------------------------------------------------------------
CURSOR cProcesso_01029(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01030
---------------------------------------------------------------------------
CURSOR cProcesso_01030(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01031
---------------------------------------------------------------------------
CURSOR cProcesso_01031(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01032
---------------------------------------------------------------------------
CURSOR cProcesso_01032(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01064
---------------------------------------------------------------------------
CURSOR cProcesso_01064(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Unid_Int , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 --- DOCUMENTO ELETRÔNICO INDICANDO O CUIDADO PALIATIVO--- And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.Cd_Atendimento = Ate.Cd_Atendimento And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Ate.Cd_Unid_Int , To_Char(Ate.Dt_Internado,'MM/YYYY') ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01065
---------------------------------------------------------------------------
CURSOR cProcesso_01065(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Unid_Int , To_Char(Ate.Dt_Internado,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 --- DOCUMENTO ELETRÔNICO INDICANDO O CUIDADO PALIATIVO--- And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.Cd_Atendimento = Ate.Cd_Atendimento And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Ate.Cd_Unid_Int , To_Char(Ate.Dt_Internado,'MM/YYYY') ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01068
---------------------------------------------------------------------------
CURSOR cProcesso_01068(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', TEMPO MÉDIO: '||Movimento.Hr_Tempo_Conforme ||', TEMPO MÉDIO DO DIA: '||Movimento.Hr_Tempo_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLIC_LIMPEZA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tempo_Conforme Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tempo_Conforme Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Data_Mes , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme,'N',MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Unid_Int,pNrCnpj,'SLN')) Vl_Tempo_Conforme , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme_Dia,'N',MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Unid_Int,pNrCnpj,'SLN')) Vl_Tempo_Conforme_Dia , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme,'C') Hr_Tempo_Conforme , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme_Dia,'C') Hr_Tempo_Conforme_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Avg((Ate.Dh_Inicio_Limpeza-Ate.Dh_Alta)*24*60) Vl_Tempo_Conforme , Avg((Ate.Dh_Inicio_Limpeza-Ate.Dh_Alta)*24*60) Vl_Tempo_Conforme_Dia
FROM ( SELECT Slc.Cd_Multi_Empresa , Slc.Cd_Solic_Limpeza , Ate.Cd_Mot_Alt , Ate.Cd_Unid_Int , Ate.Dh_Alta , (Case
WHEN Slc.Dt_Solic_Limpeza IS Null
THEN Null
ELSE To_Date(To_Char(Slc.Dt_Solic_Limpeza,'DD/MM/YYYY')||' '||To_Char(Slc.Hr_Solic_Limpeza,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')
END ) Dh_Solic_Limpeza , (Case
WHEN Slc.Dt_Realizado IS Null
THEN Null
ELSE To_Date(To_Char(Slc.dt_inicio_higieniza,'DD/MM/YYYY')||' '||To_Char(Slc.hr_inicio_higieniza,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')
END ) Dh_Inicio_Limpeza
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Solic_Limpeza Slc
WHERE Ate.Cd_Movimentacao = 1 And Ate.cd_atendimento = Slc.Cd_Atendimento And Ate.Cd_leito = Slc.Cd_leito And Slc.Dt_Cancelamento IS Null And Slc.Tp_Solicitacao in ('A','T') --ALTA HOSPITALAR OU TRANFERENCIA And Slc.Dt_Inicio_Higieniza IS Not Null And Slc.Dt_Solic_Limpeza IS Not Null And Ate.Dt_Internado = ( SELECT Max(Ate_Max.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Max
WHERE Ate_Max.Cd_Movimentacao = 1 And Ate_Max.Cd_Atendimento = Ate.Cd_Atendimento And Ate_Max.Cd_Multi_Empresa = pCdMultiEmpresa) And Slc.Dt_Realizado Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Slc.cd_multi_empresa = pCdMultiEmpresa --- TIPO DE LIMPEZA DE LEITO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Slc.Cd_Tipo_Limpeza And Vcc.Cd_Tipo_Campo_Chave = 45 --TIPO DE LIMPEZA DE LEITO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- MOTIVOS DE ALTA CONSIDERADOS --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVOS DE ALTA CONSIDERADOS And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Ate
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int(+) And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Setor.Cd_Setor = Unid_Int.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiempresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01104
---------------------------------------------------------------------------
CURSOR cProcesso_01104(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE ALTAS DA UTI: '||Sum(Movimento.Qtde_Altas_Da_Uti) ||', QTDE DE OBITOS NA UTI: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) ||', TAXA DE MORTALIDADE NA UTI: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti,0))||'%' ||', QTDE ALTAS DA UTI DO DIA: '||Sum(Movimento.Qtde_Altas_Da_Uti_Dia) ||', QTDE DE OBITOS NA UTI NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) ||', TAXA DE MORTALIDADE NA UTI DO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas_Da_Uti) Qtde_Altas_Da_Uti , Sum(Mov.Qtde_Mortes_Na_Uti) Qtde_Mortes_Na_Uti , Sum(Mov.Qtde_Altas_Da_Uti_Dia) Qtde_Altas_Da_Uti_Dia , Sum(Mov.Qtde_Mortes_Na_Uti_Dia) Qtde_Mortes_Na_Uti_Dia , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti)/Sum(Mov.Qtde_Altas_Da_Uti))*100,2)
END ) Vl_Taxa_Mortes_Uti , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti_Dia)/Sum(Mov.Qtde_Altas_Da_Uti_Dia))*100,2)
END ) Vl_Taxa_Mortes_Uti_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01107
---------------------------------------------------------------------------
CURSOR cProcesso_01107(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U') And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01108
---------------------------------------------------------------------------
CURSOR cProcesso_01108(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01109
---------------------------------------------------------------------------
CURSOR cProcesso_01109(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01110
---------------------------------------------------------------------------
CURSOR cProcesso_01110(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01111
---------------------------------------------------------------------------
CURSOR cProcesso_01111(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01112
---------------------------------------------------------------------------
CURSOR cProcesso_01112(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') Data_Mes , Count(1) Qtde_Realizada , Sum(Case
WHEN Pre.Dt_Pre_Med Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Pre.Fl_Impresso = 'S' And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Pre.Cd_Documento_Clinico And Pdc.Tp_Status In ('FECHADO','ASSINADO')) --- ITEM DE PRESCRICAO A SER CONTADO --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO A SER CONTADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Pre.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Itp.Tp_Situacao = 'N' And Pre.Dt_Pre_Med Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Pre.Cd_Unid_Int , To_Char(Pre.Dt_Pre_Med,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01113
---------------------------------------------------------------------------
CURSOR cProcesso_01113(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA (DIARIA): '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio IN ('C','P') And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U') And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01115
---------------------------------------------------------------------------
CURSOR cProcesso_01115(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO CONV., VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--CONTAS DE INTERNADOS CONVENIO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') data_mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Projetado_Dia
FROM (---VALORES INTERNADOS--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE ENTREGA (e) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Reg.Sn_Fechada = 'S' And Reg.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL --VALORES DE INTERNACAO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor, Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Exists ( SELECT 1
FROM Dbamv.Convenio
WHERE Convenio.Cd_Convenio = Reg.Cd_Convenio And Convenio.Tp_Convenio = 'C') And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO PO DATA DE FECHAMENTO DA REMESSA(F) --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Unid_Int.Cd_Unid_Int = Leito.Cd_Unid_Int And Tip_Acom.Cd_Tip_Acom = Leito.Cd_Tip_Acom And Tip_Acom.Tp_Acomodacao = 'U' And Unid_Int.Cd_Setor = Setor.Cd_setor) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01116
---------------------------------------------------------------------------
CURSOR cProcesso_01116(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE OCUPAÇÃO DO BLOCO CIR. INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC DE OCUPAÇÃO DO BLOCO CIR. INSTITUCIONAL, NO MÊS: '||Movimento.Vl_Taxa_Ocupacao ||', NO DIA: '||Movimento.Vl_Taxa_Ocupacao_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Ocupacao Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Ocupacao_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Vl_Taxa_Ocupacao , Mov.Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , (Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END ) Vl_Taxa_Ocupacao , (Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END ) Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Nvl(Mov.Qtde_Sala_Disponiveis,0) Qtde_Instalada , Nvl(Mov.Qtde_Sala_Disponiveis,0) Qtde_Instalada_Dia , Sum(1) Qtde_Utilizada , Sum(Case
WHEN Mov.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Dt_Realizacao Dt_Realizacao , ( SELECT Count(1)
FROM Dbamv.Sal_Cir Sal
WHERE Sal.Cd_Cen_Cir = Avi.Cd_Cen_Cir)*To_Number(To_Char(Sysdate,'HH24')) Qtde_Sala_Disponiveis
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Avi.Cd_Sal_Cir And Vcc.Cd_Tipo_Campo_Chave = 133 --SALA DE CIRURGIA DESCOSIDERADA And (Vcc.Cd_Departamento = Avi.Cd_Sal_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Avi.Dt_Realizacao Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Nvl(Mov.Qtde_Sala_Disponiveis,0) ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01118
---------------------------------------------------------------------------
CURSOR cProcesso_01118(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Faturado),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Projetado),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Faturado) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Faturado) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES-- SELECT Mov.Cd_Setor_Produziu Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DO SUS--- SELECT Valor.Cd_Setor_Produziu , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor_Produziu ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor(+) And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Unid_Int, Dbamv.Leito, Dbamv.Tip_Acom
WHERE Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Cd_Unid_int = Leito.Cd_Unid_int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa And Setor.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01121
---------------------------------------------------------------------------
CURSOR cProcesso_01121(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Setor.Nm_Setor||', VALOR FATURADO TOTAL: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Faturado,0)),'999G999G999G999D99')),'0,00') ||', VALOR PROJETADO: '||Nvl(LTrim(To_Char(Sum(Nvl(Movimento.Valor_Projetado,0)),'999G999G999G999D99')),'0,00') Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Valor_Faturado,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--VALORES DE FATURAMENTO-- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Valor_Faturado) Valor_Faturado , Sum(Mov.Valor_Faturado)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Faturado_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Valor_Faturado),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Projetado
FROM (---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Fatura.Dt_Competencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'C' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE COMPETENCIA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.Dt_Entrega_Da_Fatura Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'E' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' --- FILTRO POR NOTA FISCAL EMITIDA--- And Exists ( SELECT 1
FROM Dbamv.Nota_Fiscal Nfc
WHERE Nfc.Dt_Cancelamento_Efetivo IS Null And Nfc.Cd_Reg_Fat = Reg.Cd_Reg_Fat And Nfc.Dt_Emissao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'N' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO CONVENIO--- SELECT Itr.Cd_Setor_Produziu Cd_Setor , Itr.Vl_Total_Conta Valor_Faturado
FROM Dbamv.ItReg_Fat Itr, Dbamv.Reg_Fat Reg
WHERE Itr.Cd_Reg_Fat = Reg.Cd_Reg_Fat And (Itr.Sn_Pertence_Pacote = 'N' Or Itr.Sn_Pertence_Pacote IS Null) And ( Itr.Tp_Pagamento <> 'C' Or Itr.Tp_Pagamento IS Null) And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Itr.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Reg.Sn_Fechada = 'S' And Exists ( SELECT 1
FROM Dbamv.Remessa_Fatura, Dbamv.Fatura
WHERE Remessa_Fatura.Cd_Remessa = Reg.Cd_Remessa And Remessa_Fatura.Cd_Fatura = Fatura.Cd_Fatura --- FILTRO POR DATA DE FECHAMENTO DA REMESSA --- And Fatura.Cd_Multi_Empresa = pCdMultiEmpresa And Remessa_Fatura.dt_fechamento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ---TIPO DO FATURAMENTO DO CONVENIO--- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = 'F' And Vcc.Cd_Tipo_Campo_Chave = 76 ---TIPO DO FATURAMENTO DO CONVENIO--- And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
UNION ALL ---VALORES DE INTERNACAO SUS--- SELECT Valor.Cd_Setor_Produziu Cd_Setor , Nvl(Valor.Vl_Sh_Proprio,0)+Nvl(Valor.Vl_Sp_Proprio,0) Valor_Faturado
FROM MvccAdmin.v_Valores_Aih Valor
WHERE Valor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Valor.Cd_Setor_Produziu And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Valor.Sn_Fechada = 'S' And Valor.Dt_Final Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Setor ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Leito, Dbamv.Unid_Int, Dbamv.Tip_Acom
WHERE Leito.Cd_Unid_Int = Unid_Int.Cd_Unid_Int And Unid_Int.Cd_Setor = Setor.Cd_Setor And Leito.Cd_Tip_Acom = Tip_Acom.Cd_Tip_Acom And Unid_Int.Sn_Ativo = 'S' And Tip_Acom.Tp_Acomodacao = 'U') And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01122
---------------------------------------------------------------------------
CURSOR cProcesso_01122(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Setor.Nm_Setor||', VALOR CUSTO OPERACIONAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo),'999G999G999G999D99')),'0,00')||Chr(10) ||' PROJETADOS: '||Chr(10) ||', VALOR CUSTO OPERACIONAL (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Total_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/PESSOAL (PROJETADO): '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Pessoal_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO C/MAT. MED (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_MatMed_Proj),'999G999G999G999D99')),'0,00')||Chr(10) ||', VALOR CUSTO FIXO (PROJETADO: '||Nvl(LTrim(To_Char(Sum(Movimento.Valor_Custo_Fixo_Proj),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , NuLL Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Valor_Custo_Total_proj) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Valor_Custo_Total_proj_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Valor_Custo_Pessoal , Mov.Valor_Custo_MatMed , Mov.Valor_Custo_Fixo , Mov.Valor_Custo_Total , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Pessoal,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Pessoal_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_MatMed,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_MatMed_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Fixo,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Fixo_Proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Valor_Custo_Total_proj , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Valor_Custo_Total,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Valor_Custo_Total_proj_Dia
FROM ( SELECT Mov.Cd_Setor , Sum(Mov.Valor_Custo_Pessoal) Valor_Custo_Pessoal , Sum(Mov.Valor_Custo_MatMed) Valor_Custo_MatMed , Sum(Mov.Valor_Custo_Fixo) Valor_Custo_Fixo , Sum(Mov.Valor_Custo_Total) Valor_Custo_Total
FROM (--VALOR DAS DESPESAS OPERACIONAIS DAS UNIDADES-- SELECT Setor.Cd_Setor , Nvl(( SELECT Sum(Dme.vl_despesas_matmed)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_MatMed , Nvl(( SELECT Sum(Dme.vl_total_despesas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Total , Nvl(( SELECT Sum(Dme.vl_despesas_pessoal)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Pessoal , Nvl(( SELECT Sum(Dme.vl_despesas_fixas)
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Dme.Cd_Setor = Setor.Cd_Setor And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Valor_Custo_Fixo
FROM Dbamv.Setor
WHERE Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip, Dbamv.Unid_Int Und
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.tp_acomodacao = 'U' And Und.Cd_Setor = Setor.Cd_Setor) And Setor.Sn_Ativo = 'S' ) Mov
GROUP BY Mov.Cd_Setor ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01129
---------------------------------------------------------------------------
CURSOR cProcesso_01129(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||', TEMPO MÉDIO DE FECHAMENTO DA CONTA: '||Movimento.Hr_Tempo_Conforme Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , 1 Qtde_Naoconforme , Null Qtde_Instalada , 'REG_FAT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tempo_Conforme Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tempo_Conforme Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Ori_Ate , Mov.Data_Mes , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme,'N',MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Ori_Ate,pNrCnpj,'SLN')) Vl_Tempo_Conforme , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme_Dia,'N',MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Ori_Ate,pNrCnpj,'SLN')) Vl_Tempo_Conforme_Dia , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme,'C') Hr_Tempo_Conforme , MvccAdmin.Converte_Minutos_Em_Hhmm(Mov.Vl_Tempo_Conforme_Dia,'C') Hr_Tempo_Conforme_Dia
FROM ( SELECT Cta.Cd_Ori_Ate , To_Char(Cta.Dt_Fechamento,'MM/YYYY') Data_Mes , Avg((Cta.Dt_Fechamento-Cta.Dt_Final)*24*60) Vl_Tempo_Conforme , Avg((Cta.Dt_Fechamento-Cta.Dt_Final)*24*60) Vl_Tempo_Conforme_Dia
FROM ( SELECT ( SELECT Min(Ate.Cd_Ori_Ate)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Reg.Cd_Atendimento) Cd_Ori_Ate , Reg.cd_atendimento , Reg.cd_reg_fat , Reg.Dt_Fechamento , Reg.Dt_Final , (Case
WHEN Reg.Dt_Fechamento Between Trunc(Sysdate) And Sysdate
THEN Reg.Dt_Fechamento
ELSE Null
END ) Dt_Fechamento_Dia
FROM Dbamv.Reg_Fat Reg
WHERE Exists ( SELECT 1
FROM dbamv.convenio Con
WHERE Con.Cd_convenio = Reg.Cd_convenio and con.tp_convenio = 'H') And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Reg.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Reg.Dt_Fechamento Between To_Date(To_Char(Add_Months(v_Dt_Ini_Diagno,-1),'MM/YYYY'),'MM/YYYY') And Last_Day(To_Date(To_Char(Add_Months(v_Dt_Fim_Diagno,0),'MM/YYYY'),'MM/YYYY')) And Reg.Cd_Multi_Empresa = pCdMultiEmpresa ) Cta
GROUP BY Cta.Cd_Ori_Ate , To_Char(Cta.Dt_Fechamento,'MM/YYYY') ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01145
---------------------------------------------------------------------------
CURSOR cProcesso_01145(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Departamento.Cd_Departamento , Departamento.Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Departamento.Ds_Departamento||Chr(10)||', QTDE ESPERANDO LEITO NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_departamento , Sum(Mov.Qtde_Conforme) Qtde_Conforme , Sum(Mov.Qtde_Conforme_Dia) Qtde_Conforme_Dia
FROM (---PACIENTES EXTERNOS, ACAMADOS EM ESPERA DE LEITO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_departamento , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Atendimento , Ate.Dh_Atendimento , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Conforme , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 98 --CONSIDERAR OU NÃO PACIENTES COM TERAPIAS (PRESCRIÇÃO) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Sn_Paciente_Terapia , (Case
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 Between 0 And 30
THEN 30
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 Between 30 And 60
THEN 60
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 Between 61 And 120
THEN 120
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 > 120
THEN 121
END ) Cd_Departamento
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS Null And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa And (Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc, MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = 466 --PROCESSO DE BOARDING INTERNAÇÃO-DOC. ELETRONICO And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.Cd_Atendimento = Ate.Cd_Atendimento) or Exists ( SELECT 1
FROM Dbamv.Tiss_Sol_Guia Sol
WHERE Sol.Nm_Xml = 'solicitacaoInternacao' And Sol.Cd_Atendimento = Ate.Cd_Atendimento) or Exists ( SELECT 1
FROM Dbamv.Laudo_Aih Lau
WHERE Lau.Cd_Atendimento = Ate.Cd_Atendimento) or Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre, Dbamv.ItPre_Med Itp, MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = 1008 --PROCESSO DE BOARDING INTERNAÇÃO-ITEM DE PRESCRIÇÃO And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRIÇÃO A SER CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = 3 Or Vcc.Cd_Departamento IS Null) And Itp.Tp_Situacao = 'N' And Pre.Fl_Impresso = 'S' And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Pre.Cd_Atendimento = Ate.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) ) Mov
WHERE (Mov.Sn_Paciente_Terapia = 'S' And Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp , MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO CONSIDERADO And Mov.Dh_Atendimento Between Pre.Dt_Pre_Med And Pre.Dt_Pre_Med+.99999 And Pre.fl_impresso = 'S' And Pre.Cd_Atendimento = Mov.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) OR Mov.Sn_Paciente_Terapia = 'N')
UNION ALL ---PACIENTES INTERNADOS, EM UNIDADE VIRTUAL, A ESPERA DE LEITO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_departamento , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Conforme , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , (Case
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 Between 0 And 30
THEN 30
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 Between 30 And 60
THEN 60
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 Between 61 And 120
THEN 120
WHEN (Sysdate-Ate.Dh_Atendimento)*24*60 > 120
THEN 121
END ) Cd_Departamento
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Dt_Internado In ( SELECT Max(Ate_Max.Dt_Internado)
FROM MvccAdmin.Fato_Atendime_Internado Ate_Max
WHERE Ate_Max.Cd_Atendimento = Ate.Cd_Atendimento And Ate_Max.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 15 --UNIDADE DE INTERNAÇÃO CONSIDERADA And Vcc.Cd_campo_chave = Ate.Cd_Unid_Int And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa
UNION ALL SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 146 --LEITOS CONSIDERADOS And Vcc.Cd_campo_chave = Ate.Cd_Leito And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_departamento ) Movimento , ( SELECT 30 Cd_Departamento, 'AGUARDANDO - ATÉ 30 MINUTOS' Ds_Departamento
FROM Dual
UNION ALL SELECT 60 Cd_Departamento, 'AGUARDANDO - DE 31 A 60 MINUTOS' Ds_Departamento
FROM Dual
UNION ALL SELECT 120 Cd_Departamento, 'AGUARDANDO - DE 61 A 120 MINUTOS' Ds_Departamento
FROM Dual
UNION ALL SELECT 121 Cd_Departamento, 'AGUARDANDO - A MAIS DE DUAS HORAS' Ds_Departamento
FROM DuaL) Departamento , MvccAdmin.Estabelecimento
WHERE Departamento.Cd_Departamento = Movimento.Cd_Departamento And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01146
---------------------------------------------------------------------------
CURSOR cProcesso_01146(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Hora.Cd_Hora Cd_Departamento , Hora.Ds_Hora Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Hora.Ds_Hora||', PERC. DE OCUPAÇÃO: '||Movimento.Vl_Taxa_Ocupacao ||', PERC. DE OCUPAÇÃO NO DIA: '||Movimento.Vl_Taxa_Ocupacao_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Ocupacao Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Ocupacao_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Hora , SubStr(Mov.Cd_Hora,2,0) Ds_Data , To_Char(V_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , (Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Utilizada/Mov.Qtde_Instalada)*100,2)
END ) Vl_Taxa_Ocupacao , (Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Utilizada_Dia/Mov.Qtde_Instalada_Dia)*100,2)
END ) Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Hora , Mov.Cd_Unid_Int , Avg(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Cd_Hora , Mov.Dt_Data , Count(1) Qtde_Utilizada , Sum(Case
WHEN Mov.Dt_Data Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM ( SELECT Lei.Cd_Unid_Int , Trunc(Ate.Dh_Atendimento) Dt_Data , To_Number(To_Char(Ate.Dh_Atendimento,'HH24')) Cd_Data , 1 Qtde_Utilizada , ( SELECT (Case
WHEN 0 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 0
WHEN 1 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 1
WHEN 2 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 2
WHEN 3 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 3
WHEN 4 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 4
WHEN 5 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 5
WHEN 6 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 6
WHEN 7 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 7
WHEN 8 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 8
WHEN 9 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 9
WHEN 10 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 10
WHEN 11 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 11
WHEN 12 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 12
WHEN 13 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 13
WHEN 14 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 14
WHEN 15 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 15
WHEN 16 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 16
WHEN 17 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 17
WHEN 18 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 18
WHEN 19 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 19
WHEN 20 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 20
WHEN 21 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 21
WHEN 22 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 22
WHEN 23 Between To_Number(To_Char(Mov.Hr_Mov_Int,'HH24')) And To_Number(To_Char(Mov.Hr_lib_Mov,'HH24'))
THEN 23
ELSE To_Number(To_Char(Ate.Dh_Atendimento,'HH24'))
END )
FROM Dbamv.Mov_Int Mov
WHERE Mov.Cd_Atendimento = Ate.Cd_Atendimento ) Cd_Hora
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ate.Cd_leito = Lei.Cd_leito And Ate.Tp_Atendimento = 'U' And Ate.Dh_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.cd_multi_empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Cd_Hora , Mov.Dt_Data ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Cd_Hora ) Mov ) Movimento , ( SELECT Level-1 Cd_Hora, ' AS '||LPad(Level-1,2,0)||' HORA' Ds_Hora
FROM Sys.Dual Connect By Level <= 24) Hora , MvccAdmin.Estabelecimento
WHERE Hora.Cd_Hora = Movimento.Cd_Hora And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01147
---------------------------------------------------------------------------
CURSOR cProcesso_01147(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Unid_Int.Ds_Unid_Int||', QTDE INSTALADA (DIARIA): '||Sum(Movimento.Qtde_Instalada)||Chr(10) ||', QTDE UTILIZADA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', TAXA DE OCUPAÇÃO: '||Avg(Movimento.Vl_Taxa_Ocupacao)||'%'||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Avg(Movimento.Vl_Taxa_Ocupacao_Dia)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Instalada) Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Taxa_Ocupacao) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Taxa_Ocupacao_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Case
WHEN Nvl(Mov.Qtde_Instalada,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada,0)/Nvl(Mov.Qtde_Instalada,0))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Nvl(Mov.Qtde_Instalada_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Utilizada_Dia,0)/Nvl(Mov.Qtde_Instalada_Dia,0))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Utilizada , MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str, Dbamv.Convenio Con
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Und.Cd_Unid_Int) And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTOICULAR And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY mov.Cd_Unid_int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01149
---------------------------------------------------------------------------
CURSOR cProcesso_01149(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTES ACAMADOS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE PACIENTES ACAMADOS'||', QTDE TOTAL: '||Movimento.Qtde_Total ||', QTDE TOTAL DIA: '||Movimento.Qtde_Total_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Total Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Total_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTIO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Total , Mov.Qtde_Total_Dia
FROM (---TOTAL DE PACIENTES ACAMADOS NA URGENCIA--- SELECT Sum(Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia , Count(1) Qtde_Total
FROM ( SELECT Ate.Cd_Atendimento , Ate.Dh_Atendimento , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 98 --CONSIDERAR OU NÃO PACIENTES COM TERAPIAS (PRESCRIÇÃO) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Sn_Paciente_Terapia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS NULL --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa ) Mov
WHERE (Mov.Sn_Paciente_Terapia = 'S' And Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp , MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO CONSIDERADO And Mov.Dh_Atendimento Between Pre.Dt_Pre_Med And Pre.Dt_Pre_Med+.99999 And Pre.fl_impresso = 'S' And Pre.Cd_Atendimento = Mov.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) OR Mov.Sn_Paciente_Terapia = 'N') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01150
---------------------------------------------------------------------------
CURSOR cProcesso_01150(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||Chr(10)||', QTDE. ATENDIDO FORA DO SLA: '||Movimento.Qtde_Atend_Fora_Sla||Chr(10) ||', QTDE. ATENDIDO FORA DO SLA NO DIA: '||Movimento.Qtde_Atend_Fora_Sla_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Atend_Fora_Sla Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Atend_Fora_Sla_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Ori_Ate , Mov.Data_Mes , Sum(Mov.Qtde_Atend_Fora_Sla) Qtde_Atend_Fora_Sla , Sum(Mov.Qtde_Atend_Fora_Sla_Dia) Qtde_Atend_Fora_Sla_Dia
FROM ( SELECT Mov.Cd_Ori_Ate , To_Char(Mov.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Atend_Fora_Sla , (Case
WHEN Mov.Dh_Pre_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Atend_Fora_Sla_Dia
FROM ( SELECT Ate.Cd_Ori_Ate , Ta.Dh_Pre_Atendimento , ( SELECT Min(Nvl(Stp_H.dh_processo,Stp.dh_processo))
FROM Dbamv.Sacr_Tempo_Processo Stp, Dbamv.Sacr_Tempo_Processo_Historico Stp_H
WHERE Stp_H.cd_atendimento(+) = Stp.cd_atendimento And Stp_H.cd_triagem_atendimento(+) = Stp.cd_triagem_atendimento And Stp_H.cd_tipo_tempo_processo(+) = Stp.cd_tipo_tempo_processo And Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo = Nvl(vChaveFimProcesso,30)) Dh_Processo_Fim --CHAMADA PARA ATENDIMENTO MEDICO OU CONFIGURACAO , Ta.Dh_Pre_Atendimento+(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA')/24/60) Dh_Atendimento
FROM Dbamv.Triagem_Atendimento ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Removido IS Null And Ta.cd_cor_referencia IS Not Null And Ta.Dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
WHERE Mov.Dh_Processo_Fim > Mov.Dh_Atendimento ) Mov
GROUP BY Mov.Data_Mes , Mov.Cd_Ori_Ate ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01151
---------------------------------------------------------------------------
CURSOR cProcesso_01151(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE DE ABANDONOS: '||Movimento.Qtde_Abandonos||Chr(10) ||', TAXA DE ABANDONOS: '||Movimento.Vl_Taxa_Abandono||'%'||Chr(10) ||', QTDE DE ABANDONOS NO DIA: '||Movimento.Qtde_Abandonos_Dia||Chr(10) ||', TAXA DE ABANDONOS NO DIA: '||Movimento.Vl_Taxa_Abandono_Dia||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Abandonos Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Abandonos_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia , Sum(Mov.Qtde_Abandono) Qtde_Abandonos , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandonos_Dia , (Case
WHEN Sum(Mov.qtde_total) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono)/Sum(Mov.qtde_total))*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Sum(Mov.qtde_total_dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono_Dia)/Sum(Mov.qtde_total_dia))*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , To_Char(Mov.Dh_Abandono,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Abandono) Qtde_Abandono , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandono_Dia , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia
FROM (---QTDE TOTAL DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---EVASÃO DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Tip_Res And Vcc.Cd_Tipo_Campo_Chave = 134 --TIPO DE RESULTADO CONSIDERADO EVASAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE SENHAS--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS NULL And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---REMOÇÃO DE SENHA/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS Null And Ta.Dh_Removido IS Not Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , To_Char(Mov.Dh_Abandono,'MM/YYYY') ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01152
---------------------------------------------------------------------------
CURSOR cProcesso_01152(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Movimento.Cd_Departamento , Movimento.Ds_Departamento , Movimento.Data_Mes , Null Nm_Processo , Movimento.Ds_Departamento||', QTDE AGUARDANDO: '||Movimento.Qtde_Conforme Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Mov.Cd_Departamento , Mov.Ds_Departamento , Sum(Qtde_Aguard_Classificacao)+Sum(Qtde_Aguard_Cadastro)+Sum(Qtde_Aguard_Atend_Medico) Qtde_Conforme
FROM ( SELECT Mov.Data_Mes , Mov.Cd_Departamento , Mov.Ds_Departamento , Mov.Qtde_Aguard_Classificacao , Mov.Qtde_Aguard_Cadastro , Mov.Qtde_Aguard_Atend_Medico
FROM (---TRIAGEM--- SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , 1000 Cd_Departamento , 'TRIAGEM' Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139--FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ta.cd_cor_referencia = Cr.cd_cor_referencia(+) And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS Null And Ta.Cd_Atendimento IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , 2000 Cd_Departamento , 'CADASTRO' Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 0 Qtde_Aguard_Classificacao , 1 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139--FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ta.cd_cor_referencia = Cr.cd_cor_referencia(+) And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS Null And Ta.Cd_Atendimento IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (21,22)) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---COM ATENDIMENTO: AGUARDANDO MÉDICOS--- SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , Cr.Cd_Cor_Referencia+3000 Cd_Departamento , Cr.nm_cor||' AGUARDANDO MÉDICO' Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 0 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 1 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ate.Cd_Atendimento = Ta.Cd_Atendimento And Ta.cd_cor_referencia = Cr.cd_cor_referencia And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (21,22)) And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (31,32)) --- ORIGEM A SER DESCONSIDERADA NO CALCULO --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S' ) Mov
GROUP BY Mov.Data_Mes , Mov.Cd_Departamento , Mov.Ds_Departamento ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01157
---------------------------------------------------------------------------
CURSOR cProcesso_01157(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE DE ENTRADAS NA URGÊNCIA NO MÊS: '||Movimento.Qtde_Entradas ||', QTDE DE ENTRADAS NA URGÊNCIA NO HORÁRIO: '||Movimento.Qtde_Entradas_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Entradas Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Entradas_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Especialid , Mov.Data_Mes , Mov.Qtde_Entradas , Mov.Qtde_Entradas_Dia
FROM ( SELECT Mov.Cd_Especialid , To_Char(Mov.Dh_Atendimento,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Entradas) Qtde_Entradas , Sum(Mov.Qtde_Entradas_Dia) Qtde_Entradas_Dia
FROM ( SELECT Ate.Cd_Especialid , Ate.Dh_Atendimento , 1 Qtde_Entradas , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Entradas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Especialid , To_Char(Mov.Dh_Atendimento,'MM/YYYY') ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01158
---------------------------------------------------------------------------
CURSOR cProcesso_01158(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tip_Res.Cd_Tip_Res Cd_Departamento , Tip_Res.Ds_Tip_Res Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tip_Res.Ds_Tip_Res||', QTDE DE SAÍDAS DA URGÊNCIA: '||Movimento.Qtde_Saidas ||', QTDE DE SAÍDAS DA URGÊNCIA NO DIA: '||Movimento.Qtde_Saidas_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Saidas Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Saidas_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Tip_Res , Mov.Data_Mes , Mov.Qtde_Saidas , Mov.Qtde_Saidas_Dia
FROM ( SELECT Tip.Cd_Tip_Res , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , Count(1) Qtde_Saidas , Sum(Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Saidas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Tip.Cd_Tip_Res , To_Char(Ate.Dh_Atendimento,'MM/YYYY') ) Mov ) Movimento , Dbamv.Tip_Res , MvccAdmin.Estabelecimento
WHERE Tip_Res.Cd_Tip_Res = Movimento.Cd_Tip_Res And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01163
---------------------------------------------------------------------------
CURSOR cProcesso_01163(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE DE ALTAS DA URGENCIA: '||Movimento.Qtde_Altas ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO: '||Movimento.Qtde_Encaminhado ||', TAXA DE INTERNAÇÃO DA URGÊNCIA: '||Movimento.Vl_Taxa_Encaminhado||'%' ||', QTDE DE ALTAS DA URGENCIA NO DIA: '||Movimento.Qtde_Altas_Dia ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO NO DIA: '||Movimento.Qtde_Encaminhado_Dia ||', TAXA DE INTERNAÇÃO DA URGÊNCIA NO DIA: '||Movimento.Vl_Taxa_Encaminhado_Dia||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Encaminhado Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Encaminhado_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Ori_Ate , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Encaminhado) Qtde_Encaminhado , Sum(Mov.Qtde_Encaminhado_Dia) Qtde_Encaminhado_Dia , (Case
WHEN Sum(Mov.Qtde_Altas) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado)/Sum(Mov.Qtde_Altas))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado , (Case
WHEN Sum(Mov.Qtde_Altas_Dia) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado_Dia)/Sum(Mov.Qtde_Altas_Dia))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado_Dia
FROM ( SELECT Ate.Cd_Ori_Ate , Ate.Dh_Alta_Medica , 1 Qtde_Altas , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia , (Case
WHEN Tip.Tp_Saida_Tiss = 4
THEN 1
ELSE 0
END ) Qtde_Encaminhado , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate And Tip.Tp_Saida_Tiss = 4
THEN 1
ELSE 0
END ) Qtde_Encaminhado_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Ori_Ate , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01164
---------------------------------------------------------------------------
CURSOR cProcesso_01164(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Convenio.Cd_Convenio Cd_Departamento , Convenio.Nm_Convenio Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Convenio.Nm_Convenio||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Convenio , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Alt.Cd_Multi_Empresa , Alt.Data_mes , Alt.Cd_Convenio , Sum(Alt.Qtde_Realizada) Qtde_Realizada , Sum(Alt.Qtde_Realizada_dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Alt.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = Lei.Cd_leito And Und.Sn_hospital_dia = 'S' And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA A DESSCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Convenio Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom Or Und.sn_hospital_dia = 'S') And Vcc.Cd_Tipo_Campo_Chave(+) = 91 --TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Alt
GROUP BY Alt.Cd_Multi_Empresa , Alt.Data_mes , Alt.Cd_Convenio ) Mov ) Movimento , Dbamv.Convenio , MvccAdmin.Estabelecimento
WHERE Convenio.Cd_Convenio = Movimento.Cd_Convenio And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01170
---------------------------------------------------------------------------
CURSOR cProcesso_01170(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE PROTOCOLO DE CIRURGIA SEGURA' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null Nm_Processo , 'PERC. DE PROTOCOLO DE CIRURGIA SEGURA'||Chr(10)||', QTDE TOTAL DE CIRURGIA: '||Movimento.Qtde_Total||Chr(10) ||', QTDE COM PROTOCOLO DE SEG.: '||Movimento.Qtde_Conforme||Chr(10) ||', TAXA DE PROTOCOLO DE SEG.: '||Movimento.Vl_Perc_Conforme||' %'||Chr(10) ||', QTDE TOTAL DE CIRURGIA NO DIA: '||Movimento.Qtde_Total_Dia||Chr(10) ||', QTDE COM PROTOCOLO DE SEG. NO DIA: '||Movimento.Qtde_Conforme_Dia||Chr(10) ||', TAXA DE PROTOCOLO DE SEG. NO DIA: '||Movimento.Vl_Perc_Conforme_Dia||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Perc_Conforme Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Perc_Conforme_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Data_Mes , Mov.Qtde_Total , Mov.Qtde_Total_Dia , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT To_Char(Mov.Dt_Realizacao,'MM/YYYY') Data_Mes , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia , Sum(Mov.Qtde_Conforme) Qtde_Conforme , Sum(Case
WHEN Mov.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Conforme
ELSE 0
END ) Qtde_Conforme_Dia
FROM ( SELECT Avi.Cd_Cen_Cir , Avi.Dt_Realizacao , Nvl(( SELECT Min(1)
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.Cd_Atendimento = Avi.Cd_Atendimento ),0) Qtde_Conforme
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.tp_situacao = 'R' And Avi.Cd_Mot_Canc IS Null And Avi.dt_realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY To_Char(Mov.Dt_Realizacao,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01171
---------------------------------------------------------------------------
CURSOR cProcesso_01171(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S CLASSIFICACAO DA URGÊNCIA' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null Nm_Processo , 'QTDE DE PAC´S CLASSIFICACAO DA URGÊNCIA'||Chr(10)||', QTDE REALIZADA: '||Movimento.Qtde_Conforme||Chr(10) ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada||Chr(10) ||', QTDE REALIZADA NO DIA: '||Movimento.Qtde_Conforme_Dia||Chr(10) ||', QTDE PROJETADA NO DIA: '||Movimento.Qtde_Projetada_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'TRIAGEM_ATENDIMENTO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Projetada_Dia Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , Count(1) Qtde_Conforme , Sum(Case
WHEN Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Trunc(MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Projetada , Trunc(MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD')) Qtde_Projetada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Protocolo_Multi_Empresa Pr
WHERE Ta.Cd_Multi_Empresa = Pr.Cd_Multi_Empresa And Ate.Cd_Atendimento = Ta.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Ta.Dh_Removido IS Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fl
WHERE Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Fl.cd_multi_empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.cd_tipo_tempo_processo = 10) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ta.Cd_Fila_Senha And Vcc.Cd_Tipo_Campo_Chave = 139 ---FILA DE TRIAGEM CONSIDERADA: FILA DO FLUXO DE ATENDIMENTO CONSIDERADA And (Vcc.Cd_Departamento = Ta.Cd_Fila_Senha Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Pre_Atendimento Between v_Dt_Ini_Diagno AND v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01172
---------------------------------------------------------------------------
CURSOR cProcesso_01172(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S CLASSIFICACAO DA MATERNIDADE' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null Nm_Processo , 'QTDE DE PAC´S CLASSIFICACAO DA MATERNIDADE'||Chr(10)||', QTDE REALIZADA: '||Movimento.Qtde_Conforme||Chr(10) ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada||Chr(10) ||', QTDE REALIZADA NO DIA: '||Movimento.Qtde_Conforme_Dia||Chr(10) ||', QTDE PROJETADA NO DIA: '||Movimento.Qtde_Projetada_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'TRIAGEM_ATENDIMENTO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , Count(1) Qtde_Conforme , Sum(Case
WHEN Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Trunc(MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Projetada , Trunc(MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Count(1),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD')) Qtde_Projetada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Protocolo_Multi_Empresa Pr
WHERE Ta.Cd_Multi_Empresa = Pr.Cd_Multi_Empresa And Ate.Cd_Atendimento = Ta.Cd_Atendimento And Ta.Dh_Removido IS Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fl
WHERE Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Fl.cd_multi_empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.cd_tipo_tempo_processo = 10) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ta.Cd_Fila_Senha And Vcc.Cd_Tipo_Campo_Chave = 139 ---FILA DE TRIAGEM CONSIDERADA: FILA DO FLUXO DE ATENDIMENTO CONSIDERADA And (Vcc.Cd_Departamento = Ta.Cd_Fila_Senha Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Pre_Atendimento Between v_Dt_Ini_Diagno AND v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01173
---------------------------------------------------------------------------
CURSOR cProcesso_01173(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_mes , Mov.Cd_Unid_Int , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Cd_Unid_Int , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Lei.Cd_Unid_Int , To_Char(Mov.Dt_Lib_Mov,'MM/YYYY') Data_Mes , Sum(1) Qtde_Realizada , Sum(Case
WHEN Mov.Dt_Lib_Mov Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mov_Int Mov , Dbamv.Leito Lei
WHERE Lei.Cd_Leito = Mov.Cd_Leito And Ate.Cd_Atendimento = Mov.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between To_Date(To_Char(Mov.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov.Hr_Mov_Int,'DD/MM/YYYY'),'DD/MM/YYYY HH24:MI:SS') And To_Date(To_Char(Mov.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov.Hr_Lib_Mov,'DD/MM/YYYY'),'DD/MM/YYYY HH24:MI:SS') And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Vcc.Cd_Campo_Chave = Ate.Cd_Tipo_Internacao OR Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom) And (Vcc.Cd_Tipo_Campo_Chave = 65 Or Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom) --TIPO DE INTERNACAO OU TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Mov.Dt_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Lei.Cd_Unid_Int , To_Char(Mov.Dt_Lib_Mov,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01174
---------------------------------------------------------------------------
CURSOR cProcesso_01174(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_mes , Mov.Cd_Unid_Int , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Cd_Unid_Int , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Lei.Cd_Unid_Int , To_Char(Mov.Dt_Lib_Mov,'MM/YYYY') Data_Mes , Sum(1) Qtde_Realizada , Sum(Case
WHEN Mov.Dt_Lib_Mov Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mov_Int Mov , Dbamv.Leito Lei
WHERE Lei.Cd_Leito = Mov.Cd_Leito And Ate.Cd_Atendimento = Mov.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between To_Date(To_Char(Mov.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov.Hr_Mov_Int,'DD/MM/YYYY'),'DD/MM/YYYY HH24:MI:SS') And To_Date(To_Char(Mov.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov.Hr_Lib_Mov,'DD/MM/YYYY'),'DD/MM/YYYY HH24:MI:SS') And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Vcc.Cd_Campo_Chave = Ate.Cd_Tipo_Internacao OR Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom) And (Vcc.Cd_Tipo_Campo_Chave = 65 Or Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom) --TIPO DE INTERNACAO OU TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Mov.Dt_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Lei.Cd_Unid_Int , To_Char(Mov.Dt_Lib_Mov,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01175
---------------------------------------------------------------------------
CURSOR cProcesso_01175(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_mes , Mov.Cd_Unid_Int , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Cd_Unid_Int , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Lei.Cd_Unid_Int , To_Char(Mov.Dt_Lib_Mov,'MM/YYYY') Data_Mes , Sum(1) Qtde_Realizada , Sum(Case
WHEN Mov.Dt_Lib_Mov Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mov_Int Mov , Dbamv.Leito Lei
WHERE Lei.Cd_Leito = Mov.Cd_Leito And Ate.Cd_Atendimento = Mov.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between To_Date(To_Char(Mov.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov.Hr_Mov_Int,'DD/MM/YYYY'),'DD/MM/YYYY HH24:MI:SS') And To_Date(To_Char(Mov.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov.Hr_Lib_Mov,'DD/MM/YYYY'),'DD/MM/YYYY HH24:MI:SS') And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Vcc.Cd_Campo_Chave = Ate.Cd_Tipo_Internacao OR Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom) And (Vcc.Cd_Tipo_Campo_Chave = 65 Or Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom) --TIPO DE INTERNACAO OU TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Mov.Dt_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Lei.Cd_Unid_Int , To_Char(Mov.Dt_Lib_Mov,'MM/YYYY') ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01176
---------------------------------------------------------------------------
CURSOR cProcesso_01176(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ANGIORESSONÂNCIA MAGNÉTICA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ANGIO RESSONANCIA MAGNETICA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01177
---------------------------------------------------------------------------
CURSOR cProcesso_01177(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ANGIORESSONÂNCIA(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'ANGIORESSONANCIA'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Movimentacao = 1 And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01178
---------------------------------------------------------------------------
CURSOR cProcesso_01178(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS MÉDICAS REGULADAS' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS MÉDICAS REGULADAS'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01179
---------------------------------------------------------------------------
CURSOR cProcesso_01179(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS MÉDICAS FOLLOW UP' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS MÉDICAS FOLLOW UP'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01180
---------------------------------------------------------------------------
CURSOR cProcesso_01180(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS NAO MÉDICAS' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS NÃO MÉDICAS'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01181
---------------------------------------------------------------------------
CURSOR cProcesso_01181(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS MÉDICAS REG.+FOLLOW UP' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS MÉDICAS REG.+FOLLOW UP'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01182
---------------------------------------------------------------------------
CURSOR cProcesso_01182(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'INDICE DE QUEDA HOSPITALAR' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'INDICE DE QUEDA HOSPITALAR, QTDE PACIENTE DIA: '||Nvl(Movimento.Qtde_Paciente_Dia,0) ||', QTDE DE QUEDA: '||Nvl(Movimento.Qtde_Queda,0) ||', INDICE DE QUEDA: '||Nvl(Movimento.Vl_Indice_Queda,0) ||', QTDE PACIENTE DIA NO DIA: '||Nvl(Movimento.Qtde_Paciente_Dia_Dia,0) ||', QTDE DE QUEDA NO DIA: '||Nvl(Movimento.Qtde_Queda_Dia,0) ||', INDICE DE QUEDA NO DIA: '||Nvl(Movimento.Vl_Indice_Queda_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Indice_Queda,0) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Nvl(Movimento.Vl_Indice_Queda_Dia,0) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Paciente_Dia , Mov.Qtde_Queda , Mov.Qtde_Paciente_Dia_Dia , Mov.Qtde_Queda_Dia , Mov.Vl_Indice_Queda , Mov.Vl_Indice_Queda_Dia
FROM ( SELECT Dia.Data_Mes , Sum(Dia.Qtde_Paciente_Dia) Qtde_Paciente_Dia , Sum(Dia.Qtde_Queda) Qtde_Queda , Sum(Dia.Qtde_Paciente_Dia_Dia) Qtde_Paciente_Dia_Dia , Sum(Dia.Qtde_Queda_Dia) Qtde_Queda_Dia , (Case
WHEN Sum(Dia.Qtde_Paciente_Dia) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Queda)/Sum(Dia.Qtde_Paciente_Dia))*1000,2)
END ) Vl_Indice_Queda , (Case
WHEN Sum(Dia.Qtde_Paciente_Dia_Dia) = 0
THEN 0
ELSE Round((Sum(Dia.Qtde_Queda_Dia)/Sum(Dia.Qtde_Paciente_Dia_Dia))*1000,2)
END ) Vl_Indice_Queda_Dia
FROM ( SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Paciente_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) ),0) Qtde_Queda , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa ) Qtde_Paciente_Dia_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) ),0) Qtde_Queda_Dia
FROM Dual ) Dia
GROUP BY Dia.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01183
---------------------------------------------------------------------------
CURSOR cProcesso_01183(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. INTERNADOS GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. INTERNADOS GLOBAL'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Alt.Cd_Multi_Empresa , Alt.Data_mes , Sum(Alt.Qtde_Realizada) Qtde_Realizada , Sum(Alt.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Alt.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA A DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Alt
GROUP BY Alt.Cd_Multi_Empresa , Alt.Data_mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01184
---------------------------------------------------------------------------
CURSOR cProcesso_01184(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE SAIDAS HOSP. HOSPITAL DIA GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'NUMERO DE SAIDAS HOSP. HOSPITAL DIA GLOBAL'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Cd_Especialid , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada
FROM ( SELECT Alt.Cd_Multi_Empresa , Alt.Data_mes , Alt.Cd_Especialid , Sum(Alt.Qtde_Realizada) Qtde_Realizada , Sum(Alt.Qtde_Realizada_dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Alt.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = Lei.Cd_leito And Ate.Cd_Movimentacao = 5 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA A DESSCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom Or Und.sn_hospital_dia = 'S') And Vcc.Cd_Tipo_Campo_Chave(+) = 91 --TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Alt
GROUP BY Alt.Cd_Multi_Empresa , Alt.Data_mes , Alt.Cd_Especialid ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01185
---------------------------------------------------------------------------
CURSOR cProcesso_01185(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. CLÍNICA MÉDICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. CLÍNICA MÉDICA'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito Lei
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_leito = lei.Cd_leito And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01186
---------------------------------------------------------------------------
CURSOR cProcesso_01186(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. CIRÚRGICAS (GLOBAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. CIRÚRGICAS (GLOBAL)'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 44 --ESPECIALIDADE MÉDICA A DESCONSIDERAR And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 185 --TIPO DE ACOMODAÇÃO A DESCONSIDERADA And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Tip_Acom) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Multi_Empresa = pCdMultiEmpresa And Avi.Cd_Atendimento = Ate.Cd_Atendimento) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01187
---------------------------------------------------------------------------
CURSOR cProcesso_01187(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. CLÍNICA OBSTÉTRICA GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. CLÍNICA OBSTÉTRICA GLOBAL'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und , Dbamv.Leito lei
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Leito = Lei.Cd_leito And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And ((Vcc.Cd_Tipo_Campo_Chave = 66 And Vcc.Cd_Campo_Chave = Ate.Cd_Especialid) Or (Vcc.Cd_Tipo_Campo_Chave = 91 And Vcc.Cd_Campo_Chave = Lei.Cd_Tip_Acom)) --ESPECIALIDADE A CONSIDERAR ou TIPO DE ACOMODAÇÃO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01188
---------------------------------------------------------------------------
CURSOR cProcesso_01188(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. UTI NEONATAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. UTI NEONATAL'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , Sum(1) Qtde_Realizada , Sum(Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 15 --UNIDADE DE INTERNAÇÃO CONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY To_Char(Ate.Dh_Alta,'MM/YYYY') ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01189
---------------------------------------------------------------------------
CURSOR cProcesso_01189(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. CENTRO DE TRAT. QUEIMADO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. CENTRO DE TRAT. QUEIMADO'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , Sum(1) Qtde_Realizada , Sum(Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 15 --UNIDADE DE INTERNAÇÃO CONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY To_Char(Ate.Dh_Alta,'MM/YYYY') ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01190
---------------------------------------------------------------------------
CURSOR cProcesso_01190(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. SEMI INTENSIVO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. SEMI INTENSIVO'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , Sum(1) Qtde_Realizada , Sum(Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 15 --UNIDADE DE INTERNAÇÃO CONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY To_Char(Ate.Dh_Alta,'MM/YYYY') ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01191
---------------------------------------------------------------------------
CURSOR cProcesso_01191(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE ULTRASSONOGRAFIA ABDOME TOTAL C/DOPPLER(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'NUMERO DE ULTRASSONOGRAFIA ABDOME TOTAL C/DOPPLER(EXT)'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01198
---------------------------------------------------------------------------
CURSOR cProcesso_01198(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Exa_Rx.Cd_Exa_Rx Cd_Departamento , Exa_Rx.Ds_Exa_Rx Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , Exa_Rx.Ds_Exa_Rx||Chr(10)||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada)||Chr(10) ||', TAXA REALIZADA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Conforme,0)),2)||'%'||Chr(10) ||', QTDE EXAMES PROJETADA NO DIA: '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia)||Chr(10) ||', TAXA REALIZADA NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Conforme_Dia,0)),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Exa_Rx , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada_Dia/(Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD')))*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Exa_Rx , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Itp.Cd_Exa_Rx , To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Ate.Cd_Movimentacao = 1 And Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ped.Cd_Set_Exa And Vcc.Cd_Tipo_Campo_Chave = 143 --SETOR DE EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 90 --EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Exa_Rx , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Exa_Rx , MvccAdmin.Estabelecimento
WHERE Exa_Rx.Cd_Exa_Rx = Movimento.Cd_Exa_Rx And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Exa_Rx.Cd_Exa_Rx , Exa_Rx.Ds_Exa_Rx , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01199
---------------------------------------------------------------------------
CURSOR cProcesso_01199(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Exa_Rx.Cd_Exa_Rx Cd_Departamento , Exa_Rx.Ds_Exa_Rx Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Null nm_processo , Exa_Rx.Ds_Exa_Rx||Chr(10)||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada)||Chr(10) ||', TAXA REALIZADA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Conforme,0)),2)||'%'||Chr(10) ||', QTDE EXAMES PROJETADA NO DIA: '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia)||Chr(10) ||', TAXA REALIZADA NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Conforme_Dia,0)),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Exa_Rx , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada_Dia/(Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD')))*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Exa_Rx , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Itp.Cd_Exa_Rx , To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ped.Cd_Set_Exa And Vcc.Cd_Tipo_Campo_Chave = 143 --SETOR DE EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 90 --EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Exa_Rx , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Exa_Rx , MvccAdmin.Estabelecimento
WHERE Exa_Rx.Cd_Exa_Rx = Movimento.Cd_Exa_Rx And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Exa_Rx.Cd_Exa_Rx , Exa_Rx.Ds_Exa_Rx , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01264
---------------------------------------------------------------------------
CURSOR cProcesso_01264(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Departamento.Cd_Departamento Cd_Departamento , Departamento.Ds_Departamento Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Departamento.Ds_Departamento||': '||Movimento.Qtde_Pacientes Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Pacientes Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Pacientes Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTIO--- SELECT Mov.Cd_Departamento , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Pacientes
FROM (---TOTAL DE PAC´S ESPERA DE EXAMES--- SELECT 1 Cd_Departamento , Count(1) Qtde_Pacientes
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS NULL --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And (Exists ( SELECT 1
FROM Dbamv.Ped_Lab Ped, Dbamv.ItPed_Lab ItP
WHERE Ped.Cd_Ped_Lab = Itp.Cd_Ped_Lab And Itp.Dt_Laudo IS Null And Ped.Cd_Atendimento = Ate.Cd_Atendimento) Or Exists ( SELECT 1
FROM Dbamv.Ped_Rx Ped, Dbamv.ItPed_Rx ItP
WHERE Ped.Cd_Ped_Rx = Itp.Cd_Ped_Rx And Itp.Sn_Realizado = 'N' And Ped.Cd_Atendimento = Ate.Cd_Atendimento)) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa
UNION ALL ---TOTAL DE PAC´S ESPERA DE EXAMES IMAG. FORA DO SLA--- SELECT 2 Cd_Departamento , Count(1) Qtde_Pacientes
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS Null And Exists ( SELECT 1
FROM Dbamv.Ped_Rx Ped, Dbamv.ItPed_Rx ItP
WHERE Ped.Cd_Ped_Rx = Itp.Cd_Ped_Rx And Itp.Sn_Realizado = 'N' And Ped.Cd_Atendimento = Ate.Cd_Atendimento And Sysdate-To_Date(To_Char(Ped.dt_pedido,'DD/MM/YYYY')||' '||To_Char(Ped.hr_pedido,'HH24:MI'),'DD/MM/YYYY HH24:MI:SS') > MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,903,Ped.cd_set_exa,pNrCnpj,'SLA')/24/60 ) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa
UNION ALL ---TOTAL DE PAC´S ESPERA DE EXAMES LAB. FORA DO SLA--- SELECT 3 Cd_Departamento , Count(1) Qtde_Pacientes
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS NULL And Exists ( SELECT 1
FROM Dbamv.Ped_Lab Ped, Dbamv.ItPed_Lab ItP
WHERE Ped.Cd_Ped_Lab = Itp.Cd_Ped_Lab And Itp.Sn_Realizado = 'N' And Ped.Cd_Atendimento = Ate.Cd_Atendimento And Sysdate-To_Date(To_Char(Ped.Dt_Pedido,'DD/MM/YYYY')||' '||To_Char(Ped.Hr_Ped_Lab,'HH24:MI'),'DD/MM/YYYY HH24:MI:SS') > MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,902,Itp.Cd_Laboratorio,pNrCnpj,'SLA')/24/60 ) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa ) Mov ) Movimento , ( SELECT 1 Cd_Departamento, 'TOTAL DE PAC´S ESPERA DE EXAME' Ds_Departamento
FROM Dual
UNION ALL SELECT 2 Cd_Departamento, 'TOTAL DE PAC´S ESPERA DE EXAME IMAG. FORA DO SLA' Ds_Departamento
FROM Dual
UNION ALL SELECT 3 Cd_Departamento, 'TOTAL DE PAC´S ESPERA DE EXAME LAB. FORA DO SLA' Ds_Departamento
FROM Dual ) Departamento , MvccAdmin.Estabelecimento
WHERE Departamento.Cd_Departamento = Movimento.Cd_Departamento And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01274
---------------------------------------------------------------------------
CURSOR cProcesso_01274(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. OCUPAÇÃO UTI-PANDEMIA-GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. OCUPAÇÃO UTI-PANDEMIA-GLOBAL'||', QTDE INSTALADA: '||Movimento.Qtde_Instalada ||', QTDE UTILIZADA (DIARIA): '||Movimento.Qtde_Utilizada ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Movimento.Qtde_Utilizada_Dia ||', TAXA DE OCUPAÇÃO: '||Movimento.Vl_Taxa_Ocupacao||' %' ||', TAXA DE OCUPAÇÃO DO DIA: '||Movimento.Vl_Taxa_Ocupacao_Dia||' %' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Movimento.Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Ocupacao Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Ocupacao_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada) Qtde_Instalada , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada,0))/Sum(Nvl(Mov.Qtde_Instalada,0)))*100,2)
END Vl_Taxa_Ocupacao , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia
FROM ( SELECT Ate.Cd_Unid_Int , Count(1) Qtde_Utilizada , Sum(Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' and Lei.Cd_Unid_Int = Ate.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Diagnostico_Atendime Diag
WHERE Diag.Cd_Atendimento = Ate.cd_atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Diag.Cd_Cid And Vcc.Cd_Tipo_Campo_Chave = 2 --CID And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01285
---------------------------------------------------------------------------
CURSOR cProcesso_01285(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS MÉDICAS' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS MÉDICAS'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01286
---------------------------------------------------------------------------
CURSOR cProcesso_01286(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS TELEMEDICINA' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS TELEMEDICINA'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01287
---------------------------------------------------------------------------
CURSOR cProcesso_01287(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS CARDIOLOGIA' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS CARDIOLOGIA'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01288
---------------------------------------------------------------------------
CURSOR cProcesso_01288(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS NEUROLOGIA PEDIATRIA' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS NEUROLOGIA PEDIATRIA'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01289
---------------------------------------------------------------------------
CURSOR cProcesso_01289(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE EXAME DE TESTE DA ORELHINHA(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'EXAME DE TESTE DA ORELHINHA(EXT)'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPED_LAB' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Lab Ped , Dbamv.ItPed_Lab Itp
WHERE Itp.Cd_Ped_Lab = Ped.Cd_Ped_Lab And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Lab And Vcc.Cd_Tipo_Campo_Chave = 90 ---EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Lab ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01290
---------------------------------------------------------------------------
CURSOR cProcesso_01290(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE TESTE HORMONAL(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'EXAME DE TESTE HORMONAL(EXT)'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPED_LAB' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Lab Ped , Dbamv.ItPed_Lab Itp
WHERE Itp.Cd_Ped_Lab = Ped.Cd_Ped_Lab And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Lab And Vcc.Cd_Tipo_Campo_Chave = 90 ---EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Lab ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01291
---------------------------------------------------------------------------
CURSOR cProcesso_01291(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE EXAME ANTI-TPO(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'EXAME ANTI-TPO(EXT)'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPED_LAB' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Lab Ped , Dbamv.ItPed_Lab Itp
WHERE Itp.Cd_Ped_Lab = Ped.Cd_Ped_Lab And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Lab And Vcc.Cd_Tipo_Campo_Chave = 90 ---EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Lab ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01292
---------------------------------------------------------------------------
CURSOR cProcesso_01292(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DIGESTIVA ALTA PED.(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ENDOSCOPIA DIGESTIVA ALTA PED.'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01293
---------------------------------------------------------------------------
CURSOR cProcesso_01293(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ENDOSCOPIA DIGESTIVA ALTA PED.(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'ENDOSCOPIA DIGESTIVA ALTA PED.'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Ate.Cd_Movimentacao = 1 And Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01294
---------------------------------------------------------------------------
CURSOR cProcesso_01294(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ECOCARDIOGRAMA TRANSTORACICO(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ECOCARDIOGRAMA TRANSTORACICO'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01295
---------------------------------------------------------------------------
CURSOR cProcesso_01295(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ECOCARDIOGRAMA TRANSTORACICO(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'ECOCARDIOGRAMA TRANSTORACICO'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Ate.Cd_Movimentacao = 1 And Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01296
---------------------------------------------------------------------------
CURSOR cProcesso_01296(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ELETROENCEFALOGRAMA C/SEDAÇÃO(EXT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'ELETROENCEFALOGRAMA C/SEDAÇÃO'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'E' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01297
---------------------------------------------------------------------------
CURSOR cProcesso_01297(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE ELETROENCEFALOGRAMA C/SEDAÇÃO(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'ELETROENCEFALOGRAMA C/SEDAÇÃO'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Ate.Cd_Movimentacao = 1 And Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01298
---------------------------------------------------------------------------
CURSOR cProcesso_01298(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE CONSULTAS OFTALMOLOGICAS-ABAIXO DE 18 MANOS' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'CONSULTAS OFTALMOLOGICAS-ABAIXO DE 18 MANOS'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01299
---------------------------------------------------------------------------
CURSOR cProcesso_01299(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE MAPEAMENTO DE RETINA COM SEDAÇÃO' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'MAPEAMENTO DE RETINA COM SEDAÇÃO'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01300
---------------------------------------------------------------------------
CURSOR cProcesso_01300(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE MAPEAMENTO DE RETINA SEM SEDAÇÃO' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'MAPEAMENTO DE RETINA SEM SEDAÇÃO'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01301
---------------------------------------------------------------------------
CURSOR cProcesso_01301(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE PAQUIMETRIA ULTRASSONICA SEM SEDAÇÃO' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'PAQUIMETRIA ULTRASSONICA SEM SEDAÇÃO'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01302
---------------------------------------------------------------------------
CURSOR cProcesso_01302(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE POTENCIAL DE ACUIDADE VISUAL' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'POTENCIAL DE ACUIDADE VISUAL'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01303
---------------------------------------------------------------------------
CURSOR cProcesso_01303(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE TONOMETRIA SEM SEDAÇÃO' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'TONOMETRIA SEM SEDAÇÃO'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01304
---------------------------------------------------------------------------
CURSOR cProcesso_01304(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE TOPOGRAFIA COMPUT. DE CORNEA SEM SEDAÇÃO' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'TOPOGRAFIA COMPUT. DE CORNEA SEM SEDAÇÃO'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01305
---------------------------------------------------------------------------
CURSOR cProcesso_01305(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'NUMERO DE CORREÇÃO CIR. ESTRABISMO(ATÉ 2 MÚSCULOS)' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'CORREÇÃO CIR. ESTRABISMO(ATÉ 2 MÚSCULOS)'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01308
---------------------------------------------------------------------------
CURSOR cProcesso_01308(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE HORAS DE TREINAMENTO/HOMEM' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE HORAS DE TREINAMENTO/HOMEM'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada ||', QTDE PROJETADA NO DIA: '||Movimento.Qtde_Projetada_Dia ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Realizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sol.Cd_Multi_Empresa , To_Char(Sol.dt_pedido,'MM/YYYY') Data_Mes , Sum(Case
WHEN ItS.hr_inicio IS Not Null And ItS.hr_final IS Not Null
THEN (ItS.hr_final-ItS.hr_inicio)*24
END ) Qtde_Realizada , Sum(Case
WHEN Sol.dt_pedido Between Trunc(Sysdate) And Sysdate And ItS.hr_inicio IS Not Null And ItS.hr_final IS Not Null
THEN (ItS.hr_final-ItS.hr_inicio)*24
END ) Qtde_Realizada_Dia
FROM Dbamv.Solicitacao_Os Sol , Dbamv.ItSolicitacao_Os ItS , Dbamv.Tipo_Os Tip
WHERE Its.cd_os = Sol.cd_os And Sol.Cd_Tipo_Os = Tip.Cd_Tipo_Os And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE SERVISO CONSIDERADO NA COLETA (TREINAMENTO) And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Sol.cd_tipo_os Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.dt_pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Sol.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Sol.Cd_Multi_Empresa , To_Char(Sol.dt_pedido,'MM/YYYY') ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01325
---------------------------------------------------------------------------
CURSOR cProcesso_01325(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE CIR. PED.' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE CIR. PED.'||', QTDE DE EQUIPTOS: '||Sum(Movimento.Qtde_Total) ||', QTDE REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', PERC. REALIZADA: '||Avg(Movimento.Vl_Perc_Conforme) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Total , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada_Dia/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , Sum(Mov.Qtde_Total) Qtde_Total
FROM ( SELECT Mov.Cd_multi_empresa , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao > Sysdate-Mov.Nr_Dias_Manutencao And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao Between Trunc(Sysdate) And Sysdate And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia , 1 Qtde_Total
FROM ( SELECT Bem.Cd_multi_empresa , Bem.Cd_Bem , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 155 --DIAS PREVISTO PARA MANUTENÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),30) Nr_Dias_Manutencao
FROM Dbamv.Bens Bem
WHERE Bem.Dt_Baixa IS Null And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Bem.Cd_Bem) And Vcc.Cd_Tipo_Campo_Chave = 154 --BEM A SER CONSIDERADOS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Bem.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01326
---------------------------------------------------------------------------
CURSOR cProcesso_01326(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE EXAMES' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE EXAMES'||', QTDE DE EQUIPTOS: '||Sum(Movimento.Qtde_Total) ||', QTDE REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', PERC. REALIZADA: '||Avg(Movimento.Vl_Perc_Conforme) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Perc_Conforme) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Perc_Conforme_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Total , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada_Dia/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , Sum(Mov.Qtde_Total) Qtde_Total
FROM ( SELECT Mov.Cd_multi_empresa , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao > Sysdate-Mov.Nr_Dias_Manutencao And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao Between Trunc(Sysdate) And Sysdate And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia , 1 Qtde_Total
FROM ( SELECT Bem.Cd_multi_empresa , Bem.Cd_Bem , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 155 --DIAS PREVISTO PARA MANUTENÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),30) Nr_Dias_Manutencao
FROM Dbamv.Bens Bem
WHERE Bem.Dt_Baixa IS Null And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Bem.Cd_Bem) And Vcc.Cd_Tipo_Campo_Chave = 154 --BEM A SER CONSIDERADOS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Bem.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01327
---------------------------------------------------------------------------
CURSOR cProcesso_01327(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE OFTALMOLOGIA' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE OFTALMOLOGIA'||', QTDE DE EQUIPTOS: '||Sum(Movimento.Qtde_Total) ||', QTDE REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', PERC. REALIZADA: '||Avg(Movimento.Vl_Perc_Conforme) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Perc_Conforme) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Perc_Conforme_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Total , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada_Dia/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , Sum(Mov.Qtde_Total) Qtde_Total
FROM ( SELECT Mov.Cd_multi_empresa , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao > Sysdate-Mov.Nr_Dias_Manutencao And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao Between Trunc(Sysdate) And Sysdate And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia , 1 Qtde_Total
FROM ( SELECT Bem.Cd_multi_empresa , Bem.Cd_Bem , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 155 --DIAS PREVISTO PARA MANUTENÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),30) Nr_Dias_Manutencao
FROM Dbamv.Bens Bem
WHERE Bem.Dt_Baixa IS Null And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Bem.Cd_Bem) And Vcc.Cd_Tipo_Campo_Chave = 154 --BEM A SER CONSIDERADOS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Bem.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01328
---------------------------------------------------------------------------
CURSOR cProcesso_01328(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE CONSULTAS NRA-CONTRATADA/DISPONÍVEL' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE CONSULTAS NRA-CONTRATADA/DISPONÍVEL'||', QTDE DISPONIBILIZADA: '||Movimento.Qtde_Disponivel ||', QTDE DISPONIBILIZADA NO DIA: '||Movimento.Qtde_Disponivel_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'IT_AGENDA_CENTRAL' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Disponivel Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Disponivel_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Disponivel , Mov.Qtde_Disponivel_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Disponivel) Qtde_Disponivel , Sum(Mov.Qtde_Disponivel_Dia) Qtde_Disponivel_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Age.Cd_Multi_Empresa , To_Char(Age.Dt_Agenda,'MM/YYYY') Data_Mes , 1 Qtde_Disponivel , (Case
WHEN Age.Dt_Agenda Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Disponivel_dia
FROM Dbamv.Agenda_Central Age , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Agenda_Central = Age.Cd_Agenda_Central And Iag.sn_bloqueado = 'N' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Age.Dt_Agenda Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Age.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01329
---------------------------------------------------------------------------
CURSOR cProcesso_01329(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE AGENDAS CONSULTA NRA-CONTRATADA/DISPONÍVEL' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE AGENDAS CONSULTA NRA-CONTRATADA/DISPONÍVEL'||', QTDE DISPONIBILIZADA: '||Movimento.Qtde_Disponivel ||', QTDE DISPONIBILIZADA NO DIA: '||Movimento.Qtde_Disponivel_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'IT_AGENDA_CENTRAL' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Disponivel Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Disponivel_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Disponivel) Qtde_Disponivel , Sum(Mov.Qtde_Disponivel_Dia) Qtde_Disponivel_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel_Dia),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dt_Agenda,'MM/YYYY') Data_Mes , Mov.Qtde_Disponivel , Mov.Qtde_Disponivel_Dia , Mov.Dt_Agenda , Mov.Nr_Mes_Anterior , Mov.Nr_Dia_Mes_Anterior , To_Date(To_Char(Add_Months(Mov.Dt_Agenda,(Mov.Nr_Mes_Anterior*-1)),'MM/YYYY'),'MM/YYYY')+(Mov.Nr_Dia_Mes_Anterior-1) Dt_Prev_Liberacao , Mov.Dt_Liberacao
FROM ( SELECT Age.Cd_Multi_Empresa , To_Char(Age.Dt_Agenda,'MM/YYYY') Data_Mes , Age.Dt_Agenda , Age.Dt_Liberacao , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 156 --NÚMERO DE MÊS ANTERIOR P/LIBERAR A AGENDA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Nr_Mes_Anterior , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 157 --NÚMERO DO DIA DO MÊS ANTERIOR P/LIBERAR A AGENDA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Nr_Dia_Mes_Anterior , 1 Qtde_Disponivel , (Case
WHEN Age.Dt_Agenda Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Disponivel_Dia
FROM Dbamv.Agenda_Central Age , Dbamv.It_Agenda_Central Iag
WHERE Age.Cd_Agenda_Central = Iag.Cd_Agenda_Central And Iag.sn_bloqueado = 'N' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Age.Dt_Agenda Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Age.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
WHERE Mov.Dt_Liberacao <= Mov.Dt_Prev_Liberacao
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01330
---------------------------------------------------------------------------
CURSOR cProcesso_01330(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE EXAMES NRA-CONTRATADO/DISPONÍVEL' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE EXAMES NRA-CONTRATADO/DISPONÍVEL'||', QTDE DISPONIBILIZADA: '||Movimento.Qtde_Disponivel ||', QTDE DISPONIBILIZADA NO DIA: '||Movimento.Qtde_Disponivel_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'IT_AGENDA_CENTRAL' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Disponivel Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Disponivel_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Disponivel , Mov.Qtde_Disponivel_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Disponivel) Qtde_Disponivel , Sum(Mov.Qtde_Disponivel_Dia) Qtde_Disponivel_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Age.Cd_Multi_Empresa , To_Char(Age.Dt_Agenda,'MM/YYYY') Data_Mes , 1 Qtde_Disponivel , (Case
WHEN Age.Dt_Agenda Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Disponivel_dia
FROM Dbamv.Agenda_Central Age , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Agenda_Central = Age.Cd_Agenda_Central And Iag.sn_bloqueado = 'N' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Age.Dt_Agenda Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Age.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01331
---------------------------------------------------------------------------
CURSOR cProcesso_01331(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE AGENDAS EXAME NRA-CONTRATADO/DISPONÍVEL' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE AGENDAS EXAME NRA-CONTRATADO/DISPONÍVEL'||', QTDE DISPONIBILIZADA: '||Movimento.Qtde_Disponivel ||', QTDE DISPONIBILIZADA NO DIA: '||Movimento.Qtde_Disponivel_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'IT_AGENDA_CENTRAL' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Disponivel Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Disponivel_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Disponivel) Qtde_Disponivel , Sum(Mov.Qtde_Disponivel_Dia) Qtde_Disponivel_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel_Dia),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dt_Agenda,'MM/YYYY') Data_Mes , Mov.Qtde_Disponivel , Mov.Qtde_Disponivel_Dia , Mov.Dt_Agenda , Mov.Nr_Mes_Anterior , Mov.Nr_Dia_Mes_Anterior , To_Date(To_Char(Add_Months(Mov.Dt_Agenda,(Mov.Nr_Mes_Anterior*-1)),'MM/YYYY'),'MM/YYYY')+(Mov.Nr_Dia_Mes_Anterior-1) Dt_Prev_Liberacao , Mov.Dt_Liberacao
FROM ( SELECT Age.Cd_Multi_Empresa , To_Char(Age.Dt_Agenda,'MM/YYYY') Data_Mes , Age.Dt_Agenda , Age.Dt_Liberacao , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 156 --NÚMERO DE MÊS ANTERIOR P/LIBERAR A AGENDA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Nr_Mes_Anterior , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 157 --NÚMERO DO DIA DO MÊS ANTERIOR P/LIBERAR A AGENDA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Nr_Dia_Mes_Anterior , 1 Qtde_Disponivel , (Case
WHEN Age.Dt_Agenda Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Disponivel_Dia
FROM Dbamv.Agenda_Central Age , Dbamv.It_Agenda_Central Iag
WHERE Age.Cd_Agenda_Central = Iag.Cd_Agenda_Central And Iag.sn_bloqueado = 'N' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Age.Dt_Agenda Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Age.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
WHERE Mov.Dt_Liberacao <= Mov.Dt_Prev_Liberacao
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01332
---------------------------------------------------------------------------
CURSOR cProcesso_01332(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE EXAMES OFTAL NRA-CONTRATADO/DISPONÍVEL' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE EXAMES OFTAL NRA-CONTRATADO/DISPONÍVEL'||', QTDE DISPONIBILIZADA: '||Movimento.Qtde_Disponivel ||', QTDE DISPONIBILIZADA NO DIA: '||Movimento.Qtde_Disponivel_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'IT_AGENDA_CENTRAL' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Disponivel Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Disponivel_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Data_Mes , Mov.Qtde_Disponivel , Mov.Qtde_Disponivel_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Disponivel) Qtde_Disponivel , Sum(Mov.Qtde_Disponivel_Dia) Qtde_Disponivel_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Age.Cd_Multi_Empresa , To_Char(Age.Dt_Agenda,'MM/YYYY') Data_Mes , 1 Qtde_Disponivel , (Case
WHEN Age.Dt_Agenda Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Disponivel_dia
FROM Dbamv.Agenda_Central Age , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Agenda_Central = Age.Cd_Agenda_Central And Iag.sn_bloqueado = 'N' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Age.Dt_Agenda Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Age.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01333
---------------------------------------------------------------------------
CURSOR cProcesso_01333(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'QTDE DE AGENDAS EXAMES OFTAL NRA-CONTRATADO/DISPONÍVEL' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'QTDE DE AGENDAS EXAMES OFTAL NRA-CONTRATADO/DISPONÍVEL'||', QTDE DISPONIBILIZADA: '||Movimento.Qtde_Disponivel ||', QTDE DISPONIBILIZADA NO DIA: '||Movimento.Qtde_Disponivel_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'IT_AGENDA_CENTRAL' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Disponivel Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Disponivel_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Disponivel) Qtde_Disponivel , Sum(Mov.Qtde_Disponivel_Dia) Qtde_Disponivel_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Disponivel_Dia),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dt_Agenda,'MM/YYYY') Data_Mes , Mov.Qtde_Disponivel , Mov.Qtde_Disponivel_Dia , Mov.Dt_Agenda , Mov.Nr_Mes_Anterior , Mov.Nr_Dia_Mes_Anterior , To_Date(To_Char(Add_Months(Mov.Dt_Agenda,(Mov.Nr_Mes_Anterior*-1)),'MM/YYYY'),'MM/YYYY')+(Mov.Nr_Dia_Mes_Anterior-1) Dt_Prev_Liberacao , Mov.Dt_Liberacao
FROM ( SELECT Age.Cd_Multi_Empresa , To_Char(Age.Dt_Agenda,'MM/YYYY') Data_Mes , Age.Dt_Agenda , Age.Dt_Liberacao , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 156 --NÚMERO DE MÊS ANTERIOR P/LIBERAR A AGENDA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Nr_Mes_Anterior , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 157 --NÚMERO DO DIA DO MÊS ANTERIOR P/LIBERAR A AGENDA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Nr_Dia_Mes_Anterior , 1 Qtde_Disponivel , (Case
WHEN Age.Dt_Agenda Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Disponivel_Dia
FROM Dbamv.Agenda_Central Age , Dbamv.It_Agenda_Central Iag
WHERE Age.Cd_Agenda_Central = Iag.Cd_Agenda_Central And Iag.sn_bloqueado = 'N' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Age.Dt_Agenda Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Age.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
WHERE Mov.Dt_Liberacao <= Mov.Dt_Prev_Liberacao
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01334
---------------------------------------------------------------------------
CURSOR cProcesso_01334(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE CIR. ADULTO' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE CIR. ADULTO'||', QTDE DE EQUIPTOS: '||Sum(Movimento.Qtde_Total) ||', QTDE REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', PERC. REALIZADA: '||Avg(Movimento.Vl_Perc_Conforme) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Total , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada_Dia/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , Sum(Mov.Qtde_Total) Qtde_Total
FROM ( SELECT Mov.Cd_multi_empresa , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao > Sysdate-Mov.Nr_Dias_Manutencao And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao Between Trunc(Sysdate) And Sysdate And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia , 1 Qtde_Total
FROM ( SELECT Bem.Cd_multi_empresa , Bem.Cd_Bem , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 155 --DIAS PREVISTO PARA MANUTENÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),30) Nr_Dias_Manutencao
FROM Dbamv.Bens Bem
WHERE Bem.Dt_Baixa IS Null And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Bem.Cd_Bem) And Vcc.Cd_Tipo_Campo_Chave = 154 --BEM A SER CONSIDERADOS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Bem.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01335
---------------------------------------------------------------------------
CURSOR cProcesso_01335(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_departamento , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE CIRURGIA' Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , 'PERC. DE MANUTENÇÃO PREVENTIVA-EQUIPTO DE CIRURGIA'||', QTDE DE EQUIPTOS: '||Sum(Movimento.Qtde_Total) ||', QTDE REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', PERC. REALIZADA: '||Avg(Movimento.Vl_Perc_Conforme) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'SOLICITACAO_OS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Total , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Round((Mov.Qtde_Realizada_Dia/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , Sum(Mov.Qtde_Total) Qtde_Total
FROM ( SELECT Mov.Cd_multi_empresa , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao > Sysdate-Mov.Nr_Dias_Manutencao And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada , ( SELECT Min(1)
FROM Dbamv.Solicitacao_Os Sol
WHERE Sol.Cd_Bem = Mov.Cd_Bem And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Sol.cd_tipo_os) And Vcc.Cd_Tipo_Campo_Chave = 151 --TIPO DE ORDENS DE SERVIÇOS CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Sol.Dt_Execucao Between Trunc(Sysdate) And Sysdate And Sol.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Realizada_Dia , 1 Qtde_Total
FROM ( SELECT Bem.Cd_multi_empresa , Bem.Cd_Bem , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 155 --DIAS PREVISTO PARA MANUTENÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),30) Nr_Dias_Manutencao
FROM Dbamv.Bens Bem
WHERE Bem.Dt_Baixa IS Null And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Bem.Cd_Bem) And Vcc.Cd_Tipo_Campo_Chave = 154 --BEM A SER CONSIDERADOS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Bem.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01336
---------------------------------------------------------------------------
CURSOR cProcesso_01336(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01338
---------------------------------------------------------------------------
CURSOR cProcesso_01338(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Cirurgia.cd_Tipo_Cirurgia Cd_Departamento , Tipo_Cirurgia.Ds_Tipo_Cirurgia Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Cirurgia.Ds_Tipo_Cirurgia||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Tipo_Cirurgia , Mov.Data_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Cirurgia , Avi.Data_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Avi.Tp_Cirurgias = 'E'
THEN 1
WHEN Avi.Tp_Cirurgias = 'U'
THEN 2
END ) Cd_Tipo_Cirurgia , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Tipo_Cirurgia , Avi.Data_Mes ) Mov ) Movimento , ( SELECT 1 Cd_Tipo_Cirurgia, 'CIRURGIA ELETIVA' Ds_Tipo_Cirurgia
FROM Dual
UNION ALL SELECT 2 Cd_Tipo_Cirurgia, 'CIRURGIA URGENCIA' Ds_Tipo_Cirurgia
FROM Dual) Tipo_Cirurgia , MvccAdmin.Estabelecimento
WHERE Tipo_Cirurgia.cd_Tipo_Cirurgia = Movimento.cd_Tipo_Cirurgia(+) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Tipo_Cirurgia.cd_Tipo_Cirurgia , Tipo_Cirurgia.Ds_Tipo_Cirurgia , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01341
---------------------------------------------------------------------------
CURSOR cProcesso_01341(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_departamento , Especialid.Ds_Especialid Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Especialid , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Ori_Ate Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01342
---------------------------------------------------------------------------
CURSOR cProcesso_01342(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_departamento , Especialid.Ds_Especialid Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE CONSULTAS-- SELECT Mov.Cd_Especialid , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Especialid , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01343
---------------------------------------------------------------------------
CURSOR cProcesso_01343(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE CIRURGIA PEDIATRICA CONV/PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE CIRURGIA PEDIATRICA CONV/PART.'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NOD IA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Avi.Dt_Realizacao,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Con.Tp_Convenio In ('C','P') --CIRURGIAS CONVENIO E PARTICULAR And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias IN ('M','U','E') --(E)letiva, E(M)ergencia, (U)rgencia. And (Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 < Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Avi.Cd_Paciente) Or Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 66 --ESPECIALIDADE MÉDICA And Vcc.Cd_Campo_Chave = To_Char(Cir.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01344
---------------------------------------------------------------------------
CURSOR cProcesso_01344(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE CIRURGIA PEDIATRICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE CIRURGIA PEDIATRICA'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NOD IA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Avi.Dt_Realizacao,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias IN ('M','U','E') --(E)letiva, E(M)ergencia, (U)rgencia. And (Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 < Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Avi.Cd_Paciente) Or Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 66 --ESPECIALIDADE MÉDICA And Vcc.Cd_Campo_Chave = To_Char(Cir.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01345
---------------------------------------------------------------------------
CURSOR cProcesso_01345(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE CIRURGIA PEDIATRICA CARDIACA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE CIRURGIA PEDIATRICA CARDIACA'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NOD IA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , (Case
WHEN Mov.Qtde_Projetada = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Avi.Dt_Realizacao,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias IN ('M','U','E') --(E)letiva, E(M)ergencia, (U)rgencia. And (Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 < Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Avi.Cd_Paciente) Or Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 66 --ESPECIALIDADE MÉDICA And Vcc.Cd_Campo_Chave = To_Char(Cir.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01346
---------------------------------------------------------------------------
CURSOR cProcesso_01346(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE CIRURGIA PEDIATRICA CARDIACA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'CIRURGIA PEDIATRICA CARDIACA'||', QTDE DE CIRURGIA PEDIÁTRICA: '||Movimento.Qtde_Pediatrica ||', QTDE DE CIRURGIA PEDIÁTRICA CARDÍACA: '||Movimento.Qtde_Pediatrica_Cardiaca ||' ,TAXA DE CIRURGIA PEDIÁTRICA CARDÍACA:: '||Movimento.Vl_Taxa_Ped_Cardiaca||'%' ||', QTDE DE CIRURGIA PEDIÁTRICA NO DIA: '||Movimento.Qtde_Pediatrica_Dia ||', QTDE DE CIRURGIA PEDIÁTRICA CARDÍACA NO DIA: '||Movimento.Qtde_Pediatrica_Cardiaca_Dia ||' ,TAXA DE CIRURGIA PEDIÁTRICA CARDÍACA NO DIA: '||Movimento.Vl_Taxa_Ped_Cardiaca_Dia||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Pediatrica_Cardiaca Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Pediatrica_Cardiaca_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Pediatrica , Mov.Qtde_Pediatrica_Dia , Mov.Qtde_Pediatrica_Cardiaca , Mov.Qtde_Pediatrica_Cardiaca_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia , (Case
WHEN Mov.Qtde_Pediatrica = 0
THEN 0
ELSE Trunc((Mov.Qtde_Pediatrica_Cardiaca/Mov.Qtde_Pediatrica)+100,2)
END ) Vl_Taxa_Ped_Cardiaca , (Case
WHEN Mov.Qtde_Pediatrica_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Pediatrica_Cardiaca_Dia/Mov.Qtde_Pediatrica_Dia)+100,2)
END ) Vl_Taxa_Ped_Cardiaca_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Pediatrica) Qtde_Pediatrica , Sum(Mov.Qtde_Pediatrica_Dia) Qtde_Pediatrica_Dia , Sum(Mov.Qtde_Pediatrica_Cardiaca) Qtde_Pediatrica_Cardiaca , Sum(Mov.Qtde_Pediatrica_Cardiaca_Dia) Qtde_Pediatrica_Cardiaca_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Pediatrica),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Pediatrica),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Pediatrica , (Case
WHEN Mov.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Pediatrica
ELSE 0
END ) Qtde_Pediatrica_Dia , Mov.Qtde_Pediatrica_Cardiaca , (Case
WHEN Mov.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Pediatrica_Cardiaca
ELSE 0
END ) Qtde_Pediatrica_Cardiaca_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Dt_Realizacao , To_Char(Avi.Dt_Realizacao,'MM/YYYY') Data_Mes , 1 Qtde_Pediatrica , ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi, Dbamv.Cirurgia_Aviso Cir, Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias IN ('M','U','E') --(E)letiva, E(M)ergencia, (U)rgencia. And Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 < Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Avi.Cd_Paciente) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 160 --ESPECIALIDADE MÉDICA DA CIRURGIA PED. CADIACA And Vcc.Cd_Campo_Chave = To_Char(Cir.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa) Qtde_Pediatrica_Cardiaca
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias IN ('M','U','E') --(E)letiva, E(M)ergencia, (U)rgencia. And (Exists ( SELECT 1
FROM Dbamv.Paciente Pac
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And (Sysdate-Pac.Dt_Nascimento)/365 < Vcc.Cd_Campo_Chave --Anos And Vcc.Cd_Tipo_Campo_Chave = 73 --IDADE LIMITE And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Pac.Cd_Paciente = Avi.Cd_Paciente) Or Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 66 --ESPECIALIDADE MÉDICA And Vcc.Cd_Campo_Chave = To_Char(Cir.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01347
---------------------------------------------------------------------------
CURSOR cProcesso_01347(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Cirurgia Cia , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Cd_Cirurgia = Cia.Cd_Cirurgia And Cia.Tp_Cirurgia = 'P' --PEQUENO PORTE And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01348
---------------------------------------------------------------------------
CURSOR cProcesso_01348(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Cirurgia Cia , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Cd_Cirurgia = Cia.Cd_Cirurgia And Cia.Tp_Cirurgia = 'M' --MEDIO PORTE And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01349
---------------------------------------------------------------------------
CURSOR cProcesso_01349(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Cirurgia Cia , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Cd_Cirurgia = Cia.Cd_Cirurgia And Cia.Tp_Cirurgia = 'G' --GRANDE PORTE And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01350
---------------------------------------------------------------------------
CURSOR cProcesso_01350(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Cirurgia Cia , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Cd_Cirurgia = Cia.Cd_Cirurgia And Cia.Tp_Cirurgia = 'E' --PORTE ESPECIAL And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Avi.Data_Mes ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01351
---------------------------------------------------------------------------
CURSOR cProcesso_01351(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo_Obitos.Cd_Tipo_Obitos Cd_Departamento , Tipo_Obitos.Ds_Tipo_Obitos Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo_Obitos.Ds_Tipo_Obitos||': '||Movimento.Vl_Tipo_Obitos||Chr(10) ||' NO DIA: '||Movimento.Vl_Tipo_Obitos_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tipo_Obitos Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tipo_Obitos_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Cd_Tipo_Obitos , Sum(Mov.Vl_Total_Altas) Vl_Total_Altas , Sum(Mov.Vl_Total_Altas_Dia) Vl_Total_Altas_Dia , Sum(Mov.Vl_Tipo_Obitos) Vl_Tipo_Obitos , Sum(Mov.Vl_Tipo_Obitos_Dia) Vl_Tipo_Obitos_Dia
FROM (---NUMERO DE ÓBITOS TOTAIS--- SELECT Emp.Cd_Multi_Empresa , 1 Cd_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---NUMERO DE ÓBITOS NA UTI GERAL--- SELECT Emp.Cd_Multi_Empresa , 2 Cd_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos_Dia
FROM MvccAdmin.Estabelecimento Emp , Dbamv.Unid_Int Und ---- IDENTIFICACAO DA UTI GERAL PARA O EVENTO ----
WHERE Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 15 --UNIDADE DE INTERNAÇÃO - CONSIDERADA And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Emp.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---TAXA DE MORTALIDADE HOSPITALAR--- SELECT Emp.Cd_Multi_Empresa , 3 Cd_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---TAXA DE MORTALIDADE INSTITUCIONAL--- SELECT Emp.Cd_Multi_Empresa , 4 Cd_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Total_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And (Ate.Dh_Alta_Medica-Ate.Dh_Atendimento)*24 > 24 ---MORTALIDADE INSTITUCIONAL, MAIOR QUE 24 HORAS DA ADMISSAO And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.tp_mot_alta = 'O' And (Ate.Dh_Alta_Medica-Ate.Dh_Atendimento)*24 > 24 ---MORTALIDADE INSTITUCIONAL, MAIOR QUE 24 HORAS DA ADMISSAO And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Obitos_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.cd_multi_empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') , Mov.Cd_Tipo_Obitos ) Movimento , ( SELECT 1 Cd_Tipo_Obitos, 'NUMERO DE ÓBITOS TOTAIS' Ds_Tipo_Obitos
FROM Dual
UNION ALL SELECT 2 Cd_Tipo_Obitos, 'NUMERO DE ÓBITOS NA UTI GERAL' Ds_Tipo_Obitos
FROM Dual
UNION ALL SELECT 3 Cd_Tipo_Obitos, 'TAXA DE MORTALIDADE HOSPITALAR' Ds_Tipo_Obitos
FROM Dual
UNION ALL SELECT 4 Cd_Tipo_Obitos, 'TAXA DE MORTALIDADE INSTITUCIONAL(>24H)' Ds_Tipo_Obitos
FROM Dual ) Tipo_Obitos , MvccAdmin.Estabelecimento
WHERE Tipo_Obitos.Cd_Tipo_Obitos = Movimento.Cd_Tipo_Obitos And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01352
---------------------------------------------------------------------------
CURSOR cProcesso_01352(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo.Cd_Tipo Cd_Departamento , Tipo.Ds_Tipo Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo.Ds_Tipo||': '||Movimento.Vl_Tipo||Chr(10) ||' NO DIA: '||Movimento.Vl_Tipo_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tipo Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tipo_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Cd_Tipo , Sum(Mov.Vl_Tipo) Vl_Tipo , Sum(Mov.Vl_Tipo_Dia) Vl_Tipo_Dia
FROM (---NUMERO DE ÓBITOS CIRÚRGICOS ATÉ 7 DIAS--- SELECT Emp.Cd_Multi_Empresa , 1 Cd_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento And (Ate.Dh_Alta_Medica-Avi.Dt_Realizacao) <= 7) --CIRURGIA ATÉ 7 DIAS APÓS O PROCEDIMENTO And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento And (Ate.Dh_Alta_Medica-Avi.Dt_Realizacao) <= 7) --CIRURGIA ATÉ 7 DIAS APÓS O PROCEDIMENTO And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---NUMERO DE ÓBITOS CIRÚRGICOS ATÉ 7 DIAS¿COM ASA--- SELECT Emp.Cd_Multi_Empresa , 2 Cd_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Cd_Asa IS Not Null --COM ASA And (Ate.Dh_Alta_Medica-Avi.Dt_Realizacao) <= 7) --CIRURGIA ATÉ 7 DIAS APÓS O PROCEDIMENTO And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Mot.tp_mot_alta = 'O' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Cd_Asa IS Not Null --COM ASA And (Ate.Dh_Alta_Medica-Avi.Dt_Realizacao) <= 7) --CIRURGIA ATÉ 7 DIAS APÓS O PROCEDIMENTO And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Mot.tp_mot_alta = 'O' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---NUMERO DE PACIENTES OPERADOS--- SELECT Emp.Cd_Multi_Empresa , 3 Cd_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 AND Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento) --PACIENTES OPERADOS And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 AND Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento) --PACIENTES OPERADOS And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---NUMERO DE PACIENTES OPERADOS-COM ASA--- SELECT Emp.Cd_Multi_Empresa , 4 Cd_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Asa IS Not Null --COM ASA And Avi.Cd_Atendimento = Ate.Cd_Atendimento) --PACIENTES OPERADOS And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Asa IS Not Null --COM ASA And Avi.Cd_Atendimento = Ate.Cd_Atendimento) --PACIENTES OPERADOS And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---TAXA DE MORTALIDADE OPERATÓRIA--- SELECT Mov.cd_multi_empresa , 5 Cd_Tipo , (Case
WHEN Nvl(Mov.Vl_Operados,0) = 0
THEN 0
ELSE Round((Mov.Vl_Operados_Obitos/Mov.Vl_Operados)*100,2)
END ) Vl_Tipo , (Case
WHEN Nvl(Mov.Vl_Operados_Dia,0) = 0
THEN 0
ELSE Round((Mov.Vl_Operados_Obitos_Dia/Mov.Vl_Operados_Dia)*100,2)
END ) Vl_Tipo_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa ---OPERADOS--- , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento ) --PACIENTES OPERADOS And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno ),0) Vl_Operados , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento ) --PACIENTES OPERADOS And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 ),0) Vl_Operados_Dia ---OBITOS--- , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento And (Ate.Dh_Alta_Medica-Avi.Dt_Realizacao) <= 7) --CIRURGIA ATÉ 7 DIAS APÓS O PROCEDIMENTO And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Operados_Obitos , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt(+) And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Atendimento = Ate.Cd_Atendimento And (Ate.Dh_Alta_Medica-Avi.Dt_Realizacao) <= 7) --CIRURGIA ATÉ 7 DIAS APÓS O PROCEDIMENTO And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Operados_Obitos_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.cd_multi_empresa , Mov.Cd_Tipo ) Movimento , ( SELECT 1 Cd_Tipo, 'NUMERO DE ÓBITOS CIRÚRGICOS ATÉ 7 DIAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 2 Cd_Tipo, 'NUMERO DE ÓBITOS CIRÚRGICOS ATÉ 7 DIAS¿COM ASA' Ds_Tipo
FROM Dual
UNION ALL SELECT 3 Cd_Tipo, 'NUMERO DE PACIENTES OPERADOS' Ds_Tipo
FROM Dual
UNION ALL SELECT 4 Cd_Tipo, 'NUMERO DE PACIENTES OPERADOS¿COM ASA' Ds_Tipo
FROM Dual
UNION ALL SELECT 5 Cd_Tipo, 'TAXA DE MORTALIDADE OPERATÓRIA' Ds_Tipo
FROM Dual ) Tipo , MvccAdmin.Estabelecimento
WHERE Tipo.Cd_Tipo = Movimento.Cd_Tipo And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01353
---------------------------------------------------------------------------
CURSOR cProcesso_01353(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo.Cd_Tipo Cd_Departamento , Tipo.Ds_Tipo Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo.Ds_Tipo||': '||Movimento.Vl_Tipo||Chr(10) ||' NO DIA: '||Movimento.Vl_Tipo_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tipo Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tipo_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Cd_Tipo , Mov.Vl_Tipo , Mov.Vl_Tipo_Dia
FROM (---NUMERO DE ÓBITOS--- SELECT Mov.cd_multi_empresa , Mov.cd_tipo , Sum(Mov.vl_tipo) Vl_Tipo , Sum(Mov.vl_tipo_Dia) Vl_Tipo_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , (Case
WHEN ItCsv.valor Between 0 And 499
THEN 1
WHEN ItCsv.valor Between 500 And 749
THEN 2
WHEN ItCsv.valor Between 750 And 999
THEN 3
WHEN ItCsv.valor Between 1000 And 1249
THEN 4
WHEN ItCsv.valor Between 1250 And 1749
THEN 5
WHEN ItCsv.valor Between 1750 And 1999
THEN 6
WHEN ItCsv.valor Between 2000 And 2249
THEN 7
WHEN ItCsv.valor Between 2250 And 2499
THEN 8
WHEN ItCsv.valor > 2500
THEN 9
ELSE 0
END ) Cd_Tipo , 1 Vl_Tipo , (Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Vl_Tipo_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot, Dbamv.Paciente Pac, Dbamv.Coleta_Sinal_Vital Csv, Dbamv.ItColeta_Sinal_Vital ItCsv
WHERE Ate.Cd_Movimentacao = 1 And Ate.Cd_Paciente = Pac.Cd_Paciente And Ate.Cd_Atendimento = Csv.Cd_Atendimento And Ate.cd_multi_empresa = Csv.cd_multi_empresa And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.dh_alta_medica IS Not Null And Ate.Dt_Internado = Trunc(Ate.dh_alta_medica) And Csv.Cd_coleta_sinal_vital = ItCsv.Cd_coleta_sinal_vital And Csv.data_coleta Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Csv.data_coleta = ( SELECT Max(Csv_Max.data_coleta)
FROM Dbamv.coleta_sinal_vital Csv_Max , Dbamv.ItColeta_Sinal_Vital ItCsv_Max
WHERE Csv_Max.Cd_coleta_sinal_vital = ItCsv_Max.Cd_coleta_sinal_vital And Csv_Max.Cd_Atendimento = Csv.Cd_Atendimento And Csv_Max.cd_multi_empresa = Csv.cd_multi_empresa And Csv_Max.Cd_Atendimento = Ate.Cd_Atendimento And Csv_Max.cd_multi_empresa = Ate.cd_multi_empresa And ItCsv_Max.Cd_Sinal_Vital = ItCsv.Cd_Sinal_Vital) --- SINAL VITAL: PARA COLETA DO PESO DO PACIENTE --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 34 --SINAL VITAL-PESO And Vcc.Cd_Campo_Chave = To_Char(ItCsv.cd_sinal_vital) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ---IDADE DE 0 A 6 DIAS--- And Trunc(Sysdate-Pac.Dt_Nascimento) Between 0 And 6 ---IDADE DE 0 A 6 DIAS--- And Mot.tp_mot_alta = 'O' And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
WHERE Mov.cd_tipo > 0
GROUP BY Mov.cd_multi_empresa , Mov.cd_tipo ) Mov ) Movimento , ( SELECT 1 Cd_Tipo, 0 Vl_Tipo_Inicio, 499 Vl_Tipo_Fim, 'NUMERO COM < 500 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 2 Cd_Tipo, 500 Vl_Tipo_Inicio, 749 Vl_Tipo_Fim, 'NUMERO COM 500 ATÉ 749 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 3 Cd_Tipo, 750 Vl_Tipo_Inicio, 999 Vl_Tipo_Fim, 'NUMERO COM 750 ATÉ 999 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 4 Cd_Tipo, 1000 Vl_Tipo_Inicio, 1249 Vl_Tipo_Fim, 'NUMERO COM 1000 ATÉ 1249 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 5 Cd_Tipo, 1250 Vl_Tipo_Inicio, 1749 Vl_Tipo_Fim, 'NUMERO COM 1250 ATÉ 1749 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 6 Cd_Tipo, 1750 Vl_Tipo_Inicio, 1999 Vl_Tipo_Fim, 'NUMERO COM 1750 ATÉ 1999 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 7 Cd_Tipo, 2000 Vl_Tipo_Inicio, 2249 Vl_Tipo_Fim, 'NUMERO COM 2000 ATÉ 2249 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 8 Cd_Tipo, 2250 Vl_Tipo_Inicio, 2499 Vl_Tipo_Fim, 'NUMERO COM 2250 ATÉ 2499 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 9 Cd_Tipo, 2500 Vl_Tipo_Inicio, 999999 Vl_Tipo_Fim, 'NUMERO COM 2500 GRAMAS OU MAIS' Ds_Tipo
FROM Dual) Tipo , MvccAdmin.Estabelecimento
WHERE Tipo.Cd_Tipo = Movimento.Cd_Tipo And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01354
---------------------------------------------------------------------------
CURSOR cProcesso_01354(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo.Cd_Tipo Cd_Departamento , Tipo.Ds_Tipo Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo.Ds_Tipo||': '||Movimento.Vl_Tipo||Chr(10) ||' NO DIA: '||Movimento.Vl_Tipo_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tipo Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tipo_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Cd_Tipo , Mov.Vl_Tipo , Mov.Vl_Tipo_Dia
FROM (---NUMERO DE ÓBITOS--- SELECT Mov.cd_multi_empresa , Mov.cd_tipo , Sum(Mov.vl_tipo) Vl_Tipo , Sum(Mov.vl_tipo_Dia) Vl_Tipo_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , (Case
WHEN ItCsv.valor Between 0 And 499
THEN 1
WHEN ItCsv.valor Between 500 And 749
THEN 2
WHEN ItCsv.valor Between 750 And 999
THEN 3
WHEN ItCsv.valor Between 1000 And 1249
THEN 4
WHEN ItCsv.valor Between 1250 And 1749
THEN 5
WHEN ItCsv.valor Between 1750 And 1999
THEN 6
WHEN ItCsv.valor Between 2000 And 2249
THEN 7
WHEN ItCsv.valor Between 2250 And 2499
THEN 8
WHEN ItCsv.valor > 2500
THEN 9
ELSE 0
END ) Cd_Tipo , 1 Vl_Tipo , (Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Vl_Tipo_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot, Dbamv.Paciente Pac, Dbamv.Coleta_Sinal_Vital Csv, Dbamv.ItColeta_Sinal_Vital ItCsv
WHERE Ate.Cd_Movimentacao = 1 And Ate.Cd_Paciente = Pac.Cd_Paciente And Ate.Cd_Atendimento = Csv.Cd_Atendimento And Ate.cd_multi_empresa = Csv.cd_multi_empresa And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.dh_alta_medica IS Not Null And Ate.Dt_Internado = Trunc(Ate.dh_alta_medica) And Csv.Cd_coleta_sinal_vital = ItCsv.Cd_coleta_sinal_vital And Csv.data_coleta Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Csv.data_coleta = ( SELECT Max(Csv_Max.data_coleta)
FROM Dbamv.coleta_sinal_vital Csv_Max , Dbamv.ItColeta_Sinal_Vital ItCsv_Max
WHERE Csv_Max.Cd_coleta_sinal_vital = ItCsv_Max.Cd_coleta_sinal_vital And Csv_Max.Cd_Atendimento = Csv.Cd_Atendimento And Csv_Max.cd_multi_empresa = Csv.cd_multi_empresa And Csv_Max.Cd_Atendimento = Ate.Cd_Atendimento And Csv_Max.cd_multi_empresa = Ate.cd_multi_empresa And ItCsv_Max.Cd_Sinal_Vital = ItCsv.Cd_Sinal_Vital) --- SINAL VITAL: PARA COLETA DO PESO DO PACIENTE --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 34 --SINAL VITAL-PESO And Vcc.Cd_Campo_Chave = To_Char(ItCsv.cd_sinal_vital) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ---IDADE DE 7 A 28 DIAS--- And Trunc(Sysdate-Pac.Dt_Nascimento) Between 7 And 28 ---IDADE DE 7 A 28 DIAS--- And Mot.tp_mot_alta = 'O' And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
WHERE Mov.cd_tipo > 0
GROUP BY Mov.cd_multi_empresa , Mov.cd_tipo ) Mov ) Movimento , ( SELECT 1 Cd_Tipo, 0 Vl_Tipo_Inicio, 499 Vl_Tipo_Fim, 'NUMERO COM < 500 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 2 Cd_Tipo, 500 Vl_Tipo_Inicio, 749 Vl_Tipo_Fim, 'NUMERO COM 500 ATÉ 749 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 3 Cd_Tipo, 750 Vl_Tipo_Inicio, 999 Vl_Tipo_Fim, 'NUMERO COM 750 ATÉ 999 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 4 Cd_Tipo, 1000 Vl_Tipo_Inicio, 1249 Vl_Tipo_Fim, 'NUMERO COM 1000 ATÉ 1249 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 5 Cd_Tipo, 1250 Vl_Tipo_Inicio, 1749 Vl_Tipo_Fim, 'NUMERO COM 1250 ATÉ 1749 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 6 Cd_Tipo, 1750 Vl_Tipo_Inicio, 1999 Vl_Tipo_Fim, 'NUMERO COM 1750 ATÉ 1999 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 7 Cd_Tipo, 2000 Vl_Tipo_Inicio, 2249 Vl_Tipo_Fim, 'NUMERO COM 2000 ATÉ 2249 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 8 Cd_Tipo, 2250 Vl_Tipo_Inicio, 2499 Vl_Tipo_Fim, 'NUMERO COM 2250 ATÉ 2499 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 9 Cd_Tipo, 2500 Vl_Tipo_Inicio, 999999 Vl_Tipo_Fim, 'NUMERO COM 2500 GRAMAS OU MAIS' Ds_Tipo
FROM Dual) Tipo , MvccAdmin.Estabelecimento
WHERE Tipo.Cd_Tipo = Movimento.Cd_Tipo And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01355
---------------------------------------------------------------------------
CURSOR cProcesso_01355(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo.Cd_Tipo Cd_Departamento , Tipo.Ds_Tipo Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo.Ds_Tipo||': '||Movimento.Vl_Tipo||Chr(10) ||' NO DIA: '||Movimento.Vl_Tipo_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tipo Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tipo_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MORTALIDADE-- SELECT Mov.cd_multi_empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Cd_Tipo , Mov.Vl_Tipo , Mov.Vl_Tipo_Dia
FROM (---NUMERO DE ÓBITOS--- SELECT Mov.cd_multi_empresa , Mov.Cd_Tipo , Mov.Vl_Tipo , Mov.Vl_Tipo_Dia
FROM (---NUMERO DE ÓBITOS NEONATAIS--- SELECT Emp.Cd_Multi_Empresa , 1 Cd_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot, Dbamv.Paciente Pac
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Paciente = Pac.Cd_Paciente And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt --- LIMITE DE IDADE PARA 29 OOU MAIS DIAS --- And (Sysdate-Pac.Dt_Nascimento) <= Nvl(( SELECT To_Number(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 93 --IDADE MÁXIMA (DIAS) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),60) --DOIS MESES LIMITE PADRAO And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot, Dbamv.Paciente Pac
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Paciente = Pac.Cd_Paciente And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt --- LIMITE DE IDADE PARA 29 OOU MAIS DIAS --- And (Sysdate-Pac.Dt_Nascimento) <= Nvl(( SELECT To_Number(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 93 --IDADE MÁXIMA (DIAS) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),60) --DOIS MESES LIMITE PADRAO And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Vl_Tipo_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov ) Movimento , ( SELECT 1 Cd_Tipo, 'QTDE DE OBITOS NEONATAIS' Ds_Tipo
FROM Dual) Tipo , MvccAdmin.Estabelecimento
WHERE Tipo.Cd_Tipo = Movimento.Cd_Tipo And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01356
---------------------------------------------------------------------------
CURSOR cProcesso_01356(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tipo.Cd_Tipo Cd_Departamento , Tipo.Ds_Tipo Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tipo.Ds_Tipo||': '||Movimento.Vl_Tipo||Chr(10) ||' NO DIA: '||Movimento.Vl_Tipo_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Tipo Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Tipo_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Cd_Tipo , Mov.Vl_Tipo , Mov.Vl_Tipo_Dia
FROM (---NUMERO DE ÓBITOS--- SELECT Mov.cd_multi_empresa , Mov.cd_tipo , Sum(Mov.vl_tipo) Vl_Tipo , Sum(Mov.vl_tipo_Dia) Vl_Tipo_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , (Case
WHEN ItCsv.valor Between 0 And 499
THEN 1
WHEN ItCsv.valor Between 500 And 749
THEN 2
WHEN ItCsv.valor Between 750 And 999
THEN 3
WHEN ItCsv.valor Between 1000 And 1249
THEN 4
WHEN ItCsv.valor Between 1250 And 1749
THEN 5
WHEN ItCsv.valor Between 1750 And 1999
THEN 6
WHEN ItCsv.valor Between 2000 And 2249
THEN 7
WHEN ItCsv.valor Between 2250 And 2499
THEN 8
WHEN ItCsv.valor > 2500
THEN 9
ELSE 0
END ) Cd_Tipo , 1 Vl_Tipo , (Case
WHEN Ate.Dt_Internado Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Vl_Tipo_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot, Dbamv.Paciente Pac, Dbamv.Coleta_Sinal_Vital Csv, Dbamv.ItColeta_Sinal_Vital ItCsv
WHERE Ate.Cd_Movimentacao = 1 And Ate.Cd_Paciente = Pac.Cd_Paciente And Ate.Cd_Atendimento = Csv.Cd_Atendimento And Ate.cd_multi_empresa = Csv.cd_multi_empresa And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.dh_alta_medica IS Not Null And Ate.Dt_Internado = Trunc(Ate.dh_alta_medica) And Csv.Cd_coleta_sinal_vital = ItCsv.Cd_coleta_sinal_vital And Csv.data_coleta Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Csv.data_coleta = ( SELECT Max(Csv_Max.data_coleta)
FROM Dbamv.coleta_sinal_vital Csv_Max , Dbamv.ItColeta_Sinal_Vital ItCsv_Max
WHERE Csv_Max.Cd_coleta_sinal_vital = ItCsv_Max.Cd_coleta_sinal_vital And Csv_Max.Cd_Atendimento = Csv.Cd_Atendimento And Csv_Max.cd_multi_empresa = Csv.cd_multi_empresa And Csv_Max.Cd_Atendimento = Ate.Cd_Atendimento And Csv_Max.cd_multi_empresa = Ate.cd_multi_empresa And ItCsv_Max.Cd_Sinal_Vital = ItCsv.Cd_Sinal_Vital) --- SINAL VITAL: PARA COLETA DO PESO DO PACIENTE --- And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 34 --SINAL VITAL-PESO And Vcc.Cd_Campo_Chave = To_Char(ItCsv.cd_sinal_vital) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- IDADE DE 29 OU MAIS DIAS--- And Trunc(Sysdate-Pac.Dt_Nascimento) Between 29 And 999999 ---IDADE DE 29 OU MAIS DIAS--- And Mot.tp_mot_alta = 'O' And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
WHERE Mov.cd_tipo > 0
GROUP BY Mov.cd_multi_empresa , Mov.cd_tipo ) Mov ) Movimento , ( SELECT 1 Cd_Tipo, 0 Vl_Tipo_Inicio, 499 Vl_Tipo_Fim, 'NUMERO COM < 500 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 2 Cd_Tipo, 500 Vl_Tipo_Inicio, 749 Vl_Tipo_Fim, 'NUMERO COM 500 ATÉ 749 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 3 Cd_Tipo, 750 Vl_Tipo_Inicio, 999 Vl_Tipo_Fim, 'NUMERO COM 750 ATÉ 999 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 4 Cd_Tipo, 1000 Vl_Tipo_Inicio, 1249 Vl_Tipo_Fim, 'NUMERO COM 1000 ATÉ 1249 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 5 Cd_Tipo, 1250 Vl_Tipo_Inicio, 1749 Vl_Tipo_Fim, 'NUMERO COM 1250 ATÉ 1749 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 6 Cd_Tipo, 1750 Vl_Tipo_Inicio, 1999 Vl_Tipo_Fim, 'NUMERO COM 1750 ATÉ 1999 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 7 Cd_Tipo, 2000 Vl_Tipo_Inicio, 2249 Vl_Tipo_Fim, 'NUMERO COM 2000 ATÉ 2249 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 8 Cd_Tipo, 2250 Vl_Tipo_Inicio, 2499 Vl_Tipo_Fim, 'NUMERO COM 2250 ATÉ 2499 GRAMAS' Ds_Tipo
FROM Dual
UNION ALL SELECT 9 Cd_Tipo, 2500 Vl_Tipo_Inicio, 999999 Vl_Tipo_Fim, 'NUMERO COM 2500 GRAMAS OU MAIS' Ds_Tipo
FROM Dual) Tipo , MvccAdmin.Estabelecimento
WHERE Tipo.Cd_Tipo = Movimento.Cd_Tipo And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01357
---------------------------------------------------------------------------
CURSOR cProcesso_01357(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE PACIENTE-DIA'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', QTDE PRODUZIDA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno),0) Qtde_Utilizada , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999),0) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Und.Sn_Ativo = 'S' And Und.Tp_Unid_Int = 'I' --- UNIDADE DE INTERNACAO DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Str.Cd_multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01358
---------------------------------------------------------------------------
CURSOR cProcesso_01358(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE PACIENTE-DIA'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', QTDE PRODUZIDA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno),0) Qtde_Utilizada , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999),0) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'C' --CONVENIO --- UNIDADE DE INTERNACAO DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Str.Cd_multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01359
---------------------------------------------------------------------------
CURSOR cProcesso_01359(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE PACIENTE-DIA'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', QTDE PRODUZIDA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio IN ('C','P') --CONVENIO/PARTICULAR --- UNIDADE DE INTERNACAO DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01360
---------------------------------------------------------------------------
CURSOR cProcesso_01360(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE PACIENTE-DIA'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', QTDE PRODUZIDA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' --SUS --- UNIDADE DE INTERNACAO DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Str.Cd_multi_Empresa = pCdMultiEmpresa
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01361
---------------------------------------------------------------------------
CURSOR cProcesso_01361(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null tp_categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE PACIENTE-DIA'||', QTDE PRODUZIDA (DIARIA): '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PROJETADA (DIARIA): '||Sum(Movimento.Qtde_Projetada)||Chr(10) ||', QTDE PRODUZIDA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA (DIARIA) NO DIA: '||Sum(Movimento.Qtde_Projetada_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Sum(Movimento.Qtde_Instalada) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia , Sum(Movimento.Qtde_Instalada_Dia) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--NUMERO DE DIARIAS REALIZADAS-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Nvl(Mov.Qtde_Utilizada_Dia,0),v_Dt_Ini_Diagno,v_Dt_Atual_Diagno) Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno),0) Qtde_Utilizada , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Null,Trunc(Sysdate),Trunc(Sysdate)+.99999),0) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio = 'H' --SUS --- UNIDADE DE INTERNACAO DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Str.Cd_multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01362
---------------------------------------------------------------------------
CURSOR cProcesso_01362(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE OBITOS/MORTES NÃO INSTITUCIONAL (<24H)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE OBITOS/MORTES NÃO INSTITUCIONAL (<24H), QTDE DE ALTAS: '||Sum(Movimento.Qtde_Altas) ||', QTDE DE OBITOS: '||Sum(Nvl(Movimento.Qtde_Mortes,0)) ||', TAXA DE MORTALIDADE: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes,0))||'%' ||', QTDE DE ALTAS DO DIA: '||Sum(Movimento.Qtde_Altas_Dia) ||', QTDE DE OBITOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)) ||', TAXA DE MORTALIDADE NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Sum(Nvl(Movimento.Qtde_Mortes,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , Mov.Qtde_Mortes , Mov.Qtde_Altas , Mov.Qtde_Mortes_Dia , Mov.Qtde_Altas_Dia , (Case
WHEN Mov.Qtde_Altas = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes/Mov.Qtde_Altas)*100,2)
END ) Vl_Taxa_Mortes , (Case
WHEN Mov.Qtde_Altas_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Taxa_Mortes_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 <= 24 --MENOR OU IGUAL A 24 HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Mortes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And (Ate.dh_alta_medica-Ate.Dh_Atendimento)*24 <= 24 --MENOR OU IGUAL A 24 HORAS DO ATENDIMENTO - MORTES INSTITUCIONAIS And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Mortes_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01363
---------------------------------------------------------------------------
CURSOR cProcesso_01363(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE OBITO/MORTE GLOBAIS (TODOS)' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE OBITO/MORTE GLOBAIS (TODOS), QTDE DE ALTAS: '||Sum(Movimento.Qtde_Altas) ||', QTDE DE OBITOS: '||Sum(Nvl(Movimento.Qtde_Mortes,0)) ||', TAXA DE MORTALIDADE: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes,0))||'%' ||', QTDE DE ALTAS DO DIA: '||Sum(Movimento.Qtde_Altas_Dia) ||', QTDE DE OBITOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)) ||', TAXA DE MORTALIDADE NO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Sum(Nvl(Movimento.Qtde_Mortes,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Sum(Nvl(Movimento.Qtde_Mortes_Dia,0)),2) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.cd_multi_empresa , Mov.Qtde_Mortes , Mov.Qtde_Altas , Mov.Qtde_Mortes_Dia , Mov.Qtde_Altas_Dia , (Case
WHEN Mov.Qtde_Altas = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes/Mov.Qtde_Altas)*100,2)
END ) Vl_Taxa_Mortes , (Case
WHEN Mov.Qtde_Altas_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Mortes_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Taxa_Mortes_Dia
FROM ( SELECT Emp.Cd_Multi_Empresa , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Mortes , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Altas_Dia , Nvl(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.dh_alta_medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ),0) Qtde_Mortes_Dia
FROM MvccAdmin.Estabelecimento Emp
WHERE Emp.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01422
---------------------------------------------------------------------------
CURSOR cProcesso_01422(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PARTOS NORMAIS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE PARTOS NORMAIS, QTDE DE PARTOS: '||Sum(Movimento.Qtde_Partos) ||', QTDE DE PARTOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Partos_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Partos_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Partos_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 175 --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 175 --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01423
---------------------------------------------------------------------------
CURSOR cProcesso_01423(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PARTOS CESARIANOS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE PARTOS CESARIANOS, QTDE DE CESARIANAS: '||Sum(Nvl(Movimento.Qtde_Cesarianas,0)) ||', QTDE DE CESARIANAS DIA: '||Sum(Nvl(Movimento.Qtde_Cesarianas_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Cesarianas,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Cesarianas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Cesarianas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Cesarianas , Mov.Qtde_Cesarianas_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Cesarianas) Qtde_Cesarianas , Sum(Mov.Qtde_Cesarianas_Dia) Qtde_Cesarianas_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 176 --CIRURGIA A SER CONSIDERADA PARTO CESARIANA And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Cesarianas , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 176 --CIRURGIA A SER CONSIDERADA PARTO CESARIANA And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Cesarianas_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01424
---------------------------------------------------------------------------
CURSOR cProcesso_01424(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PARTOS NORMAIS PRIMIPARAS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE PARTOS NORMAIS PRIMIPARAS, QTDE DE PARTOS: '||Sum(Movimento.Qtde_Partos) ||', QTDE DE PARTOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Partos_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Partos_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Partos_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 175 --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 175 --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' --- PRIMIPARAS --- And Exists ( SELECT 1
FROM Dbamv.Admissao_Co Adm
WHERE Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01425
---------------------------------------------------------------------------
CURSOR cProcesso_01425(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE PARTOS NORMAIS PRIMIPARAS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERC. DE PARTOS NORMAIS PRIMIPARAS, QTDE DE PARTOS NORMAIS: '||Sum(Movimento.Qtde_Partos)||Chr(10) ||', QTDE DE PRIMIPARAS: '||Sum(Movimento.Qtde_Primiparas)||Chr(10) ||', PERC. DE PRIMIPARAS: '||Avg(Movimento.Vl_Taxa_Primiparas)||Chr(10) ||', QTDE DE PARTOS NORMAIS NO DIA: '||Sum(Movimento.Qtde_Partos_Dia)||Chr(10) ||', QTDE DE PRIMIPARAS NO DIA: '||Sum(Movimento.Qtde_Primiparas_Dia)||Chr(10) ||', PERC. DE PRIMIPARAS: '||Avg(Movimento.Vl_Taxa_Primiparas_Dia) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Taxa_Primiparas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Taxa_Primiparas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Primiparas , Mov.Qtde_Partos_Dia , Mov.Qtde_Primiparas_Dia , (Case
WHEN Nvl(Mov.Qtde_Partos,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas,0)/Nvl(Mov.Qtde_Partos,0))*100,2)
END ) Vl_Taxa_Primiparas , (Case
WHEN Nvl(Mov.Qtde_Partos_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas_Dia,0)/Nvl(Mov.Qtde_Partos_Dia,0))*100,2)
END ) Vl_Taxa_Primiparas_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia , Sum(Mov.Qtde_Primiparas) Qtde_Primiparas , Sum(Mov.Qtde_Primiparas_Dia)Qtde_Primiparas_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175) --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175) --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia , Nvl(( SELECT Min(1)
FROM Dbamv.Admissao_Co Adm , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0 And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175) --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Primiparas , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM Dbamv.Admissao_Co Adm , MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0 And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175) --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Primiparas_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01426
---------------------------------------------------------------------------
CURSOR cProcesso_01426(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PARTOS CESÁREOS PRIMIPARAS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE PARTOS CESÁREOS PRIMIPARAS, QTDE DE PRIMIPARAS: '||Sum(Movimento.Qtde_Cesarianas) ||', QTDE DE PRIMIPARAS NO DIA: '||Sum(Nvl(Movimento.Qtde_Cesarianas_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Cesarianas,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Cesarianas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Cesarianas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Cesarianas , Mov.Qtde_Cesarianas_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Cesarianas) Qtde_Cesarianas , Sum(Mov.Qtde_Cesarianas_Dia) Qtde_Cesarianas_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 176 --CIRURGIA A SER CONSIDERADA PARTOS CESARIANAS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Cesarianas , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave = 176 --CIRURGIA A SER CONSIDERADA PARTOS CESARIANAS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Cesarianas_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' --- PRIMIPARAS --- And Exists ( SELECT 1
FROM Dbamv.Admissao_Co Adm
WHERE Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01427
---------------------------------------------------------------------------
CURSOR cProcesso_01427(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE PARTOS CESAREOS PRIMIPARAS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERC. DE PARTOS CESÁREOS PRIMIPARAS, QTDE DE PARTOS CESÁREOS: '||Sum(Movimento.Qtde_Partos)||Chr(10) ||', QTDE DE PRIMIPARAS: '||Sum(Movimento.Qtde_Primiparas)||Chr(10) ||', PERC. DE PRIMIPARAS: '||Avg(Movimento.Vl_Taxa_Primiparas)||Chr(10) ||', QTDE DE PARTOS CESÁREOS NO DIA: '||Sum(Movimento.Qtde_Partos_Dia)||Chr(10) ||', QTDE DE PRIMIPARAS NO DIA: '||Sum(Movimento.Qtde_Primiparas_Dia)||Chr(10) ||', PERC. DE PRIMIPARAS: '||Avg(Movimento.Vl_Taxa_Primiparas_Dia) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Taxa_Primiparas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Taxa_Primiparas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Primiparas , Mov.Qtde_Partos_Dia , Mov.Qtde_Primiparas_Dia , (Case
WHEN Nvl(Mov.Qtde_Partos,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas,0)/Nvl(Mov.Qtde_Partos,0))*100,2)
END ) Vl_Taxa_Primiparas , (Case
WHEN Nvl(Mov.Qtde_Partos_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas_Dia,0)/Nvl(Mov.Qtde_Partos_Dia,0))*100,2)
END ) Vl_Taxa_Primiparas_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia , Sum(Mov.Qtde_Primiparas) Qtde_Primiparas , Sum(Mov.Qtde_Primiparas_Dia)Qtde_Primiparas_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (176) --CIRURGIA A SER CONSIDERADA PARTOS CESAREANAS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (176) --CIRURGIA A SER CONSIDERADA PARTOS CESAREANAS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia , Nvl(( SELECT Min(1)
FROM Dbamv.Admissao_Co Adm , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0 And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (176) --CIRURGIA A SER CONSIDERADA PARTOS CESAREANAS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Primiparas , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM Dbamv.Admissao_Co Adm , MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0 And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (176) --CIRURGIA A SER CONSIDERADA PARTOS CESAREANAS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Primiparas_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01428
---------------------------------------------------------------------------
CURSOR cProcesso_01428(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE TOTAL DE PARTOS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE TOTAL DE PARTOS, QTDE DE PARTOS: '||Sum(Movimento.Qtde_Partos) ||', QTDE DE PARTOS NO DIA: '||Sum(Movimento.Qtde_Partos_Dia) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Partos_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Partos_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01429
---------------------------------------------------------------------------
CURSOR cProcesso_01429(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE TOTAL DE PARTOS PRIMIPARAS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'QTDE DE TOTAL DE PARTOS PRIMIPARAS, QTDE DE PARTOS: '||Sum(Movimento.Qtde_Partos) ||', QTDE DE PARTOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Partos_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Partos_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Partos_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave IN (175,176) --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS E CESAREANOS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave IN (175,176) --CIRURGIA A SER CONSIDERADA PARTOS NORMAIS E CESAREANOS And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' --- PRIMIPARAS --- And Exists ( SELECT 1
FROM Dbamv.Admissao_Co Adm
WHERE Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01430
---------------------------------------------------------------------------
CURSOR cProcesso_01430(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. TOTAL DE PARTOS PRIMIPARAS' Ds_Departamento , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , NUll Nm_Processo , 'PERC. TOTAL DE PARTOS PRIMIPARAS, QTDE TOTAL DE PARTOS: '||Sum(Movimento.Qtde_Partos)||Chr(10) ||', QTDE TOTAL DE PRIMIPARAS: '||Sum(Movimento.Qtde_Primiparas)||Chr(10) ||', PERC. TOTAL DE PRIMIPARAS: '||Avg(Movimento.Vl_Taxa_Primiparas)||Chr(10) ||', QTDE TOTAL DE PARTOS NO DIA: '||Sum(Movimento.Qtde_Partos_Dia)||Chr(10) ||', QTDE TOTAL DE PRIMIPARAS NO DIA: '||Sum(Movimento.Qtde_Primiparas_Dia)||Chr(10) ||', PERC. TOTAL DE PRIMIPARAS: '||Avg(Movimento.Vl_Taxa_Primiparas_Dia) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Partos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Nvl(Movimento.Vl_Taxa_Primiparas,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Nvl(Movimento.Vl_Taxa_Primiparas_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO DOS PARTOS--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Partos , Mov.Qtde_Primiparas , Mov.Qtde_Partos_Dia , Mov.Qtde_Primiparas_Dia , (Case
WHEN Nvl(Mov.Qtde_Partos,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas,0)/Nvl(Mov.Qtde_Partos,0))*100,2)
END ) Vl_Taxa_Primiparas , (Case
WHEN Nvl(Mov.Qtde_Partos_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Primiparas_Dia,0)/Nvl(Mov.Qtde_Partos_Dia,0))*100,2)
END ) Vl_Taxa_Primiparas_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Partos) Qtde_Partos , Sum(Mov.Qtde_Partos_Dia) Qtde_Partos_Dia , Sum(Mov.Qtde_Primiparas) Qtde_Primiparas , Sum(Mov.Qtde_Primiparas_Dia)Qtde_Primiparas_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Nvl(( SELECT Min(1)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Partos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Partos_Dia , Nvl(( SELECT Min(1)
FROM Dbamv.Admissao_Co Adm , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0 And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0) Qtde_Primiparas , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN Nvl(( SELECT Min(1)
    FROM Dbamv.Admissao_Co Adm , MvccAdmin.v_Campo_Chave Vcc
    WHERE Vcc.Nr_Processo = pProcesso And Adm.Cd_Atendimento = Avi.Cd_Atendimento And Adm.qt_paridade = 0 And Vcc.Cd_Campo_Chave = To_Char(Cav.Cd_Cirurgia) And Vcc.Cd_Tipo_Campo_Chave in (175,176) --CIRURGIA A SER CONSIDERADA PARTOS (NORMAL/CESAREANA) And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),0)
ELSE 0
END ) Qtde_Primiparas_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cav
WHERE Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01431
---------------------------------------------------------------------------
CURSOR cProcesso_01431(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cirurgia.Cd_Cirurgia Cd_Departamento , Cirurgia.Ds_Cirurgia Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cirurgia.Ds_Cirurgia||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Cirurgia , Mov.Data_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Cirurgia , Avi.Data_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Cirurgia , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir , Dbamv.Convenio Con
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Cd_Convenio = Con.Cd_Convenio And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Cirurgia , Avi.Data_Mes ) Mov ) Movimento , Dbamv.Cirurgia , MvccAdmin.Estabelecimento
WHERE Cirurgia.Cd_Cirurgia = Movimento.Cd_Cirurgia And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Cirurgia.Cd_Cirurgia , Cirurgia.Ds_Cirurgia , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01432
---------------------------------------------------------------------------
CURSOR cProcesso_01432(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE NASCIDOS VIVOS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE NASCIDOS VIVOS, QTDE VIVOS: '||Sum(Movimento.Qtde_Nascidos_Vivos_Dia) ||', QTDE VIVOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Nascidos_Vivos_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Nascidos_Vivos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Nascidos_Vivos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Nascidos_Vivos_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Nascidos_Vivos , Mov.Qtde_Nascidos_Vivos_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Nascidos_Vivos) Qtde_Nascidos_Vivos , Sum(Mov.Qtde_Nascidos_Vivos_Dia) Qtde_Nascidos_Vivos_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Rna.Cd_Tip_Morte_Rn IS Null
THEN 1
ELSE 0
END ) Qtde_Nascidos_Vivos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate And Rna.Cd_Tip_Morte_Rn IS Null
THEN 1
ELSE 0
END ) Qtde_Nascidos_Vivos_Dia , (Case
WHEN Rna.Cd_Tip_Morte_Rn IS Not Null
THEN 1
ELSE 0
END ) Qtde_Nascidos_Morto , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate And Rna.Cd_Tip_Morte_Rn IS Not Null
THEN 1
ELSE 0
END ) Qtde_Nascidos_Morto_Dia
FROM Dbamv.Atendime , Dbamv.Aviso_Cirurgia Avi , Dbamv.Recem_Nascido Rna , Dbamv.Cirurgia_Aviso Cav
WHERE Atendime.Cd_Atendimento_Pai = Avi.Cd_Atendimento And Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Atendime.Cd_Atendimento = Rna.Cd_Atendimento(+) And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01433
---------------------------------------------------------------------------
CURSOR cProcesso_01433(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE NATIMORTO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE NATIMORTO: '||Sum(Movimento.Qtde_Nascidos_Morto_Dia) ||', QTDE DE NATIMORTO NO DIA: '||Sum(Nvl(Movimento.Qtde_Nascidos_Morto_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Nascidos_Morto,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Nascidos_Morto,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Nascidos_Morto_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Nascidos_Morto , Mov.Qtde_Nascidos_Morto_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Nascidos_Morto) Qtde_Nascidos_Morto , Sum(Mov.Qtde_Nascidos_Morto_Dia) Qtde_Nascidos_Morto_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Rna.Cd_Tip_Morte_Rn IS Not Null
THEN 1
ELSE 0
END ) Qtde_Nascidos_Morto , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate And Rna.Cd_Tip_Morte_Rn IS Not Null
THEN 1
ELSE 0
END ) Qtde_Nascidos_Morto_Dia
FROM Dbamv.Atendime , Dbamv.Aviso_Cirurgia Avi , Dbamv.Recem_Nascido Rna , Dbamv.Cirurgia_Aviso Cav
WHERE Atendime.Cd_Atendimento_Pai = Avi.Cd_Atendimento And Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Atendime.Cd_Atendimento = Rna.Cd_Atendimento(+) And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01434
---------------------------------------------------------------------------
CURSOR cProcesso_01434(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE NASCIDOS VIVOS APGAR 1 MIN >=7' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE NASCIDOS VIVOS APGAR 1 MIN >=7: '||Sum(Movimento.Qtde_Nascidos_Vivos_Dia) ||', QTDE DE NASCIDOS VIVOS APGAR 1 MIN >=7 NO DIA: '||Sum(Nvl(Movimento.Qtde_Nascidos_Vivos_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Nascidos_Vivos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Nascidos_Vivos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Nascidos_Vivos_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Nascidos_Vivos , Mov.Qtde_Nascidos_Vivos_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Nascidos_Vivos) Qtde_Nascidos_Vivos , Sum(Mov.Qtde_Nascidos_Vivos_Dia) Qtde_Nascidos_Vivos_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Rna.Cd_Tip_Morte_Rn IS Null And Rna.Vl_Apgar_1Minuto >=7
THEN 1
ELSE 0
END ) Qtde_Nascidos_Vivos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate And Rna.Cd_Tip_Morte_Rn IS Null And Rna.Vl_Apgar_1Minuto >=7
THEN 1
ELSE 0
END ) Qtde_Nascidos_Vivos_Dia
FROM Dbamv.Atendime , Dbamv.Aviso_Cirurgia Avi , Dbamv.Recem_Nascido Rna , Dbamv.Cirurgia_Aviso Cav
WHERE Atendime.Cd_Atendimento_Pai = Avi.Cd_Atendimento And Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Atendime.Cd_Atendimento = Rna.Cd_Atendimento(+) And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01435
---------------------------------------------------------------------------
CURSOR cProcesso_01435(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE NASCIDOS VIVOS APGAR 5 MIN >=7' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE NASCIDOS VIVOS APGAR 5 MIN >=7: '||Sum(Movimento.Qtde_Nascidos_Vivos_Dia) ||', QTDE DE NASCIDOS VIVOS APGAR 5 MIN >=7: '||Sum(Nvl(Movimento.Qtde_Nascidos_Vivos_Dia,0)) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Nvl(Movimento.Qtde_Nascidos_Vivos,0)) Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Nascidos_Vivos,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Nascidos_Vivos_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Nascidos_Vivos , Mov.Qtde_Nascidos_Vivos_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Sum(Mov.Qtde_Nascidos_Vivos) Qtde_Nascidos_Vivos , Sum(Mov.Qtde_Nascidos_Vivos_Dia) Qtde_Nascidos_Vivos_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , (Case
WHEN Rna.Cd_Tip_Morte_Rn IS Null And Rna.Vl_Apgar_5Minuto >=7
THEN 1
ELSE 0
END ) Qtde_Nascidos_Vivos , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate And Rna.Cd_Tip_Morte_Rn IS Null And Rna.Vl_Apgar_5Minuto >=7
THEN 1
ELSE 0
END ) Qtde_Nascidos_Vivos_Dia
FROM Dbamv.Atendime , Dbamv.Aviso_Cirurgia Avi , Dbamv.Recem_Nascido Rna , Dbamv.Cirurgia_Aviso Cav
WHERE Atendime.Cd_Atendimento_Pai = Avi.Cd_Atendimento And Avi.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Atendime.Cd_Atendimento = Rna.Cd_Atendimento(+) And Cav.sn_principal = 'S' And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01436
---------------------------------------------------------------------------
CURSOR cProcesso_01436(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ÓBITOS NOTIFICADOS-P/MORTE DE PCR' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE ÓBITOS NOTIFICADOS-P/MORTE DE PCR'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 178 --DOCUMENTO DE NOTIFICAÇÃO DE OBITO PARA DOAÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01437
---------------------------------------------------------------------------
CURSOR cProcesso_01437(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ÓBITOS NOTIFICADOS-P/MORTE ENCEFÁLICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE ÓBITOS NOTIFICADOS-P/MORTE ENCEFÁLICA'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 178 --DOCUMENTO DE NOTIFICAÇÃO DE OBITO PARA DOAÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01438
---------------------------------------------------------------------------
CURSOR cProcesso_01438(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE POTENCIAIS DOADORES-P/MORTE DE PCR' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE POTENCIAIS DOADORES-P/MORTE DE PCR'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 179 --DOCUMENTO DE AVALIAÇÃO DE DOADOR And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01439
---------------------------------------------------------------------------
CURSOR cProcesso_01439(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE POTENCIAIS DOADORES-P/MORTE ENCEFÁLICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE POTENCIAIS DOADORES-P/MORTE ENCEFÁLICA'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 179 --DOCUMENTO DE AVALIAÇÃO DE DOADOR And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01440
---------------------------------------------------------------------------
CURSOR cProcesso_01440(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ABORDAGEM PARA DOAÇÃO-P/MORTE DE PCR' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE ABORDAGEM PARA DOAÇÃO-P/MORTE DE PCR'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 180 --DOCUMENTO DE ABORDAGEM FAMILIAR P/DOAÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01441
---------------------------------------------------------------------------
CURSOR cProcesso_01441(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ABORDAGEM PARA DOAÇÃO-P/MORTE DE PCR' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE ABORDAGEM PARA DOAÇÃO-P/MORTE ENCEFÁLICA'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 180 --DOCUMENTO DE ABORDAGEM FAMILIAR P/DOAÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01442
---------------------------------------------------------------------------
CURSOR cProcesso_01442(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE AUT. DE DOAÇÕES-P/MORTE DE PCR' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE AUT. DE DOAÇÕES-P/MORTE DE PCR'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 181 --DOCUMENTO DE AUTORIZAÇÃO PARA DOAÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01443
---------------------------------------------------------------------------
CURSOR cProcesso_01443(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE AUT. DE DOAÇÕES-P/MORTE DE PCR (CÓRNEA)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE AUT. DE DOAÇÕES-P/MORTE DE PCR (CÓRNEA)'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 181 --DOCUMENTO DE AUTORIZAÇÃO PARA DOAÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01444
---------------------------------------------------------------------------
CURSOR cProcesso_01444(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE AUT. DE DOAÇÕES-P/MORTE ENCEFÁLICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE AUT. DE DOAÇÕES-P/MORTE ENCEFÁLICA'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 181 --DOCUMENTO DE AUTORIZAÇÃO PARA DOAÇÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01445
---------------------------------------------------------------------------
CURSOR cProcesso_01445(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ÓRGÃOS CAPTADOS-P/MORTE DE PCR' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE ÓRGÃOS CAPTADOS-P/MORTE DE PCR'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 182 --DOCUMENTO DE REGISTRO DA CAPTAÇÃO DE ORGÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01446
---------------------------------------------------------------------------
CURSOR cProcesso_01446(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ÓRGÃOS CAPTADOS-P/MORTE ENCEFÁLICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE ÓRGÃOS CAPTADOS-P/MORTE ENCEFÁLICA'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 182 --DOCUMENTO DE REGISTRO DA CAPTAÇÃO DE ORGÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01447
---------------------------------------------------------------------------
CURSOR cProcesso_01447(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE RECUSA DE DOAÇÃO-P/MORTE DE PCR' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE RECUSA DE DOAÇÃO-P/MORTE DE PCR'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 183 --DOCUMENTO DE RECUSA DE DOAÇÃO DE ORGÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01448
---------------------------------------------------------------------------
CURSOR cProcesso_01448(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE RECUSA DE DOAÇÃO-P/MORTE ENCEFÁLICA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE RECUSA DE DOAÇÃO-P/MORTE ENCEFÁLICA'||', QTDE DE NOTIFICADA: '||Nvl(Movimento.Qtde_Realizada,0)||Chr(10) ||', QTDE DE RECUSA DE MORTE DE PCR NO DIA: '||Nvl(Movimento.Qtde_Realizada_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Realizada,0) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Realizada_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Alta_Medica , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc , MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 183 --DOCUMENTO DE RECUSA DE DOAÇÃO DE ORGÃO And Vcc.Nr_Cnpj = pNrCnpj And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.dh_referencia Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.cd_atendimento = Ate.Cd_Atendimento) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 43 --MOTIVO DE ALTA CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMvccEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Alta_Medica,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01471
---------------------------------------------------------------------------
CURSOR cProcesso_01471(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE ULTRASSON. ABD. TOTAL C/DOPPLER(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Null nm_processo , 'NUMERO DE ULTRASSON. ABD. TOTAL C/DOPPLER(INT)'||', QTDE EXAMES REALIZADA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE EXAMES REALIZADA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE EXAMES PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Rx Ped , Dbamv.ItPed_Rx Itp
WHERE Ate.Cd_Movimentacao = 1 And Itp.Cd_Ped_Rx = Ped.Cd_Ped_Rx And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'I' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Rx And Vcc.Cd_Tipo_Campo_Chave = 140 --EXAME A SER CONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Rx ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01472
---------------------------------------------------------------------------
CURSOR cProcesso_01472(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NÚMERO DE EXAME ANTI-TPO(INT)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll nm_processo , 'NÚMERO DE EXAME ANTI-TPO(INT)'||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||', TAXA: '||Avg(Nvl(Movimento.Vl_Taxa_Conforme,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPED_LAB' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Projetada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Projetada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia , (Case
WHEN Nvl(Mov.Qtde_Projetada,0) = 0
THEN 0
ELSE Trunc((Mov.Qtde_Realizada/Mov.Qtde_Projetada)*100,2)
END ) Vl_Taxa_Conforme
FROM ( SELECT Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT To_Char(Ped.Dt_Pedido,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ped.Dt_Pedido Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Ped_Lab Ped , Dbamv.ItPed_Lab Itp
WHERE Ate.Cd_Movimentacao = 1 And Itp.Cd_Ped_Lab = Ped.Cd_Ped_Lab And Itp.Sn_Realizado = 'S' And Ate.Tp_Atendimento = 'I' And Ate.Cd_Atendimento = Ped.Cd_Atendimento And Ped.Dt_Pedido Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Exa_Lab And Vcc.Cd_Tipo_Campo_Chave = 90 ---EXAME A SER DESCONSIDERADO NO EVENTO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ped.Dt_Pedido Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY To_Char(Ped.Dt_Pedido,'MM/YYYY') , Ped.Dt_Pedido , Ped.Cd_Ped_Lab ) Mov
GROUP BY Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01476
---------------------------------------------------------------------------
CURSOR cProcesso_01476(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ABANDONO/EVASÃO NO PS INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE ABANDONO/EVASÃO NO PS INSTITUCIONAL'||', QTDE DE ABANDONOS: '||Movimento.Qtde_Abandono||Chr(10) ||', TAXA DE ABANDONOS: '||Movimento.Vl_Taxa_Abandono||'%'||Chr(10) ||', QTDE DE ABANDONOS NO DIA: '||Movimento.Qtde_Abandono_Dia||Chr(10) ||', TAXA DE ABANDONOS NO DIA: '||Movimento.Vl_Taxa_Abandono_Dia||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Abandono Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Abandono_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Total , Mov.Qtde_Total_Dia , Mov.Qtde_Abandono , Mov.Qtde_Abandono_Dia , (Case
WHEN Mov.qtde_total = 0
THEN 0
ELSE Round((Mov.Qtde_Abandono/Mov.qtde_total)*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Mov.qtde_total_dia = 0
THEN 0
ELSE Round((Mov.Qtde_Abandono_Dia/Mov.qtde_total_dia)*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Abandono,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Abandono) Qtde_Abandono , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandono_Dia , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia
FROM (---QTDE TOTAL DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---EVASÃO DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Tip_Res And Vcc.Cd_Tipo_Campo_Chave = 134 --TIPO DE RESULTADO CONSIDERADO EVASAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE SENHAS--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Ta.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS NULL And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---REMOÇÃO DE SENHA/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Ta.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS Null And Ta.Dh_Removido IS Not Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Abandono,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01477
---------------------------------------------------------------------------
CURSOR cProcesso_01477(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ENTRADAS NA URGENCIA NO DIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE ENTRADAS NA URGENCIA'||', QTDE DE ENTRADA NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme_Dia Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Entradas_Dia Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Count(1) Qtde_Entradas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' --- ORIGEM A SER DESCONSIDERADA NO CALCULO --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01478
---------------------------------------------------------------------------
CURSOR cProcesso_01478(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S ATEND. NO PS FORA SLA INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE PAC´S ATEND. NO PS FORA SLA INSTITUCIONAL'||', QTDE FORA DO SLA: '||Movimento.Qtde_Atend_Fora_Sla ||', QTDE FORA DO SLA NO DIA: '||Movimento.Qtde_Atend_Fora_Sla_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Atend_Fora_Sla Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Atend_Fora_Sla_dIA Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Sum(Mov.Qtde_Atend_Fora_Sla) Qtde_Atend_Fora_Sla , Sum(Mov.Qtde_Atend_Fora_Sla_Dia) Qtde_Atend_Fora_Sla_Dia
FROM ( SELECT To_Char(Mov.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Atend_Fora_Sla , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Atend_Fora_Sla_Dia
FROM ( SELECT Ate.Dh_Atendimento , ( SELECT Min(Nvl(Stp_H.dh_processo,Stp.dh_processo))
FROM Dbamv.Sacr_Tempo_Processo Stp, Dbamv.Sacr_Tempo_Processo_Historico Stp_H
WHERE Stp_H.cd_atendimento(+) = Stp.cd_atendimento And Stp_H.cd_triagem_atendimento(+) = Stp.cd_triagem_atendimento And Stp_H.cd_tipo_tempo_processo(+) = Stp.cd_tipo_tempo_processo And Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo = Nvl(vChaveIniProcesso,30)) Dh_Processo --FIM DO CADASTRO OU CONFIGURACAO , ( SELECT Min(Nvl(Stp_H.dh_processo,Stp.dh_processo))
FROM Dbamv.Sacr_Tempo_Processo Stp, Dbamv.Sacr_Tempo_Processo_Historico Stp_H
WHERE Stp_H.cd_atendimento(+) = Stp.cd_atendimento And Stp_H.cd_triagem_atendimento(+) = Stp.cd_triagem_atendimento And Stp_H.cd_tipo_tempo_processo(+) = Stp.cd_tipo_tempo_processo And Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo = Nvl(vChaveFimProcesso,30)) Dh_Processo_Fim --CHAMADA PARA ATENDIMENTO MEDICO OU CONFIGURACAO , Ate.Dh_Atendimento+(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA')/24/60) Dh_Prev_Atendimento
FROM Dbamv.Triagem_Atendimento ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Removido IS Null And Ta.cd_cor_referencia IS Not Null And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
WHERE Mov.Dh_Processo > Mov.Dh_Prev_Atendimento ) Mov
GROUP BY Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01479
---------------------------------------------------------------------------
CURSOR cProcesso_01479(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE DE ALTAS DA URGENCIA: '||Movimento.Qtde_Altas ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO: '||Movimento.Qtde_Encaminhado ||', TAXA DE INTERNAÇÃO DA URGÊNCIA: '||Movimento.Vl_Taxa_Encaminhado||'%' ||', QTDE DE ALTAS DA URGENCIA NO DIA: '||Movimento.Qtde_Altas_Dia ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO NO DIA: '||Movimento.Qtde_Encaminhado_Dia ||', TAXA DE INTERNAÇÃO DA URGÊNCIA NO DIA: '||Movimento.Vl_Taxa_Encaminhado_Dia||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Encaminhado Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Encaminhado_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Encaminhado) Qtde_Encaminhado , Sum(Mov.Qtde_Encaminhado_Dia) Qtde_Encaminhado_Dia , (Case
WHEN Sum(Mov.Qtde_Altas) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado)/Sum(Mov.Qtde_Altas))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado , (Case
WHEN Sum(Mov.Qtde_Altas_Dia) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado_Dia)/Sum(Mov.Qtde_Altas_Dia))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Lei.Cd_Unid_Int , To_Char(Mov.Dt_Atendimento,'MM/YYYY') Data_mes , Qtde_Altas.Qtde_Altas , Qtde_Altas.Qtde_Altas_Dia , Count(1) Qtde_Encaminhado , Sum(Case
WHEN Mov.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Encaminhado_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dt_Atendimento , ( SELECT Min(Mov.Cd_Mov_Int)
FROM Dbamv.Mov_Int Mov , ( SELECT Cd_Atendimento, Dh_Atendimento, Cd_paciente
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno
GROUP BY Cd_Atendimento, Dh_Atendimento, Cd_paciente) Ate_Int , Dbamv.Leito Lei
WHERE Mov.Cd_Atendimento = Ate_Int.Cd_Atendimento And Ate_Int.Cd_Paciente = Ate.Cd_Paciente And Mov.Cd_leito = Lei.Cd_Leito And Ate_Int.Dh_Atendimento >= Ate.Dh_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Cd_Mov_Int
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Dt_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Tip.Tp_Saida_Tiss = 4 ) Mov , Dbamv.Mov_Int , Dbamv.Leito Lei , ( SELECT Count(1) Qtde_Altas , Sum(Case
WHEN Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Dt_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Tip.Tp_Saida_Tiss = 4 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate_Int
WHERE Ate_Int.Cd_Movimentacao = 4 And Ate_Int.Dh_Atendimento >= Ate.Dh_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Int.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) )) Qtde_Altas
WHERE Mov.Cd_Mov_Int = Mov_Int.Cd_Mov_Int And Mov_Int.Cd_Leito = Lei.Cd_Leito
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dt_Atendimento,'MM/YYYY') , Lei.Cd_Unid_Int , Qtde_Altas.Qtde_Altas , Qtde_Altas.Qtde_Altas_Dia ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Data_Mes ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Unid_Int.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01480
---------------------------------------------------------------------------
CURSOR cProcesso_01480(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS HOSP. NÃO CIRÚRGICAS (GLOBAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS HOSP. NÃO CIRÚRGICAS (GLOBAL)'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Sai.Cd_Multi_Empresa , Sai.Data_mes , Sum(Sai.Qtde_Realizada) Qtde_Realizada , Sum(Sai.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Sai.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Convenio , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA A DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 44 --ESPECIALIDADE MÉDICA A DESCONSIDERAR And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Especialid) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 185 --TIPO DE ACOMODAÇÃO A DESCONSIDERADA And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Tip_Acom) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Tp_Situacao = 'R' And Avi.Cd_Multi_Empresa = pCdMultiEmpresa And Avi.Cd_Atendimento = Ate.Cd_Atendimento) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Sai
GROUP BY Sai.Cd_Multi_Empresa , Sai.Data_mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01530
---------------------------------------------------------------------------
CURSOR cProcesso_01530(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S ACAMADOS FORA DO SLA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE PAC´S ACAMADOS FORA DO SLA'||Movimento.Qtde_Conforme ||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Movimento.Qtde_Conforme Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTIO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia
FROM (---TOTAL DE PACIENTES ACAMADOS FORA DO SLA--- SELECT Count(1) Qtde_Conforme , Sum(Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Atendimento , Ate.Dh_Atendimento , (Sysdate-Ate.Dh_Atendimento) Vl_Tempo --- TEMPO MEDICO DECISÃO NA URGÊNCIA , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,874,Ate.Cd_Especialid,pNrCnpj,'SLA')/24/60 Vl_Tempo_Previsto , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 98 --CONSIDERAR OU NÃO PACIENTES COM TERAPIAS (PRESCRIÇÃO) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Sn_Paciente_Terapia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS NULL --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa ) Mov
WHERE Mov.Vl_Tempo > Mov.Vl_Tempo_Previsto And (Mov.Sn_Paciente_Terapia = 'S' And Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp , MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO CONSIDERADO And Mov.Dh_Atendimento Between Pre.Dt_Pre_Med And Pre.Dt_Pre_Med+.99999 And Pre.fl_impresso = 'S' And Pre.Cd_Atendimento = Mov.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) OR Mov.Sn_Paciente_Terapia = 'N') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01531
---------------------------------------------------------------------------
CURSOR cProcesso_01531(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S ACAMADOS EM ESPERA DE LEITO' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE PAC´S ACAMADOS NA URG. EM ESPERA DE LEITO'||Movimento.Qtde_Conforme ||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTIO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia
FROM (---TOTAL DE PACIENTES ACAMADOS FORA DO SLA--- SELECT Count(1) Qtde_Conforme , Count(1) Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Atendimento , Ate.Dh_Atendimento
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta IS Null --AINDA ESTÃO NA URGENCIA And Not Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate_Int
WHERE Ate_Int.Dh_Atendimento > Ate.Dh_Atendimento And Ate_Int.Cd_Paciente = Ate.Cd_Paciente And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate_Int.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY Ate_Int.Cd_Paciente) --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And (Exists (--PROCESSO DE BOARDING INTERNAÇÃO-DOC. ELETRONICO-- SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc, MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.Cd_Atendimento = Ate.Cd_Atendimento) or Exists (--SOLICITAÇÃO DE GUIA DE INTERNACAO-- SELECT 1
FROM Dbamv.Tiss_Sol_Guia Sol
WHERE Sol.Nm_Xml = 'solicitacaoInternacao' And Sol.Cd_Atendimento = Ate.Cd_Atendimento) or Exists (--ITEM DE PRESCRIÇÃO DE SOLICITAÇÃO DE INTERNAÇÃO-- SELECT 1
FROM Dbamv.Laudo_Aih Lau
WHERE Lau.Cd_Atendimento = Ate.Cd_Atendimento) or Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre, Dbamv.ItPre_Med Itp, MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRIÇÃO A SER CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Itp.Tp_Situacao = 'N' And Pre.Fl_Impresso = 'S' And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Pre.Cd_Atendimento = Ate.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno-30 --QTDE DE DIAS AGUARDANDO NA URGENCIA And v_Dt_Fim_Diagno And Ate.cd_multi_empresa = pCdMultiEmpresa ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01533
---------------------------------------------------------------------------
CURSOR cProcesso_01533(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||', QTDE DE ABANDONOS: '||Movimento.Qtde_Abandonos||Chr(10) ||', TAXA DE ABANDONOS: '||Movimento.Vl_Taxa_Abandono||'%'||Chr(10) ||', QTDE DE ABANDONOS NO DIA: '||Movimento.Qtde_Abandonos_Dia||Chr(10) ||', TAXA DE ABANDONOS NO DIA: '||Movimento.Vl_Taxa_Abandono_Dia||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Movimento.Qtde_Abandonos Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Abandonos Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Abandonos_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTIO--- SELECT Mov.Cd_Multi_Empresa , Mov.cd_especialid , Mov.Data_Mes , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia , Sum(Mov.Qtde_Abandono) Qtde_Abandonos , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandonos_Dia , (Case
WHEN Sum(Mov.qtde_total) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono)/Sum(Mov.qtde_total))*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Sum(Mov.qtde_total_dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono_Dia)/Sum(Mov.qtde_total_dia))*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(Mov.Dh_Abandono,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Abandono) Qtde_Abandono , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandono_Dia , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia
FROM (---QTDE TOTAL DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---EVASÃO DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Tip_Res And Vcc.Cd_Tipo_Campo_Chave = 134 --TIPO DE RESULTADO CONSIDERADO EVASAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE SENHAS--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS NULL And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---REMOÇÃO DE SENHA/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS Null And Ta.Dh_Removido IS Not Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(Mov.Dh_Abandono,'MM/YYYY') ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , Mov.Data_Mes ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01534
---------------------------------------------------------------------------
CURSOR cProcesso_01534(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE ABANDONO/EVASÃO NO PS INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'PERC DE ABANDONO/EVASÃO NO PS INSTITUCIONAL'||', QTDE DE SENHAS: '||Sum(Movimento.Qtde_Total) ||', QTDE DE ABANDONO: '||Sum(Nvl(Movimento.Qtde_Abandonos,0)) ||', TAXA DE ABANDONO: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2)||'%' ||', QTDE DE SENHAS NO DIA: '||Sum(Movimento.Qtde_Total_Dia) ||', QTDE DE ABANDONO NO DIA: '||Sum(Nvl(Movimento.Qtde_Abandonos_Dia,0)) ||', TAXA DE ABANDONO NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono_Dia,0)),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2) Qtde_NaoConforme , Null Qtde_Instalada , 'TRIAGEM_ATENDIMENTO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Null Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Null Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia , Sum(Mov.Qtde_Abandono) Qtde_Abandonos , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandonos_Dia , (Case
WHEN Sum(Mov.qtde_total) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono)/Sum(Mov.qtde_total))*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Sum(Mov.qtde_total_dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono_Dia)/Sum(Mov.qtde_total_dia))*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Abandono,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Abandono) Qtde_Abandono , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandono_Dia , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia
FROM (---QTDE TOTAL DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---EVASÃO DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Tip_Res And Vcc.Cd_Tipo_Campo_Chave = 134 --TIPO DE RESULTADO CONSIDERADO EVASAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE SENHAS--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Ta.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS NULL And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---REMOÇÃO DE SENHA/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Ta.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS Null And Ta.Dh_Removido IS Not Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Abandono,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01535
---------------------------------------------------------------------------
CURSOR cProcesso_01535(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , NUll Nm_indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE DE SENHAS: '||Sum(Movimento.Qtde_Total) ||', QTDE DE ABANDONO: '||Sum(Nvl(Movimento.Qtde_Abandonos,0)) ||', TAXA DE ABANDONO: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2)||'%' ||', QTDE DE SENHAS NO DIA: '||Sum(Movimento.Qtde_Total_Dia) ||', QTDE DE ABANDONO NO DIA: '||Sum(Nvl(Movimento.Qtde_Abandonos_Dia,0)) ||', TAXA DE ABANDONO NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono_Dia,0)),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Taxa_Abandono,0)),2) Qtde_NaoConforme , Null Qtde_Instalada , 'TRIAGEM_ATENDIMENTO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Null Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Null Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTACAO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia , Sum(Mov.Qtde_Abandono) Qtde_Abandonos , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandonos_Dia , (Case
WHEN Sum(Mov.qtde_total) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono)/Sum(Mov.qtde_total))*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Sum(Mov.qtde_total_dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Abandono_Dia)/Sum(Mov.qtde_total_dia))*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , To_Char(Mov.Dh_Abandono,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Abandono) Qtde_Abandono , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandono_Dia , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia
FROM (---QTDE TOTAL DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---EVASÃO DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Tip_Res And Vcc.Cd_Tipo_Campo_Chave = 134 --TIPO DE RESULTADO CONSIDERADO EVASAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE SENHAS--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS NULL And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---REMOÇÃO DE SENHA/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Nvl(Ta.Cd_Especialid,( SELECT Min(Esp.Cd_Especialid)
FROM Dbamv.Esp_Med Esp
WHERE Esp.Cd_Prestador = Cfg.Cd_Prestador_Geral And Esp.Sn_Especial_Principal = 'S')) Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS Null And Ta.Dh_Removido IS Not Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , To_Char(Mov.Dh_Abandono,'MM/YYYY') ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Data_Mes ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01545
---------------------------------------------------------------------------
CURSOR cProcesso_01545(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE ALTAS DA UTI: '||Sum(Movimento.Qtde_Altas_Da_Uti) ||', QTDE DE OBITOS NA UTI: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) ||', TAXA DE MORTALIDADE NA UTI: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti,0))||'%' ||', QTDE ALTAS DA UTI DO DIA: '||Sum(Movimento.Qtde_Altas_Da_Uti_Dia) ||', QTDE DE OBITOS NA UTI NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) ||', TAXA DE MORTALIDADE NA UTI DO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas_Da_Uti) Qtde_Altas_Da_Uti , Sum(Mov.Qtde_Mortes_Na_Uti) Qtde_Mortes_Na_Uti , Sum(Mov.Qtde_Altas_Da_Uti_Dia) Qtde_Altas_Da_Uti_Dia , Sum(Mov.Qtde_Mortes_Na_Uti_Dia) Qtde_Mortes_Na_Uti_Dia , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti)/Sum(Mov.Qtde_Altas_Da_Uti))*100,2)
END ) Vl_Taxa_Mortes_Uti , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti_Dia)/Sum(Mov.Qtde_Altas_Da_Uti_Dia))*100,2)
END ) Vl_Taxa_Mortes_Uti_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 --- SOMENTE OS PACIENTES COM ALTA NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_leito = Ate.Cd_Leito_Anterior) And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE RECEBERAM ALTA DA UTI --- And Ate.Dh_Lib_Mov Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int --- SOMENTE OS PACIENTES QUE MORRERAM NA UTI --- And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Tip_Acom Tip, Dbamv.Leito Lei
WHERE Tip.Cd_Tip_Acom = Lei.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01551
---------------------------------------------------------------------------
CURSOR cProcesso_01551(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'C') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01552
---------------------------------------------------------------------------
CURSOR cProcesso_01552(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'C') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01553
---------------------------------------------------------------------------
CURSOR cProcesso_01553(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'C') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01554
---------------------------------------------------------------------------
CURSOR cProcesso_01554(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'C') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01555
---------------------------------------------------------------------------
CURSOR cProcesso_01555(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'C') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01556
---------------------------------------------------------------------------
CURSOR cProcesso_01556(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR À RECEBER NO MÊS PART. (GLOBAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_a_receber),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'P') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_a_receber
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01557
---------------------------------------------------------------------------
CURSOR cProcesso_01557(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'P') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01558
---------------------------------------------------------------------------
CURSOR cProcesso_01558(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'P') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01559
---------------------------------------------------------------------------
CURSOR cProcesso_01559(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'P') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01560
---------------------------------------------------------------------------
CURSOR cProcesso_01560(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'P') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01561
---------------------------------------------------------------------------
CURSOR cProcesso_01561(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio = 'P') And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01562
---------------------------------------------------------------------------
CURSOR cProcesso_01562(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'VALOR À RECEBER NO MÊS CONV./PART. (GLOBAL)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Nvl(( SELECT Trunc(Avg(Dme.vl_a_receber),2)
FROM ( SELECT Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio in ('C','P')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes ) Dme ),0) vl_a_receber
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01563
---------------------------------------------------------------------------
CURSOR cProcesso_01563(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('C','P')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01564
---------------------------------------------------------------------------
CURSOR cProcesso_01564(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('C','P')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01565
---------------------------------------------------------------------------
CURSOR cProcesso_01565(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('C','P')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01566
---------------------------------------------------------------------------
CURSOR cProcesso_01566(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('C','P')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01567
---------------------------------------------------------------------------
CURSOR cProcesso_01567(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , NULL Tp_Diagnostico , NULL Nm_Indicador , NULL Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Setor.Cd_Setor Cd_Departamento , Setor.Nm_Setor Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'VALOR À RECEBER (PROJETADO): R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_Projetado),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER PREVISTO: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber_previsto),0),'999G999G999G999D99')),'0,00')||Chr(10)|| 'VALOR À RECEBER NO MÊS: R$ '||Nvl(Ltrim(To_Char(Nvl(Sum(Movimento.vl_a_receber),0),'999G999G999G999D99')),'0,00')||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_VALOR_ECONOMICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.vl_a_receber_Projetado,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.vl_a_receber_Projetado_dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTOS--- SELECT Mov.Cd_Setor , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Nvl(Mov.vl_a_receber,0) vl_a_receber , Trunc(Nvl(Mov.vl_a_receber,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_dia , Nvl(Mov.vl_a_receber_previsto,0) vl_a_receber_previsto , Nvl(Mov.vl_a_receber_Projetado,0) vl_a_receber_Projetado , Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/To_Char(v_Dt_Fim_Diagno,'DD'),2) vl_a_receber_Projetado_dia , Case
WHEN Nvl(Mov.vl_a_receber_previsto,0) = 0
THEN 0
ELSE Trunc(Nvl(Mov.vl_a_receber_Projetado,0)/Nvl(Mov.vl_a_receber_previsto,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Mov.Cd_Setor , Nvl(Mov.vl_a_receber,0) vl_a_receber , MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Setor,pNrCnpj,'SLA') vl_a_receber_previsto , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.vl_a_receber,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) vl_a_receber_Projetado
FROM ( SELECT Dme.Cd_Setor , Dme.Dt_Mes , Sum(Nvl(Dme.vl_a_receber,0)) vl_a_receber
FROM MvccAdmin.Fato_Valor_Economico Dme
WHERE Dme.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM Dbamv.Convenio Con
WHERE Con.Cd_Fornecedor = Dme.Cd_Fornecedor And Con.Tp_Convenio In ('C','P')) And Dme.Dt_Mes Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Dme.Dt_Mes , Dme.Cd_Setor ) Mov ) Mov ) Movimento , Dbamv.Setor , MvccAdmin.Estabelecimento
WHERE Setor.Cd_Setor = Movimento.Cd_Setor And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Setor.Cd_Setor , Setor.Nm_Setor , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01568
---------------------------------------------------------------------------
CURSOR cProcesso_01568(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA HEMATOLOGIA GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE PACIENTE-DIA HEMATOLOGIA GLOBAL'||Chr(10)||', QTDE PROJETADA: '||Sum(Nvl(Movimento.Qtde_Projetada,0))||Chr(10) ||', QTDE PRODUZIDA: '||Sum(Nvl(Movimento.Qtde_Utilizada,0))||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Utilizada,0)) Qtde_Conforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0)) Qtde_Conforme_Dia , Sum(Nvl(Movimento.Qtde_Instalada_Dia,0)) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO--- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada) Qtde_Utilizada , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Tip.Cd_Tipo_Internacao,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno),0) Qtde_Utilizada , Nvl(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Null,Null,Tip.Cd_Tipo_Internacao,Trunc(Sysdate),Trunc(Sysdate)+.99999),0) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und , Dbamv.Tipo_Internacao Tip , Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Tip.Cd_Tipo_Internacao And Vcc.Cd_Tipo_Campo_Chave = 65 --TIPO DE INTERNACAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Str.Cd_multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01569
---------------------------------------------------------------------------
CURSOR cProcesso_01569(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTE-DIA HEMATOLOGIA CONV./PART.' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'QTDE DE PACIENTE-DIA HEMATOLOGIA CONV./PART.'||Chr(10)||', QTDE PROJETADA: '||Sum(Nvl(Movimento.Qtde_Projetada,0))||Chr(10) ||', QTDE PRODUZIDA: '||Sum(Nvl(Movimento.Qtde_Utilizada,0))||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Utilizada,0)) Qtde_Conforme , Sum(Nvl(Movimento.Qtde_Instalada,0)) Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Utilizada_Dia,0)) Qtde_Conforme_Dia , Sum(Nvl(Movimento.Qtde_Instalada_Dia,0)) Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO ATENDIMENTO--- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_mes , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Qtde_Instalada , Mov.Qtde_Instalada_Dia , Mov.Qtde_Utilizada , Mov.Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Mov.Qtde_Utilizada,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'M'),0) Qtde_Instalada , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Final_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Tip.Cd_Tipo_Internacao,v_Dt_Ini_Diagno,v_Dt_Fim_Diagno)) Qtde_Utilizada , Sum(MvccAdmin.Fnc_Leitos_Utilizados(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,Con.Cd_Convenio,Null,Tip.Cd_Tipo_Internacao,Trunc(Sysdate),Trunc(Sysdate)+.99999)) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und, Dbamv.Convenio Con, Dbamv.Setor Str, Dbamv.Tipo_Internacao Tip
WHERE Str.Cd_Setor = Und.Cd_Setor And Con.Cd_Convenio = ( SELECT Distinct Ate.Cd_Convenio
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Convenio = Con.Cd_Convenio And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Und.Sn_Ativo = 'S' And Con.Sn_Ativo = 'S' And Con.Tp_Convenio IN ('C','P') And Str.Cd_multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Tip.Cd_Tipo_Internacao And Vcc.Cd_Tipo_Campo_Chave = 65 --TIPO DE INTERNACAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY Und.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01570
---------------------------------------------------------------------------
CURSOR cProcesso_01570(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Cid.Ds_Cid||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Cid , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Cid , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin. Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Cid , Mov.Data_Mes ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01571
---------------------------------------------------------------------------
CURSOR cProcesso_01571(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cen_Cir.Cd_Cen_Cir Cd_Departamento , Cen_Cir.Ds_Cen_Cir Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cen_Cir.Ds_Cen_Cir||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Cen_Cir , Mov.Dt_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Cen_Cir , Avi.Dt_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Cen_Cir , To_Char(Avi.Dt_Realizacao,'MM/YYYY') dt_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada --- IDADE MINIMA A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 74 --IDADE MINIMA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) -- CIRUGIAS A SER DESCONSIDERADAS -- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 89 --CIRURGIA A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Cen_Cir , Avi.Dt_Mes ) Mov ) Movimento , Dbamv.Cen_Cir , MvccAdmin.Estabelecimento
WHERE Cen_Cir.Cd_Cen_Cir = Movimento.Cd_Cen_Cir And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Cen_Cir.Cd_Cen_Cir , Cen_Cir.Ds_Cen_Cir , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01572
---------------------------------------------------------------------------
CURSOR cProcesso_01572(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cen_Cir.Cd_Cen_Cir Cd_Departamento , Cen_Cir.Ds_Cen_Cir Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cen_Cir.Ds_Cen_Cir||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) ||' ,TAXA: '||Sum(Movimento.Vl_Taxa_Conforme)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AVISO_CIRURGIA' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_cen_Cir , Mov.Data_Mes , Nvl(Mov.Qtde_Realizada,0) Qtde_Realizada , Nvl(Mov.Qtde_Realizada_Dia,0) Qtde_Realizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Case
WHEN Nvl(Mov.Qtde_Realizada,0) = 0
THEN 0
ELSE Round(Nvl(Mov.Qtde_Realizada,0)/Nvl(Mov.Qtde_Projetada,0)*100,2)
END Vl_Taxa_Conforme
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_cen_Cir , Avi.Data_Mes , Sum(Avi.Qtde_Realizada) Qtde_Realizada , Sum(Avi.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_cen_Cir , To_Char(Avi.Dt_Realizacao,'MM/YYYY') data_mes , 1 Qtde_Realizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.sn_principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada And Avi.tp_cirurgias = 'U' --Somente (U)rg¿ncia. --- IDADE MINIMA A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 74 --IDADE MINIMA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) -- CIRUGIAS A SER DESCONSIDERADAS -- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 89 --CIRURGIA A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Avi.Cd_Cen_Cir Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Cen_Cir , Avi.Data_Mes ) Mov ) Movimento , Dbamv.Cen_Cir , MvccAdmin.Estabelecimento
WHERE Cen_Cir.Cd_Cen_Cir = Movimento.Cd_Cen_Cir And Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Cen_Cir.Cd_Cen_Cir , Cen_Cir.Ds_Cen_Cir , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01584
---------------------------------------------------------------------------
CURSOR cProcesso_01584(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE LEITOS INSTALADOS (ATIVOS)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE LEITOS INSTALADOS (ATIVOS), TOTAL: '||Sum(Movimento.Qtde_Conforme) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , Null Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Conforme) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Sum(Movimento.Qtde_Conforme_Dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Str.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_mes , Trunc(Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0)/To_Number(To_Char(v_Dt_Fim_Diagno,'DD')),2) Qtde_Conforme , Trunc(Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0),2) Qtde_Conforme_Dia
FROM Dbamv.Unid_Int Und , Dbamv.Setor Str
WHERE Und.Cd_Setor = Str.Cd_Setor And Und.Sn_Ativo = 'S' And Und.tp_unid_int = 'I' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Nr_Cnpj , Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY'));


---------------------------------------------------------------------------
-- CURSOR cProcesso_01585
---------------------------------------------------------------------------
CURSOR cProcesso_01585(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE LEITOS EXTRAS (ATIVOS)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE LEITOS EXTRAS (ATIVOS), TOTAL: '||Movimento.Qtde_Conforme Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , Null Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Str.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_mes , Count(1) Qtde_Conforme
FROM Dbamv.Leito Lei , Dbamv.Unid_Int Und , Dbamv.Setor Str , Dbamv.Multi_Empresas Emp
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Und.Cd_Setor = Str.Cd_Setor And Emp.Cd_Multi_Empresa = Str.Cd_Multi_Empresa And Lei.Sn_Extra = 'S' And Lei.Tp_Situacao = 'A' And Und.Tp_Unid_Int = 'I' And Str.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Str.Cd_Multi_Empresa ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01586
---------------------------------------------------------------------------
CURSOR cProcesso_01586(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE LEITOS UTILIZADOS P/PACIENTE' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE LEITOS UTILIZADOS P/PACIENTE, TOTAL: '||Movimento.Qtde_Conforme Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , Null Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Ate.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_mes , Count(Distinct Ate.cd_Leito) Qtde_Conforme
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno
GROUP BY Ate.Cd_Multi_Empresa ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01589
---------------------------------------------------------------------------
CURSOR cProcesso_01589(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE LEITOS DE URGENCIA (ATIVOS)' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE LEITOS DE URGENCIA (ATIVOS), TOTAL: '||Movimento.Qtde_Conforme Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , Null Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Movimento.Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Str.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_mes , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0) Qtde_Conforme , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Conforme_Dia
FROM Dbamv.Unid_Int Und , Dbamv.Setor Str
WHERE Und.Cd_Setor = Str.Cd_Setor And Und.Sn_Ativo = 'S' And Und.tp_unid_int = 'U' And Str.Cd_Multi_Empresa = pCdMultiEmpresa ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01590
---------------------------------------------------------------------------
CURSOR cProcesso_01590(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S EM RESPIRADOR NA URGÊNCIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE PAC´S EM RESPIRADOR NA URGÊNCIA, TOTAL: '||Sum(Movimento.Qtde_Conforme) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , Null Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Conforme) Qtde_Conforme , Null Qtde_Total , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Sum(Movimento.Qtde_Conforme_Dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--PROCEDIMENTO INVASIVO-- SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_mes , Count(1) Qtde_Conforme , Count(1) Qtde_Conforme_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Mov_Inv Mov
WHERE Ate.Tp_Atendimento = 'U' And Ate.Cd_Atendimento = Mov.Cd_Atendimento And Mov.Dt_Termino IS Null --PROCEDIMENTO NÃO RETIRADO And Ate.Dh_Atendimento Between Mov.Dt_Inicio And Nvl(Mov.Dt_Termino,Sysdate) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 192 --PROCESSO DE USO DE OXIGENIO - PROC_INVASIVO And Vcc.Cd_Campo_Chave = To_Char(Mov.cd_pro_invasivo) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Atendimento,'MM/YYYY')
UNION ALL --MOVIMENTO DE GASES-- SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_mes , Count(1) Qtde_Conforme , Count(1) Qtde_Conforme_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Mvto_Gases Mov
WHERE Ate.Tp_Atendimento = 'U' And Ate.Cd_Atendimento = Mov.Cd_Atendimento And Mov.Dt_Desliga IS Null --Procedimento Não Desligado And Ate.Dh_Atendimento Between Mov.Dt_Liga And Nvl(Mov.Dt_Desliga,Sysdate) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 193 --PROCESSO DE USO DE OXIGENIO - LIGA_DESLIGA And Vcc.Cd_Campo_Chave = To_Char(Mov.Cd_Tip_Presc) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Atendimento,'MM/YYYY') ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Nr_Cnpj , Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY'));


---------------------------------------------------------------------------
-- CURSOR cProcesso_01591
---------------------------------------------------------------------------
CURSOR cProcesso_01591(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE INTERNAÇÕES A PARTIR DA URGENCIA GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC DE INTERNAÇÕES A PARTIR DA URGENCIA GLOBAL'||', QTDE DE ALTAS DA URGENCIA: '||Movimento.Qtde_Altas ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO: '||Movimento.Qtde_Encaminhado ||', TAXA DE INTERNAÇÃO DA URGÊNCIA: '||Movimento.Vl_Taxa_Encaminhado||'%' ||', QTDE DE ALTAS DA URGENCIA NO DIA: '||Movimento.Qtde_Altas_Dia ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO NO DIA: '||Movimento.Qtde_Encaminhado_Dia ||', TAXA DE INTERNAÇÃO DA URGÊNCIA NO DIA: '||Movimento.Vl_Taxa_Encaminhado_Dia||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Taxa_Encaminhado Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Taxa_Encaminhado_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Encaminhado) Qtde_Encaminhado , Sum(Mov.Qtde_Encaminhado_Dia) Qtde_Encaminhado_Dia , (Case
WHEN Sum(Mov.Qtde_Altas) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado)/Sum(Mov.Qtde_Altas))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado , (Case
WHEN Sum(Mov.Qtde_Altas_Dia) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado_Dia)/Sum(Mov.Qtde_Altas_Dia))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Lei.Cd_Unid_Int , To_Char(Mov.Dt_Atendimento,'MM/YYYY') Data_mes , Qtde_Altas.Qtde_Altas , Qtde_Altas.Qtde_Altas_Dia , Count(1) Qtde_Encaminhado , Sum(Case
WHEN Mov.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Encaminhado_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dt_Atendimento , ( SELECT Min(Mov.Cd_Mov_Int)
FROM Dbamv.Mov_Int Mov , ( SELECT Cd_Atendimento, Dh_Atendimento, Cd_paciente
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno
GROUP BY Cd_Atendimento, Dh_Atendimento, Cd_paciente) Ate_Int , Dbamv.Leito Lei
WHERE Mov.Cd_Atendimento = Ate_Int.Cd_Atendimento And Ate_Int.Cd_Paciente = Ate.Cd_Paciente And Mov.Cd_leito = Lei.Cd_Leito And Ate_Int.Dh_Atendimento >= Ate.Dh_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Cd_Mov_Int
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Dt_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Tip.Tp_Saida_Tiss = 4 ) Mov , Dbamv.Mov_Int , Dbamv.Leito Lei , ( SELECT Count(1) Qtde_Altas , Sum(Case
WHEN Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Dt_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Tip.Tp_Saida_Tiss = 4 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate_Int
WHERE Ate_Int.Cd_Movimentacao = 4 And Ate_Int.Dh_Atendimento >= Ate.Dh_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Int.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) )) Qtde_Altas
WHERE Mov.Cd_Mov_Int = Mov_Int.Cd_Mov_Int And Mov_Int.Cd_Leito = Lei.Cd_Leito
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dt_Atendimento,'MM/YYYY') , Lei.Cd_Unid_Int , Qtde_Altas.Qtde_Altas , Qtde_Altas.Qtde_Altas_Dia ) Mov
GROUP BY Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01592
---------------------------------------------------------------------------
CURSOR cProcesso_01592(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE INTERNAÇÕES A PARTIR DA URGENCIA GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE INTERNAÇÕES A PARTIR DA URGENCIA GLOBAL'||', QTDE DE ALTAS DA URGENCIA: '||Movimento.Qtde_Altas ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO: '||Movimento.Qtde_Encaminhado ||', TAXA DE INTERNAÇÃO DA URGÊNCIA: '||Movimento.Vl_Taxa_Encaminhado||'%' ||', QTDE DE ALTAS DA URGENCIA NO DIA: '||Movimento.Qtde_Altas_Dia ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO NO DIA: '||Movimento.Qtde_Encaminhado_Dia ||', TAXA DE INTERNAÇÃO DA URGÊNCIA NO DIA: '||Movimento.Vl_Taxa_Encaminhado_Dia||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Encaminhado Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Encaminhado_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Encaminhado) Qtde_Encaminhado , Sum(Mov.Qtde_Encaminhado_Dia) Qtde_Encaminhado_Dia , (Case
WHEN Sum(Mov.Qtde_Altas) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado)/Sum(Mov.Qtde_Altas))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado , (Case
WHEN Sum(Mov.Qtde_Altas_Dia) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado_Dia)/Sum(Mov.Qtde_Altas_Dia))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_mes , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Encaminhado) Qtde_Encaminhado , Sum(Mov.Qtde_Encaminhado_Dia) Qtde_Encaminhado_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Atendimento , Ate_Int.Cd_Unid_Int , 1 Qtde_Altas , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia , (Case
WHEN Ate_Int.Dh_Atendimento IS Not Null
THEN 1
ELSE 0
END ) Qtde_Encaminhado , (Case
WHEN Ate_Int.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Encaminhado_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , MvccAdmin.Fato_Atendime_Internado Ate_Int , Dbamv.Tip_Res Tip
WHERE Ate_Int.Cd_Movimentacao = 4 --INTERNAÇÕES And Ate.Cd_Paciente = Ate_Int.Cd_Paciente(+) And Ate_Int.Dh_Atendimento(+) Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Int.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Cd_multi_empresa = Ate_Int.Cd_multi_empresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Tip.Tp_Saida_Tiss = 4 And Ate.Dh_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Qtde_Altas , Mov.Qtde_Altas_Dia ) Mov
GROUP BY Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01593
---------------------------------------------------------------------------
CURSOR cProcesso_01593(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE DE ALTAS DA URGENCIA: '||Movimento.Qtde_Altas ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO: '||Movimento.Qtde_Encaminhado ||', TAXA DE INTERNAÇÃO DA URGÊNCIA: '||Movimento.Vl_Taxa_Encaminhado||'%' ||', QTDE DE ALTAS DA URGENCIA NO DIA: '||Movimento.Qtde_Altas_Dia ||', QTDE DE ENCAMINHADO P/INTERNAÇÃO NO DIA: '||Movimento.Qtde_Encaminhado_Dia ||', TAXA DE INTERNAÇÃO DA URGÊNCIA NO DIA: '||Movimento.Vl_Taxa_Encaminhado_Dia||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Encaminhado Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Encaminhado_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Encaminhado) Qtde_Encaminhado , Sum(Mov.Qtde_Encaminhado_Dia) Qtde_Encaminhado_Dia , (Case
WHEN Sum(Mov.Qtde_Altas) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado)/Sum(Mov.Qtde_Altas))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado , (Case
WHEN Sum(Mov.Qtde_Altas_Dia) > 0
THEN Trunc((Sum(Mov.Qtde_Encaminhado_Dia)/Sum(Mov.Qtde_Altas_Dia))*100,2)
ELSE 0
END ) Vl_Taxa_Encaminhado_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Lei.Cd_Unid_Int , To_Char(Mov.Dt_Atendimento,'MM/YYYY') Data_mes , Qtde_Altas.Qtde_Altas , Qtde_Altas.Qtde_Altas_Dia , Count(1) Qtde_Encaminhado , Sum(Case
WHEN Mov.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Encaminhado_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Dt_Atendimento , ( SELECT Min(Mov.Cd_Mov_Int)
FROM Dbamv.Mov_Int Mov , ( SELECT Cd_Atendimento, Dh_Atendimento, Cd_paciente
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno
GROUP BY Cd_Atendimento, Dh_Atendimento, Cd_paciente) Ate_Int , Dbamv.Leito Lei
WHERE Mov.Cd_Atendimento = Ate_Int.Cd_Atendimento And Ate_Int.Cd_Paciente = Ate.Cd_Paciente And Mov.Cd_leito = Lei.Cd_Leito And Ate_Int.Dh_Atendimento >= Ate.Dh_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Lei.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Lei.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Cd_Mov_Int
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Dt_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Tip.Tp_Saida_Tiss = 4 ) Mov , Dbamv.Mov_Int , Dbamv.Leito Lei , ( SELECT Count(1) Qtde_Altas , Sum(Case
WHEN Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Tip
WHERE Ate.Dt_Atendimento Between V_Dt_Ini_Diagno And V_Dt_Fim_Diagno And Ate.Cd_multi_empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Tp_Atendimento = 'U' And Ate.Cd_Tip_Res = Tip.Cd_Tip_Res And Tip.Tp_Saida_Tiss = 4 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate_Int
WHERE Ate_Int.Cd_Movimentacao = 4 And Ate_Int.Dh_Atendimento >= Ate.Dh_Atendimento And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Int.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNACAO A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) )) Qtde_Altas
WHERE Mov.Cd_Mov_Int = Mov_Int.Cd_Mov_Int And Mov_Int.Cd_Leito = Lei.Cd_Leito
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dt_Atendimento,'MM/YYYY') , Lei.Cd_Unid_Int , Qtde_Altas.Qtde_Altas , Qtde_Altas.Qtde_Altas_Dia ) Mov
GROUP BY Mov.Cd_Unid_Int ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01595
---------------------------------------------------------------------------
CURSOR cProcesso_01595(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', PERC DE UTILIZAÇÃO DO LEITO: '||Movimento.Vl_Perc_Conforme||'%' ||', NÚMERO DE PACIENTE DIA: '||Movimento.Nr_Paciente_Dia ||', QTDE DE LEITOS OPERACIONAIS: '||Movimento.Qtde_Leitos ||', TEMPO MÉDIO DE PERMANÊNCIA: '||Movimento.Vl_Media_Permanencia||'(Dia)' ||', PERC DE UTILIZAÇÃO DO LEITO DO DIA: '||Movimento.Vl_Perc_Conforme_Dia||'%' ||', NÚMERO DE PACIENTE DIA DO DIA: '||Movimento.Nr_Paciente_Dia_Dia ||', QTDE DE LEITOS OPERACIONAIS DO DIA: '||Movimento.Qtde_Leitos ||', TEMPO MÉDIO DE PERMANÊNCIA NO DIA: '||Movimento.Vl_Media_Permanencia||'(Dia)' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Perc_Conforme Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Perc_Conforme_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Unid_Int , Mov.Nr_Paciente_Dia , Mov.Nr_Paciente_Dia_Dia , Mov.Nr_Saidas , Mov.Qtde_Leitos , Mov.Qtde_Leitos_Dia , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Media_Permanencia , Mov.Vl_Media_Permanencia_Dia --Número de pacientes internados no dia X Média de permanência / Número de leitos operacionais da Organização. , Trunc((Case
WHEN Nvl(Mov.Qtde_Leitos,0) = 0
THEN 0
ELSE ((Mov.Nr_Paciente_Dia_Dia*Mov.Vl_Media_Permanencia)/Mov.Qtde_Leitos)*100
END ),2) Vl_Perc_Conforme , Trunc((Case
WHEN Nvl(Mov.Qtde_Leitos_Dia,0) = 0
THEN 0
ELSE ((Mov.Nr_Paciente_Dia_Dia*Mov.Vl_Media_Permanencia_Dia)/Mov.Qtde_Leitos_Dia)*100
END ),2) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Nr_Paciente_Dia , Mov.Nr_Paciente_Dia_Dia , Mov.Nr_Saidas , Mov.Qtde_Leitos , Mov.Qtde_Leitos_Dia , Round(Case
WHEN Mov.Nr_Saidas = 0
THEN (Mov.Nr_Paciente_Dia/1)
ELSE (Mov.Nr_Paciente_Dia/Mov.Nr_Saidas)
END ,2) Vl_Media_Permanencia , Round(Case
WHEN Mov.Nr_Saidas_Dia = 0
THEN (Mov.Nr_Paciente_Dia_Dia/1)
ELSE (Mov.Nr_Paciente_Dia_Dia/Mov.Nr_Saidas_Dia)
END ,2) Vl_Media_Permanencia_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0)/To_Number(To_Char(v_Dt_Atual_Diagno,'DD')) Qtde_Leitos , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Leitos_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Nr_Paciente_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Nr_Saidas , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Nr_Paciente_Dia_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Nr_Saidas_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Setor.Cd_Setor = Und.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Unid_Int.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01596
---------------------------------------------------------------------------
CURSOR cProcesso_01596(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE UTILIZAÇÃO DO LEITO INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC DE UTILIZAÇÃO DO LEITO INSTITUCIONAL'||', TEMPO MÉDIO DE PERMANÊNCIA DO PAC. INTERNADO: '||Movimento.Vl_Media_Permanencia||Chr(10) ||', QTDE MÉDIA DE INTERNAÇÕES DIÁRIAS: '||Movimento.Nr_Medio_Internacao_Dia||Chr(10) ||', QUADE DE LEITOS OPERACIONAIS: '||Movimento.Qtde_Leitos_Disponivel||Chr(10) ||', FATOR DE UTILIZAÇÃO DO LEITO: '||Movimento.Vl_Fator_Conforme||Chr(10) ||', PERC DE UTILIZAÇÃO DO LEITO: '||Movimento.Vl_Perc_Conforme||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Perc_Conforme Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Perc_Conforme Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Nr_Medio_Internacao_Dia , Mov.Qtde_Leitos_Disponivel , Mov.Vl_Media_Permanencia , Mov.Nr_Saidas , Mov.Nr_Paciente_Dia , Mov.Nr_Internados_Dia ---TEMPO MEDIO DE PERMANENCIA DO PAC INTERNADO X QTDE MÉDIA DE INTERNAÇÕES DIARIA / NúMERO DE LEITOS OPERACIONAIS DA ORGANIZAÇÃO--- , Trunc((Case
WHEN Mov.Qtde_Leitos_Disponivel = 0
THEN 0
ELSE Mov.Vl_Media_Permanencia * Mov.Nr_Medio_Internacao_Dia / Mov.Qtde_Leitos_Disponivel
END ),2) Vl_Fator_Conforme , Trunc((Case
WHEN Mov.Qtde_Leitos_Disponivel = 0
THEN 0
ELSE Mov.Vl_Media_Permanencia * Mov.Nr_Medio_Internacao_Dia / Mov.Qtde_Leitos_Disponivel
END )*100,2) Vl_Perc_Conforme ---QTDE MÉDIA DE INTERNAÇÕES NO DIA / NúMERO DE LEITOS OPERACIONAIS DA ORGANIZAÇÃO--- , Trunc((Case
WHEN Mov.Qtde_Leitos_Disponivel = 0
THEN 0
ELSE Mov.Nr_Internados_Dia / Mov.Qtde_Leitos_Disponivel
END ),2) vl_Fator_conforme_dia , Trunc((Case
WHEN Mov.Qtde_Leitos_Disponivel = 0
THEN 0
ELSE Mov.Nr_Internados_Dia / Mov.Qtde_Leitos_Disponivel
END )*100,2) vl_perc_conforme_dia
FROM ( SELECT Mov.Nr_Medio_Internacao_Dia , Mov.Qtde_Leitos_Disponivel , Mov.Nr_Saidas , Mov.Nr_Paciente_Dia , Mov.Nr_Internados_Dia , Round(Case
WHEN Nvl(Mov.Nr_Saidas,0) = 0
THEN Mov.Nr_Paciente_Dia
ELSE (Mov.Nr_Paciente_Dia/Mov.Nr_Saidas)
END ,2) Vl_Media_Permanencia
FROM ( SELECT ---NUMERO DE PACIENTES INTERNADOS--- Avg(( SELECT Trunc(Avg(Nr_Medio_Internacao_Dia))
FROM ( SELECT Count(Distinct Cd_Atendimento) Nr_Medio_Internacao_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Trunc(Dh_Atendimento) ))) Nr_Medio_Internacao_Dia , Sum(( SELECT Count(Distinct Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Dh_Alta IS Null And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa )) Nr_Internados_Dia , Sum(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta IS Null --AINDA ESTÃO NA URGENCIA And Not Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate_Int
WHERE Ate_Int.Dh_Atendimento > Ate.Dh_Atendimento And Ate_Int.Cd_Paciente = Ate.Cd_Paciente And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate_Int.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa)
GROUP BY Ate_Int.Cd_Paciente) --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And (Exists (--PROCESSO DE BOARDING INTERNAÇÃO-DOC. ELETRONICO-- SELECT 1
FROM MvccAdmin.Fato_Documento_Clinico Pdc, MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Pdc.Cd_Documento And Vcc.Cd_Tipo_Campo_Chave = 1 --DOCUMENTO ELETRONICO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Pdc.Tp_Status IN ('ASSINADO','FECHADO') And Pdc.Cd_Atendimento = Ate.Cd_Atendimento) or Exists (--SOLICITAÇÃO DE GUIA DE INTERNACAO-- SELECT 1
FROM Dbamv.Tiss_Sol_Guia Sol
WHERE Sol.Nm_Xml = 'solicitacaoInternacao' And Sol.Cd_Atendimento = Ate.Cd_Atendimento) or Exists (--ITEM DE PRESCRIÇÃO DE SOLICITAÇÃO DE INTERNAÇÃO-- SELECT 1
FROM Dbamv.Laudo_Aih Lau
WHERE Lau.Cd_Atendimento = Ate.Cd_Atendimento) or Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre, Dbamv.ItPre_Med Itp, MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRIÇÃO A SER CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Itp.Tp_Situacao = 'N' And Pre.Fl_Impresso = 'S' And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Pre.Cd_Atendimento = Ate.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 195 --CONSIDERAR PAC´S AGUARDANDO LEITOS NA URGÊNCIA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno-30 --QTDE DE DIAS AGUARDANDO NA URGENCIA And v_Dt_Fim_Diagno And Ate.cd_multi_empresa = pCdMultiEmpresa )) Nr_Internados_Urgencia , Sum(( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Movimentacao = 1 --- UNIDADE DE INTERNACAO DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNAÇÃO DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno )) Nr_Paciente_Dia , Sum(( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Multi_Empresa = pCdMultiEmpresa And Ate.Cd_Movimentacao = 5 --- UNIDADE DE INTERNACAO DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Unid_Int And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNAÇÃO DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno )) Nr_Saidas , Sum(( SELECT Sum(Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0)) Qtde_Leitos_Disponivel
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor
WHERE Setor.Cd_Setor = Und.Cd_Setor And Setor.Cd_Multi_Empresa = pCdMultiEmpresa) )) Qtde_Leitos_Disponivel
FROM Dual ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01597
---------------------------------------------------------------------------
CURSOR cProcesso_01597(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PACIENTES ACAMADOS: '||Sum(Movimento.Qtde_Pacientes)||Chr(10) ||', QTDE PROFISSIONAIS TRABALHANDO: '||Sum(Movimento.Qtde_Recursos_Atendendo)||Chr(10) ||', QTDE RECURSOS PREVISTOS (POR PACIENTE): '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Perc_Utilizacao,0))||'%'||Chr(10) ||', FATOR DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Fator_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Recursos_Previsto , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Unid_Int,pNrCnpj,'SLA'),4)) Qtde_Recursos_Previsto
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int , Count(Distinct Ate.Cd_Atendimento) Qtde_Pacientes , Count(Distinct Doc.Cd_Prestador) Qtde_Recursos_Atendendo
FROM MvccAdmin.Fato_Atendime_Internado Ate , MvccAdmin.Fato_Documento_Clinico Doc
WHERE Doc.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Doc.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Prestador Ptd, MvccAdmin.V_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ptd.Cd_Tip_Presta) And Ptd.Cd_Prestador = Doc.Cd_Prestador And Vcc.Cd_Tipo_Campo_Chave = 194 --TIPO DE PRESTADOR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.cd_multi_empresa = pCdMvccEmpresa) And Doc.dh_referencia Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01598
---------------------------------------------------------------------------
CURSOR cProcesso_01598(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE UTILIZAÇÃO DA CLASSIFICAÇÃO NA URGENCIA' Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , 'PERC DE UTILIZAÇÃO DA CLASSIFICAÇÃO'||', QTDE PACIENTES ACAMADOS: '||Sum(Movimento.Qtde_Pacientes)||Chr(10) ||', QTDE PROFISSIONAIS TRABALHANDO: '||Sum(Movimento.Qtde_Recursos_Atendendo)||Chr(10) ||', QTDE RECURSOS PREVISTOS (POR PACIENTE): '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Perc_Utilizacao,0))||'%'||Chr(10) ||', FATOR DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Fator_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'TRIAGEM_ATENDIMENTO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Previsto , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA'),4)) Qtde_Recursos_Previsto
FROM ( SELECT Ta.Cd_Multi_Empresa , Count(Distinct Ta.Cd_Triagem_Atendimento) Qtde_Pacientes , Count(Distinct Ta.Nm_Usuario_Triagem) Qtde_Recursos_Atendendo
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Fila_Senha Fl
WHERE Ta.Dh_Removido IS Null And Ta.cd_cor_referencia IS Not null And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fl
WHERE Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Fl.cd_multi_empresa = pCdMultiEmpresa) And To_Char(Ta.Dh_Pre_Atendimento,'DD/MM/YYYY HH24') = To_Char(Sysdate,'DD/MM/YYYY HH24') And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ta.Cd_Multi_Empresa ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01599
---------------------------------------------------------------------------
CURSOR cProcesso_01599(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE PACIENTES ACAMADOS: '||Sum(Movimento.Qtde_Pacientes)||Chr(10) ||', QTDE PROFISSIONAIS TRABALHANDO: '||Sum(Movimento.Qtde_Recursos_Atendendo)||Chr(10) ||', QTDE RECURSOS PREVISTOS (POR PACIENTE): '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Perc_Utilizacao,0))||'%'||Chr(10) ||', FATOR DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Fator_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Recursos_Previsto , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Ori_Ate,pNrCnpj,'SLA'),4)) Qtde_Recursos_Previsto
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Count(Distinct Ate.Cd_Atendimento) Qtde_Pacientes , Count(Distinct Doc.Cd_Prestador) Qtde_Recursos_Atendendo
FROM MvccAdmin.Fato_Atendime_Externo Ate , MvccAdmin.Fato_Documento_Clinico_Urg Doc
WHERE Doc.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Doc.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Prestador Ptd, MvccAdmin.V_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ptd.Cd_Tip_Presta) And Ptd.Cd_Prestador = Doc.Cd_Prestador And Vcc.Cd_Tipo_Campo_Chave = 194 --TIPO DE PRESTADOR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.cd_multi_empresa = pCdMvccEmpresa) And Doc.dh_referencia Between Ate.Dt_Atendimento And Ate.Dt_Atendimento+.99999 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate ) Mov ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Ori_Ate.Cd_Ori_Ate , Ori_Ate.Ds_Ori_Ate , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01600
---------------------------------------------------------------------------
CURSOR cProcesso_01600(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE PACIENTES ACAMADOS: '||Sum(Movimento.Qtde_Pacientes)||Chr(10) ||', QTDE PROFISSIONAIS TRABALHANDO: '||Sum(Movimento.Qtde_Recursos_Atendendo)||Chr(10) ||', QTDE RECURSOS PREVISTOS (POR PACIENTE): '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Perc_Utilizacao,0))||'%'||Chr(10) ||', FATOR DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Fator_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Recursos_Previsto , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Ori_Ate,pNrCnpj,'SLA'),4)) Qtde_Recursos_Previsto
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Count(Distinct Ate.Cd_Atendimento) Qtde_Pacientes , Count(Distinct Doc.Cd_Prestador) Qtde_Recursos_Atendendo
FROM MvccAdmin.Fato_Atendime_Externo Ate , MvccAdmin.Fato_Documento_Clinico_Urg Doc
WHERE Doc.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Doc.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Prestador Ptd, MvccAdmin.V_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ptd.Cd_Tip_Presta) And Ptd.Cd_Prestador = Doc.Cd_Prestador And Vcc.Cd_Tipo_Campo_Chave = 194 --TIPO DE PRESTADOR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.cd_multi_empresa = pCdMvccEmpresa) And Doc.dh_referencia Between Ate.Dt_Atendimento And Ate.Dt_Atendimento+.99999 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate ) Mov ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Ori_Ate.Cd_Ori_Ate , Ori_Ate.Ds_Ori_Ate , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01601
---------------------------------------------------------------------------
CURSOR cProcesso_01601(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE PACIENTES ACAMADOS: '||Sum(Movimento.Qtde_Pacientes)||Chr(10) ||', QTDE PROFISSIONAIS TRABALHANDO: '||Sum(Movimento.Qtde_Recursos_Atendendo)||Chr(10) ||', QTDE RECURSOS PREVISTOS (POR PACIENTE): '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Perc_Utilizacao,0))||'%'||Chr(10) ||', FATOR DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Fator_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Recursos_Previsto , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Unid_Int , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Unid_Int,pNrCnpj,'SLA'),4)) Qtde_Recursos_Previsto
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int , Count(Distinct Ate.Cd_Atendimento) Qtde_Pacientes , Count(Distinct Doc.Cd_Prestador) Qtde_Recursos_Atendendo
FROM MvccAdmin.Fato_Atendime_Internado Ate , MvccAdmin.Fato_Documento_Clinico Doc
WHERE Doc.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Doc.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Prestador Ptd, MvccAdmin.V_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ptd.Cd_Tip_Presta) And Ptd.Cd_Prestador = Doc.Cd_Prestador And Vcc.Cd_Tipo_Campo_Chave = 194 --TIPO DE PRESTADOR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.cd_multi_empresa = pCdMvccEmpresa) And Doc.dh_referencia Between Ate.Dt_Internado And Ate.Dt_Internado+.99999 And Ate.Dt_Internado Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Unid_Int ) Mov ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01602
---------------------------------------------------------------------------
CURSOR cProcesso_01602(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Ori_Ate.Cd_Ori_Ate Cd_Departamento , Ori_Ate.Ds_Ori_Ate Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , Ori_Ate.Ds_Ori_Ate||', QTDE PACIENTES ACAMADOS: '||Sum(Movimento.Qtde_Pacientes)||Chr(10) ||', QTDE PROFISSIONAIS TRABALHANDO: '||Sum(Movimento.Qtde_Recursos_Atendendo)||Chr(10) ||', QTDE RECURSOS PREVISTOS (POR PACIENTE): '||Sum(Nvl(Movimento.Qtde_Recursos_Previsto,0))||Chr(10) ||', PERC. DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Perc_Utilizacao,0))||'%'||Chr(10) ||', FATOR DE UTILIZAÇÃO: '||Avg(Nvl(Movimento.Vl_Fator_Utilizacao,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Vl_Perc_Utilizacao,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , Mov.Qtde_Recursos_Previsto , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))*100
END ),2) Vl_Perc_Utilizacao , Trunc((Case
WHEN Nvl(Mov.Qtde_Recursos_Previsto,0) = 0
THEN 0
ELSE (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Atendendo,0)) / (Nvl(Mov.Qtde_Pacientes,0)/Nvl(Mov.Qtde_Recursos_Previsto,0))
END ),2) Vl_Fator_Utilizacao
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Ori_Ate , Mov.Qtde_Pacientes , Mov.Qtde_Recursos_Atendendo , To_Number(Nvl(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Mov.Cd_Ori_Ate,pNrCnpj,'SLA'),4)) Qtde_Recursos_Previsto
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Count(Distinct Ate.Cd_Atendimento) Qtde_Pacientes , Count(Distinct Doc.Cd_Prestador) Qtde_Recursos_Atendendo
FROM MvccAdmin.Fato_Atendime_Externo Ate , MvccAdmin.Fato_Documento_Clinico_Urg Doc
WHERE Doc.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Doc.Cd_Paciente = Ate.Cd_Paciente And Exists ( SELECT 1
FROM Dbamv.Prestador Ptd, MvccAdmin.V_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ptd.Cd_Tip_Presta) And Ptd.Cd_Prestador = Doc.Cd_Prestador And Vcc.Cd_Tipo_Campo_Chave = 194 --TIPO DE PRESTADOR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.cd_multi_empresa = pCdMvccEmpresa) And Doc.dh_referencia Between Ate.Dt_Atendimento And Ate.Dt_Atendimento+.99999 And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa , Ate.Cd_Ori_Ate ) Mov ) Mov ) Movimento , Dbamv.Ori_Ate , MvccAdmin.Estabelecimento
WHERE Ori_Ate.Cd_Ori_Ate = Movimento.Cd_Ori_Ate And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Ori_Ate.Cd_Ori_Ate , Ori_Ate.Ds_Ori_Ate , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01605
---------------------------------------------------------------------------
CURSOR cProcesso_01605(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S EM SERVIÇO DE URGÊNCIA' Ds_Departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) data_mes , Null Nm_Processo , 'QTDE DE PAC´S EM SERVIÇO DE URGÊNCIA, SENDO: '||', QTDE DE PAC´S ACAMADOS: '||Sum(Movimento.Qtde_Acamados)||Chr(10) ||', QTDE DE PAC´S AGUARDANDO TRIAGEM: '||Sum(Movimento.Qtde_Aguard_Classificacao)||Chr(10) ||', QTDE DE PAC´S AGUARDANDO CADASTRO: '||Sum(Nvl(Movimento.Qtde_Aguard_Cadastro,0))||Chr(10) ||', QTDE DE PAC´S AGUARDADO MÉDICO: '||Sum(Nvl(Movimento.Qtde_Aguard_Atend_Medico,0))||'%'||Chr(10) ||', TOTAL DE PAC´S: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Conforme_Dia,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Conforme_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Departamento , Mov.Ds_Departamento , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Acamados , Mov.Qtde_Aguard_Classificacao , Mov.Qtde_Aguard_Cadastro , Mov.Qtde_Aguard_Atend_Medico , (Mov.Qtde_Acamados+Mov.Qtde_Aguard_Classificacao+Mov.Qtde_Aguard_Cadastro+Mov.Qtde_Aguard_Atend_Medico) Qtde_Conforme_Dia
FROM (---QTDE DE PACIENTES NA URGENCIA: ACAMADOS--- SELECT 1 Cd_Departamento , 'QTDE DE PAC´S ACAMADOS NA URGENCIA' Ds_Departamento , Count(1) Qtde_Acamados , 0 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico
FROM ( SELECT Ate.Cd_Atendimento , Ate.Dh_Atendimento , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 98 --CONSIDERAR OU NÃO PACIENTES COM TERAPIAS (PRESCRIÇÃO) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Sn_Paciente_Terapia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS NULL --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa ) Mov
WHERE (Mov.Sn_Paciente_Terapia = 'S' And Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp , MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO CONSIDERADO And Mov.Dh_Atendimento Between Pre.Dt_Pre_Med And Pre.Dt_Pre_Med+.99999 And Pre.fl_impresso = 'S' And Pre.Cd_Atendimento = Mov.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) OR Mov.Sn_Paciente_Terapia = 'N')
UNION ALL SELECT Mov.Cd_Departamento , Mov.Ds_Departamento , 0 Qtde_Acamados , Sum(Mov.Qtde_Aguard_Classificacao) Qtde_Aguard_Classificacao , Sum(Mov.Qtde_Aguard_Cadastro) Qtde_Aguard_Cadastro , Sum(Mov.Qtde_Aguard_Atend_Medico) Qtde_Aguard_Atend_Medico
FROM (---TRIAGEM--- SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , 1000 Cd_Departamento , 'QTDE DE PAC´S AGUARDANDO TRIAGEM' Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139--FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ta.cd_cor_referencia = Cr.cd_cor_referencia(+) And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS Null And Ta.Cd_Atendimento IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , 2000 Cd_Departamento , 'QTDE DE PAC´S AGUARDANDO CADASTRO' Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 0 Qtde_Aguard_Classificacao , 1 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139--FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ta.cd_cor_referencia = Cr.cd_cor_referencia(+) And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS Null And Ta.Cd_Atendimento IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (21,22)) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---COM ATENDIMENTO: AGUARDANDO MÉDICOS--- SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , Cr.Cd_Cor_Referencia+3000 Cd_Departamento , 'QTDE DE PAC´S AGUARDANDO MÉDICO-'||Cr.nm_cor Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 0 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 1 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ate.Cd_Atendimento = Ta.Cd_Atendimento And Ta.cd_cor_referencia = Cr.cd_cor_referencia And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (21,22)) And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (31,32)) --- ORIGEM A SER DESCONSIDERADA NO CALCULO --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Departamento , Mov.Ds_Departamento ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01607
---------------------------------------------------------------------------
CURSOR cProcesso_01607(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||', QTDE DE READMISSÃO: '||Nvl(Movimento.Qtde_Reint_Uti,0)||Chr(10) ||', QTDE DE READMISSÃO <48H: '||Nvl(Movimento.Qtde_Reint_Uti_48h,0)||Chr(10) ||', TAXA DE READMISSÃO <48H: '||Nvl(Movimento.Vl_Taxa_Conforme,0)||Chr(10) ||', QTDE DE READMISSÃO NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_Dia,0)||Chr(10) ||', QTDE DE READMISSÃO <48H NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_48h_Dia,0)||Chr(10) ||', TAXA DE READMISSÃO <48H NO DIA: '||Nvl(Movimento.Vl_Taxa_Conforme_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Conforme,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Vl_Taxa_Conforme_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Mov.Qtde_Reint_Uti , Mov.Qtde_Reint_Uti_Dia , Mov.Qtde_Reint_Uti_48h , Mov.Qtde_Reint_Uti_48h_Dia , (Case
WHEN Mov.Qtde_Reint_Uti = 0
THEN 0
ELSE Round((Mov.Qtde_Reint_Uti_48h/Mov.Qtde_Reint_Uti)*100,2)
END ) Vl_Taxa_Conforme , (Case
WHEN Mov.Qtde_Reint_Uti_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Reint_Uti_48h_Dia/Mov.Qtde_Reint_Uti_Dia)*100,2)
END ) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Mov.Data_Mes , Sum(Mov.Qtde_Reint_Uti) Qtde_Reint_Uti , Sum(Mov.Qtde_Reint_Uti_Dia) Qtde_Reint_Uti_Dia , Sum(Mov.Qtde_Reint_Uti_48h) Qtde_Reint_Uti_48h , Sum(Mov.Qtde_Reint_Uti_48h_Dia) Qtde_Reint_Uti_48h_Dia
FROM ( SELECT Und.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Reint , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Tip_Acom Tip_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Leito Lei_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito --- ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA --- And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- --- O TEMPO DA ULTIMA SAIDA ATE A NOVA ENTRADA MENOR QUE 24 HORAS --- And (To_Date(To_Char(Mov_Reint.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov_Reint.Hr_Mov_Int,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') - To_Date(To_Char(Mov_Uti_Antes.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov_Uti_Antes.Hr_Lib_Mov,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 48 --48 HORAS And Mov_Uti_Antes.Dt_Lib_Mov IS Not Null And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_48h , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Reint , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Tip_Acom Tip_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Leito Lei_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito --- ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA --- And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- --- O TEMPO DA ULTIMA SAIDA ATE A NOVA ENTRADA MENOR QUE 24 HORAS --- And (To_Date(To_Char(Mov_Reint.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov_Reint.Hr_Mov_Int,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') - To_Date(To_Char(Mov_Uti_Antes.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov_Uti_Antes.Hr_Lib_Mov,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 48 --48 HORAS And Mov_Uti_Antes.Dt_Lib_Mov IS Not Null And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_48h_Dia
FROM Dbamv.Unid_Int Und
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Tp_Situacao = 'A' And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) AND Und.sn_ativo = 'S' ) Mov
GROUP BY Mov.Cd_Unid_Int , Mov.Data_Mes ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int AND Unid_Int.sn_ativo = 'S' And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01608
---------------------------------------------------------------------------
CURSOR cProcesso_01608(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Cid.Ds_Cid||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Cid , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Cid , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin. Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Cid , Mov.Data_Mes ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01609
---------------------------------------------------------------------------
CURSOR cProcesso_01609(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , NUll tp_diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.data_mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) data_mes , Null nm_processo , Cid.Ds_Cid||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Realizada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Cid , Mov.Data_Mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Cid , Mov.Data_Mes , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dt_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dt_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_dia
FROM MvccAdmin. Fato_Atendime_Externo Ate , Dbamv.It_Agenda_Central Iag
WHERE Iag.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'A' And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Iag.Cd_Item_Agendamento And Vcc.Cd_Tipo_Campo_Chave = 72 --ITEM DE AGENDAMENTO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Ate.Cd_Especialid Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dt_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Cd_Cid , Mov.Data_Mes ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01610
---------------------------------------------------------------------------
CURSOR cProcesso_01610(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cid.Ds_Cid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 4 And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01611
---------------------------------------------------------------------------
CURSOR cProcesso_01611(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cid.Ds_Cid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 5 And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01612
---------------------------------------------------------------------------
CURSOR cProcesso_01612(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cid.Ds_Cid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.Tp_Mot_Alta = 'O' And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01613
---------------------------------------------------------------------------
CURSOR cProcesso_01613(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cid.Ds_Cid||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Realizada) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Realizada_Dia) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Realizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Realizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Sum(Mov.Qtde_Realizada) Qtde_Realizada , Sum(Mov.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Mov.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa) And Ate.Cd_Movimentacao = 5 And Mot.Tp_Mot_Alta = 'O' And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01614
---------------------------------------------------------------------------
CURSOR cProcesso_01614(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cid.Ds_Cid||', QTDE OBITOS: '||Sum(Movimento.Qtde_Obitos)||Chr(10) ||', PERC. DE OBITOS: '||Sum(Movimento.Vl_Perc_Conforme)||Chr(10) ||', QTDE OBITOS NO DIA: '||Sum(Movimento.Qtde_Obitos_Dia)||Chr(10) ||', PERC. DE OBITOS NO DIA: '||Sum(Movimento.Vl_Perc_Conforme_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Perc_Conforme) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Perc_Conforme_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Mov.Qtde_Altas , Mov.Qtde_Altas_Dia , Mov.Qtde_Obitos , Mov.Qtde_Obitos_Dia , (Case
WHEN Mov.Qtde_Obitos = 0
THEN 0
ELSE Trunc((Mov.Qtde_Obitos/Mov.Qtde_Altas)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Obitos_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Obitos_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Obitos) Qtde_Obitos , Sum(Mov.Qtde_Obitos_Dia) Qtde_Obitos_Dia
FROM (---QTDE DE OBITOS--- SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 0 Qtde_Altas , 0 Qtde_Altas_Dia , 1 Qtde_Obitos , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Obitos_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Mot.Tp_Mot_Alta = 'O' And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE DE ALTAS--- SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Altas , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia , 0 Qtde_Obitos , 0 Qtde_Obitos_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Ate.Cd_Movimentacao = 5 And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01615
---------------------------------------------------------------------------
CURSOR cProcesso_01615(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cid.Ds_Cid||', QTDE OBITOS: '||Sum(Movimento.Qtde_Obitos)||Chr(10) ||', PERC. DE OBITOS: '||Sum(Movimento.Vl_Perc_Conforme)||Chr(10) ||', QTDE OBITOS NO DIA: '||Sum(Movimento.Qtde_Obitos_Dia)||Chr(10) ||', PERC. DE OBITOS NO DIA: '||Sum(Movimento.Vl_Perc_Conforme_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Perc_Conforme) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Perc_Conforme_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Mov.Qtde_Altas , Mov.Qtde_Altas_Dia , Mov.Qtde_Obitos , Mov.Qtde_Obitos_Dia , (Case
WHEN Mov.Qtde_Obitos = 0
THEN 0
ELSE Trunc((Mov.Qtde_Obitos/Mov.Qtde_Altas)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Obitos_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Obitos_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Obitos) Qtde_Obitos , Sum(Mov.Qtde_Obitos_Dia) Qtde_Obitos_Dia
FROM (---QTDE DE OBITOS--- SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Obitos , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Obitos_Dia , 0 Qtde_Altas , 0 Qtde_Altas_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa) And Ate.Cd_Movimentacao = 5 And Mot.Tp_Mot_Alta = 'O' And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE DE ALTAS--- SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 0 Qtde_Obitos , 0 Qtde_Obitos_Dia , 1 Qtde_Altas , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avi
WHERE Avi.Cd_Atendimento = Ate.Cd_Atendimento And Avi.Tp_Situacao = 'R' And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa) And Ate.Cd_Movimentacao = 5 And Trunc(Ate.Dh_Atendimento) = Trunc(Ate.Dt_Internado) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01616
---------------------------------------------------------------------------
CURSOR cProcesso_01616(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , Null nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Cid.Nr_Cid Cd_departamento , Cid.Ds_Cid Ds_departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Cid.Ds_Cid||', QTDE OBITOS: '||Sum(Movimento.Qtde_Obitos)||Chr(10) ||', PERC. DE OBITOS: '||Sum(Movimento.Vl_Perc_Conforme)||Chr(10) ||', QTDE OBITOS NO DIA: '||Sum(Movimento.Qtde_Obitos_Dia)||Chr(10) ||', PERC. DE OBITOS NO DIA: '||Sum(Movimento.Vl_Perc_Conforme_Dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Avg(Movimento.Vl_Perc_Conforme) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Avg(Movimento.Vl_Perc_Conforme_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Mov.Qtde_Altas , Mov.Qtde_Altas_Dia , Mov.Qtde_Obitos , Mov.Qtde_Obitos_Dia , (Case
WHEN Mov.Qtde_Obitos = 0
THEN 0
ELSE Trunc((Mov.Qtde_Obitos/Mov.Qtde_Altas)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Obitos_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Obitos_Dia/Mov.Qtde_Altas_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid , Sum(Mov.Qtde_Altas) Qtde_Altas , Sum(Mov.Qtde_Altas_Dia) Qtde_Altas_Dia , Sum(Mov.Qtde_Obitos) Qtde_Obitos , Sum(Mov.Qtde_Obitos_Dia) Qtde_Obitos_Dia
FROM (---QTDE DE OBITOS--- SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 0 Qtde_Altas , 0 Qtde_Altas_Dia , 1 Qtde_Obitos , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Obitos_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Tip_Res Res
WHERE Ate.Cd_Tip_Res = Res.Cd_Tip_Res And Ate.Tp_Atendimento = 'U' And Res.sn_obito = 'S' And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE DE ALTAS--- SELECT Ate.Cd_Multi_Empresa , Ate.Cd_Cid , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Altas , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Altas_Dia , 0 Qtde_Obitos , 0 Qtde_Obitos_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Cd_Cid ) Mov ) Movimento , ( SELECT Cid.cd_cid , To_Number(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(REPLACE( Cid.cd_cid,'A','100'),'B','101'),'C','102'),'D','103'),'E','104'),'F','105'),'G','106'),'G','107'),'H','108') ,'I','109'),'J','110'),'K','111'),'L','112'),'M','113'),'N','114'),'O','115'),'P','116'),'Q','117') ,'R','118'),'S','119'),'T','120'),'W','121'),'U','122'),'V','123'),'X','124'),'Y','125'),'Z','126')) Nr_Cid , Cid.cd_cid||'-'||Cid.Ds_cid Ds_cid
FROM dbamv.cid) Cid , MvccAdmin.Estabelecimento
WHERE Cid.Cd_Cid = Movimento.Cd_Cid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01619
---------------------------------------------------------------------------
CURSOR cProcesso_01619(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NULL Cd_Atendimento , NULL Cd_Paciente , NULL Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , NUll Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'FATOR DE SUPERLOTAÇÃO INSTITUCIONAL' Ds_Departamento , To_Char(Sysdate,'MM/YYYY') Data_Mes , Null Nm_Processo , 'FATOR DE SUPERLOTAÇÃO INSTITUCIONAL'||', RESULTADO: '||Movimento.Vl_Pontuacao||' ('||Movimento.Ds_Consistencia||') - '||Chr(10)||Movimento.Ds_Situacao||Chr(10) ||', QTDE DE PAC´S EM SERVIÇO DE URGÊNCIA: '||Movimento.Vl_Evento_1605||Chr(10) ||', QTDE DE LEITOS DE URGENCIA (ATIVOS): '||Movimento.Vl_Evento_1589||Chr(10) ||', QTDE DE PAC´S NA URGENCIA AGUARD. INTERNAÇÃO: '||Movimento.Vl_Evento_1531||Chr(10) ||', QTDE DE LEITOS DE INTERNAÇÃO (ATIVOS): '||Movimento.Vl_Evento_1584||Chr(10) ||', QTDE DE PAC´S EM RESPIRADOR NA URGENCIA: '||Movimento.Vl_Evento_1590||Chr(10) ||', MAIOR TEMPO BOARDING DE CHEGADA NO LEITO: '||Movimento.Vl_Evento_1620||Chr(10) ||', MAIOR TEMPO BOARDING INTERNAÇÃO: '||Movimento.Vl_Evento_1621||Chr(10) ||', PERC. DE UTILIZAÇÃO DO LEITO INSTITUCIONAL: '||Movimento.Vl_Evento_1596||Chr(10) ||', PERC. OCUPAÇÃO PREDITIVA DA URGÊNCIA: '||Movimento.Vl_Ocupacao_Preditiva_Urgencia||Chr(10) ||', PERC. OCUPAÇÃO INSTITUCIONAL: '||Movimento.Vl_Evento_316||Chr(10) ||', NOTA: '||(Case
WHEN Movimento.Ds_Situacao = 'NORMAL'
THEN 'A situação NORMAL trata-se de um momento de estabilidade indicando que a unidade está operando com folga e não requer preocupação. '||Movimento.Ds_Consistencia
WHEN Movimento.Ds_Situacao = 'OCUPADO'
THEN 'A situação OCUPADO embora seja de uma situação de estabilidade, indica que a unidade está em um nível de ocupação no seu limite e precisará ser observada e acompanhada. '||Movimento.Ds_Consistencia
WHEN Movimento.Ds_Situacao = 'SUPERLOTADO'
THEN 'A situação SUPERLOTADO indica que a unidade está operando acima do seu limite e requer uma ação imediata para não agravar ainda mais. Para uma análise imediata da situação é sugerido que, no primeiro momento, a unidade se auto avalie fazendo uma comparação com sigo mesma para perceber se algo diferente está contecendo. '||Movimento.Ds_Consistencia
WHEN Movimento.Ds_Situacao = 'GRAVE'
THEN 'A situação GRAVE indica que a unidade ULTRAPASSOU a superlotação está operando acima dos seus limites, para estes casos requer ações mais severas para não agravar ainda mais. Para uma análise imediata da situação é sugerido que, no primeiro momento, a unidade se auto avalie fazendo uma comparação com sigo mesma para perceber se algo diferente está contecendo. '||Movimento.Ds_Consistencia
WHEN Movimento.Ds_Situacao = 'ALTO RISCO'
THEN 'A situação de ALTO RISCO indica que a unidade atingiu um ponto critico e sua operação está completamente comprometida. Para uma análise imediata da situação é sugerido que, no primeiro momento, a unidade se auto avalie fazendo uma comparação com sigo mesma para perceber se algo diferente está contecendo. '||Movimento.Ds_Consistencia
WHEN Movimento.Ds_Situacao = 'SEM INFORMAÇÃO'
THEN 'Esse tipo de situação indica inconsistência nos dados coletados que precisará de um análise mais aprofundada para verificar o uso do sistema de governança da organização. O problema pode está no uso de funcionalidades ou falha em configuração necessária como é o caso de cadastro de leitos, poltronas e/ou camas disponíveis no serviços de urgência. '||Movimento.Ds_Consistencia
END ) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'DIAGNOSTICO_PROCESSO_SINTETICO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Pontuacao,0) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Pontuacao Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Vl_Evento_1605 --QTDE DE PAC´S EM SERVIÇO DE URGÊNCIA(a) , Mov.Vl_Evento_1589 --QTDE DE LEITOS DE URGENCIA (ATIVOS)(b) , Mov.Vl_Evento_1531 --QTDE DE PAC´S NA URGENCIA AGUARD. INT.(c) , Mov.Vl_Evento_1584 --QTDE DE LEITOS DE INTERNAÇÃO (ATIVOS)(d) , Mov.Vl_Evento_1590 --QTDE DE PAC´S EM RESPIRADOR NA URGENCIA(e) , Mov.Vl_Evento_1620 --TEMPO BOARDING CHEGADA NO LEITO C/MAIOR TEMPO(f) , Mov.Vl_Evento_1621 --TEMPO BOARDING INTERNAÇÃO C/MAIOR TEMPO(g) , Mov.Vl_Evento_1596 --PERC DE UTILIZAÇÃO DO LEITO INSTITUCIONAL , Mov.Vl_Evento_316 --PERC OCUPAÇÃO-GLOBAL , Mov.Vl_Ocupacao_Preditiva_Urgencia , (Case
WHEN Mov.Ds_Consistencia IS Null
THEN Null
ELSE 'FALTA(S): '||Mov.Ds_Consistencia
END ) Ds_Consistencia , (Case
WHEN Mov.Vl_pontuacao < 0
THEN -1
ELSE Mov.Vl_pontuacao
END ) Vl_pontuacao , (Case
WHEN Mov.Vl_Pontuacao < 0
THEN 'SEM INFORMAÇÃO'
WHEN Mov.Vl_Pontuacao Between 0 And 50
THEN 'NORMAL'
WHEN Mov.Vl_Pontuacao Between 51 And 100
THEN 'OCUPADO'
WHEN Mov.Vl_Pontuacao Between 101 And 140
THEN 'SUPERLOTADO'
WHEN Mov.Vl_Pontuacao Between 140 And 180
THEN 'GRAVE'
WHEN Mov.Vl_Pontuacao > 180
THEN 'ALTO RISCO'
ELSE ''
END ) Ds_Situacao
FROM ( SELECT Mov.Vl_Evento_1605 --QTDE DE PAC´S EM SERVIÇO DE URGÊNCIA(a) , Mov.Vl_Evento_1589 --QTDE DE LEITOS DE URGENCIA (ATIVOS) (b) , Mov.Vl_Evento_1531 --QTDE DE PAC´S NA URGENCIA AGUARD. INT.(c) , Mov.Vl_Evento_1584 --QTDE DE LEITOS DE INTERNAÇÃO (ATIVOS)(d) , Mov.Vl_Evento_1590 --QTDE DE PAC´S EM RESPIRADOR NA URGENCIA(e) , Mov.Vl_Evento_1620 --TEMPO BOARDING CHEGADA NO LEITO C/MAIOR TEMPO(f) , Mov.Vl_Evento_1621 --TEMPO BOARDING INTERNAÇÃO C/MAIOR TEMPO(g) , Mov.Vl_Evento_1596 --PERC DE UTILIZAÇÃO DO LEITO INSTITUCIONAL , Mov.Vl_Evento_316 --PERC OCUPAÇÃO-GLOBAL , (Case
WHEN Mov.Vl_Evento_1589 = 0
THEN 0
ELSE Trunc((Mov.Vl_Evento_1605/Mov.Vl_Evento_1589)*100,2)
END ) Vl_Ocupacao_Preditiva_Urgencia , (Case
WHEN Mov.vl_evento_1605 = 0 Or Mov.vl_evento_1589 = 0 Or Mov.vl_evento_1531 = 0 Or Mov.vl_evento_1584 = 0 Or Mov.Vl_Evento_1590 = 0 Or Mov.Vl_Evento_1620 = 0 Or Mov.Vl_Evento_1621 = 0
THEN 'INCOMPLETO'
ELSE 'COMPLETO'
END ) Ds_Consistencia , (Case
WHEN Nvl(Mov.vl_evento_1605,0) = 0
THEN 'QTDE DE PAC´S EM SERVIÇO DE URGÊNCIA'
ELSE Null
END ) ||(Case
WHEN Nvl(Mov.vl_evento_1589,0) = 0
THEN ;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01625
---------------------------------------------------------------------------

CURSOR cProcesso_01625(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE OCUPACAO PREDITIVA DA URGENCIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. DE OCUPACAO PREDITIVA DA URGÊNCIA, QTDE DE LEITOS DISPONÍVEIS NA URGÊRNCIA: '||Trunc(Sum(Movimento.Qtde_Leitos_Urgencia),2)||Chr(10) ||', QTDE DE PACIENTES NO SERVIÇO DE URGÊNCIA: '||Trunc(Sum(Movimento.Qtde_Pacientes_Uregencia),2)||Chr(10) ||', TAXA PREDITIVA DE OCUPAÇÃO: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2)||Chr(10) ||'LOCALIZAÇÃO DOS PACIENTES:'||Chr(10) ||', QTDE ACAMADOS: '||Sum(Movimento.Qtde_Acamados)||Chr(10) ||', QTDE AGUARDANDO CLASSIFICACAO: '||Sum(Movimento.Qtde_Aguard_Classificacao)||Chr(10) ||', QTDE AGUARDANDO CADASTRO: '||Sum(Movimento.Qtde_Aguard_Cadastro)||Chr(10) ||', QTDE AGUARDANDO ATEND. MÉDICO: '||Sum(Movimento.Qtde_Aguard_Atend_Medico)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Taxa_Ocupacao),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_mes , Sum(Mov.Qtde_Leitos_Urgencia) Qtde_Leitos_Urgencia , Sum(Mov.Qtde_Acamados) Qtde_Acamados , Sum(Mov.Qtde_Aguard_Classificacao) Qtde_Aguard_Classificacao , Sum(Mov.Qtde_Aguard_Cadastro) Qtde_Aguard_Cadastro , Sum(Mov.Qtde_Aguard_Atend_Medico) Qtde_Aguard_Atend_Medico , Sum(Mov.Qtde_Pacientes_Uregencia) Qtde_Pacientes_Uregencia , (Case
WHEN Sum(Mov.Qtde_Leitos_Urgencia) = 0
THEN 0
ELSE Trunc((Sum(Mov.Qtde_Pacientes_Uregencia)/Sum(Mov.Qtde_Leitos_Urgencia))*100,2)
END ) Vl_Taxa_Ocupacao
FROM (---QTDE DE LEITOS DISPONIVEIS NA URGENCIA--- SELECT Count(1) Qtde_Leitos_Urgencia , 0 Qtde_Acamados , 0 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico , 0 Qtde_Pacientes_Uregencia
FROM Dbamv.Leito Lei , Dbamv.Unid_Int Und , Dbamv.Setor Str , Dbamv.Multi_Empresas Emp
WHERE Lei.Cd_Unid_Int = Und.Cd_Unid_Int And Und.Cd_Setor = Str.Cd_Setor And Emp.Cd_Multi_Empresa = Str.Cd_Multi_Empresa And Lei.Tp_Situacao = 'A' And Und.Tp_Unid_Int = 'U' And Und.Sn_Ativo = 'S' And Str.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE DE PACIENTES EM SERVICOS DE URGENCIA--- SELECT 0 Qtde_Leitos_Urgencia , Sum(Mov.Qtde_Acamados) Qtde_Acamados , Sum(Mov.Qtde_Aguard_Classificacao) Qtde_Aguard_Classificacao , Sum(Mov.Qtde_Aguard_Cadastro) Qtde_Aguard_Cadastro , Sum(Mov.Qtde_Aguard_Atend_Medico) Qtde_Aguard_Atend_Medico , Sum(Mov.Qtde_Acamados+Mov.Qtde_Aguard_Classificacao+Mov.Qtde_Aguard_Cadastro+Mov.Qtde_Aguard_Atend_Medico) Qtde_Pacientes_Uregencia
FROM (---QTDE DE PACIENTES NA URGENCIA: ACAMADOS--- SELECT 1 Cd_Departamento , 'QTDE DE PAC´S ACAMADOS NA URGENCIA' Ds_Departamento , Count(1) Qtde_Acamados, 0 Qtde_Aguard_Classificacao, 0 Qtde_Aguard_Cadastro, 0 Qtde_Aguard_Atend_Medico
FROM ( SELECT Ate.Cd_Atendimento , Ate.Dh_Atendimento , Nvl(( SELECT Min(Vcc.Cd_Campo_Chave)
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 98 --CONSIDERAR OU NÃO PACIENTES COM TERAPIAS (PRESCRIÇÃO) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Sn_Paciente_Terapia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Leito Lei
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_leito = Lei.Cd_Leito(+) And Ate.Tp_Atendimento = 'U' And Ate.Dh_Alta_Medica IS NULL --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.cd_multi_empresa = pCdMultiEmpresa ) Mov
WHERE (Mov.Sn_Paciente_Terapia = 'S' And Exists ( SELECT 1
FROM Dbamv.Pre_Med Pre , Dbamv.ItPre_Med Itp , MvccAdmin.v_Campo_Chave Vcc
WHERE Pre.Cd_Pre_Med = Itp.Cd_Pre_Med And Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO CONSIDERADO And Mov.Dh_Atendimento Between Pre.Dt_Pre_Med And Pre.Dt_Pre_Med+.99999 And Pre.fl_impresso = 'S' And Pre.Cd_Atendimento = Mov.Cd_Atendimento And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) OR Mov.Sn_Paciente_Terapia = 'N')
UNION ALL SELECT Mov.Cd_Departamento , Mov.Ds_Departamento , 0 Qtde_Acamados, Sum(Mov.Qtde_Aguard_Classificacao) Qtde_Aguard_Classificacao, Sum(Mov.Qtde_Aguard_Cadastro) Qtde_Aguard_Cadastro, Sum(Mov.Qtde_Aguard_Atend_Medico) Qtde_Aguard_Atend_Medico
FROM (---TRIAGEM--- SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , 1000 Cd_Departamento , 'QTDE DE PAC´S AGUARDANDO TRIAGEM' Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139--FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ta.cd_cor_referencia = Cr.cd_cor_referencia(+) And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS Null And Ta.Cd_Atendimento IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , 2000 Cd_Departamento , 'QTDE DE PAC´S AGUARDANDO CADASTRO' Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 0 Qtde_Aguard_Classificacao , 1 Qtde_Aguard_Cadastro , 0 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139--FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ta.cd_cor_referencia = Cr.cd_cor_referencia(+) And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS Null And Ta.Cd_Atendimento IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (21,22)) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---COM ATENDIMENTO: AGUARDANDO MÉDICOS--- SELECT Ta.Cd_Triagem_Atendimento , Ta.Cd_Fila_Senha , Cr.Cd_Cor_Referencia+3000 Cd_Departamento , 'QTDE DE PAC´S AGUARDANDO MÉDICO-'||Cr.nm_cor Ds_Departamento , To_Char(Ta.Dh_Pre_Atendimento,'MM/YYYY') Data_Mes , 0 Qtde_Aguard_Classificacao , 0 Qtde_Aguard_Cadastro , 1 Qtde_Aguard_Atend_Medico , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada
FROM MvccAdmin.Fato_Atendime_Externo Ate , Dbamv.Triagem_Atendimento Ta , Dbamv.Sacr_Cor_Referencia Cr , Dbamv.Fila_Senha Fl
WHERE Ate.Cd_Atendimento = Ta.Cd_Atendimento And Ta.cd_cor_referencia = Cr.cd_cor_referencia And Fl.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fl.Sn_Utiliza_Fluxo_Sacr = 'S' And Ta.Dh_Removido IS NULL And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) --- NÃO EXISTE CONFIRMAÇÃO DO ATENDIMENTO --- And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (11,12)) And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (21,22)) And Not Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Stp
WHERE Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo IN (31,32)) --- ORIGEM A SER DESCONSIDERADA NO CALCULO --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Pre_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Departamento , Mov.Ds_Departamento ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01629
---------------------------------------------------------------------------
CURSOR cProcesso_01629(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE OCUPACAO NA URGÊNCIA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. DE OCUPACAO NA URGÊNCIA'||Chr(10)||', QTDE INSTALADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Instalada_dia),2)||Chr(10) ||', QTDE UTILIZADA (DIARIA) NO DIA: '||Trunc(Sum(Movimento.Qtde_Utilizada_Dia),2)||Chr(10) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'FATO_ATENDIME_EXTERNO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Utilizada_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Dh_Alta IS Null And Ate.Tp_Atendimento = 'U' And Ate.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Ate.Cd_Multi_Empresa = pCdMultiEmpresa --- CONSIDERA OS PACIENTE QUE TEM ALGUMA PRESCRIÇÃO --- And Exists ( SELECT 1
FROM Dbamv.HrItPre_Med Hri
WHERE Hri.Dh_cancelado IS Null And Hri.Cd_Atendimento = Ate.Cd_Atendimento And Hri.dh_medicacao Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) ) Qtde_Utilizada_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Und.Tp_Unid_Int = 'U' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01634
---------------------------------------------------------------------------
CURSOR cProcesso_01634(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC. DE LEITOS ATIVOS DISPONÍVEIS' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'PERC. DE LEITOS ATIVOS DISPONÍVEIS'||Chr(10)||', QTDE DE LEITOS ATIVOS: '||Trunc(Sum(Movimento.Qtde_Ativo),2)||Chr(10) ||', QTDE DE LEITOS BLOQUEADOS: '||Trunc(Sum(Movimento.Qtde_Bloqueda),2)||Chr(10) ||', QTDE DE LEITOS DISPONÍVEIS: '||Trunc(Sum(Movimento.Qtde_Disponivel),2)||Chr(10) ||', TAXA DE LEITOS DISPONÍVEIS: '||Trunc(Avg(Movimento.Vl_Taxa_Disponivel),2)||'%'||Chr(10) ||', QTDE DE LEITOS ATIVOS NO DIA: '||Trunc(Sum(Movimento.Qtde_Ativo_dia),2)||Chr(10) ||', QTDE DE LEITOS BLOQUEADOS NO DIA: '||Trunc(Sum(Movimento.Qtde_Bloqueda_dia),2)||Chr(10) ||', QTDE DE LEITOS DISPONÍVEIS NO DIA: '||Trunc(Sum(Movimento.Qtde_Disponivel_Dia),2)||Chr(10) ||', TAXA DE LEITOS DISPONÍVEIS DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Disponivel_Dia),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'FATO_ATENDIME_EXTERNO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Taxa_Disponivel),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Taxa_Disponivel_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Ativo , Mov.Qtde_Ativo_Dia , Mov.Qtde_Disponivel , Mov.Qtde_Disponivel_Dia , Mov.Qtde_Bloqueda , Mov.Qtde_Bloqueda_Dia , 100-(Case
WHEN Nvl(Mov.Qtde_Disponivel,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Bloqueda,0)/Nvl(Mov.Qtde_Disponivel,0))*100,2)
END ) Vl_Taxa_Disponivel , 100-(Case
WHEN Nvl(Mov.Qtde_Disponivel_Dia,0) = 0
THEN 0
ELSE Round((Nvl(Mov.Qtde_Bloqueda_Dia,0)/Nvl(Mov.Qtde_Disponivel_Dia,0))*100,2)
END ) Vl_Taxa_Disponivel_Dia
FROM ( SELECT Sum(Mov.Qtde_Ativo) Qtde_Ativo , Sum(Mov.Qtde_Ativo_Dia) Qtde_Ativo_Dia , Sum(Mov.Qtde_Disponivel) Qtde_Disponivel , Sum(Mov.Qtde_Disponivel_Dia) Qtde_Disponivel_Dia , Sum(Mov.Qtde_Ativo)-Sum(Mov.Qtde_Disponivel) Qtde_Bloqueda , Sum(Mov.Qtde_Ativo_Dia)-Sum(Mov.Qtde_Disponivel_Dia) Qtde_Bloqueda_Dia
FROM ( SELECT Und.Cd_Unid_Int , MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M')/To_Number(To_Char(v_Dt_Atual_Diagno,'DD')) Qtde_Disponivel , MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D') Qtde_Disponivel_Dia , ( SELECT Count(1)
FROM Dbamv.Leito Lei
WHERE Lei.Sn_Extra = 'N' And Lei.Tp_Situacao = 'A' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) Qtde_Ativo , ( SELECT Count(1)
FROM Dbamv.Leito Lei
WHERE Lei.Sn_Extra = 'N' And Lei.Tp_Situacao = 'A' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) Qtde_Ativo_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Und.Tp_Unid_Int = 'I' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01635
---------------------------------------------------------------------------
CURSOR cProcesso_01635(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE REALIZAÇÃO DOS PROC. NO TEMPO PREVISTO' Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC DE REALIZAÇÃO DOS PROC. NO TEMPO PREVISTO'||', QTDE DE PROCEDIMENTOS: '||Sum(Nvl(Movimento.Qtde_Total,0))||Chr(10) ||', QTDE DE PROCEDIMENTOS NO TEMPO: '||Sum(Nvl(Movimento.Qtde_Conforme,0))||Chr(10) ||', PERC. DE PROCEDIMENTOS NO TEMPO: '||Avg(Nvl(Movimento.Vl_Perc_Conforme,0))||'%' ||', QTDE DE PROCEDIMENTOS NO DIA: '||Sum(Nvl(Movimento.Qtde_Total_Dia,0))||Chr(10) ||', QTDE DE PROCEDIMENTOS NO TEMPO NO DIA: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) ||', PERC. DE PROCEDIMENTOS NO TEMPO NO DIA: '||Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Total , Mov.Qtde_Total_Dia , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Sum(Case
WHEN Mov.Vl_Termpo_Previsto <= Mov.Vl_Tempo_Real
THEN 1
ELSE 0
END ) Qtde_Conforme , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dt_Realizacao Between Trunc(Sysdate) And Sysdate And Mov.Vl_Termpo_Previsto <= Mov.Vl_Tempo_Real
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Sum(Case
WHEN Mov.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Cen_Cir , Sal.Cd_Setor , Avi.Dt_Inicio_Cirurgia , Avi.Dt_Fim_Cirurgia , Avi.Dt_Realizacao , To_Char(Avi.Dt_Realizacao,'MM/YYYY') Data_Mes , To_Char(Avi.Vl_Tempo_Previsto,'HH24:MI:SS') Hr_Tempo_Previsto , (Avi.dt_fim_cirurgia-Avi.dt_inicio_cirurgia)*24 Nr_Horas_Real , To_Date(To_Char(Sysdate,'DD/MM/YYYY')||' '||To_Char(Avi.Vl_Tempo_Previsto,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS')-Trunc(Sysdate) Vl_Termpo_Previsto , (Avi.dt_fim_cirurgia-Avi.dt_inicio_cirurgia) Vl_Tempo_Real
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Sal_Cir Sal , Dbamv.Cirurgia_Aviso Cir_Avi , Dbamv.Cirurgia Cir
WHERE Avi.Cd_Cen_Cir = Sal.Cd_Cen_Cir And Avi.Cd_Sal_Cir = Sal.Cd_Sal_Cir And Avi.Cd_Aviso_Cirurgia = Cir_Avi.Cd_Aviso_Cirurgia And Cir_Avi.Cd_Cirurgia = Cir.Cd_Cirurgia And Cir_Avi.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada ---DESCONSIDERA OS AVISO COM MAIS DE UMA CIRURGIA NO MESMO ATO And Not Exists ( SELECT 1
FROM Dbamv.Aviso_Cirurgia Avc , Dbamv.Cirurgia_Aviso Cav
WHERE Avc.Cd_Aviso_Cirurgia = Cav.Cd_Aviso_Cirurgia And Avc.Dt_Realizacao Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Avc.Cd_Multi_Empresa = pCdMultiEmpresa And Cav.cd_aviso_cirurgia = Avi.cd_aviso_cirurgia
GROUP BY Cav.cd_aviso_cirurgia
HAVING Count(1) > 1) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Multi_Empresa , Mov.Data_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Movimento.Cd_Multi_Empresa = Estabelecimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01639
---------------------------------------------------------------------------
CURSOR cProcesso_01639(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE DE ITENS: '||Sum(Nvl(Movimento.Qtde_Total,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO: '||Sum(Nvl(Movimento.Qtde_Conforme,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO: '||Avg(Nvl(Movimento.Vl_Perc_Conforme,0))||'%' ||', QTDE DE ITENS NO DIA: '||Sum(Nvl(Movimento.Qtde_Total_Dia,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO NO DIA: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO NO DIA: '||Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0))||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , Mov.Qtde_Total , Mov.Qtde_Total_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Case
WHEN Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate And Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM ( SELECT Prm.Cd_Unid_Int , Prm.Cd_Atendimento , Prm.Dt_Pre_Med , Itp.Cd_Pre_Med , Tip.Ds_Tip_Presc , Itp.Cd_itPre_Med , HrI.Dh_Medicacao , ( SELECT Min(Con.Dh_Checagem)
FROM Dbamv.HrItPre_Cons Con
WHERE Con.Dh_Medicacao = HrI.Dh_Medicacao And Con.Cd_Itpre_Med = Hri.Cd_Itpre_Med And (Con.Ds_Origem = 'MOB' Or Con.Ds_Origem = 'MOBAST' Or Con.Ds_Origem = 'MOBPEP') AND Con.Cd_Justificativa_Mobile IS Null -- esta justificativa verifica a leitura do produto ) Dh_Checagem
FROM Dbamv.Pre_Med Prm , Dbamv.ItPre_Med Itp , Dbamv.Tip_Presc Tip , Dbamv.HrItPre_Med HrI
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And tip.cd_tip_presc = itp.cd_tip_presc And Itp.Cd_Itpre_Med = Hri.Cd_Itpre_Med And Prm.Cd_Atendimento = ( SELECT Ate.Cd_Atendimento
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Hri.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Atendimento) And Itp.Tp_Situacao = 'N' And Itp.sn_cancelado = 'N' And Prm.Tp_Pre_Med = 'M' And Prm.Fl_Impresso = 'S' And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) --- SE O PRODUTO É CHECADO --- And Itp.Cd_Tip_Esq = ( SELECT Esq.Cd_Tip_Esq
FROM MvccAdmin.v_Campo_Chave Vcc , Dbamv.Tip_Esq Esq
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Esq.Cd_Tip_Esq And Esq.Cd_Tip_Esq = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO-CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Esq.Tp_Checagem = 'CC'
GROUP BY Esq.Cd_Tip_Esq) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 150 --TIPO DE ESQUEMA DA PRESCRIÇÃO-DESCONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Hri.Dh_Medicacao Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Prm.Dt_Pre_Med Between v_Dt_Ini_Diagno-1--(Para trazer AS medicações de prescrições de 24 Horas. Se Deixar Somente a data da medicação fica lento and v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01640
---------------------------------------------------------------------------
CURSOR cProcesso_01640(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tip_Esq.Nr_Tip_Esq Cd_Departamento , Tip_Esq.Ds_Tip_Esq Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tip_Esq.Ds_Tip_Esq||Chr(10)||', QTDE DE ITENS: '||Sum(Nvl(Movimento.Qtde_Total,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO: '||Sum(Nvl(Movimento.Qtde_Conforme,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO: '||Avg(Nvl(Movimento.Vl_Perc_Conforme,0))||'%' ||', QTDE DE ITENS NO DIA: '||Sum(Nvl(Movimento.Qtde_Total_Dia,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO NO DIA: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO NO DIA: '||Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0))||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Tip_Esq , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , Mov.Qtde_Total , Mov.Qtde_Total_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Tip_Esq , Sum(Case
WHEN Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate And Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM ( SELECT Itp.Cd_Tip_Esq , Prm.Cd_Atendimento , Prm.Dt_Pre_Med , Itp.Cd_Pre_Med , Tip.Ds_Tip_Presc , Itp.Cd_itPre_Med , HrI.Dh_Medicacao , ( SELECT Min(Con.Dh_Checagem)
FROM Dbamv.HrItPre_Cons Con
WHERE Con.Dh_Medicacao = HrI.Dh_Medicacao And Con.Cd_Itpre_Med = Hri.Cd_Itpre_Med And (Con.Ds_Origem = 'MOB' Or Con.Ds_Origem = 'MOBAST' Or Con.Ds_Origem = 'MOBPEP') AND Con.Cd_Justificativa_Mobile IS Null -- esta justificativa verifica a leitura do produto ) Dh_Checagem
FROM Dbamv.Pre_Med Prm , Dbamv.ItPre_Med Itp , Dbamv.Tip_Presc Tip , Dbamv.HrItPre_Med HrI
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And tip.cd_tip_presc = itp.cd_tip_presc And Itp.Cd_Itpre_Med = Hri.Cd_Itpre_Med And Prm.Cd_Atendimento = ( SELECT Ate.Cd_Atendimento
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Hri.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Atendimento) And Itp.Tp_Situacao = 'N' And Itp.sn_cancelado = 'N' And Prm.Tp_Pre_Med = 'M' And Prm.Fl_Impresso = 'S' And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) --- SE O PRODUTO É CHECADO --- And Itp.Cd_Tip_Esq = ( SELECT Esq.Cd_Tip_Esq
FROM MvccAdmin.v_Campo_Chave Vcc , Dbamv.Tip_Esq Esq
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Esq.Cd_Tip_Esq And Esq.Cd_Tip_Esq = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO-CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Esq.Tp_Checagem = 'CC'
GROUP BY Esq.Cd_Tip_Esq) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 150 --TIPO DE ESQUEMA DA PRESCRIÇÃO-DESCONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNAÇÃO DESCONSIDERADA And Vcc.Cd_campo_chave = Prm.Cd_Unid_Int And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Hri.Dh_Medicacao Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Prm.Dt_Pre_Med Between v_Dt_Ini_Diagno-1--(Para trazer AS medicações de prescrições de 24 Horas. Se Deixar Somente a data da medicação fica lento and v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Tip_Esq ) Mov ) Movimento , ( SELECT Cd_Tip_Esq , Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Cd_Tip_Esq,'A',101),'B',102),'C',103),'D',104),'E',105),'F',106),'G',107),'H',108),'I',109),'J',110),'K',111),'L',112),'M',113),'N',114),'O',115),'P',116),'Q',117),'R',118),'S',119),'T',120),'U',121),'V',122),'W',123),'X',124),'Z',125),'Y',125) Nr_Tip_Esq , Cd_Tip_Esq||'-'||Ds_Tip_Esq Ds_Tip_Esq
FROM Dbamv.Tip_Esq) Tip_Esq , MvccAdmin.Estabelecimento
WHERE Tip_Esq.Cd_Tip_Esq = Movimento.Cd_Tip_Esq And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Tip_Esq.Nr_Tip_Esq , Tip_Esq.Ds_Tip_Esq , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01641
---------------------------------------------------------------------------
CURSOR cProcesso_01641(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE DE ITENS: '||Sum(Nvl(Movimento.Qtde_Total,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO: '||Sum(Nvl(Movimento.Qtde_Conforme,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO: '||Avg(Nvl(Movimento.Vl_Perc_Conforme,0))||'%' ||', QTDE DE ITENS NO DIA: '||Sum(Nvl(Movimento.Qtde_Total_Dia,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO NO DIA: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO NO DIA: '||Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0))||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , Mov.Qtde_Total , Mov.Qtde_Total_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Case
WHEN Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate And Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM ( SELECT Prm.Cd_Unid_Int , Prm.Cd_Atendimento , Prm.Dt_Pre_Med , Itp.Cd_Pre_Med , Tip.Ds_Tip_Presc , Itp.Cd_itPre_Med , HrI.Dh_Medicacao , ( SELECT Min(Con.Dh_Checagem)
FROM Dbamv.HrItPre_Cons Con
WHERE Con.Dh_Medicacao = HrI.Dh_Medicacao And Con.Cd_Itpre_Med = Hri.Cd_Itpre_Med And (Con.Ds_Origem = 'MOB' Or Con.Ds_Origem = 'MOBAST' Or Con.Ds_Origem = 'MOBPEP') AND Con.Cd_Justificativa_Mobile IS Null -- esta justificativa verifica a leitura do produto ) Dh_Checagem
FROM Dbamv.Pre_Med Prm , Dbamv.ItPre_Med Itp , Dbamv.Tip_Presc Tip , Dbamv.HrItPre_Med HrI
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And tip.cd_tip_presc = itp.cd_tip_presc And Itp.Cd_Itpre_Med = Hri.Cd_Itpre_Med And Prm.Cd_Atendimento = ( SELECT Ate.Cd_Atendimento
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Hri.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Atendimento) And Itp.Tp_Situacao = 'N' And Itp.sn_cancelado = 'N' And Prm.Fl_Impresso = 'S' And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) --- SE O PRODUTO É CHECADO --- And Itp.Cd_Tip_Esq = ( SELECT Esq.Cd_Tip_Esq
FROM MvccAdmin.v_Campo_Chave Vcc , Dbamv.Tip_Esq Esq
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Presc And Itp.Cd_Tip_Esq = Esq.Cd_Tip_Esq And Esq.Tp_Checagem = 'CC' And Vcc.Cd_Tipo_Campo_Chave = 17 --ITEM DE PRESCRICAO (LEITE/MAMADEIRA) And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 150 --TIPO DE ESQUEMA DA PRESCRIÇÃO-DESCONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Hri.Dh_Medicacao Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Prm.Dt_Pre_Med Between v_Dt_Ini_Diagno-1--(Para trazer AS medicações de prescrições de 24 Horas. Se Deixar Somente a data da medicação fica lento and v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01642
---------------------------------------------------------------------------
CURSOR cProcesso_01642(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE DE ITENS: '||Sum(Nvl(Movimento.Qtde_Total,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO: '||Sum(Nvl(Movimento.Qtde_Conforme,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO: '||Avg(Nvl(Movimento.Vl_Perc_Conforme,0))||'%' ||', QTDE DE ITENS NO DIA: '||Sum(Nvl(Movimento.Qtde_Total_Dia,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO NO DIA: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO NO DIA: '||Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0))||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , Mov.Qtde_Total , Mov.Qtde_Total_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Case
WHEN Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate And Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM ( SELECT Prm.Cd_Unid_Int , Prm.Cd_Atendimento , Prm.Dt_Pre_Med , Itp.Cd_Pre_Med , Tip.Ds_Tip_Presc , Itp.Cd_itPre_Med , HrI.Dh_Medicacao , ( SELECT Min(Con.Dh_Checagem)
FROM Dbamv.HrItPre_Cons Con
WHERE Con.Dh_Medicacao = HrI.Dh_Medicacao And Con.Cd_Itpre_Med = Hri.Cd_Itpre_Med And (Con.Ds_Origem = 'MOB' Or Con.Ds_Origem = 'MOBAST' Or Con.Ds_Origem = 'MOBPEP') AND Con.Cd_Justificativa_Mobile IS Null -- esta justificativa verifica a leitura do produto ) Dh_Checagem
FROM Dbamv.Pre_Med Prm , Dbamv.ItPre_Med Itp , Dbamv.Tip_Presc Tip , Dbamv.HrItPre_Med HrI
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And tip.cd_tip_presc = itp.cd_tip_presc And Itp.Cd_Itpre_Med = Hri.Cd_Itpre_Med And Prm.Cd_Atendimento = ( SELECT Ate.Cd_Atendimento
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Hri.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Cd_Movimentacao = 1 And Ate.Dt_Internado Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Atendimento) And Itp.Tp_Situacao = 'N' And Itp.sn_cancelado = 'N' And Prm.Tp_Pre_Med = 'M' And Prm.Fl_Impresso = 'S' And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) --- SE O PRODUTO É CHECADO --- And Itp.Cd_Tip_Esq = ( SELECT Esq.Cd_Tip_Esq
FROM MvccAdmin.v_Campo_Chave Vcc , Dbamv.Tip_Esq Esq
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Esq.Cd_Tip_Esq And Esq.Cd_Tip_Esq = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO-CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Esq.Tp_Checagem = 'CC'
GROUP BY Esq.Cd_Tip_Esq) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 150 --TIPO DE ESQUEMA DA PRESCRIÇÃO-DESCONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Hri.Dh_Medicacao Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Prm.Dt_Pre_Med Between v_Dt_Ini_Diagno-1--(Para trazer AS medicações de prescrições de 24 Horas. Se Deixar Somente a data da medicação fica lento and v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01643
---------------------------------------------------------------------------
CURSOR cProcesso_01643(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE DE ITENS: '||Sum(Nvl(Movimento.Qtde_Total,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO: '||Sum(Nvl(Movimento.Qtde_Conforme,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO: '||Avg(Nvl(Movimento.Vl_Perc_Conforme,0))||'%' ||', QTDE DE ITENS NO DIA: '||Sum(Nvl(Movimento.Qtde_Total_Dia,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO NO DIA: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO NO DIA: '||Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0))||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , Mov.Qtde_Total , Mov.Qtde_Total_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Case
WHEN Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate And Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM ( SELECT Prm.Cd_Unid_Int , Prm.Cd_Atendimento , Prm.Dt_Pre_Med , Itp.Cd_Pre_Med , Tip.Ds_Tip_Presc , Itp.Cd_itPre_Med , HrI.Dh_Medicacao , ( SELECT Min(Con.Dh_Checagem)
FROM Dbamv.HrItPre_Cons Con
WHERE Con.Dh_Medicacao = HrI.Dh_Medicacao And Con.Cd_Itpre_Med = Hri.Cd_Itpre_Med And (Con.Ds_Origem = 'MOB' Or Con.Ds_Origem = 'MOBAST' Or Con.Ds_Origem = 'MOBPEP') AND Con.Cd_Justificativa_Mobile IS Null -- esta justificativa verifica a leitura do produto ) Dh_Checagem
FROM Dbamv.Pre_Med Prm , Dbamv.ItPre_Med Itp , Dbamv.Tip_Presc Tip , Dbamv.HrItPre_Med HrI
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And tip.cd_tip_presc = itp.cd_tip_presc And Itp.Cd_Itpre_Med = Hri.Cd_Itpre_Med And Prm.Cd_Atendimento = ( SELECT Ate.Cd_Atendimento
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Hri.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Itp.Tp_Situacao = 'N' And Itp.sn_cancelado = 'N' And Prm.Tp_Pre_Med = 'M' And Prm.Fl_Impresso = 'S' And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) --- SE O PRODUTO É CHECADO --- And Itp.Cd_Tip_Esq = ( SELECT Esq.Cd_Tip_Esq
FROM MvccAdmin.v_Campo_Chave Vcc , Dbamv.Tip_Esq Esq
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Esq.Cd_Tip_Esq And Esq.Cd_Tip_Esq = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO-CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Esq.Tp_Checagem = 'CC'
GROUP BY Esq.Cd_Tip_Esq) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 150 --TIPO DE ESQUEMA DA PRESCRIÇÃO-DESCONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Hri.Dh_Medicacao Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Prm.Dt_Pre_Med Between v_Dt_Ini_Diagno-1--(Para trazer AS medicações de prescrições de 24 Horas. Se Deixar Somente a data da medicação fica lento and v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01644
---------------------------------------------------------------------------
CURSOR cProcesso_01644(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Tip_Esq.Nr_Tip_Esq Cd_Departamento , Tip_Esq.Ds_Tip_Esq Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Tip_Esq.Ds_Tip_Esq||Chr(10)||', QTDE DE ITENS: '||Sum(Nvl(Movimento.Qtde_Total,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO: '||Sum(Nvl(Movimento.Qtde_Conforme,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO: '||Avg(Nvl(Movimento.Vl_Perc_Conforme,0))||'%' ||', QTDE DE ITENS NO DIA: '||Sum(Nvl(Movimento.Qtde_Total_Dia,0))||Chr(10) ||', QTDE DE CHECADOS A BEIRA LEITO NO DIA: '||Sum(Nvl(Movimento.Qtde_Conforme_Dia,0))||Chr(10) ||', PERC. DE ITENS CHECADOS A BEIRA LEITO NO DIA: '||Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0))||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Tip_Esq , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Conforme , Mov.Qtde_Conforme_Dia , Mov.Qtde_Total , Mov.Qtde_Total_Dia , (Case
WHEN Mov.Qtde_Total = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme/Mov.Qtde_Total)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Total_Dia = 0
THEN 0
ELSE Trunc((Mov.Qtde_Conforme_Dia/Mov.Qtde_Total_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Tip_Esq , Sum(Case
WHEN Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate And Mov.Dh_Checagem IS Not Null
THEN 1
ELSE 0
END ) Qtde_Conforme_Dia , Count(1) Qtde_Total , Sum(Case
WHEN Mov.Dh_Medicacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM ( SELECT Itp.Cd_Tip_Esq , Prm.Cd_Atendimento , Prm.Dt_Pre_Med , Itp.Cd_Pre_Med , Tip.Ds_Tip_Presc , Itp.Cd_itPre_Med , HrI.Dh_Medicacao , ( SELECT Min(Con.Dh_Checagem)
FROM Dbamv.HrItPre_Cons Con
WHERE Con.Dh_Medicacao = HrI.Dh_Medicacao And Con.Cd_Itpre_Med = Hri.Cd_Itpre_Med And (Con.Ds_Origem = 'MOB' Or Con.Ds_Origem = 'MOBAST' Or Con.Ds_Origem = 'MOBPEP') AND Con.Cd_Justificativa_Mobile IS Null -- esta justificativa verifica a leitura do produto ) Dh_Checagem
FROM Dbamv.Pre_Med Prm , Dbamv.ItPre_Med Itp , Dbamv.Tip_Presc Tip , Dbamv.HrItPre_Med HrI
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And tip.cd_tip_presc = itp.cd_tip_presc And Itp.Cd_Itpre_Med = Hri.Cd_Itpre_Med And Prm.Cd_Atendimento = ( SELECT Ate.Cd_Atendimento
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Hri.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) And Itp.Tp_Situacao = 'N' And Itp.sn_cancelado = 'N' And Prm.Tp_Pre_Med = 'M' And Prm.Fl_Impresso = 'S' And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) --- SE O PRODUTO É CHECADO --- And Itp.Cd_Tip_Esq = ( SELECT Esq.Cd_Tip_Esq
FROM MvccAdmin.v_Campo_Chave Vcc , Dbamv.Tip_Esq Esq
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Esq.Cd_Tip_Esq And Esq.Cd_Tip_Esq = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 144 --TIPO DE ESQUEMA DA PRESCRIÇÃO-CONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa And Esq.Tp_Checagem = 'CC'
GROUP BY Esq.Cd_Tip_Esq) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 150 --TIPO DE ESQUEMA DA PRESCRIÇÃO-DESCONSIDERADO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DE INTERNAÇÃO DESCONSIDERADA And Vcc.Cd_campo_chave = Prm.Cd_Unid_Int And (Vcc.Cd_Departamento = Prm.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Hri.Dh_Medicacao Between v_Dt_Ini_Diagno and v_Dt_Fim_Diagno And Prm.Dt_Pre_Med Between v_Dt_Ini_Diagno-1--(Para trazer AS medicações de prescrições de 24 Horas. Se Deixar Somente a data da medicação fica lento and v_Dt_Fim_Diagno ) Mov
GROUP BY Mov.Cd_Tip_Esq ) Mov ) Movimento , ( SELECT Cd_Tip_Esq , Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace(Replace( Cd_Tip_Esq,'A',101),'B',102),'C',103),'D',104),'E',105),'F',106),'G',107),'H',108),'I',109),'J',110),'K',111),'L',112),'M',113),'N',114),'O',115),'P',116),'Q',117),'R',118),'S',119),'T',120),'U',121),'V',122),'W',123),'X',124),'Z',125),'Y',125) Nr_Tip_Esq , Cd_Tip_Esq||'-'||Ds_Tip_Esq Ds_Tip_Esq
FROM Dbamv.Tip_Esq) Tip_Esq , MvccAdmin.Estabelecimento
WHERE Tip_Esq.Cd_Tip_Esq = Movimento.Cd_Tip_Esq And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Tip_Esq.Nr_Tip_Esq , Tip_Esq.Ds_Tip_Esq , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01647
---------------------------------------------------------------------------
CURSOR cProcesso_01647(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , NUll Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Unid_Int.Cd_Unid_Int Cd_Departamento , Unid_Int.Ds_Unid_Int Ds_Departamento , Nvl(Movimento.Data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Unid_Int.Ds_Unid_Int||Chr(10)||', QTDE DE ALTAS NO PERÍODO: '||Sum(Nvl(Movimento.Qtde_Alta,0))||Chr(10) ||', QTDE DE RETORNO NA URGêNCIA: '||Sum(Nvl(Movimento.Qtde_Retor_Urg,0))||Chr(10) ||', PERC. DE RETORNO NA URGÊNCIA: '||Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2)||'%'||Chr(10) ||', QTDE DE ALTAS NO DIA: '||Sum(Nvl(Movimento.Qtde_Alta_Dia,0))||Chr(10) ||', QTDE DE RETORNO NA URGêNCIA NO DIA: '||Sum(Nvl(Movimento.Qtde_Retor_Urg_Dia,0))||Chr(10) ||', PERC. DE RETORNO NA URGÊNCIA NO DIA: '||Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2)||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ITPRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme,0)),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Nvl(Movimento.Vl_Perc_Conforme_Dia,0)),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Alta , Mov.Qtde_Alta_Dia , Mov.Qtde_Retor_Urg , Mov.Qtde_Retor_Urg_Dia , (Case
WHEN Mov.Qtde_Alta = 0
THEN 0
ELSE Round((Mov.Qtde_Retor_Urg/Mov.Qtde_Alta)*100,2)
END ) Vl_Perc_Conforme , (Case
WHEN Mov.Qtde_Alta_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Retor_Urg_Dia/Mov.Qtde_Alta_Dia)*100,2)
END ) Vl_Perc_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Count(1) Qtde_Alta , Sum(Case
WHEN Mov.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Alta_Dia , Sum(Mov.Qtde_Retor_Urg) Qtde_Retor_Urg , Sum(Mov.Qtde_Retor_Urg_Dia) Qtde_Retor_Urg_Dia
FROM ( SELECT Ate.Cd_Unid_Int , Ate.Dh_Alta , ( SELECT Min(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate_Retor
WHERE Ate_Retor.Tp_Atendimento = 'U' And Ate_Retor.Cd_Paciente = Ate.Cd_Paciente And Ate_Retor.Dh_Atendimento > Ate.Dh_Alta And (Ate_Retor.Dh_Atendimento-Ate.Dh_Alta) <= 3 --TRES DIAS OU 72 HORAS And Ate_Retor.Dh_Atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate_Retor.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Retor.Cd_Ori_Ate And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM DO ATENDIMENTO A DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Qtde_Retor_Urg , ( SELECT Min(1)
FROM MvccAdmin.Fato_Atendime_Externo Ate_Retor
WHERE Ate_Retor.Tp_Atendimento = 'U' And Ate_Retor.Cd_Paciente = Ate.Cd_Paciente And Ate_Retor.Dh_Atendimento > Ate.Dh_Alta And (Ate_Retor.Dh_Atendimento-Ate.Dh_Alta) <= 3 --TRES DIAS OU 72 HORAS And Ate_Retor.Dh_Atendimento Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate_Retor.Cd_Multi_Empresa = pCdMultiEmpresa And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate_Retor.Cd_Ori_Ate And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM DO ATENDIMENTO A DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Qtde_Retor_Urg_Dia
FROM MvccAdmin.fato_Atendime_Internado Ate , Dbamv.Mot_Alt Mot
WHERE Ate.cd_mot_alt = Mot.cd_mot_alt And Mot.tp_mot_alta = 'A' And Ate.Cd_Movimentacao = 5 And Ate.Dh_Alta Between Trunc(v_Dt_Ini_Diagno)-3 ---TRES DIAS OU 72 HORAS And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , Dbamv.Unid_Int , MvccAdmin.Estabelecimento
WHERE Unid_Int.Cd_Unid_Int = Movimento.Cd_Unid_Int And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Unid_Int.Cd_Unid_Int , Unid_Int.Ds_Unid_Int , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01649
---------------------------------------------------------------------------
CURSOR cProcesso_01649(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'NUMERO DE RENOVAÇÃO DE LEITO DAS UTI´S' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'GIRO DE LEITO DAS UTI´S'||', QTDE DE LEITOS OPERACIONAL: '||Trunc(Sum(Movimento.Qtde_Leitos),2)||Chr(10) ||', QTDE DE SAÍDAS ATUAL: '||Trunc(Sum(Movimento.Qtde_Saidas),2)||Chr(10) ||', GIRO DE LEITO ATUAL: '||Trunc(Avg(Movimento.Vl_Renovacao_Leito),2)||Chr(10) ||', QTDE DE LEITOS OPERACIONAL NO DIA: '||Trunc(Sum(Movimento.Qtde_Leitos_Dia),2)||Chr(10) ||', QTDE DE SAÍDAS NO DIA: '||Trunc(Sum(Movimento.Qtde_Saidas_Dia),2)||Chr(10) ||', GIRO DE LEITO DO DIA: '||Trunc(Avg(Movimento.Vl_Renovacao_Leito_Dia),2) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Renovacao_Leito),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Vl_Renovacao_Leito_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Leitos , Mov.Qtde_Saidas , Mov.Qtde_Leitos_Dia , Mov.Qtde_Saidas_Dia , (Case
WHEN Mov.Qtde_Leitos = 0
THEN 0
ELSE Round(Mov.Qtde_Saidas/Mov.Qtde_Leitos,2)
END ) Vl_Renovacao_Leito , (Case
WHEN Mov.Qtde_Leitos_Dia = 0
THEN 0
ELSE Round(Mov.Qtde_Saidas_Dia/Mov.Qtde_Leitos_Dia,2)
END ) Vl_Renovacao_Leito_Dia
FROM ( SELECT Sum(Mov.Qtde_Leitos) Qtde_Leitos , Sum(Mov.Qtde_Saidas) Qtde_Saidas , Sum(Mov.Qtde_Leitos_Dia) Qtde_Leitos_Dia , Sum(Mov.Qtde_Saidas_Dia) Qtde_Saidas_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'M'),0)/To_Number(To_Char(v_Dt_Atual_Diagno,'DD')) Qtde_Leitos , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Und.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Leitos_Dia , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Dh_Lib_Mov_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Saidas , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int_Alta = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Dh_Lib_Mov_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Saidas_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Und.Cd_Unid_Int = ( SELECT Lei.Cd_Unid_Int
FROM Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Str.Cd_Setor = Und.Cd_Setor And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Lei.tp_situacao = 'A' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int --- SOMENTE UTIS --- And Tip.Tp_acomodacao = 'U'
GROUP BY Lei.Cd_Unid_Int) ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.data_mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01650
---------------------------------------------------------------------------
CURSOR cProcesso_01650(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTES INTERNADOS GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE PACIENTES INTERNADOS GLOBAL, QTDE INTERNADOS AGORA: '||Trunc(Sum(Movimento.Qtde_Internados_Dia),2) ||', QTDE INSTALADA: '||Trunc(Sum(Movimento.Qtde_Instalada_dia),2) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Internados_Dia) Qtde_Instalada , 'FATO_ATENDIME_INTERNADO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Qtde_Internados_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Internados_Dia) Qtde_Internados_Dia , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Internados_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Internados_Dia) Qtde_Internados_Dia
FROM ( SELECT Und.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Dh_Alta IS Null) Qtde_Internados_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01651
---------------------------------------------------------------------------
CURSOR cProcesso_01651(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PACIENTES INTERNADOS EM UTI' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE PACIENTES INTERNADOS EM UTI, QTDE INTERNADOS AGORA: '||Trunc(Sum(Movimento.Qtde_Internados_Dia),2) ||', QTDE INSTALADA: '||Trunc(Sum(Movimento.Qtde_Instalada_dia),2) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Sum(Movimento.Qtde_Internados_Dia) Qtde_Instalada , 'FATO_ATENDIME_INTERNADO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Qtde_Internados_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Internados_Dia) Qtde_Internados_Dia , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Nvl(Mov.Qtde_Internados_Dia,0))/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Sum(Mov.Qtde_Internados_Dia) Qtde_Internados_Dia
FROM ( SELECT Und.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Dh_Alta IS Null) Qtde_Internados_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Und.Cd_Unid_Int = ( SELECT Lei.Cd_Unid_Int
FROM Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Str.Cd_Setor = Und.Cd_Setor And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Lei.tp_situacao = 'A' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int --- SOMENTE UTIS --- And Tip.Tp_acomodacao = 'U'
GROUP BY Lei.Cd_Unid_Int) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01652
---------------------------------------------------------------------------
CURSOR cProcesso_01652(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE LEITOS VAGOS DE UTI´S' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE LEITOS VAGOS DE UTI´S, QTDE INSTALADA AGORA: '||Trunc(Sum(Movimento.Qtde_Internados_Dia),2) ||', QTDE INTERNADOS AGORA: '||Trunc(Sum(Movimento.Qtde_Instalada_dia),2) ||', QTDE DE LEITOS VAGOS AGORA: '||Trunc(Sum(Movimento.Qtde_Leitos_Vagos_Dia),2) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , NUll Qtde_Instalada , 'FATO_ATENDIME_INTERNADO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Qtde_Leitos_Vagos_Dia),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Qtde_Leitos_Vagos_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Internados_Dia) Qtde_Internados_Dia , Sum(Mov.Qtde_Instalada_Dia)-Sum(Qtde_Internados_Dia) Qtde_Leitos_Vagos_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Instalada_Dia)-Sum(Qtde_Internados_Dia)/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Mov.Qtde_Internados_Dia Qtde_Internados_Dia
FROM ( SELECT Und.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Dh_Alta IS Null) Qtde_Internados_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Und.Cd_Unid_Int = ( SELECT Lei.Cd_Unid_Int
FROM Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Str.Cd_Setor = Und.Cd_Setor And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Lei.tp_situacao = 'A' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int --- SOMENTE UTIS --- And Tip.Tp_acomodacao = 'U'
GROUP BY Lei.Cd_Unid_Int) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01653
---------------------------------------------------------------------------
CURSOR cProcesso_01653(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE LEITO OPERACIONAIS VAGOS GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null nm_processo , 'QTDE DE LEITO OPERACIONAIS VAGOS GLOBAL, QTDE INSTALADA AGORA: '||Trunc(Sum(Movimento.Qtde_Internados_Dia),2) ||', QTDE INTERNADOS AGORA: '||Trunc(Sum(Movimento.Qtde_Instalada_dia),2) ||', QTDE DE LEITOS VAGOS AGORA: '||Trunc(Sum(Movimento.Qtde_Leitos_Vagos_Dia),2) ||', TAXA DE OCUPAÇÃO DO DIA: '||Trunc(Avg(Movimento.Vl_Taxa_Ocupacao_Dia),2)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , NUll Qtde_Instalada , 'FATO_ATENDIME_INTERNADO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Trunc(Avg(Movimento.Qtde_Leitos_Vagos_Dia),2) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Trunc(Avg(Movimento.Qtde_Leitos_Vagos_Dia),2) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Instalada_Dia) Qtde_Instalada_Dia , Sum(Mov.Qtde_Internados_Dia) Qtde_Internados_Dia , Sum(Mov.Qtde_Instalada_Dia)-Sum(Qtde_Internados_Dia) Qtde_Leitos_Vagos_Dia , Case
WHEN Sum(Nvl(Mov.Qtde_Instalada_Dia,0)) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Instalada_Dia)-Sum(Qtde_Internados_Dia)/Sum(Nvl(Mov.Qtde_Instalada_Dia,0)))*100,2)
END Vl_Taxa_Ocupacao_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Nvl(MvccAdmin.Fnc_Leitos_Instalada(pCdMultiEmpresa,pProcesso,pNrCnpj,Mov.Cd_Unid_Int,v_Dt_Ini_Diagno,v_Dt_Atual_Diagno,'D'),0) Qtde_Instalada_Dia , Mov.Qtde_Internados_Dia Qtde_Internados_Dia
FROM ( SELECT Und.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 1 And Ate.Dh_Alta IS Null) Qtde_Internados_Dia
FROM Dbamv.Unid_Int Und
WHERE Und.Sn_Ativo = 'S' And Und.Tp_Unid_Int = 'I' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Und.Cd_Unid_Int) And Vcc.Cd_Tipo_Campo_Chave = 85 --UNIDADE DESCONSIDERADA And (Vcc.Cd_Departamento = Und.Cd_Unid_Int Or Vcc.Cd_Departamento IS Null) And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) ) Mov ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01654
---------------------------------------------------------------------------
CURSOR cProcesso_01654(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null cd_paciente , Null cd_prestador , Null Tp_diagnostico , Null nm_indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAIDAS HOSP. DE UTI´S' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAIDAS HOSP. DE UTI´S'||', QTDE PRODUZIDA: '||Movimento.Qtde_Realizada ||', QTDE PRODUZIDA NO DIA: '||Movimento.Qtde_Realizada_Dia ||', QTDE PROJETADA: '||Movimento.Qtde_Projetada Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'FATO_ATENDIME_INTERNADO' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Realizada Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Projetada_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_mes , Mov.Qtde_Realizada , Mov.Qtde_Realizada_Dia , Mov.Qtde_Projetada , Mov.Qtde_Projetada/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Alt.Cd_Multi_Empresa , Alt.Data_mes , Sum(Alt.Qtde_Realizada) Qtde_Realizada , Sum(Alt.Qtde_Realizada_Dia) Qtde_Realizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Alt.Qtde_Realizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Ate.Cd_Multi_Empresa , To_Char(Ate.Dh_Alta,'MM/YYYY') Data_Mes , 1 Qtde_Realizada , (Case
WHEN Ate.Dh_Alta Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Realizada_Dia
FROM MvccAdmin.Fato_Atendime_Internado Ate , Dbamv.Unid_Int Und
WHERE Ate.Cd_Unid_Int = Und.Cd_Unid_Int And Ate.Cd_Movimentacao = 5 And Und.Cd_Unid_Int = ( SELECT Lei.Cd_Unid_Int
FROM Dbamv.Setor Str, Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Str.Cd_Setor = Und.Cd_Setor And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Lei.tp_situacao = 'A' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int --- SOMENTE UTIS --- And Tip.Tp_acomodacao = 'U'
GROUP BY Lei.Cd_Unid_Int) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Und.Sn_hospital_dia And Vcc.Cd_Tipo_Campo_Chave = 135 --DESCONSIDERAR HOSPITAL DIA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Mot_Alt) And Vcc.Cd_Tipo_Campo_Chave = 136 --MOTIVOS DE ALTA A DESCONSIDERAR And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Alt
GROUP BY Alt.Cd_Multi_Empresa , Alt.Data_mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01655
---------------------------------------------------------------------------
CURSOR cProcesso_01655(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE OBITO/MORTALIDADE INSTITUCIONAL GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , NUll Nm_Processo , 'PERC DE OBITO/MORTALIDADE INSTITUCIONAL GLOBAL, QTDE ALTAS DA UTI: '||Sum(Movimento.Qtde_Altas_Da_Uti) ||', QTDE DE OBITOS NA UTI: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) ||', TAXA DE MORTALIDADE NA UTI: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti,0))||'%' ||', QTDE ALTAS DA UTI DO DIA: '||Sum(Movimento.Qtde_Altas_Da_Uti_Dia) ||', QTDE DE OBITOS NA UTI NO DIA: '||Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) ||', TAXA DE MORTALIDADE NA UTI DO DIA: '||Sum(Nvl(Movimento.Vl_Taxa_Mortes_Uti_Dia,0))||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti,0)) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Nvl(Movimento.Qtde_Mortes_Na_Uti_Dia,0)) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Altas_Da_Uti) Qtde_Altas_Da_Uti , Sum(Mov.Qtde_Mortes_Na_Uti) Qtde_Mortes_Na_Uti , Sum(Mov.Qtde_Altas_Da_Uti_Dia) Qtde_Altas_Da_Uti_Dia , Sum(Mov.Qtde_Mortes_Na_Uti_Dia) Qtde_Mortes_Na_Uti_Dia , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti)/Sum(Mov.Qtde_Altas_Da_Uti))*100,2)
END ) Vl_Taxa_Mortes_Uti , (Case
WHEN Sum(Mov.Qtde_Altas_Da_Uti_Dia) = 0
THEN 0
ELSE Round((Sum(Mov.Qtde_Mortes_Na_Uti_Dia)/Sum(Mov.Qtde_Altas_Da_Uti_Dia))*100,2)
END ) Vl_Taxa_Mortes_Uti_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int And Ate.Dh_Lib_Mov Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti , ( SELECT Count(Distinct Ate.Cd_Atendimento||'.'||Ate.Cd_Unid_Int)
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Movimentacao = 1 And Ate.Cd_Unid_Int_Anterior = Unid_Int.Cd_Unid_Int And Ate.Dh_Lib_Mov Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Altas_Da_Uti_Dia , ( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' --OBITOS And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Mortes_Na_Uti_Dia
FROM Dbamv.Unid_Int
WHERE Unid_Int.Tp_Unid_Int = 'I' And Unid_int.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01656
---------------------------------------------------------------------------
CURSOR cProcesso_01656(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE OBITO/MORTALIDADE INSTITUCIONAL <24H' Ds_Departamento , Movimento.Data_Mes , Null Nm_Processo , 'PERC DE OBITO/MORTALIDADE INSTITUCIONAL <24H'|| ' QTDE DE MORTES NA UTI: '||Nvl(Movimento.Qtde_Obito_Uti,0)||Chr(10) ||', QTDE DE MORTES NA UTI <24H: '||Nvl(Movimento.Qtde_Obito_Uti_NaoConforme,0)||Chr(10) ||', TAXA DE MORTALIDADE NA UTI <24H: '||Nvl(Movimento.Vl_Taxa_Obito_Uti,0)||'%'||Chr(10) || ' QTDE DE MORTES NA UTI NO DIA: '||Nvl(Movimento.Qtde_Obito_Uti_Dia,0)||Chr(10) ||', QTDE DE MORTES NA UTI <24H NO DIA: '||Nvl(Movimento.Qtde_Obito_Uti_NaoConforme_Dia,0)||Chr(10) ||', TAXA DE MORTALIDADE NA UTI <24H NO DIA: '||Nvl(Movimento.Vl_Taxa_Obito_Uti_Dia,0)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Nvl(Movimento.Qtde_Obito_Uti_NaoConforme,0) Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Qtde_Obito_Uti_NaoConforme,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Qtde_Obito_Uti_NaoConforme_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT Mov.Cd_Unid_Int , To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Obito_Uti , Mov.Qtde_Obito_Uti_Dia , Mov.Qtde_Obito_Uti_NaoConforme , Mov.Qtde_Obito_Uti_NaoConforme_Dia , (Case
WHEN Mov.Qtde_Obito_Uti = 0
THEN 0
ELSE Round((Mov.Qtde_Obito_Uti_NaoConforme/Mov.Qtde_Obito_Uti)*100,2)
END ) Vl_Taxa_Obito_uti , (Case
WHEN Mov.Qtde_Obito_Uti_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Obito_Uti_NaoConforme_Dia/Mov.Qtde_Obito_Uti_Dia)*100,2)
END ) Vl_Taxa_Obito_Uti_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Mov.Qtde_Obito_Uti) Qtde_Obito_Uti , Sum(Mov.Qtde_Obito_Uti_Dia) Qtde_Obito_Uti_Dia , Sum(Mov.Qtde_Obito_Uti_NaoConforme) Qtde_Obito_Uti_NaoConforme , Sum(Mov.Qtde_Obito_Uti_NaoConforme_Dia) Qtde_Obito_Uti_NaoConforme_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_Dia ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And (Ate.dh_Lib_Mov-Ate.Dh_mov_Int) < MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Ate.Cd_Unid_Int,pNrCnpj,'SLA')/24/60 --MENOR QUE NUMERO DE HORAS And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_NaoConforme ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And (Ate.dh_Lib_Mov-Ate.Dh_mov_Int) < MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Ate.Cd_Unid_Int,pNrCnpj,'SLA')/24/60 --MENOR QUE NUMERO DE HORAS And Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_NaoConforme_Dia
FROM Dbamv.Unid_Int
WHERE Unid_Int.Tp_Unid_Int = 'I' And Unid_Int.Sn_Ativo = 'S' And Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01657
---------------------------------------------------------------------------
CURSOR cProcesso_01657(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_paciente , Null Cd_prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE OBITO/MORTALIDADE NA UTI EM <24H INSTIT.' Ds_Departamento , Movimento.Data_Mes , Null Nm_Processo , 'PERC DE OBITO/MORTALIDADE NA UTI EM <24H INSTIT.'|| ' QTDE DE MORTES NA UTI: '||Nvl(Movimento.Qtde_Obito_Uti,0)||Chr(10) ||', QTDE DE MORTES NA UTI <24H: '||Nvl(Movimento.Qtde_Obito_Uti_NaoConforme,0)||Chr(10) ||', TAXA DE MORTALIDADE NA UTI <24H: '||Nvl(Movimento.Vl_Taxa_Obito_Uti,0)||'%'||Chr(10) || ' QTDE DE MORTES NA UTI NO DIA: '||Nvl(Movimento.Qtde_Obito_Uti_Dia,0)||Chr(10) ||', QTDE DE MORTES NA UTI <24H NO DIA: '||Nvl(Movimento.Qtde_Obito_Uti_NaoConforme_Dia,0)||Chr(10) ||', TAXA DE MORTALIDADE NA UTI <24H NO DIA: '||Nvl(Movimento.Vl_Taxa_Obito_Uti_Dia,0)||'%' Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Obito_uti,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Vl_Taxa_Obito_uti_dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (--TAXA DE MORTALIDADE-- SELECT To_Char(v_Dt_Ini_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Obito_Uti) Qtde_Obito_Uti , Sum(Mov.Qtde_Obito_Uti_Dia) Qtde_Obito_Uti_Dia , Sum(Mov.Qtde_Obito_Uti_NaoConforme) Qtde_Obito_Uti_NaoConforme , Sum(Mov.Qtde_Obito_Uti_NaoConforme_Dia) Qtde_Obito_Uti_NaoConforme_Dia , Avg((Case
WHEN Mov.Qtde_Obito_Uti = 0
THEN 0
ELSE Round((Mov.Qtde_Obito_Uti_NaoConforme/Mov.Qtde_Obito_Uti)*100,2)
END )) Vl_Taxa_Obito_uti , Avg((Case
WHEN Mov.Qtde_Obito_Uti_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Obito_Uti_NaoConforme_Dia/Mov.Qtde_Obito_Uti_Dia)*100,2)
END )) Vl_Taxa_Obito_Uti_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Mov.Qtde_Obito_Uti) Qtde_Obito_Uti , Sum(Mov.Qtde_Obito_Uti_Dia) Qtde_Obito_Uti_Dia , Sum(Mov.Qtde_Obito_Uti_NaoConforme) Qtde_Obito_Uti_NaoConforme , Sum(Mov.Qtde_Obito_Uti_NaoConforme_Dia) Qtde_Obito_Uti_NaoConforme_Dia
FROM ( SELECT Unid_Int.Cd_Unid_Int ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_Dia ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And (Ate.dh_Lib_Mov-Ate.Dh_mov_Int) < MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Ate.Cd_Unid_Int,pNrCnpj,'SLA')/24/60 --MENOR QUE NUMERO DE HORAS And Ate.Dh_Alta_Medica Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_NaoConforme ,( SELECT Count(1)
FROM MvccAdmin.Fato_Atendime_Internado Ate, Dbamv.Mot_Alt Mot
WHERE Ate.Cd_Movimentacao = 5 And Ate.Cd_Mot_Alt = Mot.Cd_Mot_Alt And Mot.tp_mot_alta = 'O' And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.cd_tip_acom = Tip.cd_tip_acom And Tip.tp_acomodacao = 'U' And Lei.cd_leito = Ate.Cd_Leito_Alta) And Ate.Cd_Unid_Int_Alta = Unid_Int.Cd_Unid_Int And (Ate.dh_Lib_Mov-Ate.Dh_mov_Int) < MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,Ate.Cd_Unid_Int,pNrCnpj,'SLA')/24/60 --MENOR QUE NUMERO DE HORAS And Ate.Dh_Alta_Medica Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Qtde_Obito_Uti_NaoConforme_Dia
FROM Dbamv.Unid_Int
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Unid_Int.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Cd_Tip_Acom = Tip.Cd_tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Unid_Int.Cd_Unid_Int) ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01658
---------------------------------------------------------------------------
CURSOR cProcesso_01658(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_indicador , Null nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE READMISSÃO NA UTI < 48H INSTITUCIONAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC DE READMISSÃO NA UTI < 48H INSTITUCIONAL'||', QTDE DE READMISSÃO: '||Nvl(Movimento.Qtde_Reint_Uti,0)||Chr(10) ||', QTDE DE READMISSÃO <48H: '||Nvl(Movimento.Qtde_Reint_Uti_48h,0)||Chr(10) ||', TAXA DE READMISSÃO <48H: '||Nvl(Movimento.Vl_Taxa_Conforme,0)||Chr(10) ||', QTDE DE READMISSÃO NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_Dia,0)||Chr(10) ||', QTDE DE READMISSÃO <48H NO DIA: '||Nvl(Movimento.Qtde_Reint_Uti_48h_Dia,0)||Chr(10) ||', TAXA DE READMISSÃO <48H NO DIA: '||Nvl(Movimento.Vl_Taxa_Conforme_Dia,0) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_NaoConforme , Null Qtde_Instalada , 'MOV_INT' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Nvl(Movimento.Vl_Taxa_Conforme,0) Qtde_Conforme , Null Qtd_Readmissao_Uti , Null Dt_Finalizacao , Null Qtde_NaoConforme_Dia , Nvl(Movimento.Vl_Taxa_Conforme_Dia,0) Qtde_Conforme_Dia , Null Qtde_Total_Dia , 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Reint_Uti) Qtde_Reint_Uti , Sum(Mov.Qtde_Reint_Uti_Dia) Qtde_Reint_Uti_Dia , Sum(Mov.Qtde_Reint_Uti_48h) Qtde_Reint_Uti_48h , Sum(Mov.Qtde_Reint_Uti_48h_Dia) Qtde_Reint_Uti_48h_Dia , Trunc(Avg(Case
WHEN Mov.Qtde_Reint_Uti = 0
THEN 0
ELSE Round((Mov.Qtde_Reint_Uti_48h/Mov.Qtde_Reint_Uti)*100,2)
END ),2) Vl_Taxa_Conforme , Trunc(Avg(Case
WHEN Mov.Qtde_Reint_Uti_Dia = 0
THEN 0
ELSE Round((Mov.Qtde_Reint_Uti_48h_Dia/Mov.Qtde_Reint_Uti_Dia)*100,2)
END ),2) Vl_Taxa_Conforme_Dia
FROM ( SELECT Mov.Cd_Unid_Int , Sum(Mov.Qtde_Reint_Uti) Qtde_Reint_Uti , Sum(Mov.Qtde_Reint_Uti_Dia) Qtde_Reint_Uti_Dia , Sum(Mov.Qtde_Reint_Uti_48h) Qtde_Reint_Uti_48h , Sum(Mov.Qtde_Reint_Uti_48h_Dia) Qtde_Reint_Uti_48h_Dia
FROM ( SELECT Und.Cd_Unid_Int , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Reint , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Tip_Acom Tip_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Leito Lei_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito --- ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA --- And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- --- O TEMPO DA ULTIMA SAIDA ATE A NOVA ENTRADA MENOR QUE 24 HORAS --- And (To_Date(To_Char(Mov_Reint.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov_Reint.Hr_Mov_Int,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') - To_Date(To_Char(Mov_Uti_Antes.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov_Uti_Antes.Hr_Lib_Mov,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 48 --48 HORAS And Mov_Uti_Antes.Dt_Lib_Mov IS Not Null And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_48h , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Reint , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_Dia , Nvl(( SELECT Count(1)
FROM Dbamv.Mov_Int Mov_Reint , Dbamv.Leito Lei_Reint , Dbamv.Tip_Acom Tip_Reint , Dbamv.Leito Lei_Ant , Dbamv.Tip_Acom Tip_Ant
WHERE Mov_Reint.Cd_Leito = Lei_Reint.Cd_Leito And Mov_Reint.Tp_Mov = 'O' --- PACIENTE CHEGOU NA UTI --- And Lei_Reint.Cd_Tip_Acom = Tip_Reint.Cd_Tip_Acom And Tip_Reint.Tp_Acomodacao = 'U' --- PACIENTE VEIO DA UNIDADE ABERTA --- And Lei_Ant.Cd_leito = Mov_Reint.Cd_Leito_Anterior And Lei_Ant.Cd_Tip_Acom = Tip_Ant.Cd_Tip_Acom And Tip_Ant.Tp_Acomodacao <> 'U' --- PACIENTE ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA -- And Exists ( SELECT 1
FROM Dbamv.Mov_Int Mov_Uti_Antes , Dbamv.Leito Lei_Antes , Dbamv.Tip_Acom Tip_Antes , Dbamv.Leito Lei_Anterior
WHERE Lei_Antes.Cd_leito = Mov_Uti_Antes.Cd_Leito --- ESTEVE NA UTI ANTES DE IR PARA UNIDADE ABERTA --- And Lei_Antes.Cd_Tip_Acom = Tip_Antes.Cd_Tip_Acom And Tip_Antes.Tp_Acomodacao = 'U' And Mov_Uti_Antes.Cd_Atendimento = Mov_Reint.Cd_Atendimento --- RETIRA TRANSFERENCIA NA MESTA UNIDADE ----------------- And Mov_Uti_Antes.Cd_Leito_Anterior = Lei_Anterior.Cd_leito And Lei_Antes.Cd_Unid_Int <> Lei_Anterior.Cd_Unid_Int ----------------------------------------------------------- --- O TEMPO DA ULTIMA SAIDA ATE A NOVA ENTRADA MENOR QUE 24 HORAS --- And (To_Date(To_Char(Mov_Reint.Dt_Mov_Int,'DD/MM/YYYY')||' '||To_Char(Mov_Reint.Hr_Mov_Int,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS') - To_Date(To_Char(Mov_Uti_Antes.Dt_Lib_Mov,'DD/MM/YYYY')||' '||To_Char(Mov_Uti_Antes.Hr_Lib_Mov,'HH24:MI:SS'),'DD/MM/YYYY HH24:MI:SS'))*24 < 48 --48 HORAS And Mov_Uti_Antes.Dt_Lib_Mov IS Not Null And Mov_Uti_Antes.Cd_Mov_Int < Mov_Reint.Cd_Mov_Int) And Lei_Reint.Cd_Unid_Int = Und.Cd_Unid_Int And Mov_Reint.Dt_Mov_Int Between Trunc(Sysdate) And Trunc(Sysdate)+.99999 And Exists ( SELECT 1
FROM MvccAdmin.Fato_Atendime_Internado Ate
WHERE Ate.Cd_Atendimento = Mov_Reint.Cd_Atendimento And Ate.Cd_Multi_Empresa = pCdMultiEmpresa) ),0) Qtde_Reint_Uti_48h_Dia
FROM Dbamv.Unid_Int Und
WHERE Exists ( SELECT 1
FROM Dbamv.Setor Str
WHERE Str.Cd_Setor = Und.Cd_Setor And Str.Cd_Multi_Empresa = pCdMultiEmpresa) And Exists ( SELECT 1
FROM Dbamv.Leito Lei, Dbamv.Tip_Acom Tip
WHERE Lei.Tp_Situacao = 'A' And Lei.Cd_Tip_Acom = Tip.Cd_Tip_Acom And Tip.Tp_Acomodacao = 'U' And Lei.Cd_Unid_Int = Und.Cd_Unid_Int) AND Und.sn_ativo = 'S' ) Mov
GROUP BY Mov.Cd_Unid_Int ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01659
---------------------------------------------------------------------------
CURSOR cProcesso_01659(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ENTRADAS DA URGENCIA P/HORA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE ENTRADAS DA URGENCIA P/HORA'||', QTDE DE ENTRADA NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme_Dia Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Entradas_Dia Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Count(1) Qtde_Entradas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' --- ORIGEM A SER DESCONSIDERADA NO CALCULO --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between To_Date(To_Char(Sysdate,'DD/MM/YYYY HH24'),'DD/MM/YYYY HH24:MI:SS') And Sysdate And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01660
---------------------------------------------------------------------------
CURSOR cProcesso_01660(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE SAÍDAS DA URGENCIA P/HORA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE SAÍDAS DA URGENCIA P/HORA'||', QTDE DE SAÍDAS NO DIA: '||Movimento.Qtde_Conforme_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Conforme_Dia Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Entradas_Dia Qtde_Conforme_Dia
FROM ( SELECT Ate.Cd_Multi_Empresa , Count(1) Qtde_Entradas_Dia
FROM MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ate.Tp_Atendimento = 'U' --- ORIGEM A SER DESCONSIDERADA NO CALCULO --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ate.Dh_Atendimento Between To_Date(To_Char(Sysdate,'DD/MM/YYYY HH24'),'DD/MM/YYYY HH24:MI:SS') And Sysdate And Ate.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Ate.Cd_Multi_Empresa ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01661
---------------------------------------------------------------------------
CURSOR cProcesso_01661(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE PAC´S ATEND. NO PS FORA SLA P/HORA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE PAC´S ATEND. NO PS FORA SLA P/HORA'||', QTDE FORA DO SLA: '||Movimento.Qtde_Atend_Fora_Sla ||', QTDE FORA DO SLA NO DIA: '||Movimento.Qtde_Atend_Fora_Sla_Dia Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Atend_Fora_Sla Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Atend_Fora_Sla_dIA Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Data_Mes , Sum(Mov.Qtde_Atend_Fora_Sla) Qtde_Atend_Fora_Sla , Sum(Mov.Qtde_Atend_Fora_Sla_Dia) Qtde_Atend_Fora_Sla_Dia
FROM ( SELECT To_Char(Mov.Dh_Atendimento,'MM/YYYY') Data_Mes , 1 Qtde_Atend_Fora_Sla , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Atend_Fora_Sla_Dia
FROM ( SELECT Ate.Dh_Atendimento , ( SELECT Min(Nvl(Stp_H.dh_processo,Stp.dh_processo))
FROM Dbamv.Sacr_Tempo_Processo Stp, Dbamv.Sacr_Tempo_Processo_Historico Stp_H
WHERE Stp_H.cd_atendimento(+) = Stp.cd_atendimento And Stp_H.cd_triagem_atendimento(+) = Stp.cd_triagem_atendimento And Stp_H.cd_tipo_tempo_processo(+) = Stp.cd_tipo_tempo_processo And Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo = Nvl(vChaveIniProcesso,30)) Dh_Processo --FIM DO CADASTRO OU CONFIGURACAO , ( SELECT Min(Nvl(Stp_H.dh_processo,Stp.dh_processo))
FROM Dbamv.Sacr_Tempo_Processo Stp, Dbamv.Sacr_Tempo_Processo_Historico Stp_H
WHERE Stp_H.cd_atendimento(+) = Stp.cd_atendimento And Stp_H.cd_triagem_atendimento(+) = Stp.cd_triagem_atendimento And Stp_H.cd_tipo_tempo_processo(+) = Stp.cd_tipo_tempo_processo And Stp.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Stp.cd_tipo_tempo_processo = Nvl(vChaveFimProcesso,30)) Dh_Processo_Fim --CHAMADA PARA ATENDIMENTO MEDICO OU CONFIGURACAO , Ate.Dh_Atendimento+(MvccAdmin.Fnc_Departamento(pCdMvccEmpresa,pProcesso,1,pNrCnpj,'SLA')/24/60) Dh_Prev_Atendimento
FROM Dbamv.Triagem_Atendimento ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' --- ORIGEM A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_Removido IS Null And Ta.cd_cor_referencia IS Not Null And Ate.Dh_Atendimento Between To_Date(To_Char(Sysdate,'DD/MM/YYYY HH24'),'DD/MM/YYYY HH24:MI:SS') And Sysdate And Ate.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov
WHERE Mov.Dh_Processo > Mov.Dh_Prev_Atendimento ) Mov
GROUP BY Mov.Data_Mes ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01662
---------------------------------------------------------------------------
CURSOR cProcesso_01662(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE ABANDONO/EVASÃO NO PS INSTITUCIONAL P/HORA' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE ABANDONO/EVASÃO NO PS INSTITUCIONAL P/HORA'||', QTDE DE ABANDONOS: '||Movimento.Qtde_Abandono||Chr(10) ||', TAXA DE ABANDONOS: '||Movimento.Vl_Taxa_Abandono||'%'||Chr(10) ||', QTDE DE ABANDONOS NO DIA: '||Movimento.Qtde_Abandono_Dia||Chr(10) ||', TAXA DE ABANDONOS NO DIA: '||Movimento.Vl_Taxa_Abandono_Dia||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'ATENDIME' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Qtde_Abandono Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Qtde_Abandono_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO--- SELECT Mov.Cd_Multi_Empresa , Mov.Data_Mes , Mov.Qtde_Total , Mov.Qtde_Total_Dia , Mov.Qtde_Abandono , Mov.Qtde_Abandono_Dia , (Case
WHEN Mov.qtde_total = 0
THEN 0
ELSE Round((Mov.Qtde_Abandono/Mov.qtde_total)*100,2)
END ) Vl_Taxa_Abandono , (Case
WHEN Mov.qtde_total_dia = 0
THEN 0
ELSE Round((Mov.Qtde_Abandono_Dia/Mov.qtde_total_dia)*100,2)
END ) Vl_Taxa_Abandono_Dia
FROM ( SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Abandono,'MM/YYYY') Data_Mes , Sum(Mov.Qtde_Abandono) Qtde_Abandono , Sum(Mov.Qtde_Abandono_Dia) Qtde_Abandono_Dia , Sum(Mov.Qtde_Total) Qtde_Total , Sum(Mov.Qtde_Total_Dia) Qtde_Total_Dia
FROM (---QTDE TOTAL DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between To_Date(To_Char(Sysdate,'DD/MM/YYYY HH24'),'DD/MM/YYYY HH24:MI:SS') And Sysdate And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---EVASÃO DE ATENDIMENTO/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Ate.Cd_Ori_Ate , Ate.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Ate.Cd_Tip_Res And Vcc.Cd_Tipo_Campo_Chave = 134 --TIPO DE RESULTADO CONSIDERADO EVASAO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between To_Date(To_Char(Sysdate,'DD/MM/YYYY HH24'),'DD/MM/YYYY HH24:MI:SS') And Sysdate And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---QTDE TOTAL DE SENHAS--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Ta.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 0 Qtde_Abandono , 0 Qtde_Abandono_Dia , 1 Qtde_Total , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS NULL And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between To_Date(To_Char(Sysdate,'DD/MM/YYYY HH24'),'DD/MM/YYYY HH24:MI:SS') And Sysdate And Ta.Cd_Multi_Empresa = pCdMultiEmpresa
UNION ALL ---REMOÇÃO DE SENHA/ABANDONO--- SELECT Ta.Cd_Multi_Empresa , Null Cd_Oti_Ate , Ta.Cd_Especialid , Ta.dh_pre_atendimento Dh_Abandono , Nvl(( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
END )
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa),'N') Tp_Considerada , 1 Qtde_Abandono , (Case
WHEN Ta.dh_pre_atendimento Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Abandono_Dia , 0 Qtde_Total , 0 Qtde_Total_Dia
FROM Dbamv.Triagem_Atendimento Ta , Dbamv.Config_Paeu Cfg
WHERE Ta.Cd_Multi_Empresa = Cfg.Cd_Multi_Empresa And Ta.Cd_Atendimento IS Null And Ta.Dh_Removido IS Not Null And Exists ( SELECT 1
FROM Dbamv.Fila_Senha Fs
WHERE Fs.Cd_Fila_Senha = Ta.Cd_Fila_Senha And Fs.Sn_Utiliza_Fluxo_Sacr = 'S') And Exists ( SELECT 1
FROM Dbamv.Sacr_Tempo_Processo Ap
WHERE Ap.Cd_Triagem_Atendimento = Ta.Cd_Triagem_Atendimento And Ap.Cd_Tipo_Tempo_Processo In (1)) --RETIRADA DA SENHA And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ta.Cd_Fila_Senha) And Vcc.Cd_Tipo_Campo_Chave = 186 --FILA DO FLUXO DE ATENDIMENTO A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 188 --INCLUIR SENHA REMOVIDA/ABANDONO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Campo_Chave = 'S' And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.dh_pre_atendimento Between To_Date(To_Char(Sysdate,'DD/MM/YYYY HH24'),'DD/MM/YYYY HH24:MI:SS') And Sysdate And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov , ( SELECT Min(Case
WHEN Vcc.Cd_Tipo_Campo_Chave = 139
THEN 'C'
ELSE 'N'
END ) Tp_Configuracao
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Tipo_Campo_Chave = 139 --FILA DO FLUXO DE ATENDIMENTO A SER CONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa ) Cfg
WHERE (Case
WHEN Nvl(Cfg.Tp_Configuracao,'N') = 'N'
THEN 'S'
WHEN Cfg.Tp_Configuracao = 'C' And Mov.Tp_Considerada = 'C'
THEN 'S'
END ) = 'S'
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Abandono,'MM/YYYY') ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01663
---------------------------------------------------------------------------
CURSOR cProcesso_01663(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_Diagnostico , Null Nm_Indicador , Null Nm_Grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'PERC DE PAC´S C/USO DE PLANO TERAP. NA URG. GLOBAL' Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Ini_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'PERC DE PAC´S C/USO DE PLANO TERAP. NA URG. GLOBAL'||Chr(10)||', QTDE DE PAC´S ATENDIDOS: '||Movimento.Qtde_Paciente||Chr(10) ||', QTDE DE PAC´S COM USO DE TERAPIA: '||Movimento.Qtde_Uso_Tera||Chr(10) ||', TAXA DE PAC´S COM USO DE TERAPIA: '||Movimento.Vl_Perc_Uso_Tera||'%'||Chr(10) ||', QTDE DE PAC´S ATENDIDOS NO DIA: '||Movimento.Qtde_Paciente_Dia||Chr(10) ||', QTDE DE PAC´S COM USO DE TERAPIA NO DIA: '||Movimento.Qtde_Uso_Tera_Dia||Chr(10) ||', TAXA DE PAC´S COM USO DE TERAPIA NO DIA: '||Movimento.Vl_Perc_Uso_Tera_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/MEDICAMENTOS: '||Movimento.Qtde_Uso_Medi||Chr(10) ||', TAXA DE PAC´S SOMENTE C/MEDICAMENTOS: '||Movimento.Vl_Perc_Uso_Medi||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/MEDICAMENTOS NO DIA: '||Movimento.Qtde_Uso_Medi_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/MEDICAMENTOS NO DIA: '||Movimento.Vl_Perc_Uso_Medi_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM: '||Movimento.Qtde_Uso_Imag||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM: '||Movimento.Vl_Perc_Uso_Imag||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM NO DIA: '||Movimento.Qtde_Uso_Imag_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO: '||Movimento.Qtde_Uso_Labo||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO: '||Movimento.Vl_Perc_Uso_Labo||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO NO DIA: '||Movimento.Qtde_Uso_Labo_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO NO DIA: '||Movimento.Vl_Perc_Uso_Labo_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO: '||Movimento.Qtde_Uso_Imag_Labo||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO: '||Movimento.Vl_Perc_Uso_Imag_Labo||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO NO DIA: '||Movimento.Qtde_Uso_Imag_Labo_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E LABORATÓRIO NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Labo_Dia||'%'||Chr(10) ||', QTDE DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO: '||Movimento.Qtde_Uso_Imag_Labo_Medi||Chr(10) ||', TAXA DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO: '||Movimento.Vl_Perc_Uso_Imag_Labo_Medi||'%'||Chr(10) ||', QTDE DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Qtde_Uso_Imag_Labo_Medi_Dia||Chr(10) ||', TAXA DE PAC´S COM IMAGEM, LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Labo_Medi_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO: '||Movimento.Qtde_Uso_Imag_Medi||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO: '||Movimento.Vl_Perc_Uso_Imag_Medi||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO NO DIA: '||Movimento.Qtde_Uso_Imag_Medi_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/IMAGEM E MEDICAMENTO NO DIA: '||Movimento.Vl_Perc_Uso_Imag_Medi_Dia||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO: '||Movimento.Qtde_Uso_Labo_Medi||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO: '||Movimento.Vl_Perc_Uso_Labo_Medi||'%'||Chr(10) ||', QTDE DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Qtde_Uso_Labo_Medi_Dia||Chr(10) ||', TAXA DE PAC´S SOMENTE C/LABORATÓRIO E MEDICAMENTO NO DIA: '||Movimento.Vl_Perc_Uso_Labo_Medi_Dia||'%'||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'HRIT_PRE_MED' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Movimento.Vl_Perc_Uso_Tera Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Movimento.Vl_Perc_Uso_Tera_Dia Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (--MOVIMENTO-- SELECT Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Atendimento,'MM/YYYY') Data_Mes ---MENSAL--- , Sum(Mov.Qtde_Paciente) Qtde_Paciente , Sum(Mov.Qtde_Uso_Tera) Qtde_Uso_Tera , Sum(Mov.Qtde_Uso_Medi) Qtde_Uso_Medi , Sum(Mov.Qtde_Uso_Imag) Qtde_Uso_Imag , Sum(Mov.Qtde_Uso_Labo) Qtde_Uso_Labo , Sum(Mov.Qtde_Uso_Imag_Labo) Qtde_Uso_Imag_Labo , Sum(Mov.Qtde_Uso_Imag_Labo_Medi) Qtde_Uso_Imag_Labo_Medi , Sum(Mov.Qtde_Uso_Imag_Medi) Qtde_Uso_Imag_Medi , Sum(Mov.Qtde_Uso_Labo_Medi) Qtde_Uso_Labo_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Tera)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Tera , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Labo , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag_Labo , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag_Labo_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Imag_Medi , (Case
WHEN Sum(Mov.Qtde_Paciente) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo_Medi)/Sum(Mov.Qtde_Paciente)*100,2)
END ) Vl_Perc_Uso_Labo_Medi ---DIARIO--- , Sum(Mov.Qtde_Paciente_Dia) Qtde_Paciente_Dia , Sum(Mov.Qtde_Uso_Tera_Dia) Qtde_Uso_Tera_Dia , Sum(Mov.Qtde_Uso_Medi_Dia) Qtde_Uso_Medi_Dia , Sum(Mov.Qtde_Uso_Imag_Dia) Qtde_Uso_Imag_Dia , Sum(Mov.Qtde_Uso_Labo_Dia) Qtde_Uso_Labo_Dia , Sum(Mov.Qtde_Uso_Imag_Labo_Dia) Qtde_Uso_Imag_Labo_Dia , Sum(Mov.Qtde_Uso_Imag_Labo_Medi_Dia) Qtde_Uso_Imag_Labo_Medi_Dia , Sum(Mov.Qtde_Uso_Imag_Medi_Dia) Qtde_Uso_Imag_Medi_Dia , Sum(Mov.Qtde_Uso_Labo_Medi_Dia) Qtde_Uso_Labo_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Tera_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Tera_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Labo_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Labo_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Labo_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Labo_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Imag_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Imag_Medi_Dia , (Case
WHEN Sum(Mov.Qtde_Paciente_Dia) = 0
THEN Null
ELSE Trunc(Sum(Mov.Qtde_Uso_Labo_Medi_Dia)/Sum(Mov.Qtde_Paciente_Dia)*100,2)
END ) Vl_Perc_Uso_Labo_Medi_Dia
FROM (---MEDICAMENTOS-- SELECT Mov.Cd_Multi_Empresa , Mov.Dh_Atendimento --- MENSAL --- , Mov.Qtde_Paciente , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag , (Case
WHEN Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo , (Case
WHEN Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo_Medi , (Case
WHEN Mov.Qtde_Uso_Medi = 1 Or Mov.Qtde_Uso_Imag = 1 Or Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Tera --- DIARIO --- , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate
THEN Mov.Qtde_Paciente
ELSE 0
END ) Qtde_Paciente_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 0 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Labo_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 1 And Mov.Qtde_Uso_Labo = 0
THEN 1
ELSE 0
END ) Qtde_Uso_Imag_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And Mov.Qtde_Uso_Medi = 1 And Mov.Qtde_Uso_Imag = 0 And Mov.Qtde_Uso_Labo = 1
THEN 1
ELSE 0
END ) Qtde_Uso_Labo_Medi_Dia , (Case
WHEN Mov.Dh_Atendimento Between Trunc(Sysdate) And Sysdate And (Mov.Qtde_Uso_Medi = 1 Or Mov.Qtde_Uso_Imag = 1 Or Mov.Qtde_Uso_Labo = 1)
THEN 1
ELSE 0
END ) Qtde_Uso_Tera_Dia
FROM (---MEDICAMENTOS--- SELECT Ate.Cd_Multi_Empresa , Ate.Dh_Atendimento , 1 Qtde_Paciente , Nvl(( SELECT Min(1)
FROM Dbamv.Pre_Med Prm, Dbamv.ItPre_Med Itp
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And Itp.Tp_Situacao = 'N' And Prm.Fl_Impresso = 'S' And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) And Itp.Cd_Tip_Esq = ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 196 --TIPO DE ESQUEMA DA PRESCRIÇÃO-MEDICAMENTOS And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa
GROUP BY Vcc.Cd_Campo_Chave) And Rownum = 1),0) Qtde_Uso_Medi , Nvl(( SELECT Min(1)
FROM Dbamv.Pre_Med Prm, Dbamv.ItPre_Med Itp
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And Itp.Tp_Situacao = 'N' And Prm.Fl_Impresso = 'S' And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) And Itp.Cd_Tip_Esq = ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 198 --TIPO DE ESQUEMA DA PRESCRIÇÃO-IMAGINOLOGIA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa
GROUP BY Vcc.Cd_Campo_Chave) And Rownum = 1),0) Qtde_Uso_Imag , Nvl(( SELECT Min(1)
FROM Dbamv.Pre_Med Prm, Dbamv.ItPre_Med Itp
WHERE Prm.Cd_Pre_Med = Itp.Cd_Pre_Med And Itp.Tp_Situacao = 'N' And Prm.Fl_Impresso = 'S' And Prm.Cd_Atendimento = Ate.Cd_Atendimento And Prm.Cd_Documento_Clinico = ( SELECT Pdc.Cd_Documento_Clinico
FROM MvccAdmin.Fato_Documento_Clinico_Urg Pdc
WHERE Pdc.Cd_Documento_Clinico = Prm.Cd_Documento_Clinico And Prm.Dh_Criacao Between Pdc.Dt_Criacao And Pdc.Dt_Criacao+.99999 And Pdc.Tp_Status In ('FECHADO','ASSINADO')
GROUP BY Pdc.Cd_Documento_Clinico) And Itp.Cd_Tip_Esq = ( SELECT Vcc.Cd_Campo_Chave
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = Itp.Cd_Tip_Esq And Vcc.Cd_Tipo_Campo_Chave = 197 --TIPO DE ESQUEMA DA PRESCRIÇÃO-LABORATORIO And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa
GROUP BY Vcc.Cd_Campo_Chave) And Rownum = 1),0) Qtde_Uso_Labo
FROM Dbamv.Triagem_Atendimento Ta , MvccAdmin.Fato_Atendime_Externo Ate
WHERE Ta.Cd_Atendimento = Ate.Cd_Atendimento And Ate.Tp_Atendimento = 'U' And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave = To_Char(Ate.Cd_Ori_Ate) And Vcc.Cd_Tipo_Campo_Chave = 99 --ORIGEM A DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Ta.Dh_pre_atendimento Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Ta.Cd_Multi_Empresa = pCdMultiEmpresa ) Mov ) Mov
GROUP BY Mov.Cd_Multi_Empresa , To_Char(Mov.Dh_Atendimento,'MM/YYYY') ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01669
---------------------------------------------------------------------------
CURSOR cProcesso_01669(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , 1 Cd_Departamento , 'QTDE DE CIRURGIAS REAL. (GLOBAL)' Ds_Departamento , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , 'QTDE DE CIRURGIAS REAL. (GLOBAL)'||Chr(10)||', QTDE PRODUZIDA: '||Sum(Movimento.Qtde_Utilizada)||Chr(10) ||', QTDE PRODUZIDA NO DIA: '||Sum(Movimento.Qtde_Utilizada_Dia)||Chr(10) ||', QTDE PROJETADA: '||Sum(Movimento.Qtde_Projetada) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'METAS_DIAG_PROCESSOS' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Utilizada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Utilizada_Dia) Qtde_Conforme_Dia, Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Dt_Mes , Nvl(Mov.Qtde_Utilizada,0) Qtde_Utilizada , Nvl(Mov.Qtde_Utilizada_Dia,0) Qtde_Utilizada_Dia , Nvl(Mov.Qtde_Projetada,0) Qtde_Projetada , Nvl(Mov.Qtde_Projetada,0)/To_Char(v_Dt_Fim_Diagno,'DD') Qtde_Projetada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Avi.Dt_Mes , Sum(Avi.Qtde_Utilizada) Qtde_Utilizada , Sum(Avi.Qtde_Utilizada_Dia) Qtde_Utilizada_Dia , MvccAdmin.Fnc_Valor_Perspectiva_Mensal(Sum(Avi.Qtde_Utilizada),v_Dt_Ini_Diagno,v_Dt_Fim_Diagno) Qtde_Projetada
FROM ( SELECT Avi.Cd_Multi_Empresa , To_Char(Avi.Dt_Realizacao,'MM/YYYY') dt_mes , 1 Qtde_Utilizada , (Case
WHEN Avi.Dt_Realizacao Between Trunc(Sysdate) And Sysdate
THEN 1
ELSE 0
END ) Qtde_Utilizada_Dia
FROM Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'R' --Qtde_Realizada --- IDADE MINIMA A SER DESCONSIDERADA --- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 74 --IDADE MINIMA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) -- CIRUGIAS A SER DESCONSIDERADAS -- And Not Exists ( SELECT 1
FROM MvccAdmin.v_Campo_Chave Vcc
WHERE Vcc.Nr_Processo = pProcesso And Vcc.Cd_Campo_Chave < Nvl(Avi.Ds_idade,0) And Vcc.Cd_Tipo_Campo_Chave = 89 --CIRURGIA A SER DESCONSIDERADA And Vcc.Nr_Cnpj = pNrCnpj And Vcc.Cd_Multi_Empresa = pCdMvccEmpresa) And Avi.Dt_Realizacao Between v_Dt_Ini_Diagno And v_Dt_Fim_Diagno And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Dt_Mes ) Mov ) Movimento , MvccAdmin.Estabelecimento
WHERE Estabelecimento.Cd_Multi_Empresa = Movimento.Cd_Multi_Empresa And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Dt_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01670
---------------------------------------------------------------------------
CURSOR cProcesso_01670(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||Chr(10)||', QTDE PROGRAMADA: '||Sum(Movimento.Qtde_Programada)||Chr(10) ||', QTDE PROGRAMADA NO DIA: '||Sum(Movimento.Qtde_Programada_dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AGE_CIR' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Programada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Programada_Dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Programada , Mov.Qtde_Programada_Dia
FROM (---FILA DE 30 DIAS--- SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Sum(Avi.Qtde_Programada) Qtde_Programada , Sum(Avi.Qtde_Programada_Dia) Qtde_Programada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , 1 Qtde_Programada , (Case
WHEN Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate) And Trunc(Sysdate)+.99999
THEN 1
ELSE 0
END ) Qtde_Programada_Dia
FROM Dbamv.Age_Cir Age , Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Age.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'G' --AGENDADAS/PROGRAMADAS And Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate)+1 And Trunc(Sysdate)+30 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01671
---------------------------------------------------------------------------
CURSOR cProcesso_01671(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||Chr(10)||', QTDE PROGRAMADA: '||Sum(Movimento.Qtde_Programada)||Chr(10) ||', QTDE PROGRAMADA NO DIA: '||Sum(Movimento.Qtde_Programada_dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AGE_CIR' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Programada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Programada_Dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Programada , Mov.Qtde_Programada_Dia
FROM (---FILA DE 30 DIAS--- SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Sum(Avi.Qtde_Programada) Qtde_Programada , Sum(Avi.Qtde_Programada_Dia) Qtde_Programada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , 1 Qtde_Programada , (Case
WHEN Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate) And Trunc(Sysdate)+.99999
THEN 1
ELSE 0
END ) Qtde_Programada_Dia
FROM Dbamv.Age_Cir Age , Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Age.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'G' --AGENDADAS/PROGRAMADAS And Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate)+1 And Trunc(Sysdate)+60 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01672
---------------------------------------------------------------------------
CURSOR cProcesso_01672(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||Chr(10)||', QTDE PROGRAMADA: '||Sum(Movimento.Qtde_Programada)||Chr(10) ||', QTDE PROGRAMADA NO DIA: '||Sum(Movimento.Qtde_Programada_dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AGE_CIR' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Programada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Programada_Dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Programada , Mov.Qtde_Programada_Dia
FROM (---FILA DE 30 DIAS--- SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Sum(Avi.Qtde_Programada) Qtde_Programada , Sum(Avi.Qtde_Programada_Dia) Qtde_Programada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , 1 Qtde_Programada , (Case
WHEN Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate) And Trunc(Sysdate)+.99999
THEN 1
ELSE 0
END ) Qtde_Programada_Dia
FROM Dbamv.Age_Cir Age , Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Age.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'G' --AGENDADAS/PROGRAMADAS And Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate)+1 And Trunc(Sysdate)+90 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01673
---------------------------------------------------------------------------
CURSOR cProcesso_01673(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||Chr(10)||', QTDE PROGRAMADA: '||Sum(Movimento.Qtde_Programada)||Chr(10) ||', QTDE PROGRAMADA NO DIA: '||Sum(Movimento.Qtde_Programada_dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AGE_CIR' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Programada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Programada_dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Programada , Mov.Qtde_Programada_Dia
FROM (---FILA DE 30 DIAS--- SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Sum(Avi.Qtde_Programada) Qtde_Programada , Sum(Avi.Qtde_Programada_Dia) Qtde_Programada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , 1 Qtde_Programada , (Case
WHEN Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate) And Trunc(Sysdate)+.99999
THEN 1
ELSE 0
END ) Qtde_Programada_Dia
FROM Dbamv.Age_Cir Age , Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Age.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'G' --AGENDADAS/PROGRAMADAS And Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate)+1 And Trunc(Sysdate)+180 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;


---------------------------------------------------------------------------
-- CURSOR cProcesso_01674
---------------------------------------------------------------------------
CURSOR cProcesso_01674(pCdMultiEmpresa Number, pProcesso Number, pNrCnpj Number, pCdCliente Number, pCdMvccEmpresa Number) IS SELECT pProcesso Nr_Processo , Null Tp_Categoria , Null Cd_Atendimento , Null Cd_Paciente , Null Cd_Prestador , Null Tp_diagnostico , NUll nm_indicador , NUll nm_grupo , Estabelecimento.Cd_Mvcc_Empresa Cd_Multi_Empresa , Especialid.Cd_Especialid Cd_Departamento , Especialid.Ds_Especialid Ds_Departamento , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) Data_Mes , Null Nm_Processo , Especialid.Ds_Especialid||Chr(10)||', QTDE PROGRAMADA: '||Sum(Movimento.Qtde_Programada)||Chr(10) ||', QTDE PROGRAMADA NO DIA: '||Sum(Movimento.Qtde_Programada_dia)||Chr(10) Ds_Item_Nao_Conforme , pCdCliente Cd_Cliente , Estabelecimento.Nr_Cnpj , v_Dh_Geracao Dh_Geracao , Null Qtde_Naoconforme , Null Qtde_Instalada , 'AGE_CIR' Nm_Tabela_Chave , pProcesso Cd_Coluna_Chave , v_Dh_Geracao Dt_Coluna_Chave , Null Dh_Proxima_Geracao , Sum(Movimento.Qtde_Programada) Qtde_Conforme , Null Qtde_Total, Null Dt_Finalizacao, Null Qtde_NaoConforme_Dia, Sum(Movimento.Qtde_Programada_Dia) Qtde_Conforme_Dia , Null Qtde_Total_Dia, 1 Nr_Notificacao
FROM (---MOVIMENTO CIRURGICO--- SELECT Mov.Cd_Multi_Empresa , Mov.Cd_Especialid , To_Char(v_Dt_Fim_Diagno,'MM/YYYY') Data_Mes , Mov.Qtde_Programada , Mov.Qtde_Programada_Dia
FROM (---FILA DE 30 DIAS--- SELECT Avi.Cd_Multi_Empresa , Avi.Cd_Especialid , Sum(Avi.Qtde_Programada) Qtde_Programada , Sum(Avi.Qtde_Programada_Dia) Qtde_Programada_Dia
FROM ( SELECT Avi.Cd_Multi_Empresa , Cir.Cd_Especialid , 1 Qtde_Programada , (Case
WHEN Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate) And Trunc(Sysdate)+.99999
THEN 1
ELSE 0
END ) Qtde_Programada_Dia
FROM Dbamv.Age_Cir Age , Dbamv.Aviso_Cirurgia Avi , Dbamv.Cirurgia_Aviso Cir
WHERE Age.Cd_Aviso_Cirurgia = Avi.Cd_Aviso_Cirurgia And Avi.Cd_Aviso_Cirurgia = Cir.Cd_Aviso_Cirurgia And Cir.Sn_Principal = 'S' And Avi.Tp_Situacao = 'G' --AGENDADAS/PROGRAMADAS And Age.Dt_Inicio_Age_Cir Between Trunc(Sysdate)+1 And Trunc(Sysdate)+365 And Avi.Cd_Multi_Empresa = pCdMultiEmpresa ) Avi
GROUP BY Avi.Cd_Multi_Empresa , Avi.Cd_Especialid ) Mov ) Movimento , Dbamv.Especialid , MvccAdmin.Estabelecimento
WHERE Especialid.Cd_Especialid = Movimento.Cd_Especialid And Estabelecimento.Cd_Multi_Empresa = pCdMultiEmpresa
GROUP BY Estabelecimento.Cd_Mvcc_Empresa , Nvl(Movimento.Data_Mes,To_Char(v_Dt_Fim_Diagno,'MM/YYYY')) , Especialid.Cd_Especialid , Especialid.Ds_Especialid , Estabelecimento.Nr_Cnpj;

