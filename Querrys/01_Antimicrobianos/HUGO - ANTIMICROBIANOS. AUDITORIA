SELECT 
 P.CD_PACIENTE AS CD_PACIENTE,
 P.NM_PACIENTE AS PACIENTE,
 TRUNC(MONTHS_BETWEEN(SYSDATE, P.DT_NASCIMENTO)/12) AS IDADE,
 P.TP_SEXO AS SEXO,
 A.CD_ATENDIMENTO AS ATENDIMENTO,
 TO_CHAR(A.DT_ATENDIMENTO, 'DD/MM/YYYY') AS DATA_INTERNACAO,
 TRUNC(SYSDATE - A.DT_ATENDIMENTO) AS DIAS_INTERNADO,
 L.DS_LEITO AS LEITO,
 UI.DS_UNID_INT AS UNIDADE,
 S.NM_SETOR AS SETOR,
 PM.CD_PRE_MED AS CD_PRESCRICAO,
 TO_CHAR(PM.DT_PRE_MED, 'DD/MM/YYYY') AS DATA_PRESCRICAO,
 TO_CHAR(PM.HR_PRE_MED, 'HH24:MI') AS HORA_PRESCRICAO,
 PREST.NM_PRESTADOR AS MEDICO,
 ESP.DS_ESPECIALID AS ESPECIALIDADE,
 TP.DS_TIP_PRESC AS ANTIMICROBIANO,
 IT.QT_ITPRE_MED AS DOSE,
 UP.DS_UNIDADE AS UNIDADE_MEDIDA,
 TF.DS_TIP_FRE AS FREQUENCIA,
 FA.DS_FOR_APL AS VIA_ADM,
 IT.DS_ITPRE_MED AS OBSERVACAO,
 IT.QT_DIAS AS DIAS_SOLICITADOS,
 TRUNC(SYSDATE - PM.DT_PRE_MED) AS DIAS_USO,
 CASE 
 WHEN IT.QT_DIAS IS NOT NULL AND TRUNC(SYSDATE - PM.DT_PRE_MED) > IT.QT_DIAS 
 THEN 'EXCEDEU PRAZO'
 WHEN IT.QT_DIAS IS NOT NULL AND TRUNC(SYSDATE - PM.DT_PRE_MED) = IT.QT_DIAS 
 THEN 'ULTIMO DIA'
 WHEN IT.QT_DIAS IS NOT NULL 
 THEN 'DENTRO DO PRAZO'
 ELSE 'SEM PRAZO DEFINIDO'
 END AS STATUS_PRAZO,
 CASE 
 WHEN IT.QT_DIAS IS NOT NULL 
 THEN IT.QT_DIAS - TRUNC(SYSDATE - PM.DT_PRE_MED)
 ELSE NULL
 END AS DIAS_RESTANTES,
 CASE 
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%MEROPENEM%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%MEROPENEM%' THEN 'CARBAPENEMICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ERTAPENEM%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%ERTAPENEM%' THEN 'CARBAPENEMICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%IMIPENEM%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%IMIPENEM%' THEN 'CARBAPENEMICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%DORIPENEM%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%DORIPENEM%' THEN 'CARBAPENEMICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%POLIMIXINA%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%POLIMIXINA%' THEN 'POLIMIXINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%COLISTIN%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%COLISTIMETATO%' THEN 'POLIMIXINA'
 WHEN (UPPER(TP.DS_TIP_PRESC) LIKE '%VANCOMICINA%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%VANCO %') 
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%DOSAGEM%' 
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%EXAME%' THEN 'GLICOPEPTIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TEICOPLANINA%' THEN 'GLICOPEPTIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%DAPTOMICINA%' THEN 'LIPOPEPTIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%LINEZOLIDA%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%LINEZOLID %' THEN 'OXAZOLIDINONA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TEDIZOLIDA%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%TEDIZOLID%' THEN 'OXAZOLIDINONA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTAZIDIMA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%AVIBACTAM%' THEN 'CEFALO+INIB ZAVICEFTA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ZAVICEFTA%' THEN 'CEFALO+INIB ZAVICEFTA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTOLOZANA%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTOLOZANE%' THEN 'CEFALO+INIB ZERBAXA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ZERBAXA%' THEN 'CEFALO+INIB ZERBAXA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AZTREONAM%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%AZTREONAM%' THEN 'MONOBACTAMICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AZACTAM%' THEN 'MONOBACTAMICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFALEXINA%' THEN 'CEFALOSPORINA 1G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFALOTINA%' THEN 'CEFALOSPORINA 1G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFAZOLINA%' THEN 'CEFALOSPORINA 1G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFUROXIMA%' THEN 'CEFALOSPORINA 2G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTRIAXONA%' THEN 'CEFALOSPORINA 3G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFOTAXIMA%' THEN 'CEFALOSPORINA 3G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTAZIDIMA%' AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%AVIBACTAM%' THEN 'CEFALOSPORINA 3G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFEPIME%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%CEFEPIMA%' THEN 'CEFALOSPORINA 4G'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%PIPERACILINA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%TAZOBACTAM%' THEN 'PENICILINA+INIB'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AMOXICILINA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%CLAVULANATO%' THEN 'PENICILINA+INIB'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AMPICILINA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%SULBACTAM%' THEN 'PENICILINA+INIB'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TICARCILINA%' THEN 'PENICILINA+INIB'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%PENICILINA%' THEN 'PENICILINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AMPICILINA%' AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%SULBACTAM%' THEN 'PENICILINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AMOXICILINA%' AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%CLAVULANATO%' THEN 'PENICILINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%OXACILINA%' THEN 'PENICILINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CIPROFLOXACIN%' THEN 'QUINOLONA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%LEVOFLOXACIN%' THEN 'QUINOLONA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%MOXIFLOXACIN%' THEN 'QUINOLONA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%NORFLOXACIN%' THEN 'QUINOLONA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%OFLOXACIN%' THEN 'QUINOLONA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%GENTAMICINA%' THEN 'AMINOGLICOSIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AMICACINA%' THEN 'AMINOGLICOSIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TOBRAMICINA%' THEN 'AMINOGLICOSIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AZITROMICINA%' THEN 'MACROLIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CLARITROMICINA%' THEN 'MACROLIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ERITROMICINA%' THEN 'MACROLIDEO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%METRONIDAZOL%' THEN 'NITROIMIDAZOL'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TINIDAZOL%' THEN 'NITROIMIDAZOL'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ORNIDAZOL%' THEN 'NITROIMIDAZOL'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TIGECICLINA%' THEN 'GLICILCICLINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%DOXICICLINA%' THEN 'TETRACICLINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TETRACICLINA%' THEN 'TETRACICLINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%MINOCICLINA%' THEN 'TETRACICLINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%SULFAMETOXAZOL%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%TRIMETOPRIMA%' THEN 'SULFONAMIDA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%FOSFOMICINA%' THEN 'FOSFOMICINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CLINDAMICINA%' THEN 'LINCOSAMIDA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%RIFAMPICINA%' THEN 'RIFAMICINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CLORANFENICOL%' THEN 'ANFENICOL'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%NITROFURANTOINA%' THEN 'NITROFURANTOINA'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%MUPIROCINA%' THEN 'MUPIROCINA'
 ELSE 'OUTRO'
 END AS CLASSE,
 CASE 
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%MEROPENEM%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%IMIPENEM%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%DORIPENEM%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ERTAPENEM%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%POLIMIXINA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%COLISTIN%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTAZIDIMA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%AVIBACTAM%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ZAVICEFTA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTOLOZANA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ZERBAXA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TIGECICLINA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%LINEZOLIDA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TEDIZOLIDA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%DAPTOMICINA%' THEN 'CRITICO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%VANCOMICINA%' AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%DOSAGEM%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TEICOPLANINA%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%PIPERACILINA%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFEPIME%' OR UPPER(TP.DS_TIP_PRESC) LIKE '%CEFEPIMA%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTAZIDIMA%' AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%AVIBACTAM%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CIPROFLOXACIN%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%LEVOFLOXACIN%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%MOXIFLOXACIN%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AMICACINA%' THEN 'RESTRITO'
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AZTREONAM%' THEN 'RESTRITO'
 ELSE 'PADRAO'
 END AS CRITICIDADE,
 CASE 
 WHEN TRUNC(SYSDATE - PM.DT_PRE_MED) >= 10 THEN 'URGENTE USO MAIOR 10 DIAS'
 WHEN TRUNC(SYSDATE - PM.DT_PRE_MED) >= 7 THEN 'ALERTA USO PROLONGADO'
 WHEN TRUNC(SYSDATE - PM.DT_PRE_MED) >= 5 THEN 'ATENCAO 5 DIAS OU MAIS'
 ELSE 'OK'
 END AS ALERTA_TEMPO
FROM PACIENTE P
 INNER JOIN ATENDIME A ON A.CD_PACIENTE = P.CD_PACIENTE
 INNER JOIN PRE_MED PM ON PM.CD_ATENDIMENTO = A.CD_ATENDIMENTO
 INNER JOIN ITPRE_MED IT ON IT.CD_PRE_MED = PM.CD_PRE_MED
 INNER JOIN TIP_PRESC TP ON TP.CD_TIP_PRESC = IT.CD_TIP_PRESC
 LEFT JOIN LEITO L ON L.CD_LEITO = A.CD_LEITO
 LEFT JOIN UNID_INT UI ON UI.CD_UNID_INT = L.CD_UNID_INT
 LEFT JOIN SETOR S ON S.CD_SETOR = UI.CD_SETOR
 LEFT JOIN PRESTADOR PREST ON PREST.CD_PRESTADOR = PM.CD_PRESTADOR
 LEFT JOIN ESPECIALID ESP ON ESP.CD_ESPECIALID = A.CD_ESPECIALID
 LEFT JOIN UNI_PRO UP ON UP.CD_UNI_PRO = IT.CD_UNI_PRO
 LEFT JOIN TIP_FRE TF ON TF.CD_TIP_FRE = IT.CD_TIP_FRE
 LEFT JOIN FOR_APL FA ON FA.CD_FOR_APL = IT.CD_FOR_APL
WHERE A.CD_MULTI_EMPRESA = 40
 AND A.TP_ATENDIMENTO = 'I'
 AND A.DT_ALTA IS NULL
 AND IT.SN_CANCELADO = 'N'
 AND PM.DT_PRE_MED >= TRUNC(SYSDATE - 30)
 -- Exclusões gerais de exames e dosagens
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%DOSAGEM%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%EXAME%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%GASOMETRIA%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%GASOMETRO%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%COLETA%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%LABORATORIO%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%LEVONORGESTREL%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%LEVODOPA%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%POTASSIO%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%SODIO%'
 AND UPPER(TP.DS_TIP_PRESC) NOT LIKE '%CALCIO%'
 -- Filtros específicos de antimicrobianos
 AND (
 UPPER(TP.DS_TIP_PRESC) LIKE '%MEROPENEM%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%ERTAPENEM%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%IMIPENEM%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%DORIPENEM%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%POLIMIXINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%COLISTIN%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%COLISTIMETATO%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%VANCOMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%TEICOPLANINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%DAPTOMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%LINEZOLIDA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%TEDIZOLIDA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTAZIDIMA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%AVIBACTAM%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%ZAVICEFTA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTOLOZANA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%ZERBAXA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%AZTREONAM%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%AZACTAM%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTRIAXONA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFEPIME%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFEPIMA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFOTAXIMA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFAZOLINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFALEXINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFALOTINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CEFUROXIMA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%PIPERACILINA%' OR
 (UPPER(TP.DS_TIP_PRESC) LIKE '%AMOXICILINA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%CLAVULANATO%') OR
 (UPPER(TP.DS_TIP_PRESC) LIKE '%AMPICILINA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%SULBACTAM%') OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CIPROFLOXACIN%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%LEVOFLOXACIN%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%MOXIFLOXACIN%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%NORFLOXACIN%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%OFLOXACIN%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%GENTAMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%AMICACINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%TOBRAMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%AZITROMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CLARITROMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%ERITROMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%METRONIDAZOL%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%TINIDAZOL%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%DOXICICLINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%TETRACICLINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%MINOCICLINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%TIGECICLINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%FOSFOMICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CLINDAMICINA%' OR
 (UPPER(TP.DS_TIP_PRESC) LIKE '%SULFAMETOXAZOL%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%TRIMETOPRIMA%') OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%MUPIROCINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%OXACILINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%PENICILINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%AMPICILINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%RIFAMPICINA%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%CLORANFENICOL%' OR
 UPPER(TP.DS_TIP_PRESC) LIKE '%NITROFURANTOINA%'
 )
ORDER BY 
 CASE 
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTAZIDIMA%' AND UPPER(TP.DS_TIP_PRESC) LIKE '%AVIBACTAM%' THEN 1
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ZAVICEFTA%' THEN 1
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%CEFTOLOZANA%' THEN 1
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%ZERBAXA%' THEN 1
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%MEROPENEM%' THEN 2
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%POLIMIXINA%' THEN 2
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%COLISTIN%' THEN 2
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%TIGECICLINA%' THEN 2
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%LINEZOLIDA%' THEN 2
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%VANCOMICINA%' THEN 3
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%PIPERACILINA%' THEN 3
 WHEN UPPER(TP.DS_TIP_PRESC) LIKE '%AZTREONAM%' THEN 3
 ELSE 4
 END,
 PM.DT_PRE_MED DESC, 
 PM.HR_PRE_MED DESC
