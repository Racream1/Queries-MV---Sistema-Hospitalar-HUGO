# üìã MAPEAMENTO DA ESTRUTURA DE ANTIMICROBIANOS - MV/DBAMV
## Hospital: HUGO (CD_MULTI_EMPRESA = 40)
### Data do Mapeamento: Janeiro/2025

---

## üóÇÔ∏è VIS√ÉO GERAL DAS TABELAS

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        HIERARQUIA DE TABELAS ATB                            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ  ATENDIME (Interna√ß√£o)                                                      ‚îÇ
‚îÇ      ‚îÇ                                                                      ‚îÇ
‚îÇ      ‚îú‚îÄ‚îÄ PRE_MED (Prescri√ß√£o M√©dica) ‚îÄ‚îÄ‚îÄ 53 colunas                        ‚îÇ
‚îÇ      ‚îÇ       ‚îÇ                                                              ‚îÇ
‚îÇ      ‚îÇ       ‚îî‚îÄ‚îÄ ITPRE_MED (Itens Prescritos) ‚îÄ‚îÄ‚îÄ 93 colunas               ‚îÇ
‚îÇ      ‚îÇ               ‚îÇ                                                      ‚îÇ
‚îÇ      ‚îÇ               ‚îú‚îÄ‚îÄ TIP_PRESC (Tipos de Prescri√ß√£o) ‚îÄ‚îÄ‚îÄ 99 colunas    ‚îÇ
‚îÇ      ‚îÇ               ‚îÇ       ‚îî‚îÄ‚îÄ CD_TIP_ESQ = 'ATB' (631 registros)        ‚îÇ
‚îÇ      ‚îÇ               ‚îÇ                                                      ‚îÇ
‚îÇ      ‚îÇ               ‚îú‚îÄ‚îÄ PRODUTO (Medicamentos)                             ‚îÇ
‚îÇ      ‚îÇ               ‚îÇ       ‚îî‚îÄ‚îÄ ANT_PRO ‚Üí ANTIMICROB (211 cadastrados)    ‚îÇ
‚îÇ      ‚îÇ               ‚îÇ                                                      ‚îÇ
‚îÇ      ‚îÇ               ‚îú‚îÄ‚îÄ TIP_FRE (Frequ√™ncias) ‚îÄ‚îÄ‚îÄ 387 usadas em ATB       ‚îÇ
‚îÇ      ‚îÇ               ‚îÇ                                                      ‚îÇ
‚îÇ      ‚îÇ               ‚îî‚îÄ‚îÄ FOR_APL (Vias) ‚îÄ‚îÄ‚îÄ 41 usadas em ATB               ‚îÇ
‚îÇ      ‚îÇ                                                                      ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ PW_DOCUMENTO_CLINICO (Documentos Cl√≠nicos)                        ‚îÇ
‚îÇ              ‚îÇ                                                              ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ Documento 709: Ficha de Antimicrobianos                   ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ CD_OBJETO 29190: Evolu√ß√£o SCIH/Infectologia               ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ CD_OBJETO 29121: Evolu√ß√£o Farm√°cia Cl√≠nica                ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä TABELA 1: PRE_MED (Prescri√ß√£o M√©dica)
**Total: 53 colunas**

### Colunas Principais:
| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_PRE_MED | NUMBER | **PK** - C√≥digo da prescri√ß√£o |
| CD_ATENDIMENTO | NUMBER | **FK** ‚Üí ATENDIME |
| CD_PRESTADOR | NUMBER | **FK** ‚Üí PRESTADOR (m√©dico) |
| CD_UNID_INT | NUMBER | **FK** ‚Üí UNID_INT |
| DT_PRE_MED | DATE | Data da prescri√ß√£o |
| HR_PRE_MED | DATE | Data/hora completa |
| DS_EVOLUCAO | LONG | Texto da evolu√ß√£o |
| TP_PRE_MED | VARCHAR2(1) | Tipo: M=M√©dica, O=Outros |
| CD_OBJETO | NUMBER | FK ‚Üí Formul√°rio/Objeto |
| CD_DOCUMENTO_CLINICO | NUMBER | FK ‚Üí PW_DOCUMENTO_CLINICO |
| SN_FECHADO | VARCHAR2(1) | Prescri√ß√£o fechada? |
| DT_VALIDADE | DATE | Data de validade |

---

## üìä TABELA 2: ITPRE_MED (Itens da Prescri√ß√£o)
**Total: 93 colunas**

### Colunas Principais:
| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_ITPRE_MED | NUMBER | **PK** - C√≥digo do item |
| CD_PRE_MED | NUMBER | **FK** ‚Üí PRE_MED |
| CD_TIP_ESQ | VARCHAR2(3) | Esquema: **ATB**, DIE, MED |
| CD_TIP_PRESC | NUMBER | **FK** ‚Üí TIP_PRESC |
| CD_PRODUTO | NUMBER | **FK** ‚Üí PRODUTO |
| CD_TIP_FRE | NUMBER | **FK** ‚Üí TIP_FRE (frequ√™ncia) |
| CD_FOR_APL | VARCHAR2(4) | **FK** ‚Üí FOR_APL (via) |
| QT_ITPRE_MED | NUMBER | Dose prescrita |
| CD_UNI_PRO | NUMBER | **FK** ‚Üí UNI_PRO (unidade) |
| QT_DIAS | NUMBER | Dura√ß√£o em dias |
| SN_CANCELADO | VARCHAR2(1) | Item cancelado? |
| DH_INICIAL | DATE | In√≠cio do uso |
| DH_FINAL | DATE | Fim do uso |
| SN_ATM_PRORROGACAO | VARCHAR2(1) | Flag prorroga√ß√£o ATB |
| DS_JUSTIFICATIVA | VARCHAR2(2000) | Justificativa |
| CD_PRESTADOR | NUMBER | M√©dico prescritor |

---

## üìä TABELA 3: TIP_PRESC (Tipos de Prescri√ß√£o)
**Total: 99 colunas | 631 registros ATB | 185 produtos √∫nicos**

### Colunas Principais:
| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_TIP_PRESC | NUMBER | **PK** |
| CD_TIP_ESQ | VARCHAR2(3) | Esquema: **ATB** |
| DS_TIP_PRESC | VARCHAR2(60) | Nome do tipo |
| CD_PRODUTO | NUMBER | **FK** ‚Üí PRODUTO |
| SN_JUSTIFICATIVA | VARCHAR2(1) | Exige justificativa? |
| SN_ATIVO | VARCHAR2(1) | Ativo/Inativo |

### Estat√≠sticas:
- **613 ativos** / 17 inativos
- **5 exigem justificativa**
- **185 produtos ATB √∫nicos**

---

## üìä TABELA 4: ANTIMICROB (Cadastro de Antimicrobianos)
**Total: 211 antimicrobianos cadastrados**

### Estrutura:
| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_ANTIMICROB | VARCHAR2(4) | **PK** |
| NM_ANTIMICROB | VARCHAR2(30) | Nome do ATB |
| NR_DIAS_LIBERADO | NUMBER | Dias liberados |
| NR_DDD | NUMBER | Dose Di√°ria Definida |
| SN_RESTRITO | VARCHAR2(1) | **Uso restrito?** |
| SN_VIGILANCIA | VARCHAR2(1) | **Sob vigil√¢ncia?** |

### Classifica√ß√£o:
- üî¥ **17 RESTRITOS**: Anfotericina B lipossomal, RIPE, Ganciclovir, Sulfadiazina, Pirimetamina, Tobramicina
- üü° **79 SOB VIGIL√ÇNCIA**: Carbapen√™micos, Glicopept√≠deos, Polimixinas, Fluoroquinolonas
- üîó **60 com produtos vinculados**

---

## üìä TABELA 5: ANT_PRO (V√≠nculo Antimicrobiano ‚Üî Produto)

| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_PRODUTO | NUMBER | **FK** ‚Üí PRODUTO |
| CD_ANTIMICROB | VARCHAR2(4) | **FK** ‚Üí ANTIMICROB |
| QT_GRAMA | NUMBER | Quantidade em gramas |
| NR_DIAS_LIBERADO | NUMBER | Override dias |
| SN_IMPEDE_LIBERACAO | VARCHAR2(1) | Impede libera√ß√£o? |

---

## üìä TABELA 6: TIP_FRE (Frequ√™ncias de Administra√ß√£o)
**387 frequ√™ncias usadas em ATB**

### TOP 10 Mais Usadas:
| Rank | Frequ√™ncia | Prescri√ß√µes |
|------|------------|-------------|
| 1 | 6/6H | 600.081 |
| 2 | AGORA | 317.748 |
| 3 | 12/12H | 270.590 |
| 4 | 8/8H | 259.565 |
| 5 | 24/24H | 204.443 |
| 6 | 8/8H (hor√°rios espec√≠ficos) | 178.181 |
| 7 | 12/12H (10/22) | 200.513 |
| 8 | 8/8H (00/06/16) | 172.336 |
| 9 | 8/8H (06/14/22) | 151.686 |
| 10 | 12/12H padr√£o | 145.370 |

---

## üìä TABELA 7: FOR_APL (Vias de Administra√ß√£o)
**41 vias usadas em ATB**

### Principais:
| Via | Descri√ß√£o | Prescri√ß√µes |
|-----|-----------|-------------|
| **EV** | Endovenoso | 2.507.474 |
| **IV** | Intravenoso | 1.767.530 |
| **VO** | Via Oral | 335.170 |
| **IM** | Intramuscular | 59.582 |
| **SE** | Sonda Nasoent√©rica | 55.612 |
| **TO** | T√≥pico | 22.770 |
| **BI** | Bomba de Infus√£o | 18.658 |

> ‚ö†Ô∏è **Nota**: EV e IV s√£o duplicidades (mesma via) - total IV ‚âà 4,3 milh√µes

---

## üìã DOCUMENTO 709: FICHA DE ANTIMICROBIANOS

### Campos Principais (DS_IDENTIFICADOR):

| Identificador | Descri√ß√£o | Uso na Query |
|---------------|-----------|--------------|
| `PAR_CD_ITPRE_MED` | V√≠nculo com ITPRE_MED | Join com prescri√ß√£o |
| `Metadado_57_722_1` | **INDICA√á√ÉO/JUSTIFICATIVA** | Campo texto livre |
| `radioUsoProfTerapeutico_1` | Uso PROFIL√ÅTICO | true/false |
| `radioUsoProfTerapeutico_2` | Uso TERAP√äUTICO | true/false |
| `INFECCAO_HOSPITALAR_1` | Infec√ß√£o Hospitalar | true/false |
| `INFECCAO_COMUNITARIA_1` | Infec√ß√£o Comunit√°ria | true/false |
| `radioCultura_1` | Cultura coletada SIM | true/false |
| `radioCultura_2` | Cultura coletada N√ÉO | true/false |
| `texto_antimicr_1` | **DOSE/DIA** | Campo texto |
| `texto_antimicr_2` | **POSOLOGIA** | Campo texto |
| `texto_antimicr_3` | **TEMPO SOLICITADO** | Campo texto |
| `radioInsuficRenal_1/2` | Insuf. Renal S/N | true/false |
| `radioInsufichepatica_1/2` | Insuf. Hep√°tica S/N | true/false |
| `radioObesidade_1/2` | Obesidade S/N | true/false |

### Como Extrair Dados da Ficha:
```sql
SELECT 
    TRIM(MAX(CASE WHEN ec.DS_IDENTIFICADOR = 'Metadado_57_722_1' 
        THEN TO_CHAR(DBMS_LOB.SUBSTR(erc.LO_VALOR, 500, 1)) END)) AS INDICACAO,
    TRIM(MAX(CASE WHEN ec.DS_IDENTIFICADOR = 'radioUsoProfTerapeutico_1' 
        THEN TO_CHAR(DBMS_LOB.SUBSTR(erc.LO_VALOR, 10, 1)) END)) AS USO_PROFILATICO,
    -- ... demais campos
FROM DBAMV.PW_DOCUMENTO_CLINICO dc
JOIN DBAMV.PW_EDITOR_CLINICO pec ON pec.CD_DOCUMENTO_CLINICO = dc.CD_DOCUMENTO_CLINICO
JOIN DBAMV.EDITOR_REGISTRO_CAMPO erc ON erc.CD_REGISTRO = pec.CD_EDITOR_REGISTRO
JOIN DBAMV.EDITOR_CAMPO ec ON ec.CD_CAMPO = erc.CD_CAMPO
WHERE pec.CD_DOCUMENTO = 709
```

---

## üîó RELACIONAMENTOS PRINCIPAIS

```sql
-- Prescri√ß√£o ‚Üí Item ‚Üí Tipo ATB
ITPRE_MED.CD_PRE_MED ‚Üí PRE_MED.CD_PRE_MED
ITPRE_MED.CD_TIP_PRESC ‚Üí TIP_PRESC.CD_TIP_PRESC (WHERE CD_TIP_ESQ = 'ATB')

-- Item ‚Üí Produto ‚Üí Antimicrobiano
ITPRE_MED.CD_PRODUTO ‚Üí PRODUTO.CD_PRODUTO
ANT_PRO.CD_PRODUTO ‚Üí PRODUTO.CD_PRODUTO
ANT_PRO.CD_ANTIMICROB ‚Üí ANTIMICROB.CD_ANTIMICROB

-- Item ‚Üí Frequ√™ncia e Via
ITPRE_MED.CD_TIP_FRE ‚Üí TIP_FRE.CD_TIP_FRE
ITPRE_MED.CD_FOR_APL ‚Üí FOR_APL.CD_FOR_APL

-- Ficha ATB ‚Üí Item Prescrito
EDITOR_REGISTRO_CAMPO.LO_VALOR (PAR_CD_ITPRE_MED) ‚Üí ITPRE_MED.CD_ITPRE_MED
```

---

## üìå OBJETOS/DOCUMENTOS CL√çNICOS IMPORTANTES

| CD_OBJETO | Descri√ß√£o | Uso |
|-----------|-----------|-----|
| - | Documento 709 | Ficha de Antimicrobianos |
| 29190 | Evolu√ß√£o SCIH | Auditoria Infectologia |
| 29121 | Evolu√ß√£o Farm√°cia | Auditoria Farm√°cia Cl√≠nica |
| 1088 | Evolu√ß√£o Nutricional | Dados antropom√©tricos |

---

## ‚úÖ CONCLUS√ÉO

Este mapeamento permite:
1. **Rastrear prescri√ß√µes ATB** desde a interna√ß√£o at√© o item espec√≠fico
2. **Extrair dados da ficha de justificativa** (documento 709)
3. **Identificar ATBs restritos e sob vigil√¢ncia** para stewardship
4. **Monitorar auditorias** da Infectologia e Farm√°cia
5. **Calcular m√©tricas** de uso (frequ√™ncias, vias, dura√ß√£o)

---

*Documento gerado em: Janeiro/2025*
*Hospital: HUGO - CD_MULTI_EMPRESA = 40*


MAPEAMENTO DE ATBS X FARM√ÅCIA 

# üì¶ MAPEAMENTO DA ESTRUTURA DE FARM√ÅCIA/DISPENSA√á√ÉO - MV/DBAMV
## Hospital: HUGO (CD_MULTI_EMPRESA = 40)
### Data do Mapeamento: Janeiro/2025

---

## üóÇÔ∏è VIS√ÉO GERAL DAS TABELAS DE FARM√ÅCIA

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    HIERARQUIA DE TABELAS - FARM√ÅCIA                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                                             ‚îÇ
‚îÇ  PRE_MED (Prescri√ß√£o)                                                       ‚îÇ
‚îÇ      ‚îÇ                                                                      ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ ITPRE_MED (Item Prescrito)                                        ‚îÇ
‚îÇ              ‚îÇ                                                              ‚îÇ
‚îÇ              ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                   ‚îÇ
‚îÇ              ‚îÇ                                          ‚îÇ                   ‚îÇ
‚îÇ              ‚ñº                                          ‚ñº                   ‚îÇ
‚îÇ      SOLSAI_PRO (Solicita√ß√£o/Sa√≠da)            MVTO_ESTOQUE (Movimento)    ‚îÇ
‚îÇ      42.7M registros                            37.3M registros            ‚îÇ
‚îÇ              ‚îÇ                                          ‚îÇ                   ‚îÇ
‚îÇ              ‚ñº                                          ‚ñº                   ‚îÇ
‚îÇ      ITSOLSAI_PRO (Itens)                      ITMVTO_ESTOQUE (Itens)      ‚îÇ
‚îÇ      158M registros                             134M registros             ‚îÇ
‚îÇ              ‚îÇ                                          ‚îÇ                   ‚îÇ
‚îÇ              ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                   ‚îÇ
‚îÇ                             ‚îÇ                                               ‚îÇ
‚îÇ                             ‚ñº                                               ‚îÇ
‚îÇ                      CUSTO_MEDIO                                           ‚îÇ
‚îÇ                      1.9M registros                                        ‚îÇ
‚îÇ                      (CD_MULTI_EMPRESA = 1)                                ‚îÇ
‚îÇ                                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìä TABELA: SOLSAI_PRO (Solicita√ß√£o/Sa√≠da de Produtos)
**Total: 57 colunas | 42.7M registros**

### Campos Principais:
| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_SOLSAI_PRO | NUMBER | **PK** |
| TP_SOLSAI_PRO | VARCHAR2(1) | **Tipo da solicita√ß√£o** |
| TP_SITUACAO | VARCHAR2(1) | **Status** |
| CD_ATENDIMENTO | NUMBER | FK ‚Üí ATENDIME |
| CD_PRE_MED | NUMBER | FK ‚Üí PRE_MED |
| CD_ESTOQUE | NUMBER | FK ‚Üí Estoque origem |
| CD_SETOR | NUMBER | FK ‚Üí Setor solicitante |
| CD_UNID_INT | NUMBER | FK ‚Üí Unidade de interna√ß√£o |
| DT_SOLSAI_PRO | DATE | Data da solicita√ß√£o |
| HR_SOLSAI_PRO | DATE | Data/hora completa |
| CD_PRESTADOR | NUMBER | M√©dico solicitante |
| SN_URGENTE | VARCHAR2(1) | Solicita√ß√£o urgente? |

### Tipos de Solicita√ß√£o (TP_SOLSAI_PRO):
| C√≥digo | Descri√ß√£o | Volume (30 dias) |
|--------|-----------|------------------|
| **P** | Prescri√ß√£o | 735.414 |
| **S** | Sa√≠da/Solicita√ß√£o | 23.799 |
| **C** | Consumo | 14.039 |
| **E** | Empr√©stimo | 10.604 |
| **D** | Devolu√ß√£o | 150 |
| **G** | Geral | 376 |
| **L** | Livre | 654 |

### Status (TP_SITUACAO):
| C√≥digo | Descri√ß√£o | Uso |
|--------|-----------|-----|
| **S** | Solicitado | Aguardando atendimento |
| **P** | Pendente | Em processamento |
| **A** | Atendido | Dispensado |
| **C** | Cancelado | Cancelado |

---

## üìä TABELA: ITSOLSAI_PRO (Itens da Solicita√ß√£o)
**Total: 39 colunas | 158M registros**

### Campos Principais:
| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_ITSOLSAI_PRO | NUMBER | **PK** |
| CD_SOLSAI_PRO | NUMBER | **FK** ‚Üí SOLSAI_PRO |
| CD_PRODUTO | NUMBER | **FK** ‚Üí PRODUTO |
| CD_ITPRE_MED | NUMBER | **FK** ‚Üí ITPRE_MED ‚≠ê |
| QT_SOLICITADO | NUMBER | Quantidade solicitada |
| QT_ATENDIDA | NUMBER | Quantidade dispensada |
| QT_PRESCRITA | NUMBER | Quantidade da prescri√ß√£o |
| SN_ATENDIDO | VARCHAR2(1) | Flag atendido |
| CD_TIP_PRESC | NUMBER | FK ‚Üí TIP_PRESC |
| CD_TIP_FRE | NUMBER | FK ‚Üí TIP_FRE (frequ√™ncia) |
| CD_LOTE | VARCHAR2(500) | Lote do produto |
| DT_VALIDADE | DATE | Validade do lote |
| NR_DIAS | NUMBER | Dias de tratamento |

> ‚≠ê **CD_ITPRE_MED** √© o campo chave para vincular dispensa√ß√£o com prescri√ß√£o!

---

## üìä TABELA: CUSTO_MEDIO
**Total: 18 colunas | 1.9M registros**

### Campos Principais:
| Coluna | Tipo | Descri√ß√£o |
|--------|------|-----------|
| CD_CUSTO_MEDIO | NUMBER | **PK** |
| CD_PRODUTO | NUMBER | **FK** ‚Üí PRODUTO |
| CD_MULTI_EMPRESA | NUMBER | **Empresa** (usar = 1) |
| VL_CUSTO_MEDIO | NUMBER | **Custo m√©dio unit√°rio** |
| DH_CUSTO_MEDIO | DATE | Data/hora do c√°lculo |
| DT_CUSTO | DATE | Data refer√™ncia |
| QT_ESTOQUE_ANTES | NUMBER | Estoque antes |
| QT_ENTRADA | NUMBER | Quantidade entrada |
| VL_ENTRADA | NUMBER | Valor da entrada |

### ‚ö†Ô∏è IMPORTANTE - CD_MULTI_EMPRESA para Custos:
```
CD_MULTI_EMPRESA = 1  ‚Üí Almoxarifado Central (HUGOL) - TEM CUSTOS
CD_MULTI_EMPRESA = 40 ‚Üí HUGO - SEM CUSTOS DIRETOS

Para obter custos de ATB no HUGO, usar CD_MULTI_EMPRESA = 1
```

---

## üîó RELACIONAMENTOS FARM√ÅCIA ‚Üî PRESCRI√á√ÉO

```sql
-- Prescri√ß√£o ‚Üí Solicita√ß√£o ‚Üí Dispensa√ß√£o
PRE_MED.CD_PRE_MED ‚Üí SOLSAI_PRO.CD_PRE_MED
ITPRE_MED.CD_ITPRE_MED ‚Üí ITSOLSAI_PRO.CD_ITPRE_MED

-- Item Solicitado ‚Üí Produto ‚Üí Custo
ITSOLSAI_PRO.CD_PRODUTO ‚Üí PRODUTO.CD_PRODUTO
PRODUTO.CD_PRODUTO ‚Üí CUSTO_MEDIO.CD_PRODUTO (WHERE CD_MULTI_EMPRESA = 1)

-- Produto ‚Üí Antimicrobiano
PRODUTO.CD_PRODUTO ‚Üí ANT_PRO.CD_PRODUTO ‚Üí ANTIMICROB.CD_ANTIMICROB
```

---

## üìã QUERY: DISPENSA√á√ÉO DE ATB COM CUSTO

```sql
SELECT 
    -- Solicita√ß√£o
    sp.CD_SOLSAI_PRO,
    TO_CHAR(sp.HR_SOLSAI_PRO, 'DD/MM/YYYY HH24:MI') AS DH_SOLICITACAO,
    -- Produto/ATB
    prod.CD_PRODUTO,
    prod.DS_PRODUTO,
    atm.NM_ANTIMICROB,
    CASE WHEN atm.SN_RESTRITO = 'S' THEN 'RESTRITO' 
         WHEN atm.SN_VIGILANCIA = 'S' THEN 'VIGILANCIA' 
         ELSE 'LIVRE' END AS CLASSIFICACAO,
    -- Quantidades
    isp.QT_SOLICITADO,
    NVL(isp.QT_ATENDIDA, isp.QT_SOLICITADO) AS QT_DISPENSADA,
    -- Custo (usando empresa 1 - almoxarifado central)
    cm.VL_CUSTO_MEDIO,
    ROUND(NVL(isp.QT_ATENDIDA, isp.QT_SOLICITADO) * NVL(cm.VL_CUSTO_MEDIO, 0), 4) AS VL_TOTAL_ITEM,
    -- V√≠nculo com prescri√ß√£o
    isp.CD_ITPRE_MED,
    sp.CD_PRE_MED,
    sp.CD_ATENDIMENTO
FROM DBAMV.SOLSAI_PRO sp
JOIN DBAMV.ITSOLSAI_PRO isp ON isp.CD_SOLSAI_PRO = sp.CD_SOLSAI_PRO
JOIN DBAMV.PRODUTO prod ON prod.CD_PRODUTO = isp.CD_PRODUTO
JOIN DBAMV.ANT_PRO ap ON ap.CD_PRODUTO = prod.CD_PRODUTO
JOIN DBAMV.ANTIMICROB atm ON atm.CD_ANTIMICROB = ap.CD_ANTIMICROB
LEFT JOIN (
    SELECT CD_PRODUTO, VL_CUSTO_MEDIO,
           ROW_NUMBER() OVER (PARTITION BY CD_PRODUTO ORDER BY DH_CUSTO_MEDIO DESC) AS RN
    FROM DBAMV.CUSTO_MEDIO
    WHERE CD_MULTI_EMPRESA = 1  -- Almoxarifado central
) cm ON cm.CD_PRODUTO = prod.CD_PRODUTO AND cm.RN = 1
WHERE sp.HR_SOLSAI_PRO >= SYSDATE - 30
  AND sp.TP_SOLSAI_PRO = 'P'  -- Prescri√ß√£o
  AND sp.TP_SITUACAO IN ('S', 'A')  -- Solicitado ou Atendido
ORDER BY sp.HR_SOLSAI_PRO DESC;
```

---

## üìä INDICADORES POSS√çVEIS

### 1. Consumo Total por ATB (per√≠odo)
```sql
SELECT 
    atm.NM_ANTIMICROB,
    SUM(NVL(isp.QT_ATENDIDA, isp.QT_SOLICITADO)) AS QTD_TOTAL,
    SUM(NVL(isp.QT_ATENDIDA, isp.QT_SOLICITADO) * NVL(cm.VL_CUSTO_MEDIO, 0)) AS CUSTO_TOTAL
FROM ...
GROUP BY atm.NM_ANTIMICROB
ORDER BY CUSTO_TOTAL DESC;
```

### 2. DDD/1000 pacientes-dia
```sql
-- Consumo em DDD = (Quantidade dispensada * Dose unit√°ria) / DDD
-- Taxa = (DDD consumidas / pacientes-dia) * 1000
```

### 3. Custo por Paciente
```sql
SELECT 
    sp.CD_ATENDIMENTO,
    SUM(NVL(isp.QT_ATENDIDA, 0) * NVL(cm.VL_CUSTO_MEDIO, 0)) AS CUSTO_ATB_TOTAL
FROM ...
GROUP BY sp.CD_ATENDIMENTO;
```

### 4. Taxa de Atendimento
```sql
SELECT 
    COUNT(CASE WHEN isp.QT_ATENDIDA >= isp.QT_SOLICITADO THEN 1 END) * 100.0 / COUNT(*) AS TAXA_ATEND_COMPLETO
FROM ITSOLSAI_PRO isp
WHERE ...;
```

---

## üìù NOTAS IMPORTANTES

1. **Custo est√° na empresa 1** (almoxarifado central), n√£o na 40 (HUGO)
2. **TP_SOLSAI_PRO = 'P'** para prescri√ß√µes m√©dicas
3. **TP_SITUACAO IN ('S','A')** para itens solicitados/atendidos
4. **CD_ITPRE_MED** vincula dispensa√ß√£o com item da prescri√ß√£o
5. Valores de custo s√£o muito baixos (centavos) - provavelmente por unidade m√≠nima

---

*Documento gerado em Janeiro/2025*
